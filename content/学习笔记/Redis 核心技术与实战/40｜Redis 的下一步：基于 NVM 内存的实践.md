---

title: 40｜Redis 的下一步：基于 NVM 内存的实践
tags:
- Redis
- mindmap-plugin: basic
createdAt: 2023-05-24T21:34:18+08:00

---

- 特性

  - 能持久化保存数据
  - 读写速度比 DRAM 内存稍慢

    - DRAM：Dynamic random-access memory 动态随机存取存储器（半导体记存储器）

  - 容量大

- Optane AEP 内存条（简称 AEP 内存，Intel 2019 年 4 月份推出）

  - Memory 模式

    - 只用容量大和性能高的特性，没有启用数据持久化功能
    - 仍需配 DRAM 内存，但它是作为 AEP 内存的缓存，对应用软件不可见
    - 软件系统能使用到的内存空间，就是 AEP 内存条的空间容量

  - App Direct 模式

    - 启用持久化数据的功能
    - 此模式的 AEP 内存叫做持久化内存（Persistent Memory，PM）
    - 使用方法

      - 1. 部署 PM
      - 2. 格式化
      - 3. 挂载到服务器的一个目录下
      - 4. 在目录下创建文件，通过内存映射（mmap）的方式把文件映射到 Redis 的进程空间

- 仍需要主从集群

  - 分担读压力

- 没有了 RDB，主从复制的实现，二选一

  - 首先，增加从节点时，把全库数据拷贝到从节点上
  - 一、用写前日志，日志拷贝到从节点进行回放

    - 会带来双写问题

  - 二、主节点在 NVM 上做快照，但不写文件，从节点直接从主节点的 NVM 上通过远程内存拷贝来实现复制，需要基于 RDMA（远程内存访问） 来做

- 应用程序如何基于持久化内存恢复自身的状态？

  - 把应用程序本身的运行时状态，如堆栈等也保存到持久化内存上，需要对操作系统的内核做修改
  - 目前还没有成熟的方案（2021.09.29）
