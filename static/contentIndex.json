{"AboutTheGarden":{"title":"ğŸª´ 11ze's Garden","links":["%E5%AD%A6%E4%B9%A0/%E8%8B%B1%E8%AF%AD/%E8%8B%B1%E8%AF%AD","tags","%E7%AE%A1%E7%90%86%E8%8A%B1%E5%9B%AD/%E6%90%AD%E5%BB%BA/%E6%90%AD%E5%BB%BA%E6%95%B0%E5%AD%97%E8%8A%B1%E5%9B%AD","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98"],"tags":["å…³äº"],"content":"ğŸª´ æ¬¢è¿ä½ æ¥åˆ°æˆ‘çš„æ•°å­—èŠ±å›­\n\nè‹±è¯­\næ‰€æœ‰æ ‡ç­¾\næ­å»ºæ•°å­—èŠ±å›­\nMySQL å®æˆ˜ 45 è®²\nRedis æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜\n"},"README":{"title":"README","links":[],"tags":[],"content":"ğŸª´ 11zeâ€™s Garden Â§"},"index":{"title":"ğŸª´ 11ze's Garden","links":["%E5%AD%A6%E4%B9%A0/%E8%8B%B1%E8%AF%AD/%E8%8B%B1%E8%AF%AD","tags","%E7%AE%A1%E7%90%86%E8%8A%B1%E5%9B%AD/%E6%90%AD%E5%BB%BA/%E6%90%AD%E5%BB%BA%E6%95%B0%E5%AD%97%E8%8A%B1%E5%9B%AD","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98"],"tags":["å…³äº"],"content":"ğŸª´ æ¬¢è¿ä½ æ¥åˆ°æˆ‘çš„æ•°å­—èŠ±å›­\n\nè‹±è¯­\næ‰€æœ‰æ ‡ç­¾\næ­å»ºæ•°å­—èŠ±å›­\nMySQL å®æˆ˜ 45 è®²\nRedis æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜\n"},"å­¦ä¹ /å­¦ä¹ æ–¹æ³•":{"title":"å­¦ä¹ æ–¹æ³•","links":[],"tags":["æ•ˆç‡","å­¦ä¹ "],"content":"è´¹æ›¼å­¦ä¹ æ³• Â§\n\n\n\nmUAQX_2b0Ut3APWB-pyYSQ\n\n\n\n\nåœ¨çº¸ä¸Šå†™ä¸‹è¦å­¦ä¹ çš„çŸ¥è¯†ç‚¹\n\n\n\n\nå†™ä¸‹è‡ªå·±å¯¹äºè¿™ä¸ªçŸ¥è¯†ç‚¹æ‰€çŸ¥çš„ä¸€åˆ‡, ç„¶åå‡è£…è®²ç»™ä¸€ä¸ªå­©å­å¬\n\n\n\n\nåå¤ç†è§£: å¤ä¹ å¡ä½çš„åœ°æ–¹, ç›´åˆ°èƒ½ç”¨å¤§ç™½è¯è®²æ¸…æ¥šä¸ºæ­¢\n\n\n\n\nåœ¨ç¬¬äºŒæ­¥çš„åŸºç¡€ä¸Šè¿›è¡Œè¡¥å……å’Œç®€åŒ–, å¾ªç¯\n\n\n\n\n\né«˜æ•ˆå­¦ä¹ : æ·±åº¦, å½’çº³å’ŒåšæŒæ—¶é—´ Â§\n\n\n\n14360\n\n\n\nç³»ç»Ÿåœ°å­¦ä¹ ï¼ˆå­¦ä¹ æ¨¡æ¿ï¼‰\n\n\n\nè¿™ä¸ªæŠ€æœ¯å‡ºç°çš„èƒŒæ™¯ã€åˆè¡·å’Œè¦è¾¾åˆ°ä»€ä¹ˆæ ·çš„ç›®æ ‡æˆ–æ˜¯è¦è§£å†³ä»€ä¹ˆæ ·çš„é—®é¢˜\n\n\n\n\nè¿™ä¸ªæŠ€æœ¯çš„ä¼˜åŠ¿å’ŒåŠ£åŠ¿åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Œæˆ–è€…è¯´ï¼Œè¿™ä¸ªæŠ€æœ¯çš„ trade-off æ˜¯ä»€ä¹ˆ\n\n\n\n\nè¿™ä¸ªæŠ€æœ¯é€‚ç”¨çš„åœºæ™¯\n\n\n\n\næŠ€æœ¯çš„ç»„æˆéƒ¨åˆ†å’Œå…³é”®ç‚¹\n\n\n\n\næŠ€æœ¯çš„åº•å±‚åŸç†å’Œå…³é”®å®ç°\n\n\n\n\nå·²æœ‰çš„å®ç°å’Œå®ƒä¹‹é—´çš„å¯¹æ¯”\n\n\n\n\n\nç³»ç»Ÿå­¦ä¹ å®Œäº†ï¼Ÿä¸¾ä¸€åä¸‰\n\n\n\nè”æƒ³, æŠ½è±¡, è‡ªçœ\n\n\n\n\n\næ€»ç»“å’Œå½’çº³\n\n\n\nå­¦ä¹ çš„å¼€å§‹é˜¶æ®µï¼Œå¯ä»¥ä¸æ€¥äºæ€»ç»“å½’çº³ï¼Œä¸æ€¥äºä¸‹åˆ¤æ–­ï¼Œåšç»“è®ºï¼Œè€Œåº”è¯¥ä¿ç•™éƒ¨åˆ†çŸ¥è¯†çš„ä¸ç¡®å®šæ€§ï¼Œä¿æŒå¯¹çŸ¥è¯†çš„å¼€æ”¾çŠ¶æ€\n\n\n\n\næŠŠçœ‹åˆ°å’Œå­¦ä¹ åˆ°çš„ä¿¡æ¯ï¼Œå½’æ•´å¥½ï¼Œæ’åˆ—å¥½ï¼Œå…³è”å¥½ï¼Œæ€»ä¹‹æŠŠä¿¡æ¯ç¢ç‰‡ç»™ç»“æ„åŒ–æ‰ï¼Œç„¶ååœ¨ç»“æ„åŒ–çš„ä¿¡æ¯ä¸­ï¼Œæ‰¾åˆ°è§„å¾‹ï¼Œæ‰¾åˆ°ç›¸é€šä¹‹å¤„ï¼Œæ‰¾åˆ°å…±åŒä¹‹å¤„ï¼Œè¿›è¡Œç®€åŒ–ã€å½’çº³å’Œæ€»ç»“ï¼Œæœ€ç»ˆå½¢æˆä¸€ç§å¥—è·¯ï¼Œä¸€ç§æ¨¡å¼ï¼Œä¸€ç§é€šç”¨æ–¹æ³•\n\n\n\n\n\nåˆ†äº«\n\n\n\næ¯å‘¨å†™ä¸€ä¸ª ARTSï¼šAlgorithm æ˜¯ä¸€é“ç®—æ³•é¢˜ï¼ŒReview æ˜¯è¯»ä¸€ç¯‡è‹±æ–‡æ–‡ç« ï¼ŒTechnique/Tips æ˜¯åˆ†äº«ä¸€ä¸ªå°æŠ€æœ¯ï¼ŒShare æ˜¯åˆ†äº«ä¸€ä¸ªè§‚ç‚¹\n\n\n\n\nåšæŒä¸€å¹´\n\n\n\n\næ™’å‡ºæ¥, å¯ä»¥æ˜¯å•ä¸€ç¯‡æ–‡ç« : æ¯å‘¨å­¦ä¹ æŠ¥å‘Š, å¯ä»¥æ˜¯å¤šç¯‡æ–‡ç« : åšå®¢\n\n\n\n\n\nåæ­¥å­¦ä¹ æ³• Â§\n\n\n\nã€Šè½¯æŠ€èƒ½ï¼šä»£ç ä¹‹å¤–çš„ç”Ÿå­˜æŒ‡å—ã€‹\n\n\n\n\nå¦‚ä½•å¼€å§‹â€”â€”è¦æƒ³å¼€å§‹ä½¿ç”¨è‡ªå·±æ‰€å­¦çš„ï¼Œæˆ‘éœ€è¦æŒæ¡å“ªäº›åŸºæœ¬çŸ¥è¯†ï¼Ÿ\n\n\n\n\nå­¦ç§‘èŒƒå›´â€”â€”æˆ‘ç°åœ¨å­¦çš„ä¸œè¥¿æœ‰å¤šå®å¤§ï¼Ÿæˆ‘åº”è¯¥æ€ä¹ˆåšï¼Ÿ\n\n\n\n\nåŸºç¡€çŸ¥è¯†â€”â€”ä¸æ­¢åœ¨å¼€å§‹é˜¶æ®µï¼Œè¦æƒ³ä½¿ç”¨ä¸€é¡¹ç‰¹å®šçš„æŠ€æœ¯ï¼Œæˆ‘éœ€è¦äº†è§£åŸºæœ¬çš„ç”¨æˆ·æ¡ˆä¾‹å’Œæœ€å¸¸è§çš„é—®é¢˜ï¼Œä¹Ÿéœ€è¦çŸ¥é“è‡ªå·±å­¦çš„å“ª 20% å°±èƒ½æ»¡è¶³ 80% çš„æ—¥å¸¸åº”ç”¨\n\n\n\n\næ‰§è¡Œ\n\nè¯´æ˜\n\n1 - 6 èµ°ä¸€éï¼ˆæ‰€æœ‰æ­¥éª¤éƒ½æ˜¯ä¸ºäº† 3ï¼‰\n7 - 10 é‡å¤\nå…ˆå®Œæ•´è¿‡ä¸€éå†å°è¯•ä¼˜åŒ–æˆè‡ªå·±çš„å­¦ä¹ æ–¹æ³•\n\n\næ­¥éª¤\n\n\n\näº†è§£å…¨å±€ï¼šç½‘ä¸Šæœç´¢å…³é”®å­—\n\n\n\n\nç¡®å®šèŒƒå›´ï¼šç¼©å°åˆ°ä¸€ä¸ªç‰¹å®šçš„èŒƒå›´ï¼Œä¸€æ¬¡åªå­¦ä¸€æ ·ä¸œè¥¿ã€‚å¦‚ã€Œå­¦ä¹  C#ã€æ”¹ä¸ºã€Œå­¦ä¹  C# çš„åŸºç¡€çŸ¥è¯†ï¼ŒæŒæ¡å¦‚ä½•åˆ›å»ºä¸€ä¸ªç®€å•çš„æ§åˆ¶å°ç¨‹åºã€\n\n\n\n\nå®šä¹‰ç›®æ ‡ï¼šä¸å¥½çš„æˆåŠŸæ ‡å‡†ã€Œå®Œå­¦ä¹ äº†å…³äº C# è¯­è¨€çš„åŸºç¡€çŸ¥è¯†ã€ï¼Œå¥½çš„ã€Œæˆ‘å¯ä»¥åˆ©ç”¨ C# è¯­è¨€çš„ä¸»è¦åŠŸèƒ½å†™å‡ºä¸€ä¸ªå°çš„åº”ç”¨ç¨‹åºã€\n\n\n\n\nå¯»æ‰¾èµ„æº\n\n\n\n\nåˆ›å»ºå­¦ä¹ è®¡åˆ’ï¼šä»ç¬¬å››æ­¥æ‰¾åˆ°çš„èµ„æºçœ‹çœ‹åˆ«äººéƒ½æ˜¯æŒ‰ä»€ä¹ˆé¡ºåºæ•™çš„\n\n\n\n\nç­›é€‰èµ„æº\n\n\n\n\nå¼€å§‹å­¦ä¹ ï¼Œæµ…å°è¾„æ­¢ï¼šå¿«é€Ÿå­¦ä¹ åŸºç¡€çŸ¥è¯†ï¼Œç«‹åˆ»å¼€å§‹å®é™…æ“ä½œï¼ˆåƒç©æ¸¸æˆï¼‰\n\n\n\n\nåŠ¨æ‰‹æ“ä½œï¼Œè¾¹ç©è¾¹å­¦ï¼šå¦‚æœæˆ‘æ­£åœ¨å­¦ä¸€é—¨æ–°æŠ€æœ¯æˆ–è€…æ–°çš„ç¼–ç¨‹è¯­è¨€ï¼Œæˆ‘å¯ä»¥å…ˆåˆ›å»ºä¸€ä¸ªå°é¡¹ç›®æ¥æµ‹è¯•è¿™ä¸€æ­¥çš„æ•ˆæœï¼Œè®°å½•ä¸‹å°šæœªæ‰¾åˆ°ç­”æ¡ˆçš„é—®é¢˜\n\n\n\n\nå…¨é¢æŒæ¡ï¼Œå­¦ä»¥è‡´ç”¨ï¼šåªéœ€è¦é˜…è¯»æˆ–è§‚çœ‹ä¸å½“å‰æ‰€å­¦ç›¸å…³çš„éƒ¨åˆ†ï¼Œæ‰¾åˆ° 8 çš„é—®é¢˜ç­”æ¡ˆ\n\n\n\n\nä¹ä¸ºäººå¸ˆï¼Œèä¼šè´¯é€šï¼šæ¯”å¦‚å¯¹è¯ã€å†™åšå®¢ï¼Œåœ¨æ•´ç†è¿‡ç¨‹ä¸­å‘ç°é—®é¢˜\n\n\n\n\n\n\n"},"å­¦ä¹ /æ”¶è—æ–‡ç« ":{"title":"æ”¶è—æ–‡ç« ","links":[],"tags":["æ¨èé˜…è¯»"],"content":"æŠ€æœ¯ Â§\n\n[Linterä¸Šæ‰‹å®Œå…¨æŒ‡å— - GitHub](linter-tutorial: ğŸ‘®â€â™€ï¸ ã€ŠLinter ä¸Šæ‰‹å®Œå…¨æŒ‡å—ã€‹)\nä¸€æ–‡ææ‡‚ Redis æ¶æ„æ¼”åŒ–ä¹‹è·¯ - è…¾è®¯æŠ€æœ¯å·¥ç¨‹\nä¸€æ–‡ææ‡‚ä»€ä¹ˆæ˜¯ SaaSã€BaaSã€PaaS å’Œ IaaS - çŸ¥ä¹\n\nè§„èŒƒ Â§\n\nç¼–ç¨‹ä¸­çš„å‘½åè®¾è®¡é‚£ç‚¹äº‹ | é…· å£³ - CoolShell\n\nç»æµ Â§\n\nç»æµæœºå™¨æ˜¯æ€æ ·è¿è¡Œçš„ (æ—¶é•¿30åˆ†é’Ÿ) Ray Dalio - YouTube\n\næ²Ÿé€š Â§\n\nX-Y Problem | é…· å£³ - CoolShell\nä½ ä¼šé—®é—®é¢˜å—ï¼Ÿ | é…· å£³ - CoolShell\n"},"å­¦ä¹ ç¬”è®°/Rate-Limit":{"title":"Rate Limit","links":[],"tags":["å¼€å‘","è®¾è®¡","ç¼–ç¨‹"],"content":"åŠŸèƒ½ Â§\né™åˆ¶æ¥å£è¯·æ±‚æ•°\nç¼“å­˜æ•°æ®æ ¼å¼ Â§\nkey: {\n  current_count: number; // ä¹Ÿå¯ä»¥ä¸è¦è¯¥å­—æ®µï¼Œæ¯æ¬¡è¯·æ±‚éƒ½ç®—ä¸€æ¬¡é˜Ÿåˆ—é•¿åº¦\n  started_at: date;\n  request_time_queue: date[];\n  time_range: number; // æ—¶é—´çª—å£å¤§å°\n  count_limit: number;\n}\nå®ç°æµç¨‹ Â§\n\nè¯·æ±‚è¿›æ¥\næ‹¼æ¥å‡º key\næŸ¥æ‰¾ key å¯¹åº”çš„ç¼“å­˜\nå–å‡ºé˜Ÿå¤´ï¼Œè·Ÿå½“å‰æ—¶é—´æ¯”è¾ƒ\na. è‹¥è¶…å‡ºæ—¶é—´çª—å£ï¼Œåˆ™ç§»é™¤ï¼Œç»§ç»­å–ä¸‹ä¸€ä¸ª\næŸ¥çœ‹å½“å‰ç´¯ç§¯è¯·æ±‚æ•°é‡\nè·Ÿ limit æ¯”è¾ƒï¼Œè‹¥å¤§äºç­‰äºï¼Œæ‹’ç»è¯·æ±‚\nè‹¥å°äº\na. å°†å½“å‰æ—¶é—´åŠ å…¥é˜Ÿåˆ—\nb. å½“å‰è¯·æ±‚æ•°é‡ + 1\n"},"å­¦ä¹ ç¬”è®°/æŠ¢çº¢åŒ…ç³»ç»Ÿ":{"title":"æŠ¢çº¢åŒ…ç³»ç»Ÿ","links":[],"tags":["æŠ¢çº¢åŒ…","idea"],"content":"\nä¸èƒ½è¶…æŠ¢\nå‰©ä½™çš„åˆ°æœŸéœ€è¦è¿”è¿˜\né€šå¸¸ä½¿ç”¨çš„è§£å†³é«˜å¹¶å‘é—®é¢˜æ–¹æ¡ˆ\n\næ–¹æ¡ˆä¸€ï¼šä½¿ç”¨å†…å­˜æ“ä½œæ›¿ä»£å®æ—¶çš„ DB äº‹åŠ¡æ“ä½œ Â§\nå¯èƒ½ä¸¢æ•°æ®\næ–¹æ¡ˆäºŒï¼šä½¿ç”¨ä¹è§‚é”æ›¿ä»£æ‚²è§‚é” Â§\nåŒæ—¶æŠ¢çš„åªèƒ½æœ‰ä¸€ä¸ªèƒ½æˆåŠŸï¼Œå¯èƒ½æ‰‹æ…¢çš„åè€Œèƒ½æŠ¢åˆ°\nå¾®ä¿¡çº¢åŒ…ç³»ç»Ÿçš„é«˜å¹¶å‘è§£å†³æ–¹æ¡ˆ\næ–¹æ¡ˆä¸‰ï¼šå°†å…³äºåŒä¸€ä¸ªçº¢åŒ…çš„æ‰€æœ‰è¯·æ±‚èšåˆåˆ°åŒä¸€ä¸ª Â§\nåŒç»´åº¦åº“è¡¨è®¾è®¡ï¼šdb_xx.t_y_dd xx/y çº¢åŒ… ID çš„ hash å€¼åä¸‰ä½ï¼Œdd çš„å–å€¼èŒƒå›´ 01ï½31ï¼Œä¸€ä¸ªæœˆæœ€å¤š 31 å¤©\né€šè¿‡åˆ†æµ + é˜Ÿåˆ— + æµæ§è§£å†³é«˜å¹¶å‘åœºæ™¯ä¸‹åº“å­˜é”ç«äº‰çš„æƒ…å†µï¼›\né€šè¿‡äº‹åŠ¡æ“ä½œä¸²è¡ŒåŒ–ä¿è¯èµ„é‡‘å®‰å…¨ï¼Œé¿å…å‡ºç°çº¢åŒ…è¶…å‘ã€æ¼å‘ã€é‡å¤å‘çš„æƒ…å†µï¼›\né€šè¿‡çº¢åŒ… ID + å¾ªç¯å¤©åŒç»´åº¦åˆ†åº“è¡¨è§„åˆ™æå‡ç³»ç»Ÿæ€§èƒ½ã€‚"},"å­¦ä¹ ç¬”è®°/ç§’æ€ç³»ç»Ÿ":{"title":"ç§’æ€ç³»ç»Ÿ","links":[],"tags":["ç§’æ€","idea"],"content":"ä¸»è¦é—®é¢˜ï¼šå¹¶å‘è¯»ã€å¹¶å‘å†™\nå…³é”®ç‚¹ Â§\n\né«˜æ€§èƒ½\nä¸€è‡´æ€§\né«˜å¯ç”¨\n\nåŸåˆ™ Â§\n\nè¯·æ±‚æ•°æ®è¦å°½é‡å°‘\n\nå‡å°‘åºåˆ—åŒ–å’Œååºåˆ—åŒ–\nå­—ç¬¦è½¬åŒ–\n\n\nè¯·æ±‚æ•°è¦å°½é‡å°‘\n\nå¦‚åœ¨è¯·æ±‚è·¯å¾„ä¸Šå°†å¤šä¸ª Javascript ç”¨é€—å·åˆå¹¶ï¼ŒæœåŠ¡ç«¯ä¸€æ¬¡æ€§è¿”å›å¤šä¸ªæ–‡ä»¶\n\n\nè·¯å¾„è¦å°½é‡çŸ­\n\nå°†å¤šä¸ªç›¸äº’å¼ºä¾èµ–çš„åº”ç”¨åˆå¹¶éƒ¨ç½²åˆ°ä¸€èµ·\n\n\nä¾èµ–è¦å°½é‡å°‘\n\nå¯ä»¥æŠŠä¾èµ–çš„æœåŠ¡å…ˆé™çº§æˆ–åœç”¨\n\n\nä¸è¦æœ‰å•ç‚¹\n\nå°†æœåŠ¡æ— çŠ¶æ€åŒ–ï¼Œè®©å®ä¾‹å¯ä»¥åŠ¨æ€ä¼¸ç¼©\næŠŠç§’æ€ç³»ç»Ÿç‹¬ç«‹å‡ºæ¥å•ç‹¬æ‰“é€ ä¸€ä¸ªç³»ç»Ÿï¼Œå¹¶ä¸”åœ¨ç³»ç»Ÿéƒ¨ç½²ä¸Šä¹Ÿç‹¬ç«‹åšä¸€ä¸ªæœºå™¨é›†ç¾¤ï¼Œé¿å…å½±å“éç§’æ€å•†å“çš„æœºå™¨\n\n\n\nåŠ¨é™åˆ†ç¦» Â§\n\næ ¹æ®æƒ…å†µæŠŠé™æ€æ•°æ®ç¼“å­˜åˆ°ç¦»ç”¨æˆ·è¿‘çš„åœ°æ–¹ï¼ˆæµè§ˆå™¨ã€CDNã€æœåŠ¡ç«¯çš„ Cacheï¼‰\nç›´æ¥ç¼“å­˜ HTTP è¿æ¥\næ€ä¹ˆåšï¼š\n\nURL å”¯ä¸€åŒ–ï¼ˆå¦‚ /id=xxxï¼‰\nåˆ†ç¦»æµè§ˆè€…ç›¸å…³çš„å› ç´ ï¼ˆæ¯”å¦‚ç™»å½•ä¿¡æ¯ï¼Œè¿™äº›é€šè¿‡åŠ¨æ€è¯·æ±‚è·å–ï¼‰\nåˆ†ç¦»æ—¶é—´å› ç´ ï¼Œä¹Ÿé€šè¿‡åŠ¨æ€è¯·æ±‚è·å–\nå¼‚æ­¥åŒ–åœ°åŸŸå› ç´ \nå»æ‰ Cookieï¼ˆè®©ç¼“å­˜çš„é™æ€æ•°æ®ä¸­ä¸å«æœ‰ Cookieï¼‰\næœåŠ¡ç«¯ï¼š\n\nç”Ÿæˆå®Œæ•´é¡µé¢\nå®¢æˆ·ç«¯è·å–åŠ¨æ€å†…å®¹\n\n\n\n\næ¶æ„æ–¹æ¡ˆ\n\nå®ä½“æœºå•æœºéƒ¨ç½²ï¼šå¤§ Cache å®¹é‡ï¼Œé«˜ç¼“å­˜å‘½ä¸­ç‡\nç»Ÿä¸€ Cache å±‚\nä¸Š CDNï¼šäºŒçº§ Cacheï¼ˆä¸€çº§å‘ç°æ²¡ç¼“å­˜æ•°æ®å°±å»äºŒçº§æ‰¾ï¼Œéƒ½æ²¡æœ‰å°±å›æºè·å–æ•°æ®å¹¶ç¼“å­˜åˆ°ä¸€çº§ã€äºŒçº§ç¼“å­˜ï¼‰\n\n\n\nçƒ­ç‚¹æ•°æ® Â§\n\né™æ€çƒ­ç‚¹æ•°æ®ï¼šèƒ½æå‰é¢„æµ‹çš„\n\né€šè¿‡å•†ä¸šæ‰‹æ®µï¼ˆå¼ºåˆ¶è®©å•†å®¶ç™»è®°ã€å¯¹ä¹°å®¶æ¯å¤©è®¿é—®çš„å•†å“è¿›è¡Œå¤§æ•°æ®è®¡ç®—ï¼‰\n\n\nåŠ¨æ€çƒ­ç‚¹æ•°æ®ï¼šä¸èƒ½æå‰é¢„æµ‹çš„\n\nï¼ˆå¼‚æ­¥ï¼‰æ”¶é›†äº¤æ˜“é“¾è·¯ä¸Šå„ä¸ªç¯èŠ‚ä¸­çš„ä¸­é—´ä»¶äº§å“çš„çƒ­ç‚¹ Keyï¼ˆNginxã€ç¼“å­˜ã€RPC æœåŠ¡æ¡†æ¶ç­‰ï¼‰\nä¸ŠæŠ¥çƒ­ç‚¹ï¼Œé€ä¼ ç»™ä¸‹æ¸¸ç³»ç»Ÿ\n\n\n\næµé‡å‰Šå³° Â§\n\næ’é˜Ÿ\nç­”é¢˜ï¼šå»¶ç¼“è¯·æ±‚ï¼Œå¹¶å¯ä»¥é˜²æ­¢ä¹°å®¶ä½¿ç”¨ç§’æ€å™¨ä½œå¼Š\nåˆ†å±‚è¿‡æ»¤ï¼šåªåœ¨å†™æ•°æ®æ—¶è¿›è¡Œå¼ºä¸€è‡´æ€§æ ¡éªŒ\n\næ€§èƒ½ä¼˜åŒ– Â§\nå½±å“ï¼š\n\nå‡å°‘çº¿ç¨‹ç­‰å¾…æ—¶é—´å½±å“ä¸å¤§\n\nå‡å°‘ CPU æ‰§è¡Œæ—¶é—´å½±å“å¤§\nçº¿ç¨‹æ•°å½±å“å¤§\n\n\nå‘ç°ç“¶é¢ˆï¼š\n\nå·¥å…·ï¼šJProfilerã€Yourkit\nCPU ä½¿ç”¨ç‡è¶…è¿‡ 95%\n\n\nä¼˜åŒ–æ–¹å¼ï¼š\nå‡å°‘ç¼–ç \n\nå‡å°‘åºåˆ—åŒ–\nJava æè‡´ä¼˜åŒ–ï¼ˆç›´æ¥è¾“å‡ºæµæ•°æ®ã€ç›´æ¥ä½¿ç”¨ Servlet å¤„ç†è¯·æ±‚ï¼‰\nå¹¶å‘è¯»ä¼˜åŒ–\n\n\n\nå‡åº“å­˜ Â§\n\nä¸‹å•å‡åº“å­˜ï¼šæ¶æ„ä¸‹å•\nä»˜æ¬¾å‡åº“å­˜ï¼šè¶…å–\né¢„æ‰£åº“å­˜ï¼ˆæœ€å¸¸è§ï¼‰ï¼šåŒæ ·å¯èƒ½æ¶æ„ä¸‹å•ï¼ˆå½±å“å°ä¸€äº›ï¼‰ï¼Œç¡®ä¿æœ€ç»ˆä¸€è‡´æ€§\n\nPlan B Â§\n\né™çº§\né™æµï¼šå®¢æˆ·ç«¯é™æµã€æœåŠ¡ç«¯é™æµ\næ‹’ç»æœåŠ¡\n"},"æ€è€ƒ/3-2-1-çš„æœ‰è¶£æƒ³æ³•":{"title":"3-2-1 çš„æœ‰è¶£æƒ³æ³•","links":[],"tags":["æƒ³æ³•","æ€è€ƒ"],"content":"å†…å®¹æ‘˜æŠ„è‡ªï¼š3-2-1\næƒ³æ³• Â§\n\n\nIf youâ€™re searching for more time this year, start with a clean slate and choose what to add to your days rather than starting with a full schedule and trying to figure out what to eliminate.\n\nå¦‚æœä½ ä»Šå¹´æ­£åœ¨å¯»æ‰¾æ›´å¤šçš„æ—¶é—´ï¼Œé‚£å°±ä»ä¸€å—å¹²å‡€çš„çŸ³æ¿å¼€å§‹ï¼Œé€‰æ‹©åœ¨ä½ çš„æ—¥å­é‡Œå¢åŠ ä»€ä¹ˆï¼Œè€Œä¸æ˜¯ä»ä¸€ä¸ªå®Œæ•´çš„æ—¶é—´è¡¨å¼€å§‹ï¼Œè¯•å›¾æ‰¾å‡ºè¦å–æ¶ˆçš„ä¸œè¥¿ã€‚\n\n\n\nI was reviewing some old notes to myself recently and I found this one:You just need to have the courage to eliminate everything that doesnâ€™t directly feed what you really want.\n\næˆ‘æœ€è¿‘å›é¡¾äº†ä¸€äº›ç»™è‡ªå·±çš„æ—§ç¬”è®°ï¼Œæˆ‘å‘ç°äº†è¿™ä¸€æ¡ï¼šä½ åªéœ€è¦æœ‰å‹‡æ°”æ¶ˆé™¤é‚£äº›ä¸èƒ½ç›´æ¥æ»¡è¶³ä½ çœŸæ­£æƒ³è¦çš„ä¸œè¥¿çš„ä¸€åˆ‡ã€‚\n\n\n\nWhen something fascinates you, pay attention to the details. The person who thinks, â€œThat was coolâ€ is a consumer. The person who thinks, â€œHow did they make something that cool?â€ is on the path to being a creator.\n\nå½“ä¸€ä»¶äº‹æƒ…è®©ä½ ç€è¿·æ—¶ï¼Œè¦æ³¨æ„ç»†èŠ‚ã€‚è®¤ä¸º â€œè¿™å¾ˆé…· â€œçš„äººæ˜¯ä¸€ä¸ªæ¶ˆè´¹è€…ã€‚è€Œè®¤ä¸º â€œä»–ä»¬æ˜¯å¦‚ä½•åšå‡ºè¿™ä¹ˆé…·çš„ä¸œè¥¿çš„ï¼Ÿâ€œçš„äººåˆ™æ˜¯åœ¨æˆä¸ºåˆ›é€ è€…çš„é“è·¯ä¸Šã€‚\n\n\n\nDonâ€™t just taste the recipe, look for the ingredients.â€\n\nä¸è¦åªæ˜¯å“å°é£Ÿè°±ï¼Œè¦å¯»æ‰¾å…¶ä¸­çš„æˆåˆ†â€ã€‚\n\n\n\nâ€œYou never change things by fighting the existing reality. To change something, build a new model that makes the existing model obsolete.â€\n\nä½ æ°¸è¿œä¸ä¼šé€šè¿‡å¯¹æŠ—ç°æœ‰çš„ç°å®æ¥æ”¹å˜äº‹æƒ…ã€‚è¦æ”¹å˜ä¸€äº›ä¸œè¥¿ï¼Œå°±è¦å»ºç«‹ä¸€ä¸ªæ–°çš„æ¨¡å¼ï¼Œä½¿ç°æœ‰çš„æ¨¡å¼å˜å¾—è¿‡æ—¶ã€‚\n\n\n\nâ€œIt doesnâ€™t make sense to continue wanting something if youâ€™re not willing to do what it takes to get it.\n\nâ€œå¦‚æœä½ ä¸æ„¿æ„åšä»»ä½•äº‹æƒ…æ¥å¾—åˆ°å®ƒï¼Œé‚£ä¹ˆç»§ç»­æƒ³è¦å®ƒæ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚\n\n\n\nâ€œThere seemed to be endless obstacles preventing me from living with my eyes open, but as I gradually followed up clue after clue it seemed that the root cause of them all was fear.â€\n\nä¼¼ä¹æœ‰æ— ç©·æ— å°½çš„éšœç¢é˜»æ­¢æˆ‘çå¼€çœ¼ç›ç”Ÿæ´»ï¼Œä½†å½“æˆ‘é€æ¸è¿½è¸ªä¸€æ¡åˆä¸€æ¡çš„çº¿ç´¢æ—¶ï¼Œä¼¼ä¹æ‰€æœ‰çš„æ ¹æºéƒ½æ˜¯ææƒ§ã€‚\n\n\n\nâ€œNever be limited by other peopleâ€™s limited imaginations. If you adopt their attitudes, then the possibility wonâ€™t exist because youâ€™ll have already shut it outâ€¦ You can hear other peopleâ€™s wisdom, but youâ€™ve got to re-evaluate the world for yourself.â€\n\næ°¸è¿œä¸è¦è¢«å…¶ä»–äººçš„æœ‰é™æƒ³è±¡åŠ›æ‰€é™åˆ¶ã€‚å¦‚æœä½ é‡‡ç”¨ä»–ä»¬çš„æ€åº¦ï¼Œé‚£ä¹ˆè¿™ç§å¯èƒ½æ€§å°±ä¸ä¼šå­˜åœ¨ï¼Œå› ä¸ºä½ å·²ç»æŠŠå®ƒæ‹’ä¹‹é—¨å¤–äº†â€¦â€¦ä½ å¯ä»¥å¬åˆ°åˆ«äººçš„æ™ºæ…§ï¼Œä½†ä½ å¿…é¡»ä¸ºè‡ªå·±é‡æ–°è¯„ä»·è¿™ä¸ªä¸–ç•Œã€‚\n\n\n\nâ€œBefore you throw more time at the problem, throw more focused action at the problem. You donâ€™t need more time, you need fewer distractions.â€\n\nåœ¨ä½ èŠ±æ›´å¤šçš„æ—¶é—´è§£å†³é—®é¢˜ä¹‹å‰ï¼Œå…ˆæŠŠæ›´å¤šçš„æ³¨æ„åŠ›é›†ä¸­åœ¨é—®é¢˜ä¸Šã€‚ä½ ä¸éœ€è¦æ›´å¤šçš„æ—¶é—´ï¼Œä½ éœ€è¦æ›´å°‘çš„å¹²æ‰°ã€‚\n\n\n\nâ€œWith the creative process, the key is to create a lot and edit a lot. Make more than you need, then remove everything that isnâ€™t exceptional.â€\n\nåœ¨åˆ›ä½œè¿‡ç¨‹ä¸­ï¼Œå…³é”®æ˜¯è¦å¤§é‡åˆ›ä½œï¼Œå¤§é‡ç¼–è¾‘ã€‚åˆ›ä½œè¶…è¿‡ä½ çš„éœ€è¦ï¼Œç„¶ååˆ é™¤ä¸€åˆ‡ä¸å‡ºä¼—çš„ä¸œè¥¿ã€‚\n\n\n\nâ€œWhen you need to learn quickly, learn from others. When you need to learn deeply, learn from experience.â€\n\nâ€œå½“ä½ éœ€è¦å¿«é€Ÿå­¦ä¹ çš„æ—¶å€™ï¼Œå‘åˆ«äººå­¦ä¹ ã€‚å½“ä½ éœ€è¦æ·±å…¥å­¦ä¹ æ—¶ï¼Œå°±ä»ç»éªŒä¸­å­¦ä¹ â€ã€‚\n\n\n\nâ€œItâ€™s rarely doing the work that is hard, itâ€™s starting the work. Once you begin, itâ€™s often less painful to continue working. This is whyâ€”in the beginningâ€”it is often more important to build the habit of getting started than it is to worry about whether or not you are doing enough.â€\n\nâ€œå¾ˆå°‘å·¥ä½œæ˜¯å›°éš¾çš„ï¼Œéš¾çš„æ˜¯å¼€å§‹å·¥ä½œã€‚ä¸€æ—¦ä½ å¼€å§‹å·¥ä½œï¼Œç»§ç»­å·¥ä½œå¾€å¾€å°±ä¸é‚£ä¹ˆç—›è‹¦äº†ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨å¼€å§‹æ—¶ï¼Œå…»æˆå¼€å§‹å·¥ä½œçš„ä¹ æƒ¯å¾€å¾€æ¯”æ‹…å¿ƒä½ æ˜¯å¦åšå¾—å¤Ÿå¤šæ›´é‡è¦ã€‚\n\n\n\nEnvision where you are headed in great detail. Donâ€™t talk yourself out of it. Donâ€™t encourage yourself to be realistic. You will have to wrestle with reality soon enough. Donâ€™t be your own bottleneck at this stage.\n\nè¯¦ç»†åœ°è®¾æƒ³ä½ è¦å»çš„åœ°æ–¹ã€‚ä¸è¦åŠè¯´è‡ªå·±æ”¾å¼ƒã€‚ä¸è¦é¼“åŠ±è‡ªå·±è¦ç°å®ä¸€ç‚¹ã€‚ä½ å°†ä¸å¾—ä¸å¾ˆå¿«ä¸ç°å®ææ–—ã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼Œä¸è¦æˆä¸ºä½ è‡ªå·±çš„ç“¶é¢ˆã€‚\n\n\n\nâ€œItâ€™s easier to ask forgiveness than it is to get permission.â€\n\nè¯·æ±‚å®½æ•æ¯”è·å¾—è®¸å¯æ›´å®¹æ˜“ã€‚\n\n\n\nâ€œEverything is a lesson. Learn enough lessons and the failures become useful.â€\n\næ¯ä»¶äº‹éƒ½æ˜¯ä¸€ä¸ªæ•™è®­ã€‚å­¦åˆ°è¶³å¤Ÿçš„æ•™è®­ï¼Œå¤±è´¥å°±ä¼šå˜å¾—æœ‰ç”¨ã€‚\n\n\n\nGreek philosopherÂ EpicurusÂ on desire and contentment: â€œDo not spoil what you have by desiring what you have not; remember that what you now have was once among the things you only hoped for.â€\n\nä¸è¦å› ä¸ºæ¸´æœ›ä½ æ²¡æœ‰çš„ä¸œè¥¿è€Œç ´åä½ æ‰€æ‹¥æœ‰çš„ä¸œè¥¿ï¼›è®°ä½ä½ ç°åœ¨æ‰€æ‹¥æœ‰çš„ä¸œè¥¿æ›¾ç»æ˜¯ä½ åªå¸Œæœ›å¾—åˆ°çš„ä¸œè¥¿ä¹‹ä¸€ã€‚\n\n\n\nâ€œA phrase I heard recently and found useful: I agree with the idea, but I disagree with the tone. Many ideas get dismissed because they are delivered in a cocky or hostile or dismissive toneâ€”or because of who delivers them. Separate substance from style.â€\n\næˆ‘æœ€è¿‘å¬åˆ°çš„ä¸€å¥è¯ï¼Œå‘ç°å¾ˆæœ‰ç”¨ï¼šæˆ‘åŒæ„è¿™ä¸ªæƒ³æ³•ï¼Œä½†æˆ‘ä¸åŒæ„è¿™ä¸ªè¯­æ°”ã€‚\nè®¸å¤šæƒ³æ³•è¢«é©³å›æ˜¯å› ä¸ºå®ƒä»¬æ˜¯ä»¥å‚²æ…¢ã€æ•Œæ„æˆ–è½»è”‘çš„è¯­æ°”æå‡ºçš„â€”æˆ–è€…æ˜¯å› ä¸ºè°æå‡ºçš„ã€‚\næŠŠå†…å®¹å’Œé£æ ¼åˆ†å¼€ã€‚\n\n\n\nScientist and systems engineer,Â Donella Meadows, on intellectual humility and learning from others: â€œRemember, always, that everything you know, and everything everyone knows, is only a model. Get your model out there where it can be viewed. Invite others to challenge your assumptions and add their own.â€\n\nâ€œæ°¸è¿œè®°ä½ï¼Œä½ æ‰€çŸ¥é“çš„ä¸€åˆ‡ï¼Œä»¥åŠæ¯ä¸ªäººæ‰€çŸ¥é“çš„ä¸€åˆ‡ï¼Œéƒ½åªæ˜¯ä¸€ä¸ªæ¨¡å‹ã€‚æŠŠä½ çš„æ¨¡å‹æ”¾åœ¨å¯ä»¥çœ‹åˆ°çš„åœ°æ–¹ã€‚é‚€è¯·å…¶ä»–äººæŒ‘æˆ˜ä½ çš„å‡è®¾å¹¶æ·»åŠ ä»–ä»¬è‡ªå·±çš„å‡è®¾ã€‚â€\n\n\n\nIs what Iâ€™m about to do today connected to what Iâ€™m going to value over the long-term?\n\næˆ‘ä»Šå¤©è¦åšçš„äº‹ä¸æˆ‘è¦é•¿æœŸé‡è§†çš„äº‹æœ‰å…³å—ï¼Ÿ\n\n\n\nâ€œWhoever has the most fun, wins.â€\n\nâ€œè°ç©å¾—æœ€å¼€å¿ƒï¼Œè°å°±æ˜¯èµ¢å®¶ã€‚â€\n\n\n\nâ€œIf you need 10 of something, make 30. Then pick the best.â€\n\nâ€œå¦‚æœä½ éœ€è¦ 10 ä¸ªä¸œè¥¿ï¼Œå°±åš 30 ä¸ªã€‚ç„¶åæŒ‘é€‰æœ€å¥½çš„ã€‚â€\n\n\n\nâ€œMany people wonâ€™t attempt something unless they can find an example of someone else who is already doing it. Rely on this type of thinking too much and youâ€™ll never do anything interesting.\n\nâ€œè®¸å¤šäººä¸ä¼šå°è¯•æŸäº‹ï¼Œé™¤éä»–ä»¬èƒ½æ‰¾åˆ°å…¶ä»–äººå·²ç»åœ¨åšçš„ä¾‹å­ã€‚è¿‡åˆ†ä¾èµ–è¿™ç§æ€ç»´æ–¹å¼ï¼Œä½ æ°¸è¿œä¸ä¼šåšä»»ä½•æœ‰è¶£çš„äº‹æƒ…ã€‚\n\n\n\nYour path through life is unique. It is important to extract lessons from the experiences of others, but you canâ€™t wait for a perfect example to take action. You are the example.â€\n\nä½ çš„äººç”Ÿé“è·¯æ˜¯ç‹¬ä¸€æ— äºŒçš„ã€‚ä»åˆ«äººçš„ç»éªŒä¸­å¸å–æ•™è®­å¾ˆé‡è¦ï¼Œä½†ä½ ä¸èƒ½ç­‰åˆ°ä¸€ä¸ªå®Œç¾çš„ä¾‹å­æ‰é‡‡å–è¡ŒåŠ¨ã€‚ä½ å°±æ˜¯æ¦œæ ·ã€‚â€\n\n\n\nâ€œPeople usually judge you based on where you are at currently, not what you could become eventually. Donâ€™t let one comment stop you from trying. File it away or use it as fuel. Focus on getting better. Someone elseâ€™s analysis of your current position doesnâ€™t tell you anything about your current potential.â€\n\nâ€œäººä»¬é€šå¸¸æ ¹æ®ä½ ç›®å‰æ‰€å¤„çš„ä½ç½®æ¥è¯„åˆ¤ä½ ï¼Œè€Œä¸æ˜¯ä½ æœ€ç»ˆä¼šæˆä¸ºä»€ä¹ˆæ ·çš„äººã€‚ä¸è¦è®©ä¸€æ¡è¯„è®ºé˜»æ­¢ä½ å°è¯•ã€‚æŠŠå®ƒå½’æ¡£æˆ–ç”¨å®ƒä½œä¸ºç‡ƒæ–™ã€‚ä¸“æ³¨äºå˜å¾—æ›´å¥½ã€‚åˆ«äººå¯¹ä½ çš„åˆ†æå½“å‰çš„èŒä½å¹¶ä¸èƒ½å‘Šè¯‰ä½ ä»»ä½•æœ‰å…³ä½ å½“å‰æ½œåŠ›çš„ä¿¡æ¯ã€‚â€\n\n\n\nâ€œOne of the great balancing acts in life is to be cautious and daring at the same time.\n\nâ€œç”Ÿæ´»ä¸­æœ€ä¼Ÿå¤§çš„å¹³è¡¡è¡Œä¸ºä¹‹ä¸€å°±æ˜¯åŒæ—¶ä¿æŒè°¨æ…å’Œå¤§èƒ†ã€‚\n\n\n\nCautious enough to avoid stupid mistakes, prevent burnout, and maintain a margin of safety.\n\nè¶³å¤Ÿè°¨æ…ï¼Œé¿å…æ„šè ¢çš„é”™è¯¯ï¼Œé˜²æ­¢å€¦æ€ ï¼Œå¹¶ä¿æŒå®‰å…¨è¾¹é™…ã€‚\n\n\n\nDaring enough to bet on yourself, to do the things you would regret leaving undone, and to be willing to be uncomfortable in the short term so you can learn and grow in the long term.â€\n\næ•¢äºæŠŠèµŒæ³¨æŠ¼åœ¨è‡ªå·±èº«ä¸Šï¼Œå»åšé‚£äº›ä¸åšå°±ä¼šåæ‚”çš„äº‹æƒ…ï¼Œæ„¿æ„åœ¨çŸ­æœŸå†…æ„Ÿåˆ°ä¸èˆ’æœï¼Œè¿™æ ·ä½ æ‰èƒ½é•¿æœŸå­¦ä¹ å’Œæˆé•¿ã€‚â€\n\n\n\nâ€œCuriosity is the beginning of knowledge. Action is the beginning of change.â€\n\nâ€œå¥½å¥‡å¿ƒæ˜¯çŸ¥è¯†çš„å¼€å§‹ã€‚è¡ŒåŠ¨æ˜¯æ”¹å˜çš„å¼€å§‹ã€‚â€\n\n\n\nâ€œIf you feel safe in the area that youâ€™re working in, youâ€™re not working in the right area. Always go a little further into the water than you feel youâ€™re capable of being in. Go a little bit out of your depth, and when you donâ€™t feel that your feet are quite touching the bottom, youâ€™re just about in the right place to do something exciting.â€\n\nâ€œå¦‚æœä½ åœ¨ä½ å·¥ä½œçš„åŒºåŸŸæ„Ÿåˆ°å®‰å…¨ï¼Œé‚£ä¹ˆä½ å°±æ²¡æœ‰åœ¨æ­£ç¡®çš„åŒºåŸŸå·¥ä½œã€‚æ€»æ˜¯æ¯”ä½ è®¤ä¸ºè‡ªå·±èƒ½å¤Ÿè¿›å…¥çš„åœ°æ–¹æ›´æ·±å…¥æ°´ä¸­ã€‚ç¨å¾®ç¦»å¼€ä¸€ç‚¹å½“ä½ æ„Ÿè§‰è‡ªå·±çš„è„šæ²¡æœ‰å®Œå…¨æ¥è§¦åˆ°åº•éƒ¨æ—¶ï¼Œä½ å°±å¤„äºæ­£ç¡®çš„ä½ç½®ï¼Œå¯ä»¥åšä¸€äº›ä»¤äººå…´å¥‹çš„äº‹æƒ…äº†ã€‚â€\n\n\n\næ€è€ƒ Â§\n\n\nImagine all your responsibilities and obligations vanish overnight. What would you miss doing? What would you choose to add back to your life?\n\næƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ‰€æœ‰çš„è´£ä»»å’Œä¹‰åŠ¡ä¸€å¤œä¹‹é—´æ¶ˆå¤±äº†ã€‚\nä½ ä¼šæ€€å¿µåšä»€ä¹ˆï¼Ÿä½ ä¼šé€‰æ‹©åœ¨ä½ çš„ç”Ÿæ´»ä¸­å¢åŠ ä»€ä¹ˆï¼Ÿ\n\n\n\nWhat can I do today to improve by 1%?\n\næˆ‘ä»Šå¤©èƒ½åšä»€ä¹ˆæ¥æé«˜ 1%ï¼Ÿ\n\n\n\nWhere do I want to be in 10 years? What can I do in the next 5 minutes to contribute to that outcome?\n\n10å¹´åæˆ‘æƒ³åœ¨å“ªé‡Œï¼Ÿåœ¨æ¥ä¸‹æ¥çš„5åˆ†é’Ÿå†…ï¼Œæˆ‘å¯ä»¥åšä»€ä¹ˆæ¥ä¿ƒè¿›è¿™ä¸€ç»“æœï¼Ÿâ€\n\n\n\nIf you could spend 30 minutes today creating whatever you want, what would you create?\n\nå¦‚æœä½ ä»Šå¤©å¯ä»¥èŠ± 30 åˆ†é’Ÿåˆ›é€ ä½ æƒ³è¦çš„ä¸œè¥¿ï¼Œä½ ä¼šåˆ›é€ ä»€ä¹ˆï¼Ÿ\n\n\n\nHow would my daily schedule change if I did a little more of what Iâ€™m great at and a little less of what Iâ€™m not great at?\n\nå¦‚æœæˆ‘å¤šåšä¸€ç‚¹æˆ‘æ“…é•¿çš„äº‹ï¼Œå°‘åšä¸€ç‚¹æˆ‘ä¸æ“…é•¿çš„äº‹ï¼Œæˆ‘çš„æ—¥å¸¸å®‰æ’ä¼šæœ‰ä»€ä¹ˆå˜åŒ–ï¼Ÿ\n\n\n\nIs it better to delay getting started by weeks or months so I can be fully prepared? Or is it better to start right now with little to no preparation?\n\næ˜¯æ¨è¿Ÿå‡ å‘¨æˆ–å‡ ä¸ªæœˆå¼€å§‹ï¼Œä»¥ä¾¿æˆ‘èƒ½å¤Ÿåšå¥½å……åˆ†å‡†å¤‡ï¼Ÿè¿˜æ˜¯åœ¨å‡ ä¹æ²¡æœ‰å‡†å¤‡çš„æƒ…å†µä¸‹ç°åœ¨å°±å¼€å§‹æ¯”è¾ƒå¥½ï¼Ÿ\n\n\n\nWhere am I spending energy trying to please someone who actually doesnâ€™t care?\n\næˆ‘åœ¨å“ªé‡ŒèŠ±ç²¾åŠ›å»è®¨å¥½ä¸€ä¸ªå®é™…ä¸Šå¹¶ä¸å…³å¿ƒçš„äººå‘¢ï¼Ÿ\n\n\n\nThis thing that I am unhappy aboutâ€¦ is it actually hard to change or is it simply hard to have the courage to change it?\n\næˆ‘ä¸é«˜å…´çš„è¿™ä»¶äº‹â€¦â€¦ç©¶ç«Ÿæ˜¯å¾ˆéš¾æ”¹å˜ï¼Œè¿˜æ˜¯åªæ˜¯å¾ˆéš¾æœ‰å‹‡æ°”å»æ”¹å˜ï¼Ÿ\n\n\n\nItâ€™s easy to find ways to improve when you are genuinely curious about something. Rather than asking yourself, â€œHow can I be better at this?â€ start by asking, â€œHow can I be more curious about this?â€\n\nå½“ä½ çœŸæ­£å¯¹æŸä»¶äº‹æ„Ÿåˆ°å¥½å¥‡æ—¶ï¼Œå¾ˆå®¹æ˜“æ‰¾åˆ°æ”¹è¿›çš„æ–¹æ³•ã€‚ä¸è¦é—®è‡ªå·±ï¼šâ€œæˆ‘æ€æ ·æ‰èƒ½åšå¾—æ›´å¥½ï¼Ÿâ€é¦–å…ˆé—®ï¼šâ€œæˆ‘æ€æ ·æ‰èƒ½å¯¹æ­¤æ›´å¥½å¥‡ï¼Ÿâ€\n\n\n"},"æ€è€ƒ/Tips":{"title":"Tips","links":[],"tags":["idea","æ€è€ƒ"],"content":"\næƒ³åˆ°ä»€ä¹ˆç‚¹å­å°±èµ¶ç´§è®°ä¸‹æ¥ï¼Œä¸ç„¶è¿‡ä¸€ä¼šå°±å¿˜äº†ï¼Œå³ä½¿åªæ˜¯ä¸Šä¸ªå•æ‰€æ´—ä¸ªæ‰‹ä¹Ÿä¼šå¿˜ã€‚\nåšä¸€ä»¶äº‹çš„æ—¶å€™ï¼Œæƒ³è±¡ä¸€ä¸‹ï¼Œæœ€åçš„æƒ…å†µèƒ½ååˆ°å“ªå‘¢ã€‚\nä½ èŠ±åœ¨æŒ‘é€‰å¯å®¤ç”¨çš„ç”µè§†æœºä¸Šçš„æ—¶é—´æ¯”ä½ é€‰æ‹©ä¸“ä¸šå’Œå­¦ä¹ é¢†åŸŸçš„æ—¶é—´é•¿ã€‚\næ‰¾å‡ºè‡ªå·±æ“…é•¿å’Œä¸æ“…é•¿åšçš„äº‹ã€‚\nä»€ä¹ˆå·¥ä½œæ˜¯æˆ‘éåšä¸å¯çš„ã€‚\nç”¨æœç´¢ã€‚\n"},"å­¦ä¹ /è‹±è¯­/Think-in-English":{"title":"Think in English","links":[],"tags":["è‹±è¯­"],"content":"How to THINK in English | No More Translating in Your Head! - YouTube\nIntroduction Â§\nIf youâ€™re translating in your head, then you know that thatâ€™s a frustrating way to speak English. But the good news is there are concrete things you can do and practice to stop translating in your head and start thinking in English. In this video weâ€™re going to give you tips and strategies to start thinking in English, stop translating in your head, and increase fluency speaking English. And what a better way to start 2020 than with this goal.\nSetting the Goal Â§\nFirst, I want you to name one reason why you want to start thinking in English. I want to learn to think in English so I can easily participate in conversation. Whatever your reason is, I know itâ€™s a good one. And I think in 2020, you can make that happen.\nTip 1: Start Simple Â§\nThe first tip is to start simple and name objects around you in English.\nI remember when I was learning German and I was doing this, I had to learn the article as well, der, die, das. We donâ€™t have that in English, but it doesnâ€™t hurt to really focus on the pronunciation as youâ€™re thinking of simple objects. In fact, thatâ€™s why I started my YouTube channel and even my Academy â€“ when I was learning German, French, and Italian as an opera student, I couldnâ€™t find any resources that focused enough on pronunciation. And I knew that to be effective, I needed the right pronunciation right from the beginning. So I created my YouTube channel and my Academy to put pronunciation forward.\nSo take a moment as youâ€™re naming objects to think about pronunciation. Closet. Box. Million subscriber button. Cool. Globe. Window. And if youâ€™re not sure about the pronunciation, listen to some native speakers. You can use an online dictionary. Also, Youglish is a great resource for this. Computer, compute.Theyâ€™re all saying with a flap. Compuâ€” rarararara. A flap instead of TT, a T sound. Computer. Computer. Middle syllable stress. If you can add this step, of focusing on the pronunciation and listening to native speakers, awesome. If not, if you only have 15 seconds, and youâ€™re naming as many as you can, thatâ€™s okay too. So thatâ€™s step one and itâ€™s simple.\nTake a moment, look around you, and name all of the objects that you can in English. If you can do that very easily, then you can move on. But if thatâ€™s a challenge for you, spend some time on object naming. Every time youâ€™re in a new room, a new environment, take a few seconds to do it. Note words you donâ€™t know, look them up, learn them. The context will help you remember them.\nTip 2: Think in Simple Sentences Â§\nThe next step is to think in simple sentences.\nStop right now and think of the beginning of a sentence: Iâ€™m---. Iâ€™m hungry, Iâ€™m tired, Iâ€™m working. Do it in English. Iâ€™ll wait a few seconds. Youâ€™re starting with â€˜Iâ€™mâ€¦â€™\nNow look around you. What can you say about anything in your environment? This chair is comfy. The drawer is open. My desk is messy. That oneâ€™s easy because itâ€™s almost always true. If thereâ€™s something you canâ€™t describe, look up the words you need in a dictionary, memorize it. Memorize that phrase. Learning in context like this will help.\nTip 3: Use English-Only Dictionary Â§\nSpeaking of dictionaries, see if you can do this. Get an English-only dictionary rather than a translating dictionary between English and your native language.\nIf you come across a word in English that you donâ€™t know, use the English-only dictionary, a Learnerâ€™s dictionary. Can you see what weâ€™re doing here? Weâ€™re building your mind to work in English mode rather than translation mode. There is a thing called a Learnerâ€™s dictionary, and it describes every word in English, in simple words and terms. Try it. Merriam-Webster has one, Oxford, Cambridge. If you have to learn and understand a word by reading in English, by studying what it means in English, then youâ€™ll know it as an English word. Not as a translation of your language. So youâ€™ve named single words, and youâ€™ve made simple sentences.\nTip 4: Have Small Conversations with Yourself in English Â§\nWith yourself? Yes, you donâ€™t feel pressure to speak quickly, to come up with the next thing. You can keep the pace slow, relaxed. I absolutely did this when learning Spanish. In fact, I remember a car trip I did by myself from Sarasota to Gainesville where the whole time I spoke to myself in Spanish. If this is hard for you, stop and give up. No! It will get better and easier with practice. Do it every day. Set aside 2 minutes every day to have a simple conversation with yourself. Give yourself 30 days. Do this every day for 30 days. Donâ€™t take a day off. If you have five minutes one day, do it for five minutes. A whole conversation, as simple as it needs to be, in English. In 30 days, youâ€™ll see. Wow. I did improve. This is worth my time. And rededicate 30 more days.\nOnce youâ€™re able to do this, I think youâ€™re able to do step 5, which is really exciting.\nTip 5: Change Everyday Life Things to English Â§\nChange at least one of your everyday life things to English.\nEveryday life things? Whatâ€™s that? Switch your calendar to English. Use the English months and days of the week and write what youâ€™re going to be doing in English.\nOr do you do to-do lists? Try it in English. A grocery list. Or change your Facebook settings so that your language is in English. Everything you see, youâ€™ve got a friend request, and so on, will be in English. Maybe try internet searches in English. Or read an English newspaper, or listen to news in English. Do you write a journal? Try writing it in English. Yes! I love this. Take one everyday thing and do it in English. Switch your brain. Every morning when you wake up, before you get out of bed, take two minutes to think about your day in English.\nTip 6: Learn How to Do One Thing in English Â§\nHereâ€™s another idea of an everyday thing you can do in English: take one thing like getting dressed, making breakfast, getting from your car to your desk, cleaning up. As youâ€™re doing it, in your head, narrate in English. Laundry day. Thatâ€™s light, that should go there. Letâ€™s see. Does this need to be sprayed for stains? Yeah. Better spray it. All right, letâ€™s load up the washing machine. Thatâ€™s too light, that should go there. Okay, shove it all in. Letâ€™s get some soap. Where is that? Here it is. Put it in there, close the door, press â€˜startâ€™, there we go!\nAnd hereâ€™s another one I love: learn how to do one thing in English. It can be really small, like, how to poach an egg. Research it and learn about it in English only, watch only English videos and read only English instructions.\nOr maybe itâ€™s something bigger, a bigger project like how to knit or how to draw. Take an online course in English only on that topic. Pick something youâ€™re dying to know how to do anyway. This will make it a super-enjoyable lesson.\nTip 7: Keep Track of Your Progress Â§\nThe next step is something youâ€™re actually going to want to be doing all along, with all the steps, and thatâ€™sâ€¦ keep track so youâ€™re doing it every day.\nOnce you choose that you want to think English and stop translating in your head, write down every day what you do.\nAnd of course, do this in English. It could look like this: Today I named everything around me that I could think of in English two different times. I watched a 3-minute news story in English. Just having a place to write it down can motivate you to do it.\nTip 8: Recap Your Day in English Â§\nAnd the last thing is something you can do every night after you lay down for bed, but before you fall asleep. Recap your day in English. Youâ€™re taking advantage of this opportunity that youâ€™ll have every day, no matter where you are or what your day was like: no one I know falls asleep the moment their head hits the pillow. What a lovely day that was. I got to meet my mom for lunch, go for a walk in the afternoon, and I even had time to watch a movie after I put the kids down to bed. And who knows, by putting your mind in English mode just before bed, maybe youâ€™re even setting yourself up to dream in English, continuing your practice. The brain does amazing things with what itâ€™s learned that day while you sleep."},"å­¦ä¹ /è‹±è¯­/èƒŒå•è¯":{"title":"èƒŒå•è¯","links":[],"tags":["è‹±è¯­","å•è¯"],"content":"å‡†å¤‡ Â§\n\næ‰‹æœºå®‰è£…ä¸èƒŒå•è¯ APP\næµè§ˆå™¨å®‰è£… ä¸èƒŒå•è¯æŸ¥è¯\n\nåˆ¶ä½œç”Ÿè¯æœ¬ Â§\nAPP å†…æ·»åŠ ç”Ÿè¯ Â§\n\nåˆ°ä¸èƒŒå•è¯é¦–é¡µä¸‹æ‹‰å¼¹å‡ºå•è¯æœç´¢æ¡†\nè¾“å…¥å•è¯æˆ–çŸ­è¯­åˆ°æœç´¢æ¡†è¿›è¡Œæœç´¢\nç‚¹å‡»æœç´¢ç»“æœ\nç‚¹å‡»æ˜Ÿæ˜Ÿå›¾æ ‡æ·»åŠ åˆ°ç”Ÿè¯æœ¬\n\n\n\n\n\nåœ¨ç½‘é¡µæ·»åŠ ç”Ÿè¯ Â§\n\nåˆ’è¯\nåœ¨å¼¹å‡ºçš„çª—å£ç‚¹å‡»æ·»åŠ ç”Ÿè¯\n\n\n\n\n\nå¼€å§‹èƒŒå•è¯ Â§\n\nå°†ç”Ÿè¯æœ¬è®¾ç½®ä¸ºæ­£åœ¨å­¦ä¹ çš„è¯ä¹¦\n\n\n\n\n\nåœ¨ APP è¿›è¡Œå­¦ä¹ \n\nç”Ÿè¯æ¥æº Â§\n\nè‹±æ–‡æ–‡ç« \nè‹±æ–‡æ–‡æ¡£\nç”Ÿè¯çš„ä¾‹å¥æˆ–è‹±æ–‡è§£é‡Š\n"},"å­¦ä¹ /è‹±è¯­/è‹±è¯­":{"title":"è‹±è¯­","links":["%E5%AD%A6%E4%B9%A0/%E8%8B%B1%E8%AF%AD/Think-in-English","%E5%AD%A6%E4%B9%A0/%E8%8B%B1%E8%AF%AD/%E8%83%8C%E5%8D%95%E8%AF%8D"],"tags":["è‹±è¯­"],"content":"\nThink in English\nè·Ÿ Morty çš„å­¦ä¹ è·¯çº¿å­¦ï¼šã€M14ã€‘è‹±è¯­å­¦ä¹ å”¯ä¸€æ­£ç¡®æ–¹æ³•å…·ä½“å®è·µ_å“”å“©å“”å“©\nèƒŒå•è¯\n"},"å­¦ä¹ ç¬”è®°/Github/GitHub-åŠ é€Ÿè®¿é—®":{"title":"GitHub åŠ é€Ÿè®¿é—®","links":[],"tags":["github"],"content":"\nhosts: GitHubæœ€æ–°hostsã€‚è§£å†³GitHubå›¾ç‰‡æ— æ³•æ˜¾ç¤ºï¼ŒåŠ é€ŸGitHubç½‘é¡µæµè§ˆã€‚\n"},"å­¦ä¹ ç¬”è®°/Github/å¸¸è§é”™è¯¯":{"title":"å¸¸è§é”™è¯¯","links":[],"tags":["git","github"],"content":"Connection Closed by 20.205.243.166 Port 22 Â§\næ·»åŠ ä»¥ä¸‹ä»£ç åˆ° ~/.ssh/config\nHost github.com\n  HostName ssh.github.com\n  User username\n  Port 443"},"å­¦ä¹ ç¬”è®°/MySQL-å®æˆ˜-45-è®²/01ï½œåŸºç¡€æ¶æ„ï¼šä¸€æ¡-SQL-æŸ¥è¯¢è¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Ÿ":{"title":"01ï½œåŸºç¡€æ¶æ„ï¼šä¸€æ¡ SQL æŸ¥è¯¢è¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Ÿ","links":[],"tags":["mysql"],"content":"MySQL çš„é€»è¾‘é“¾æ¥æ¶æ„å›¾ Â§\n\n1. å®¢æˆ·ç«¯è¿æ¥æ•°æ®åº“ Â§\n\nwait_timeout å‚æ•°æ§åˆ¶è¿æ¥å™¨é•¿æ—¶é—´æ²¡æ“ä½œè‡ªåŠ¨æ–­å¼€çš„æ—¶é—´\nåªæœ‰æ–°å»ºçš„è¿æ¥æ‰ä¼šä½¿ç”¨æ–°çš„æƒé™è®¾ç½®\nå°½é‡ä½¿ç”¨é•¿è¿æ¥\n\nä½¿ç”¨é•¿è¿æ¥çš„é—®é¢˜ï¼šå¯èƒ½å†…å­˜ç–¯æ¶¨ï¼Œå› ä¸º MySQL åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸´æ—¶ä½¿ç”¨çš„å†…å­˜æ˜¯ç®¡ç†åœ¨è¿æ¥å¯¹è±¡é‡Œé¢ï¼Œåœ¨è¿æ¥æ–­å¼€çš„æ—¶å€™æ‰é‡Šæ”¾\nä¸¤ä¸ªè§£å†³æ–¹æ¡ˆ\n\nå®šæœŸæ–­å¼€é•¿è¿æ¥ã€‚ä½¿ç”¨ä¸€æ®µæ—¶é—´ï¼Œæˆ–è€…ç¨‹åºé‡Œé¢åˆ¤æ–­æ‰§è¡Œè¿‡ä¸€ä¸ªå ç”¨å†…å­˜çš„å¤§æŸ¥è¯¢åï¼Œä¸»åŠ¨æ–­å¼€è¿æ¥ï¼Œä¹‹åè¦æŸ¥è¯¢å†é‡è¿\nMySQL 5.7 æˆ–æ›´æ–°ç‰ˆæœ¬ï¼Œå¯ä»¥åœ¨æ‰§è¡Œä¸€ä¸ªæ¯”è¾ƒå¤§çš„æ“ä½œåï¼Œæ‰§è¡Œ mysql_reset_connection é‡æ–°åˆå§‹åŒ–è¿æ¥èµ„æº\n\nè¿™ä¸ªè¿‡ç¨‹ä¸éœ€è¦é‡è¿å’Œé‡æ–°åšæƒé™éªŒè¯ï¼Œä¼šå°†è¿æ¥æ¢å¤åˆ°åˆšåˆšåˆ›å»ºå®Œæ—¶çš„çŠ¶æ€\n\n\n\n\n\n\n\n2. æŸ¥è¯¢ç¼“å­˜ Â§\n\nå»ºè®®ä¸ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜ï¼Œå¼Šå¤§äºåˆ©\n\nå¯¹ä¸€ä¸ªè¡¨çš„æ›´æ–°ï¼Œè¡¨ä¸Šæ‰€æœ‰çš„æŸ¥è¯¢ç¼“å­˜éƒ½ä¼šè¢«æ¸…ç©º\nè®¾ç½® query_cache_type = DEMANDï¼Œå¯¹äºé»˜è®¤çš„ SQL è¯­å¥éƒ½ä¸ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜ï¼Œç”¨ SQL_CACHE æ˜¾ç¤ºç½®é¡¶è¦ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜çš„è¯­å¥ select SQL_CACHE * from T;\n\n\nâš ï¸ MySQL 8.0 ç‰ˆæœ¬åˆ é™¤æ­¤åŠŸèƒ½\n\n3. åˆ†æå™¨ Â§\n\nè¯æ³•åˆ†æ\nè¯­æ³•åˆ†æ\n\nå…³æ³¨ç´§æ¥â€œuse nearâ€çš„å†…å®¹\n\n\n\n4. ä¼˜åŒ–å™¨ Â§\n\nå†³å®šä½¿ç”¨å“ªä¸ªç´¢å¼•\nå†³å®šå„ä¸ªè¡¨çš„è¿æ¥é¡ºåº\nåé¢çš„æ–‡ç« ä¼šå•ç‹¬å±•å¼€è¯´æ˜ä¼˜åŒ–å™¨çš„å†…å®¹\n\n5. æ‰§è¡Œå™¨ Â§\n\nåˆ¤æ–­æ‰§è¡Œæƒé™\næ ¹æ®è¡¨çš„å¼•æ“å®šä¹‰ï¼Œä½¿ç”¨å¼•æ“æä¾›çš„æ¥å£\nå…³äºæ…¢æŸ¥è¯¢æ—¥å¿—ä¸­çš„ rows_examined å­—æ®µ\n\næ‰§è¡Œå™¨æ¯æ¬¡è°ƒç”¨å¼•æ“è·å–æ•°æ®è¡Œçš„æ—¶å€™ç´¯åŠ \nè·Ÿå¼•æ“æ‰«æè¡Œæ•°å¹¶ä¸æ˜¯å®Œå…¨ç›¸åŒçš„\n\nå¯èƒ½æ‰§è¡Œå™¨è°ƒç”¨ä¸€æ¬¡ï¼Œå¼•æ“å†…éƒ¨æ‰«æäº†å¤šè¡Œ\n\n\nåé¢æœ‰å®æˆ˜æ–‡ç« å•ç‹¬å±•å¼€è®²å­˜å‚¨å¼•æ“çš„å†…éƒ¨æœºåˆ¶\n\n\n\næ€è€ƒé¢˜ Â§\n\nå¦‚æœè¡¨ T ä¸­æ²¡æœ‰å­—æ®µ kï¼Œè€Œä½ æ‰§è¡Œäº†è¿™ä¸ªè¯­å¥ select * from T where k=1, é‚£è‚¯å®šæ˜¯ä¼šæŠ¥â€œä¸å­˜åœ¨è¿™ä¸ªåˆ—â€çš„é”™è¯¯ï¼šâ€œUnknown column â€˜kâ€™ in â€˜where clauseâ€™â€ã€‚ä½ è§‰å¾—è¿™ä¸ªé”™è¯¯æ˜¯åœ¨æˆ‘ä»¬ä¸Šé¢æåˆ°çš„å“ªä¸ªé˜¶æ®µæŠ¥å‡ºæ¥çš„å‘¢ï¼Ÿ\n\nåˆ†æå™¨\n\n\n"},"å­¦ä¹ ç¬”è®°/MySQL-å®æˆ˜-45-è®²/02ï½œæ—¥å¿—ç³»ç»Ÿï¼šä¸€æ¡-SQL-æ›´æ–°è¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Ÿ":{"title":"02ï½œæ—¥å¿—ç³»ç»Ÿï¼šä¸€æ¡ SQL æ›´æ–°è¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Ÿ","links":["%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/22%EF%BD%9CMySQL%E6%9C%89%E5%93%AA%E4%BA%9B%E2%80%9C%E9%A5%AE%E9%B8%A9%E6%AD%A2%E6%B8%B4%E2%80%9D%E6%8F%90%E9%AB%98%E6%80%A7%E8%83%BD%E7%9A%84%E6%96%B9%E6%B3%95%EF%BC%9F"],"tags":["mysql"],"content":"Update è¯­å¥æ‰§è¡Œæµç¨‹ Â§\n\né‡è¦çš„æ—¥å¿—æ¨¡å—ï¼šredo Log Â§\n\næ˜¯ InnoDB å¼•æ“ç‰¹æœ‰çš„æ—¥å¿—\nWALï¼ˆWrite-Ahead Loggingï¼‰æŠ€æœ¯\n\nå…ˆå†™æ—¥å¿—ï¼Œå†å†™ç£ç›˜\nå½“æœ‰ä¸€æ¡è®°å½•éœ€è¦æ›´æ–°çš„æ—¶å€™ï¼ŒInnoDB å¼•æ“å…ˆæŠŠè®°å½•å†™åˆ° redo logï¼Œå¹¶æ›´æ–°å†…å­˜ï¼Œå¼•æ“ä¼šåœ¨é€‚å½“çš„æ—¶å€™ï¼Œå°†è¿™ä¸ªæ“ä½œè®°å½•æ›´æ–°åˆ°ç£ç›˜ï¼Œè¿™ä¸ªæ›´æ–°å¾€å¾€æ˜¯åœ¨ç³»ç»Ÿæ¯”è¾ƒç©ºé—²çš„æ—¶å€™åš\n\n\nredo log å¤§å°å›ºå®šï¼Œæ¯”å¦‚å¯ä»¥é…ç½®ä¸ºä¸€ç»„ 4 ä¸ªæ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶çš„å¤§å°æ˜¯ 1GBï¼Œæ‰€æœ‰æ–‡ä»¶ç»„æˆä¸€å—â€œç²‰æ¿â€\n\n\nwrite pos æ˜¯å½“å‰è®°å½•çš„ä½ç½®ï¼Œä¸€è¾¹å†™ä¸€è¾¹åç§»ï¼Œå†™åˆ°æ–‡ä»¶æœ«å°¾åä¼šå›åˆ°æ–‡ä»¶å¼€å¤´\ncheckpoint æ˜¯å½“å‰è¦æ“¦é™¤çš„ä½ç½®ï¼Œä¹Ÿæ˜¯å¾€åæ¨ç§»å¹¶ä¸”å¾ªç¯çš„ï¼Œæ“¦é™¤è®°å½•å‰è¦æŠŠè®°å½•æ›´æ–°åˆ°æ•°æ®æ–‡ä»¶\nwrite pos å’Œ checkpoint ä¹‹é—´çš„æ˜¯â€œç²‰æ¿â€ä¸Šè¿˜ç©ºç€çš„éƒ¨åˆ†ï¼Œå¯ä»¥ç”¨æ¥è®°å½•æ–°çš„æ“ä½œã€‚\nå¦‚æœ write pos è¿½ä¸Š checkpointï¼Œè¡¨ç¤ºâ€œç²‰æ¿â€æ»¡äº†ï¼Œè¿™æ—¶å€™ä¸èƒ½å†æ‰§è¡Œæ–°çš„æ›´æ–°ï¼Œå¾—åœä¸‹æ¥å…ˆæ“¦æ‰ä¸€äº›è®°å½•ï¼ŒæŠŠ checkpoint æ¨è¿›ä¸€ä¸‹ã€‚\n\n\ncrash-safeï¼šæœ‰äº† redo logï¼ŒInnoDB å¯ä»¥ä¿è¯æ•°æ®åº“å‘ç”Ÿå¼‚å¸¸é‡å¯ä¹Ÿä¸ä¸¢å¤±æ•°æ®\n\né‡è¦çš„æ—¥å¿—æ¨¡å—ï¼šbinlogï¼ˆå½’æ¡£æ—¥å¿—ï¼‰ Â§\n\næ˜¯ Server å±‚çš„æ—¥å¿—\nstatement æ ¼å¼ï¼šè®° SQL è¯­å¥\nrow æ ¼å¼ï¼šè®°å½•è¡Œçš„å†…å®¹ï¼Œè®°ä¸¤æ¡ï¼Œæ›´æ–°å‰å’Œæ›´æ–°åéƒ½æœ‰\n\nå»ºè®®ä½¿ç”¨\n\n\n\nRedo Log å’Œ Binlog çš„ä¸åŒ Â§\n\nredo log æ˜¯ InnoDB å¼•æ“ç‰¹æœ‰çš„ï¼›binlog æ˜¯ MySQL çš„ Server å±‚å®ç°çš„ï¼Œæ‰€æœ‰å¼•æ“éƒ½å¯ä»¥ä½¿ç”¨ã€‚\nredo log æ˜¯ç‰©ç†æ—¥å¿—ï¼Œè®°å½•çš„æ˜¯â€œåœ¨æŸä¸ªæ•°æ®é¡µä¸Šåšäº†ä»€ä¹ˆä¿®æ”¹â€ï¼›binlog æ˜¯é€»è¾‘æ—¥å¿—ï¼Œè®°å½•çš„æ˜¯è¿™ä¸ªè¯­å¥çš„åŸå§‹é€»è¾‘ï¼Œæ¯”å¦‚â€œç»™ ID=2 è¿™ä¸€è¡Œçš„ c å­—æ®µåŠ  1 â€ã€‚\n\né€»è¾‘ï¼šå…¶ä»–å¼•æ“éƒ½èƒ½ç”¨ï¼Œéƒ½è®²å¾—é€šè¿™ä¸ªâ€œé€»è¾‘â€\nç‰©ç†ï¼šåªæœ‰â€œæˆ‘â€œèƒ½ç”¨ï¼Œåˆ«äººæ²¡æœ‰å…±äº«æˆ‘çš„â€ç‰©ç†æ ¼å¼â€œ\n\n\nredo log æ˜¯å¾ªç¯å†™ï¼Œç©ºé—´å›ºå®šä¼šç”¨å®Œï¼›binlog æ˜¯è¿½åŠ å†™å…¥ã€‚\n\nâ€œè¿½åŠ å†™â€æ˜¯æŒ‡ binlog æ–‡ä»¶å†™åˆ°ä¸€å®šå¤§å°åä¼šåˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªï¼Œå¹¶ä¸ä¼šè¦†ç›–ä»¥å‰çš„æ—¥å¿—ã€‚\n\n\n\nä¸¤é˜¶æ®µæäº¤ Â§\n\næäº¤æµç¨‹\n\nredolog çš„ prepare é˜¶æ®µ\nå†™ binlog\nredolog çš„ commit\n\n\nåœ¨ 2 ä¹‹å‰å´©æºƒæ—¶ï¼Œé‡å¯æ¢å¤åå‘ç°æ²¡æœ‰ commitï¼Œå›æ»šï¼›å¤‡ä»½æ¢å¤ï¼Œæ²¡æœ‰ binlogã€‚ä¸€è‡´\nåœ¨ 3 ä¹‹å‰å´©æºƒï¼Œé‡å¯æ¢å¤åå‘ç°è™½ç„¶æ²¡æœ‰ commitï¼Œä½†æ»¡è¶³ prepare å’Œ binlog å®Œæ•´ï¼Œè‡ªåŠ¨ commitï¼›å¤‡ä»½æ¢å¤ï¼Œæœ‰ binlogã€‚ä¸€è‡´\n\nè®¾ç½®å»ºè®® Â§\n\ninnodb_flush_log_at_trx_commit å»ºè®®è®¾ç½®æˆ 1ï¼Œè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡çš„ redo log éƒ½ç›´æ¥æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œä¿è¯ MySQL å¼‚å¸¸é‡å¯ä¹‹åæ•°æ®ä¸ä¸¢å¤±\nsync_binlog å»ºè®®è®¾ç½®æˆ 1ï¼Œè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡çš„ binlog éƒ½æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œä¿è¯ MySQL å¼‚å¸¸é‡å¯ä¹‹å binlog ä¸ä¸¢å¤±\n\nç­”ç–‘æ–‡ç« ï¼ˆä¸€ï¼‰ Â§\nMySQL æ€ä¹ˆçŸ¥é“ Binlog æ˜¯å®Œæ•´çš„ï¼Ÿ Â§\n\nä¸€ä¸ªäº‹åŠ¡çš„ binlog æœ‰å®Œæ•´æ ¼å¼ï¼š\nstatement æ ¼å¼çš„ binlogï¼Œæœ€åä¼šæœ‰ COMMITï¼›\nrow æ ¼å¼çš„ binlogï¼Œæœ€åä¼šæœ‰ä¸€ä¸ª XID eventã€‚\nMySQL 5.6.2 ä¹‹åï¼Œå¼•å…¥äº† binlog-checksum å‚æ•°ï¼Œç”¨äºéªŒè¯ binlog å†…å®¹çš„æ­£ç¡®æ€§\n\nRedo Log å’Œ Binlog æ˜¯æ€ä¹ˆå…³è”èµ·æ¥çš„? Â§\n\nå®ƒä»¬æœ‰ä¸€ä¸ªå…±åŒçš„æ•°æ®å­—æ®µ XIDã€‚å´©æºƒæ¢å¤çš„æ—¶å€™ï¼Œä¼šæŒ‰é¡ºåºæ‰«æ redo logï¼š\nå¦‚æœç¢°åˆ°æ—¢æœ‰ prepareã€åˆæœ‰ commit çš„ redo logï¼Œå°±ç›´æ¥æäº¤ï¼›\nå¦‚æœç¢°åˆ°åªæœ‰ parepareã€è€Œæ²¡æœ‰ commit çš„ redo logï¼Œå°±æ‹¿ç€ XID å» binlog æ‰¾å¯¹åº”çš„äº‹åŠ¡ã€‚\n\nå¤„äº Prepare é˜¶æ®µçš„ Redo Log åŠ ä¸Šå®Œæ•´ binlogï¼Œé‡å¯å°±èƒ½æ¢å¤ï¼ŒMySQL ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆè®¾è®¡? Â§\n\nä¸æ•°æ®ä¸å¤‡ä»½çš„ä¸€è‡´æ€§æœ‰å…³ã€‚åœ¨æ—¶åˆ» Bï¼Œä¹Ÿå°±æ˜¯ binlog å†™å®Œä»¥å MySQL å‘ç”Ÿå´©æºƒï¼Œè¿™æ—¶å€™ binlog å·²ç»å†™å…¥äº†ï¼Œä¹‹åå°±ä¼šè¢«ä»åº“ï¼ˆæˆ–è€…ç”¨è¿™ä¸ª binlog æ¢å¤å‡ºæ¥çš„åº“ï¼‰ä½¿ç”¨ã€‚æ‰€ä»¥ï¼Œåœ¨ä¸»åº“ä¸Šä¹Ÿè¦æäº¤è¿™ä¸ªäº‹åŠ¡ã€‚é‡‡ç”¨è¿™ä¸ªç­–ç•¥ï¼Œä¸»åº“å’Œå¤‡åº“çš„æ•°æ®å°±ä¿è¯äº†ä¸€è‡´æ€§ã€‚\n\nå¦‚æœè¿™æ ·çš„è¯ï¼Œä¸ºä»€ä¹ˆè¿˜è¦ä¸¤é˜¶æ®µæäº¤å‘¢ï¼Ÿå¹²è„†å…ˆ Redo Log å†™å®Œï¼Œå†å†™ binlogã€‚å´©æºƒæ¢å¤çš„æ—¶å€™ï¼Œå¿…é¡»å¾—ä¸¤ä¸ªæ—¥å¿—éƒ½å®Œæ•´æ‰å¯ä»¥ã€‚æ˜¯ä¸æ˜¯ä¸€æ ·çš„é€»è¾‘ï¼Ÿ Â§\n\nä¸¤é˜¶æ®µæäº¤æ˜¯ç»å…¸çš„åˆ†å¸ƒå¼ç³»ç»Ÿé—®é¢˜ï¼Œå¹¶ä¸æ˜¯ MySQL ç‹¬æœ‰ã€‚\nè¿™ä¹ˆåšçš„å¿…è¦æ€§æ˜¯äº‹åŠ¡çš„æŒä¹…æ€§é—®é¢˜ã€‚\n\nå¯¹äº InnoDB å¼•æ“æ¥è¯´ï¼Œå¦‚æœ redo log æäº¤å®Œæˆäº†ï¼Œäº‹åŠ¡å°±ä¸èƒ½å›æ»šï¼ˆå¦‚æœè¿™è¿˜å…è®¸å›æ»šï¼Œå°±å¯èƒ½è¦†ç›–æ‰åˆ«çš„äº‹åŠ¡çš„æ›´æ–°ï¼‰ã€‚è€Œå¦‚æœ redo log ç›´æ¥æäº¤ï¼Œç„¶å binlog å†™å…¥çš„æ—¶å€™å¤±è´¥ï¼ŒInnoDB åˆå›æ»šä¸äº†ï¼Œæ•°æ®å’Œ binlog æ—¥å¿—ä¼šä¸ä¸€è‡´ã€‚\n\n\n\nä¸å¼•å…¥ä¸¤ä¸ªæ—¥å¿—ï¼Œä¹Ÿå°±æ²¡æœ‰ä¸¤é˜¶æ®µæäº¤çš„å¿…è¦äº†ã€‚åªç”¨ Binlog æ¥æ”¯æŒå´©æºƒæ¢å¤ï¼Œåˆèƒ½æ”¯æŒå½’æ¡£ï¼Œä¸å°±å¯ä»¥äº†ï¼Ÿ Â§\n\n\nbinlog æ²¡æœ‰å´©æºƒæ¢å¤çš„èƒ½åŠ›\n\nå¦‚æœå›¾ä¸­æ ‡çš„ä½ç½®ï¼Œbinlog2 å†™å®Œäº†ï¼Œä½†æ˜¯æ•´ä¸ªäº‹åŠ¡è¿˜æ²¡æœ‰ commit çš„æ—¶å€™ï¼ŒMySQL å‘ç”Ÿäº† crashã€‚é‡å¯åå¼•æ“å†…éƒ¨äº‹åŠ¡ 2 ä¼šå›æ»šï¼Œç„¶ååº”ç”¨ binlog2 å¯ä»¥è¡¥å›æ¥ï¼›ä½†æ˜¯å¯¹äºäº‹åŠ¡ 1ï¼Œç³»ç»Ÿå·²ç»è®¤ä¸ºæäº¤å®Œæˆäº†ï¼Œä¸ä¼šå†åº”ç”¨ä¸€æ¬¡ binlog1ã€‚ä½†æ˜¯ï¼Œbinlog å¼•æ“ä½¿ç”¨çš„æ˜¯ WAL æŠ€æœ¯ï¼Œæ‰§è¡Œäº‹åŠ¡çš„æ—¶å€™ï¼Œå†™å®Œå†…å­˜å’Œæ—¥å¿—ï¼Œäº‹åŠ¡å°±ç®—å®Œæˆäº†ã€‚å¦‚æœä¹‹åå´©æºƒï¼Œè¦ä¾èµ–äºæ—¥å¿—æ¥æ¢å¤æ•°æ®é¡µã€‚å¦‚æœåœ¨å›¾ä¸­è¿™ä¸ªä½ç½®å‘ç”Ÿå´©æºƒçš„è¯ï¼Œäº‹åŠ¡ 1 ä¹Ÿæ˜¯å¯èƒ½ä¸¢å¤±äº†çš„ï¼Œè€Œä¸”æ˜¯æ•°æ®é¡µçº§çš„ä¸¢å¤±ã€‚æ­¤æ—¶ï¼Œbinlog é‡Œé¢å¹¶æ²¡æœ‰è®°å½•æ•°æ®é¡µçš„æ›´æ–°ç»†èŠ‚ï¼Œæ˜¯è¡¥ä¸å›æ¥çš„ã€‚\n\n\nå¦‚æœä¼˜åŒ–ä¸€ä¸‹ binlog çš„å†…å®¹ï¼Œè®©å®ƒæ¥è®°å½•æ•°æ®é¡µçš„æ›´æ–°å¯ä»¥å—ï¼Ÿè¿™å…¶å®å°±æ˜¯åˆåšäº†ä¸€ä¸ª redo log å‡ºæ¥ã€‚è‡³å°‘ç°åœ¨çš„ binlog èƒ½åŠ›è¿˜ä¸æ”¯æŒå´©æºƒæ¢å¤ã€‚ï¼ˆMySQL 8.0ï¼‰\n\né‚£èƒ½ä¸èƒ½åè¿‡æ¥ï¼Œåªç”¨ Redo logï¼Œä¸è¦ binlogï¼Ÿ Â§\n\nå¦‚æœåªä»å´©æºƒæ¢å¤çš„è§’åº¦æ¥è®²æ˜¯å¯ä»¥çš„ã€‚æŠŠ binlog å…³æ‰ï¼Œè¿™æ ·å°±æ²¡æœ‰ä¸¤é˜¶æ®µæäº¤ï¼Œä½†ç³»ç»Ÿä¾ç„¶æ˜¯ crash-safe çš„ã€‚\nbinlog æœ‰ç€ redo log æ— æ³•æ›¿ä»£çš„åŠŸèƒ½\n\nå½’æ¡£ã€‚redo log æ˜¯å¾ªç¯å†™ï¼Œå†™åˆ°æœ«å°¾æ˜¯è¦å›åˆ°å¼€å¤´ç»§ç»­å†™çš„ã€‚è¿™æ ·å†å²æ—¥å¿—æ²¡æ³•ä¿ç•™ï¼Œredo log èµ·ä¸åˆ°å½’æ¡£çš„ä½œç”¨ã€‚\nMySQL ç³»ç»Ÿä¾èµ–äº binlogã€‚binlog ä½œä¸º MySQL ä¸€å¼€å§‹å°±æœ‰çš„åŠŸèƒ½ï¼Œè¢«ç”¨åœ¨äº†å¾ˆå¤šåœ°æ–¹ã€‚å…¶ä¸­ï¼ŒMySQL ç³»ç»Ÿé«˜å¯ç”¨çš„åŸºç¡€å°±æ˜¯ binlog å¤åˆ¶ã€‚\nå¾ˆå¤šå…¬å¸æœ‰å¼‚æ„ç³»ç»Ÿï¼ˆæ¯”å¦‚ä¸€äº›æ•°æ®åˆ†æç³»ç»Ÿï¼‰ï¼Œè¿™äº›ç³»ç»Ÿé æ¶ˆè´¹ MySQL çš„ binlog æ¥æ›´æ–°è‡ªå·±çš„æ•°æ®ã€‚\n\n\n\nRedo Log ä¸€èˆ¬è®¾ç½®å¤šå¤§ï¼Ÿ Â§\n\nredo log å¤ªå°ä¼šå¯¼è‡´å¾ˆå¿«å°±è¢«å†™æ»¡ï¼Œç„¶åä¸å¾—ä¸å¼ºè¡Œåˆ· redo logï¼ŒWAL æœºåˆ¶çš„èƒ½åŠ›å‘æŒ¥ä¸å‡ºæ¥ã€‚\nå¦‚æœæ˜¯ç°åœ¨å¸¸è§çš„å‡ ä¸ª TB çš„ç£ç›˜çš„è¯ï¼Œç›´æ¥å°† redo log è®¾ç½®ä¸º 4 ä¸ªæ–‡ä»¶ã€æ¯ä¸ªæ–‡ä»¶ 1GBã€‚\n\næ­£å¸¸è¿è¡Œä¸­çš„å®ä¾‹ï¼Œæ•°æ®å†™å…¥åçš„æœ€ç»ˆè½ç›˜ï¼Œæ˜¯ä» Redo Log æ›´æ–°è¿‡æ¥çš„è¿˜æ˜¯ä» Buffer Pool æ›´æ–°è¿‡æ¥çš„å‘¢ï¼Ÿ Â§\n\nredo log å¹¶æ²¡æœ‰è®°å½•æ•°æ®é¡µçš„å®Œæ•´æ•°æ®ï¼Œå®ƒå¹¶æ²¡æœ‰èƒ½åŠ›è‡ªå·±å»æ›´æ–°ç£ç›˜æ•°æ®é¡µï¼Œä¸å­˜åœ¨â€œæ•°æ®æœ€ç»ˆè½ç›˜ï¼Œæ˜¯ç”± redo log æ›´æ–°è¿‡å»â€çš„æƒ…å†µã€‚\nå¦‚æœæ˜¯æ­£å¸¸è¿è¡Œçš„å®ä¾‹ï¼Œæ•°æ®é¡µè¢«ä¿®æ”¹ä»¥åï¼Œè·Ÿç£ç›˜çš„æ•°æ®é¡µä¸ä¸€è‡´ï¼Œç§°ä¸ºè„é¡µã€‚æœ€ç»ˆæ•°æ®è½ç›˜ï¼Œå°±æ˜¯æŠŠå†…å­˜ä¸­çš„æ•°æ®é¡µå†™ç›˜ã€‚è¿™ä¸ªè¿‡ç¨‹ï¼Œä¸ redo log æ¯«æ— å…³ç³»ã€‚\nåœ¨å´©æºƒæ¢å¤åœºæ™¯ä¸­ï¼ŒInnoDB å¦‚æœåˆ¤æ–­åˆ°ä¸€ä¸ªæ•°æ®é¡µå¯èƒ½åœ¨å´©æºƒæ¢å¤çš„æ—¶å€™ä¸¢å¤±äº†æ›´æ–°ï¼Œå°±ä¼šå°†å®ƒè¯»åˆ°å†…å­˜ï¼Œç„¶åè®© redo log æ›´æ–°å†…å­˜å†…å®¹ã€‚æ›´æ–°å®Œæˆåï¼Œå†…å­˜é¡µå˜æˆè„é¡µï¼Œå°±å›åˆ°äº†ç¬¬ä¸€ç§æƒ…å†µçš„çŠ¶æ€ã€‚\n\nRedo Log Buffer æ˜¯ä»€ä¹ˆï¼Ÿæ˜¯å…ˆä¿®æ”¹å†…å­˜ï¼Œè¿˜æ˜¯å…ˆå†™ Redo Log æ–‡ä»¶ï¼Ÿ Â§\n\nåœ¨ä¸€ä¸ªäº‹åŠ¡çš„æ›´æ–°è¿‡ç¨‹ä¸­ï¼Œæ—¥å¿—éœ€è¦å†™å¤šæ¬¡ã€‚\n\næ¯”å¦‚ï¼šbegin; insert into t1 â€¦; insert into t2 â€¦; commit;\nè¿™ä¸ªäº‹åŠ¡è¦å¾€ä¸¤ä¸ªè¡¨ä¸­æ’å…¥è®°å½•ï¼Œæ’å…¥æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œç”Ÿæˆçš„æ—¥å¿—éƒ½å¾—å…ˆä¿å­˜èµ·æ¥ï¼Œä½†åˆä¸èƒ½åœ¨è¿˜æ²¡ commit çš„æ—¶å€™å°±ç›´æ¥å†™åˆ° redo log æ–‡ä»¶é‡Œã€‚\næ‰€ä»¥ï¼Œredo log buffer å°±æ˜¯ä¸€å—å†…å­˜ï¼Œç”¨æ¥å…ˆå­˜ redo æ—¥å¿—ã€‚\nåœ¨æ‰§è¡Œç¬¬ä¸€ä¸ª insert çš„æ—¶å€™ï¼Œæ•°æ®çš„å†…å­˜è¢«ä¿®æ”¹äº†ï¼Œredo log buffer ä¹Ÿå†™å…¥äº†æ—¥å¿—ã€‚\nä½†æ˜¯ï¼ŒçœŸæ­£æŠŠæ—¥å¿—å†™åˆ° redo log æ–‡ä»¶ï¼ˆæ–‡ä»¶åæ˜¯ ib_logfile+ æ•°å­—ï¼‰ï¼Œæ˜¯åœ¨æ‰§è¡Œ commit è¯­å¥çš„æ—¶å€™åšçš„ã€‚\nè¿™é‡Œè¯´çš„æ˜¯äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸ä¼šâ€œä¸»åŠ¨å»åˆ·ç›˜â€ï¼Œä»¥å‡å°‘ä¸å¿…è¦çš„ IO æ¶ˆè€—ã€‚ä½†æ˜¯å¯èƒ½ä¼šå‡ºç°â€œè¢«åŠ¨å†™å…¥ç£ç›˜â€ï¼Œæ¯”å¦‚å†…å­˜ä¸å¤Ÿã€å…¶ä»–äº‹åŠ¡æäº¤ç­‰æƒ…å†µã€‚è¿™ä¸ªé—®é¢˜æˆ‘ä»¬ä¼šåœ¨ 22ï½œMySQLæœ‰å“ªäº›â€œé¥®é¸©æ­¢æ¸´â€æé«˜æ€§èƒ½çš„æ–¹æ³•ï¼Ÿ ä¸­å†è¯¦ç»†å±•å¼€ã€‚\n\n\nå•ç‹¬æ‰§è¡Œä¸€ä¸ªæ›´æ–°è¯­å¥çš„æ—¶å€™ï¼ŒInnoDB ä¼šè‡ªå·±å¯åŠ¨ä¸€ä¸ªäº‹åŠ¡ï¼Œåœ¨è¯­å¥æ‰§è¡Œå®Œæˆçš„æ—¶å€™æäº¤ã€‚è¿‡ç¨‹è·Ÿä¸Šé¢æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡æ˜¯â€œå‹ç¼©â€åˆ°äº†ä¸€ä¸ªè¯­å¥é‡Œé¢å®Œæˆã€‚\n"},"å­¦ä¹ ç¬”è®°/MySQL-å®æˆ˜-45-è®²/03ï½œäº‹åŠ¡éš”ç¦»ï¼šä¸ºä»€ä¹ˆä½ æ”¹äº†ä¸ºè¿˜çœ‹ä¸è§ï¼Ÿ":{"title":"03ï½œäº‹åŠ¡éš”ç¦»ï¼šä¸ºä»€ä¹ˆä½ æ”¹äº†ä¸ºè¿˜çœ‹ä¸è§ï¼Ÿ","links":[],"tags":["mysql"],"content":"éš”ç¦»å‹ä¸éš”ç¦»çº§åˆ« Â§\n\nè¯»æœªæäº¤ read uncommitted\n\nä¸€ä¸ªäº‹åŠ¡è¿˜æ²¡æäº¤æ—¶ï¼Œå®ƒåšçš„å˜æ›´å°±èƒ½è¢«åˆ«çš„äº‹åŠ¡çœ‹åˆ°ã€‚\n\n\nè¯»æäº¤ read committed\n\nä¸€ä¸ªäº‹åŠ¡æäº¤ä¹‹åï¼Œå®ƒåšçš„å˜æ›´æ‰ä¼šè¢«å…¶ä»–äº‹åŠ¡çœ‹åˆ°ã€‚\n\n\nå¯é‡å¤è¯» repeatable read\n\nä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çœ‹åˆ°çš„æ•°æ®ï¼Œæ€»æ˜¯è·Ÿè¿™ä¸ªäº‹åŠ¡åœ¨å¯åŠ¨æ—¶çœ‹åˆ°çš„æ•°æ®æ˜¯ä¸€è‡´çš„ã€‚å½“ç„¶åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œæœªæäº¤å˜æ›´å¯¹å…¶ä»–äº‹åŠ¡ä¹Ÿæ˜¯ä¸å¯è§çš„ã€‚\n\n\nä¸²è¡ŒåŒ– serializable\n\nå¯¹äºåŒä¸€è¡Œè®°å½•ï¼Œâ€œå†™â€ä¼šåŠ â€œå†™é”â€ï¼Œâ€œè¯»â€ä¼šåŠ â€œè¯»é”â€ã€‚å½“å‡ºç°è¯»å†™é”å†²çªçš„æ—¶å€™ï¼Œåè®¿é—®çš„äº‹åŠ¡å¿…é¡»ç­‰å‰ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œå®Œæˆï¼Œæ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚\n\n\nè®¾ç½®éš”ç¦»çº§åˆ«\n\nselect @@transaction_isolation;\nset @global transaction isolation level read committed;\n\n\n\näº‹åŠ¡éš”ç¦»çš„å®ç° Â§\n\nä»¥å¯é‡å¤è¯»ä¸ºä¾‹\næ¯æ¡è®°å½•åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåŒæ—¶è®°å½•ä¸€æ¡å›æ»šæ“ä½œ\n\nè®°å½•ä¸Šçš„æœ€æ–°å€¼ï¼Œé€šè¿‡å›æ»šæ“ä½œï¼Œéƒ½å¯ä»¥å¾—åˆ°å‰ä¸€ä¸ªçŠ¶æ€çš„å€¼\n\n\n\n\nç³»ç»Ÿä¼šåˆ¤æ–­ï¼Œå½“æ²¡æœ‰äº‹åŠ¡å†éœ€è¦ç”¨åˆ°è¿™äº›å›æ»šæ—¥å¿—æ—¶ï¼Œå›æ»šæ—¥å¿—æ‰ä¼šè¢«åˆ é™¤\n\nå¦‚äº‹åŠ¡æäº¤ä¹‹å‰éƒ½å¯èƒ½ç”¨åˆ°\nâš ï¸ ä¸è¦ä½¿ç”¨é•¿äº‹åŠ¡\n\n\nMySQL 5.5 åŠä¹‹å‰çš„ç‰ˆæœ¬ï¼Œå›æ»šæ—¥å¿—è·Ÿæ•°æ®å­—å…¸ä¸€èµ·æ”¾åœ¨ ibdata æ–‡ä»¶é‡Œï¼Œå³ä½¿é•¿äº‹åŠ¡æœ€ç»ˆæäº¤ï¼Œå›æ»šæ®µè¢«æ¸…ç†ï¼Œæ–‡ä»¶ä¹Ÿä¸ä¼šå˜å°ï¼Œåªèƒ½é‡å»ºæ•´ä¸ªåº“è¿›è¡Œé‡Šæ”¾\n\n\n\näº‹åŠ¡çš„å¯åŠ¨æ–¹å¼ Â§\n\n\n\næ˜¾å¼å¯åŠ¨äº‹åŠ¡è¯­å¥ï¼ˆset autocommit=1ï¼‰ï¼Œbegin æˆ– start transactionã€‚\n\n\né…å¥—çš„æäº¤è¯­å¥æ˜¯ commitï¼Œå›æ»šè¯­å¥æ˜¯ rollbackã€‚\nå¦‚æœæ‰§è¡Œ commit work and chainï¼Œåˆ™æ˜¯æäº¤äº‹åŠ¡å¹¶è‡ªåŠ¨å¯åŠ¨ä¸‹ä¸€ä¸ªäº‹åŠ¡ï¼Œè¿™æ ·ä¹Ÿçœå»äº†å†æ¬¡æ‰§è¡Œ begin è¯­å¥çš„å¼€é”€ã€‚åŒæ—¶å¸¦æ¥çš„å¥½å¤„æ˜¯ä»ç¨‹åºå¼€å‘çš„è§’åº¦æ˜ç¡®åœ°çŸ¥é“æ¯ä¸ªè¯­å¥æ˜¯å¦å¤„äºäº‹åŠ¡ä¸­ã€‚\n\n\n\n\nset autocommit=0ï¼Œè¿™ä¸ªå‘½ä»¤ä¼šå°†è¿™ä¸ªçº¿ç¨‹çš„è‡ªåŠ¨æäº¤å…³æ‰ã€‚æ„å‘³ç€å¦‚æœä½ åªæ‰§è¡Œä¸€ä¸ª select è¯­å¥ï¼Œè¿™ä¸ªäº‹åŠ¡å°±å¯åŠ¨äº†ï¼Œè€Œä¸”å¹¶ä¸ä¼šè‡ªåŠ¨æäº¤ã€‚è¿™ä¸ªäº‹åŠ¡æŒç»­å­˜åœ¨ç›´åˆ°ä½ ä¸»åŠ¨æ‰§è¡Œ commit æˆ– rollback è¯­å¥ï¼Œæˆ–è€…æ–­å¼€è¿æ¥ã€‚\n\n\nå»ºè®®æ€»æ˜¯ä½¿ç”¨ set autocommit=1ï¼Œé€šè¿‡æ˜¾ç¤ºè¯­å¥çš„æ–¹å¼æ¥å¯åŠ¨äº‹åŠ¡\n\n\nå¯ä»¥åœ¨ information_schema åº“çš„ innodb_trx è¿™ä¸ªè¡¨ä¸­æŸ¥è¯¢é•¿äº‹åŠ¡\n\næŸ¥æ‰¾æŒç»­æ—¶é—´è¶…è¿‡ 60s çš„äº‹åŠ¡\n\nselect * from information_schema.innodb_trx where TIME_TO_SEC(timediff(now(),trx_started))&gt;60\n\n\n\n\næ‰§è¡Œ begin åé¢çš„ç¬¬ä¸€ä¸ª SQL è¯­å¥æ—¶ï¼Œäº‹åŠ¡æ‰çœŸæ­£å¯åŠ¨ï¼Œå¦‚ select\n\næ€è€ƒé¢˜ Â§\n\nä½ ç°åœ¨çŸ¥é“äº†ç³»ç»Ÿé‡Œé¢åº”è¯¥é¿å…é•¿äº‹åŠ¡ï¼Œå¦‚æœä½ æ˜¯ä¸šåŠ¡å¼€å‘è´Ÿè´£äººåŒæ—¶ä¹Ÿæ˜¯æ•°æ®åº“è´Ÿè´£äººï¼Œä½ ä¼šæœ‰ä»€ä¹ˆæ–¹æ¡ˆæ¥é¿å…å‡ºç°æˆ–è€…å¤„ç†è¿™ç§æƒ…å†µå‘¢ï¼Ÿ\n\nä»åº”ç”¨å¼€å‘ç«¯æ¥çœ‹\n\nè®¾ç½® set autocommit=1\n\n\nåœ¨æµ‹è¯•ç¯å¢ƒçœ‹ï¼ŒæŠŠ MySQL çš„ general_log å¼€èµ·æ¥ï¼Œéšä¾¿è·‘ä¸€ä¸ªä¸šåŠ¡é€»è¾‘ï¼Œé€šè¿‡ general_log çš„æ—¥å¿—ç¡®è®¤ autocommit å€¼\n\n\nç¡®è®¤æ˜¯å¦æœ‰ä¸å¿…è¦çš„åªè¯»äº‹åŠ¡\né€šè¿‡ SET MAX_EXECUTION_TIME å‘½ä»¤æ§åˆ¶æ¯ä¸ªè¯­å¥æ‰§è¡Œçš„æœ€é•¿æ—¶é—´ï¼Œé¿å…å•ä¸ªè¯­å¥æ„å¤–æ‰§è¡Œå¤ªé•¿æ—¶é—´ã€‚\n\n\nä»æ•°æ®åº“ç«¯æ¥çœ‹\n\nç›‘æ§ information_schema.Innodb_trx è¡¨ï¼Œè®¾ç½®é•¿äº‹åŠ¡é˜ˆå€¼ï¼Œè¶…è¿‡å°±æŠ¥è­¦æˆ–è€… kill\næ¨èä½¿ç”¨ Percona çš„ pt-kill å·¥å…·\nåœ¨ä¸šåŠ¡åŠŸèƒ½æµ‹è¯•é˜¶æ®µè¦æ±‚è¾“å‡ºæ‰€æœ‰çš„ general_logï¼Œåˆ†ææ—¥å¿—è¡Œä¸ºæå‰å‘ç°é—®é¢˜\nâš ï¸ å¦‚æœä½¿ç”¨çš„æ˜¯ MySQL 5.6 æˆ–è€…æ›´æ–°ç‰ˆæœ¬ï¼ŒæŠŠ innodb_undo_tablespaces è®¾ç½®æˆ 2ï¼ˆæˆ–æ›´å¤§çš„å€¼ï¼‰ã€‚å¦‚æœçœŸçš„å‡ºç°å¤§äº‹åŠ¡å¯¼è‡´å›æ»šæ®µè¿‡å¤§ï¼Œè¿™æ ·è®¾ç½®åæ¸…ç†èµ·æ¥æ›´æ–¹ä¾¿\n\n\ninnodb_undo_tablespaces æ˜¯æ§åˆ¶ undo æ˜¯å¦å¼€å¯ç‹¬ç«‹çš„è¡¨ç©ºé—´çš„å‚æ•°ã€‚ä¸º 0 è¡¨ç¤ºï¼šundo ä½¿ç”¨ç³»ç»Ÿè¡¨ç©ºé—´ï¼Œå³ ibdata1ã€‚ä¸ä¸º 0 è¡¨ç¤ºï¼šä½¿ç”¨ç‹¬ç«‹çš„è¡¨ç©ºé—´ï¼Œä¸€èˆ¬åç§°ä¸º undo001 undo002ï¼Œå­˜æ”¾åœ°å€çš„é…ç½®é¡¹ä¸ºï¼šinnodb_undo_directoryã€‚ä¸€èˆ¬ innodb_undo_tablespaces é»˜è®¤é…ç½®ä¸º 0ï¼Œinnodb_undo_directory é»˜è®¤é…ç½®ä¸ºå½“å‰æ•°æ®ç›®å½•\ninnodb_undo_tablespaces\n\né»˜è®¤ä¸º 0ï¼Œå³å›æ»šæ®µä¿å­˜åœ¨ ibata æ–‡ä»¶ä¸­\nè®¾ç½®ä¸º 2ï¼Œè¡¨ç¤ºåœ¨ undo ç›®å½•ä¸‹åˆ›å»º 2 ä¸ªæ–‡ä»¶ï¼ˆæ¯ä¸ªé»˜è®¤å¤§å° 10mï¼‰ï¼Œæœ€å¤šåˆ›å»º 126 ä¸ªï¼Œä¸€èˆ¬åç§°ä¸º undo001 undo002\n\n\ninnodb_undo_logsï¼šå›æ»šæ®µä¸ªæ•°ï¼Œé»˜è®¤ 128\ninnodb_undo_directoryï¼šå›æ»šæ—¥å¿—å­˜æ”¾ç›®å½•ï¼Œé»˜è®¤ä¸ºå½“å‰æ•°æ®ç›®å½•\n\n\n\n\n"},"å­¦ä¹ ç¬”è®°/MySQL-å®æˆ˜-45-è®²/04ï½œæ·±å…¥æµ…å‡ºç´¢å¼•ï¼ˆä¸Šï¼‰":{"title":"04ï½œæ·±å…¥æµ…å‡ºç´¢å¼•ï¼ˆä¸Šï¼‰","links":["%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/12%EF%BD%9C%E4%B8%BA%E4%BB%80%E4%B9%88%E6%88%91%E7%9A%84-MySQL-%E4%BC%9A%E2%80%9C%E6%8A%96%E2%80%9D%E4%B8%80%E4%B8%8B%EF%BC%9F"],"tags":["mysql"],"content":"\næ¯é‡åˆ°ä¸€ä¸ªæ–°æ•°æ®åº“ï¼Œå…ˆå…³æ³¨å®ƒçš„æ•°æ®æ¨¡å‹ï¼Œåˆ†ææ•°æ®åº“çš„é€‚ç”¨åœºæ™¯\næ•°æ®åº“åº•å±‚å­˜å‚¨çš„æ ¸å¿ƒåŸºäºçš„æ•°æ®æ¨¡å‹ï¼šå“ˆå¸Œè¡¨ã€æœ‰åºæ•°ç»„ã€äºŒå‰æ ‘ã€N å‰æ ‘ç­‰\n\nInnoDB çš„ç´¢å¼•æ¨¡å‹ Â§\n\næ¯ä¸€ä¸ªç´¢å¼•åœ¨ InnoDB é‡Œé¢å¯¹åº”ä¸€é¢— B+ æ ‘\nä¸»é”®ç´¢å¼•ä¹Ÿè¢«ç§°ä¸ºèšç°‡ç´¢å¼•ï¼ˆclustered indexï¼‰\n\nå¶å­èŠ‚ç‚¹å†…å®¹æ˜¯æ•´è¡Œæ•°æ®\nä¸»é”®æŸ¥è¯¢åªéœ€è¦æœç´¢ä¸»é”®è¿™é¢— B+ æ ‘\næ•´å¼ è¡¨çš„æ•°æ®å­˜åœ¨ä¸»é”®ç´¢å¼•ä¸­ï¼Œè¿™å°±æ˜¯â€œèšç°‡ç´¢å¼•â€çš„æ„æ€\n\n\néä¸»é”®ç´¢å¼•ä¹Ÿè¢«ç§°ä¸ºäºŒçº§ç´¢å¼•ï¼ˆsecondary indexï¼‰\n\nå¶å­èŠ‚ç‚¹å†…å®¹æ˜¯ä¸»é”®çš„å€¼\n\nå¦‚æœä¸»é”®ç´¢å¼•æ˜¯å¤šä¸ªåˆ—ï¼ŒäºŒçº§ç´¢å¼•é‡ŒåŒ…å«çš„ä¸»é”®ä¹Ÿæ˜¯å¤šåˆ—\n\n\nå›è¡¨ï¼šæ™®é€šç´¢å¼•æŸ¥è¯¢ï¼Œå…ˆæ‹¿åˆ°ä¸»é”®ï¼Œå†åˆ°ä¸»é”®ç´¢å¼•æ ‘æœç´¢ä¸€æ¬¡\n\n\nå¶å­èŠ‚ç‚¹æ˜¯ pageï¼ˆæ•°æ®é¡µï¼‰ï¼Œä¸€ä¸ªé¡µé‡Œé¢å¯ä»¥å­˜å¤šä¸ªè¡Œ\n\né¡µå¤§å° 16kï¼Œåˆ™è¡Œä¸ªæ•° = 16k/è¡Œå¤§å°\n\n\nç´¢å¼•ç»´æŠ¤\n\né¡µåˆ†è£‚\n\næ–°å¢åŠ ä¸€ä¸ªæ•°æ®é¡µï¼ŒæŒªåŠ¨éƒ¨åˆ†æ•°æ®è¿‡å»ï¼Œç©ºé—´åˆ©ç”¨ç‡é™ä½å¤§æ¦‚ 50%\nä¸æŒªåŠ¨æ•°æ®çš„æ–°å¢æ•°æ®é¡µæ“ä½œä¸å«é¡µåˆ†è£‚\n\n\nå½“ç›¸é‚»çš„ä¸¤ä¸ªæ•°æ®é¡µåˆ©ç”¨ç‡å¾ˆä½çš„æ—¶å€™ä¼šåšæ•°æ®é¡µåˆå¹¶\n\n\nä¸»é”®\n\nå»ºè®®ä½¿ç”¨è‡ªå¢ä¸»é”®\n\nå»ºè®®è®¾ç½® bigint unsigned\n\n\nä½¿ç”¨ä¸šåŠ¡ä¸»é”®çš„åœºæ™¯ï¼ˆå…¸å‹çš„ KV åœºæ™¯ï¼‰\n\nåªæœ‰ä¸€ä¸ªç´¢å¼•\nè¯¥ç´¢å¼•å¿…é¡»æ˜¯å”¯ä¸€ç´¢å¼•\n\n\næ²¡æœ‰ä¸»é”®çš„è¡¨ï¼ŒInnoDB ä¼šé»˜è®¤åˆ›å»ºä¸€ä¸ª RowId åšä¸»é”®\nâš ï¸ åŠ ä¸»é”®ä¼šé‡å»ºè¡¨\n\n\nç´¢å¼•åªèƒ½å®šä½åˆ° pageï¼Œpage å†…éƒ¨æ˜¯ä¸ªæœ‰åºæ•°ç»„ï¼Œç”¨äºŒåˆ†æ³•\n\næ•°æ®é¡µä¸­æœ‰é¡µç›®å½•ï¼Œé¡µç›®å½•çš„ key ä¸º id ï¼Œvalue ä¸ºæ§½ä½\näºŒåˆ†æœç´¢é¡µç›®å½•å®šä½åˆ°æ§½ä½ä¸­çš„è¡Œè®°å½•\nå†…å­˜æ•°æ®é¡µå’Œç£ç›˜æ•°æ®é¡µæ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼ŒæŒä¹…åŒ–çš„æ—¶å€™ç›´æ¥è¦†ç›–å†™è¿›å»\n\n\nå¶å­èŠ‚ç‚¹ä¸­çš„æ•°æ®è¿æ¥æ–¹å¼\n\nå¶å­å†…æ˜¯å•å‘é“¾è¡¨\nå¶å­é—´æ˜¯åŒå‘é“¾è¡¨\n\n\n\nä»€ä¹ˆæ—¶å€™éœ€è¦é‡å»ºç´¢å¼• Â§\n\nç´¢å¼•å¯èƒ½å› ä¸ºåˆ é™¤æ“ä½œã€é¡µåˆ†è£‚ç­‰åŸå› ï¼Œå¯¼è‡´æ•°æ®é¡µæœ‰ç©ºæ´\n\nå³ç©ºé—´æœªé‡Šæ”¾\n\n\né‡å»ºç´¢å¼•çš„è¿‡ç¨‹ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç´¢å¼•ï¼ŒæŠŠæ•°æ®æŒ‰é¡ºåºæ’å…¥ï¼Œé¡µé¢çš„åˆ©ç”¨ç‡æœ€é«˜ï¼Œæ›´çœç©ºé—´\n\næ€è€ƒé¢˜ Â§\n\né‡å»ºæ™®é€š k ç´¢å¼•\n\nalter table T drop index k;\nalter table T add index(k);\n\n\né‡å»ºä¸»é”®ç´¢å¼•\n\nalter table T drop primary key;\nalter table T add primary key(id);\n\n\nå¯¹äºä¸Šé¢è¿™ä¸¤ä¸ªé‡å»ºç´¢å¼•çš„åšæ³•ï¼Œè¯´å‡ºä½ çš„ç†è§£ã€‚\n\né‡å»ºç´¢å¼• k çš„åšæ³•åˆç†ï¼Œå¯ä»¥è¾¾åˆ°çœç©ºé—´çš„ç›®çš„\né‡å»ºä¸»é”®çš„è¿‡ç¨‹ä¸åˆç†\n\n\nä¸ºä»€ä¹ˆä¸åˆé€‚ï¼Ÿ\n\nåˆ é™¤æˆ–åˆ›å»ºä¸»é”®éƒ½ä¼šå°†æ•´ä¸ªè¡¨é‡å»ºï¼Œå¯¼è‡´ç¬¬ä¸€ä¸ªè¯­å¥ç™½åš\n\n\næ›´å¥½çš„æ–¹æ³•\n\nä½¿ç”¨ alter table T engine=InnoDB ä»£æ›¿\n\nè§¦å‘ MySQL é‡å»ºè¯¥è¡¨ï¼Œå¹¶è¿›è¡Œç¢ç‰‡å¤„ç†\n5.6 ç‰ˆæœ¬ä»¥åæ”¯æŒ online ddlï¼Œæ²¡æœ‰è¡Œé”ï¼Œæœ‰ mdl è¯»é”\n\n\nåœ¨ç¬¬ 12 è®²æœ‰åˆ†æ 12ï½œä¸ºä»€ä¹ˆæˆ‘çš„ MySQL ä¼šâ€œæŠ–â€ä¸€ä¸‹ï¼Ÿ\n\n\n"},"å­¦ä¹ ç¬”è®°/MySQL-å®æˆ˜-45-è®²/05ï½œæ·±å…¥æµ…å‡ºç´¢å¼•ï¼ˆä¸‹ï¼‰":{"title":"05ï½œæ·±å…¥æµ…å‡ºç´¢å¼•ï¼ˆä¸‹ï¼‰","links":["ElasticSearch","InnoDB"],"tags":["mysql"],"content":"å¦‚ä½•å®‰æ’è”åˆç´¢å¼•å†…çš„å­—æ®µé¡ºåº Â§\n\nç¬¬ä¸€åŸåˆ™ï¼šå¦‚æœé€šè¿‡è°ƒæ•´é¡ºåºï¼Œå¯ä»¥å°‘ç»´æŠ¤ä¸€ä¸ªç´¢å¼•ï¼Œé‚£ä¹ˆè¿™ä¸ªé¡ºåºå¾€å¾€å°±æ˜¯éœ€è¦ä¼˜å…ˆè€ƒè™‘é‡‡ç”¨çš„ã€‚\nå¦‚æœæ—¢æœ‰è”åˆæŸ¥è¯¢ï¼Œåˆæœ‰åŸºäº aã€b å„è‡ªçš„æŸ¥è¯¢ï¼Œæ­¤æ—¶è¦è€ƒè™‘ç©ºé—´\n\næ¯”å¦‚ a æ¯” b å¤§ï¼Œå°±å»º (a, b) + å• b\n\n\nè¿˜æœ‰å…¶ä»–æƒ…å†µï¼Œéœ€è¦ç»“åˆä¸šåŠ¡åˆ†æ\n\næŸ¥è¯¢è¯­å¥çš„ where é‡Œé¢å„ä¸ªåˆ¤æ–­è°ƒæ¢é¡ºåºä¸å½±å“ Â§\nè¦†ç›–ç´¢å¼• Â§\n\nå¦‚æœæŸ¥è¯¢æ¡ä»¶ä½¿ç”¨çš„æ˜¯æ™®é€šç´¢å¼•ï¼ˆæˆ–æ˜¯è”åˆç´¢å¼•çš„æœ€å·¦åŸåˆ™å­—æ®µï¼‰ï¼ŒæŸ¥è¯¢ç»“æœæ˜¯è”åˆç´¢å¼•çš„å­—æ®µæˆ–æ˜¯ä¸»é”®ï¼Œä¸ç”¨å›è¡¨æ“ä½œï¼Œç›´æ¥è¿”å›ç»“æœ\nè¦å…¨ç”¨ä¸Šå¿…é¡»æ˜¯æ¡ä»¶ =ï¼Œä¸èƒ½æ˜¯ &gt; æˆ– &lt;\n\nåœ¨ä¸€ä¸ªå¸‚æ°‘ä¿¡æ¯è¡¨ä¸Šï¼Œæ˜¯å¦æœ‰å¿…è¦å°†èº«ä»½è¯å·å’Œåå­—å»ºç«‹è”åˆç´¢å¼•ï¼Ÿ Â§\n\nå¦‚æœæœ‰ä¸€ä¸ªé«˜é¢‘è¯·æ±‚æ˜¯æ ¹æ®èº«ä»½è¯å·æŸ¥è¯¢å§“åï¼Œå°±æœ‰å¿…è¦\n\nå‰ç¼€ç´¢å¼• Â§\n\næœ€å·¦å‰ç¼€åŸåˆ™\n\nå¯ä»¥æ˜¯è”åˆç´¢å¼•çš„æœ€å·¦ N ä¸ªå­—æ®µ\nä¹Ÿå¯ä»¥æ˜¯å­—ç¬¦ä¸²ç´¢å¼•çš„æœ€å·¦ M ä¸ªå­—ç¬¦\n\n\n\nç´¢å¼•ä¸‹æ¨ Â§\n\nMySQL 5.6 ä¹‹åå¼•å…¥\nå¯ä»¥åœ¨ç´¢å¼•éå†è¿‡ç¨‹ä¸­ï¼Œå¯¹ç´¢å¼•ä¸­åŒ…å«çš„å­—æ®µå…ˆåšåˆ¤æ–­ï¼Œç›´æ¥è¿‡æ»¤æ‰ä¸æ»¡è¶³æ¡ä»¶çš„è®°å½•ï¼Œå‡å°‘å›è¡¨æ¬¡æ•°\nä¾‹å­ï¼šæœ‰ä¸ª (name, age) ç´¢å¼•\n\nwhere name like &#039;å¼ %&#039; and age=10\nå› ä¸ºæœ€å·¦å‰ç¼€åŸåˆ™ï¼Œåªèƒ½ç”¨åˆ° name ç´¢å¼•\n5.6 ä¹‹å‰ï¼šæŸ¥æ‰¾åˆ°æ‰€æœ‰å¼ å¼€å¤´çš„è®°å½•ï¼Œä¸€ä¸ªä¸ªå›è¡¨æ‰¾å‡ºæ•°æ®è¡Œï¼Œå¯¹æ¯” age å­—æ®µå€¼\n5.6 ä¹‹åï¼šç´¢å¼•ä¸‹æ¨\n\n\n\næ€è€ƒé¢˜ Â§\n\nå·²æœ‰æ¡ä»¶\n\nå¤šä¸ªç´¢å¼•\n\nprimary ab (a, b)\nc (c)\nca (c, a)\ncb (c, b)\n\n\nDBA è§£é‡Šï¼šä¸šåŠ¡ä¸­æœ‰ä¸¤ä¸ªè¯­å¥\n\nselect * from geek where c=N order by a limit 1;\nselect * from geek where c=N order by b limit 1;\n\n\næ‰€ä»¥éœ€è¦ ca å’Œ cbï¼Œè€Œä¸æ˜¯å•ä¸ª c\n\n\né—®é¢˜\n\nè¿™æ ·è§£é‡Šå¯¹å—ï¼Œca å’Œ cb æ˜¯å¦éƒ½æ˜¯å¿…é¡»çš„\n\nåªéœ€è¦ cb\n\n\nä¸ºä»€ä¹ˆ\n\nå› ä¸ºå­˜åœ¨ abï¼Œæ™®é€šç´¢å¼•åŒ…å«ä¸»é”®ï¼Œå³ c + ab =&gt; cab\n\n\né¢˜å¤–è¯\n\nå¯¹äº order byï¼Œå¦‚æœç´¢å¼•åˆç†ï¼Œæ•°æ®æœ‰åºï¼Œå°±ä¸éœ€è¦æ’åºäº†\n\n\n\n\n\nè¯„è®ºåŒº Â§\n\né¢è¯•é¢˜ï¼šæ€ä¹ˆè®© MySQL çš„ myisam å¼•æ“æ”¯æŒäº‹åŠ¡\n\nç”¨ lock table å®ç°ï¼Œä½†åªèƒ½å®ç°ä¸²è¡ŒåŒ–éš”ç¦»çº§åˆ«\nå› ä¸º mysiam ä¸æ”¯æŒå´©æºƒæ¢å¤ï¼Œæ‰€ä»¥å³ä½¿ç”¨ lock table ç¡¬å®ç°ï¼Œä¹Ÿæ˜¯é—®é¢˜å¤šå¤š\nACID é‡Œé¢ï¼ŒåŸå­æ€§å’ŒæŒä¹…æ€§åšä¸åˆ°\néš”ç¦»æ€§åªèƒ½å®ç°åŸºæœ¬ç”¨ä¸ä¸Šçš„ä¸²è¡ŒåŒ–\nä¸€è‡´æ€§åœ¨æ­£å¸¸è¿è¡Œçš„æ—¶å€™ä¾èµ–äºä¸²è¡ŒåŒ–ï¼Œåœ¨å¼‚å¸¸å´©æºƒçš„æ—¶å€™ä¹Ÿä¸èƒ½ä¿è¯\nè¿™æ ·å®ç°çš„äº‹åŠ¡ä¸è¦ä¹Ÿç½¢\n\n\nè®¢å•è¡¨æŸ¥è¯¢ï¼Œæœ‰å¤šä¸ªæ¡ä»¶ï¼Œä¸é€‰åˆ™ä¸ä¼ ï¼Œæ€ä¹ˆå»ºç´¢å¼•\n\nè€å¸ˆå›å¤\n\næŒ‰ç…§æŸ¥è¯¢çš„æ¨¡å¼ï¼Œé€‰æœ€å¸¸è§çš„åˆ›å»ºè”åˆç´¢å¼•ã€‚\n\næ¯”å¦‚ï¼Œå¦‚æœæ—¶é—´ + å®¢æˆ·æ ‡å¿—ç”¨å¾—æœ€å¤šï¼Œå°±åˆ›å»ºè¿™ä¸¤ä¸ªçš„è”åˆç´¢å¼•\n\n\næ¯”è¾ƒå°‘ç”¨çš„æ¡ä»¶ï¼Œå°±å•ç‹¬å»ºï¼Œç„¶åæŸ¥ id å‡ºæ¥è·Ÿåˆ«çš„å­—æ®µçš„æŸ¥è¯¢ç»“æœï¼Œåœ¨å®¢æˆ·ç«¯å–äº¤é›†\n\n\nè·Ÿè¯„\n\nç”¨ ElasticSearchï¼Œç›¸å½“äºå…¨å»ºç´¢å¼•\n\nå¥½å¤„æ˜¯å¿«ï¼Œå‡è½»æ•°æ®åº“å‹åŠ›\nåå¤„æ˜¯å¤šç»´æŠ¤ä¸€ä¸ªä¸­é—´ä»¶\n\n\n\n\n\n\nä½¿ç”¨è”åˆç´¢å¼•çš„æ—¶å€™ï¼Œè”åˆç´¢å¼•çš„å¤šä¸ªå±æ€§éƒ½åœ¨åŒä¸€æ£µæ ‘ä¸Š\n\nInnoDB çš„æ™®é€šç´¢å¼•ï¼Œéƒ½æ˜¯è¿™ä¸ªç´¢å¼•å­—æ®µ + ä¸»é”®å­—æ®µçš„è”åˆç´¢å¼•\n\n\nç”¨ key å’Œ index åˆ›å»ºç´¢å¼•æ²¡æœ‰åŒºåˆ«\nä»€ä¹ˆæƒ…å†µä¸‹ä¼šä¸€æ¬¡å–å‡ºå¤šä¸ªä¸»é”®å›è¡¨\n\nè‡ªåŠ¨ï¼Œä»£ç ç‰ˆæœ¬æ”¯æŒå°±ä¼šè¿™ä¹ˆåš\n\n\nè”åˆç´¢å¼•æ˜¯æ€ä¹ˆå­˜å‚¨çš„\n\nè”åˆç´¢å¼•æ˜¯ä¾æ¬¡æŒ‰ç…§è”åˆå­—æ®µçš„å…ˆåé¡ºåºï¼Œä¾æ¬¡è¿›è¡Œæ’åºã€‚å¦‚ a, b, c ä¸‰ä¸ªå­—æ®µæ˜¯è”åˆç´¢å¼•ï¼Œåˆ™å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯ä¸‰ä¸ªå­—æ®µçš„æ•°æ®ï¼Œä¸”æŒ‰ç…§å…ˆåé¡ºåºè¿›è¡Œæ’åºï¼›è€Œéå¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯ç¬¬ä¸€ä¸ªå…³é”®å­—çš„ç´¢å¼•ã€‚æ•…å½“æ‰§è¡ŒæŸ¥è¯¢çš„æ—¶å€™ï¼Œå› ä¸ºè”åˆç´¢å¼•ä¸­æ˜¯å…ˆæ ¹æ® a è¿›è¡Œæ’åºçš„ï¼Œå¦‚æœ a æ²¡æœ‰å…ˆç¡®å®šï¼Œç›´æ¥å¯¹ b æˆ– c è¿›è¡ŒæŸ¥è¯¢çš„è¯ï¼Œå°±ç›¸å½“äºæ˜¯ä¹±åºæŸ¥è¯¢ï¼Œå› æ­¤è”åˆç´¢å¼•æ— æ³•ç”Ÿæ•ˆï¼Œæ­¤æ—¶å°±ç›¸å½“äºæ˜¯å…¨è¡¨æŸ¥è¯¢ã€‚\n\n\nin é€Ÿåº¦å¾ˆå¿«ï¼Œin é‡Œé¢çš„é¡¹é€’å¢è¾“å…¥çš„è¯ï¼Œç†è®ºä¸Šä¼šå¿«äº›\n\nå¦‚æœå¤ªå¤šé¡¹ï¼Œå¯ä»¥æ‹†æˆå¤šä¸ª in()ï¼Œåˆ†æ‰¹å¤„ç†\nâš ï¸ ä¸è¦ç”¨ union all\n\n\nb+ æ ‘ä¸­çš„ç´¢å¼•èŠ‚ç‚¹åº”è¯¥éƒ½æ˜¯ç”±æŒ‡é’ˆå’Œç´¢å¼•ç»„æˆã€‚ä½†ç°åœ¨è¦å°†ç£ç›˜ç´¢å¼•èŠ‚ç‚¹åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè¿™äº›æŒ‡é’ˆåœ°å€æ˜¯æ€ä¹ˆæ˜ å°„çš„ï¼ˆç£ç›˜å’Œå†…å­˜æŒ‡é’ˆçš„æ˜ å°„ï¼‰\n\né¦–å…ˆç£ç›˜çš„æ•°æ®å’Œæ•°æ®é¡µæ˜¯ä¸€æ ·çš„ï¼Œ\næ‰€ä»¥ç£ç›˜åªèƒ½è®°å½• â€œæˆ‘çš„ç¬¬ä¸€ä¸ªå¶å­èŠ‚ç‚¹åœ¨ page_nâ€\nåœ¨å†…å­˜é‡Œé¢ä¹Ÿæ˜¯ï¼Œå½“æŠŠ page_n è¯»åˆ°å†…å­˜ä»¥åï¼Œå†…å­˜é‡Œé¢è®°å½•çš„æ˜¯ page_n çš„å†…å­˜åœ°å€åœ¨å“ªé‡Œ\n\n\n"},"å­¦ä¹ ç¬”è®°/MySQL-å®æˆ˜-45-è®²/06ï½œå…¨å±€é”å’Œè¡¨é”ï¼šç»™è¡¨åŠ ä¸ªå­—æ®µæ€ä¹ˆæœ‰è¿™ä¹ˆå¤šé˜»ç¢ï¼Ÿ":{"title":"06ï½œå…¨å±€é”å’Œè¡¨é”ï¼šç»™è¡¨åŠ ä¸ªå­—æ®µæ€ä¹ˆæœ‰è¿™ä¹ˆå¤šé˜»ç¢ï¼Ÿ","links":[],"tags":["mysql"],"content":"å…¨å±€é” Â§\n\nå…¸å‹ä½¿ç”¨åœºæ™¯ï¼šåšå…¨åº“é€»è¾‘å¤‡ä»½ã€‚\n\nä½¿ç”¨ MySQL æä¾›çš„åŠ å…¨å±€è¯»é”çš„æ–¹æ³•\n\nFlush tables with read lockï¼ˆFTWRLï¼‰\næ•´ä¸ªåº“è¿›å…¥åªè¯»çŠ¶æ€\næ‰§è¡Œ FTWRL å‘½ä»¤ä¹‹åç”±äºå®¢æˆ·ç«¯å‘ç”Ÿå¼‚å¸¸æ–­å¼€ï¼ŒMySQL ä¼šè‡ªåŠ¨é‡Šæ”¾è¿™ä¸ªå…¨å±€é”ï¼Œæ•´ä¸ªåº“å›åˆ°å¯ä»¥æ­£å¸¸æ›´æ–°çš„çŠ¶æ€ã€‚\n\n\næ¨èï¼šåœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹å¼€å¯ä¸€ä¸ªäº‹åŠ¡\n\nå¤‡ä»½æœŸé—´å¯ä»¥æ­£å¸¸è¯»å†™æ•°æ®åº“\néœ€è¦æ‰€æœ‰çš„è¡¨çš„å¼•æ“éƒ½æ”¯æŒï¼ˆå…¨åº“å¤‡ä»½ï¼‰\nmysqldump å¤‡ä»½å·¥å…·ä½¿ç”¨ -single-transaction å‚æ•°ï¼Œå°±ä¼šå¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œç¡®ä¿æ‹¿åˆ°ä¸€è‡´æ€§è§†å›¾\n\n\n\n\nâš ï¸ ä¸ºä»€ä¹ˆä¸ä½¿ç”¨ set global readonly=trueï¼Ÿå»ºè®®ç”¨ FTWRL\n\nåœ¨æœ‰äº›ç³»ç»Ÿä¸­ï¼Œreadonly çš„å€¼ä¼šè¢«ç”¨æ¥åšå…¶ä»–é€»è¾‘ï¼Œæ¯”å¦‚ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªåº“æ˜¯ä¸»åº“è¿˜æ˜¯å¤‡åº“ã€‚\nå°†æ•´ä¸ªåº“è®¾ç½®ä¸º readonly ä¹‹åï¼Œå¦‚æœå®¢æˆ·ç«¯å‘ç”Ÿå¼‚å¸¸ï¼Œåˆ™æ•°æ®åº“å°±ä¼šä¸€ç›´ä¿æŒ readonly çŠ¶æ€ï¼Œè¿™æ ·ä¼šå¯¼è‡´æ•´ä¸ªåº“é•¿æ—¶é—´å¤„äºä¸å¯å†™çŠ¶æ€ï¼Œé£é™©è¾ƒé«˜ã€‚\nreadonly å¯¹ super æƒé™çš„ç”¨æˆ·æ— æ•ˆ\n\n\n\nè¡¨çº§é” Â§\n\nè¡¨é”\n\nè¯­æ³•ï¼šlock tables â€¦ read/write\nunlock tables ä¸»åŠ¨é‡Šæ”¾é”ï¼Œæˆ–è€…å®¢æˆ·ç«¯æ–­å¼€æ—¶è‡ªåŠ¨é‡Šæ”¾\né™¤äº†ä¼šé™åˆ¶åˆ«çš„çº¿ç¨‹çš„è¯»å†™ï¼Œä¹Ÿä¼šé™å®šæœ¬çº¿ç¨‹è‡ªå·±æ¥ä¸‹æ¥çš„æ“ä½œå¯¹è±¡\nä¸æ¨èä½¿ç”¨ï¼Œè‹¥å¼•æ“ä¸æ”¯æŒäº‹åŠ¡ï¼Œå®‰æ’å‡çº§æ¢å¼•æ“ã€‚\n\nå‡çº§åæŠŠä½¿ç”¨ lock/unlock tables è¯­æ³•çš„åœ°æ–¹æ¢æˆ begin å’Œ commitã€‚\n\n\n\n\nå…ƒæ•°æ®é” MDLï¼ˆmetadata lockï¼‰\n\nä¸éœ€è¦æ˜¾å¼ä½¿ç”¨ï¼Œåœ¨è®¿é—®ä¸€ä¸ªè¡¨çš„æ—¶å€™ä¼šè¢«è‡ªåŠ¨åŠ ä¸Š\nMySQL 5.5 ä¸­å¼•å…¥\nMDL çš„ä½œç”¨æ˜¯é˜²æ­¢ DDLï¼ˆåŠ å­—æ®µç­‰ä¿®æ”¹è¡¨ç»“æ„çš„æ“ä½œï¼‰å’Œ DMLï¼ˆå¢åˆ æ”¹æ•°æ®ï¼‰å†²çª\nå½“å¯¹ä¸€ä¸ªè¡¨åšå¢åˆ æ”¹æŸ¥æ—¶ï¼ŒåŠ  MDL è¯»é”ã€‚\nå½“å¯¹è¡¨åšç»“æ„å˜æ›´æ“ä½œæ—¶ï¼ŒåŠ  MDL å†™é”ã€‚\nè¯»é”ä¹‹é—´ä¸äº’æ–¥\nè¯»å†™é”ä¹‹é—´ã€å†™é”ä¹‹é—´äº’æ–¥\n\n\nå¦‚ä½•å®‰å…¨åœ°ç»™å°è¡¨åŠ å­—æ®µï¼Ÿ\n\nè§£å†³é•¿äº‹åŠ¡ï¼Œäº‹åŠ¡ä¸æäº¤ä¼šä¸€ç›´å ç€ MDL é”ã€‚\n\n\nåœ¨ information_schema åº“çš„ innodb_trx è¡¨å¯ä»¥æŸ¥åˆ°å½“å‰æ‰§è¡Œä¸­çš„äº‹åŠ¡ã€‚\nå¯ä»¥æš‚åœ DDL æˆ–è€… kill æ‰è¿™ä¸ªé•¿äº‹åŠ¡\n\n\nçƒ­ç‚¹è¡¨ï¼Œæ•°æ®é‡ä¸å¤§çš„æƒ…å†µ\n\n\nkill äº‹åŠ¡ä¸ä¸€å®šç®¡ç”¨ï¼Œkill åç«‹é©¬æœ‰æ–°çš„è¯·æ±‚\nåœ¨ alter table è¯­å¥é‡Œé¢è®¾å®šç­‰å¾…æ—¶é—´ï¼Œæ‹¿ä¸åˆ° MDL å†™é”å°±å…ˆæ”¾å¼ƒï¼Œé‡è¯•å‘½ä»¤é‡å¤åŠ å­—æ®µè¿‡ç¨‹ã€‚\n\nMariaDB å·²ç»åˆå¹¶äº† AliSQL çš„è¿™ä¸ªåŠŸèƒ½ï¼Œè¿™ä¸¤ä¸ªå¼€æºåˆ†æ”¯éƒ½æ”¯æŒ DDL NOWAIT/WAIT n è¯­æ³•\n\n\n\n\nå¤§è¡¨åŠ å­—æ®µï¼šGh-ost\n\næ€è€ƒé¢˜ Â§\n\nå¤‡ä»½ä¸€èˆ¬åœ¨å¤‡åº“ä¸Šæ‰§è¡Œ\nåœ¨ç”¨ -single-transaction æ–¹æ³•åšé€»è¾‘å¤‡ä»½çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœä¸»åº“ä¸Šçš„ä¸€ä¸ªå°è¡¨åšäº†ä¸€ä¸ª DDLï¼Œæ¯”å¦‚ç»™ä¸€ä¸ªè¡¨åŠ äº†ä¸€åˆ—\nè¿™æ—¶å€™åœ¨å¤‡åº“ä¸Šä¼šçœ‹åˆ°ä»€ä¹ˆç°è±¡ï¼Ÿ\n\nQ2 å¯åŠ¨äº†ä¸€è‡´æ€§è¯•å›¾ï¼Œä½†ä¸€è‡´æ€§è§†å›¾ä¸åŒ…å«è¡¨ç»“æ„ã€‚æ­¤æ—¶æŠ¥é”™è¡¨ç»“æ„å·²æ”¹å˜ï¼Œç„¶å mysqldump ç»ˆæ­¢ã€‚\n\n\n\n"},"å­¦ä¹ ç¬”è®°/MySQL-å®æˆ˜-45-è®²/07ï½œè¡Œé”åŠŸè¿‡ï¼šæ€ä¹ˆå‡å°‘é”å¯¹æ€§èƒ½çš„å½±å“ï¼Ÿ":{"title":"07ï½œè¡Œé”åŠŸè¿‡ï¼šæ€ä¹ˆå‡å°‘é”å¯¹æ€§èƒ½çš„å½±å“ï¼Ÿ","links":[],"tags":["mysql"],"content":"\nMyISAM ä¸æ”¯æŒè¡Œé”\n\nInnoDB çš„è¡Œé” Â§\n\nä¸¤é˜¶æ®µé”åè®®ï¼šäº‹åŠ¡ä¸­ï¼Œè¡Œé”åœ¨éœ€è¦çš„æ—¶å€™æ‰åŠ ä¸Šï¼Œä½†è¦ç­‰åˆ°äº‹åŠ¡ç»“æŸæ—¶é‡Šæ”¾ã€‚\nå¦‚æœä½ çš„äº‹åŠ¡ä¸­éœ€è¦é”å¤šä¸ªè¡Œï¼Œè¦æŠŠæœ€å¯èƒ½é€ æˆé”å†²çªã€å½±å“å¹¶å‘åº¦çš„é”å°½é‡å¾€åæ”¾ã€‚\nå½“å¹¶å‘ç³»ç»Ÿä¸­ä¸åŒçº¿ç¨‹å‡ºç°å¾ªç¯èµ„æºä¾èµ–ï¼Œæ¶‰åŠçš„çº¿ç¨‹éƒ½åœ¨ç­‰å¾…åˆ«çš„çº¿ç¨‹é‡Šæ”¾èµ„æºæ—¶ï¼Œå°±ä¼šå¯¼è‡´è¿™å‡ ä¸ªçº¿ç¨‹éƒ½è¿›å…¥æ— é™ç­‰å¾…çš„çŠ¶æ€ï¼Œç§°ä¸ºæ­»é”ã€‚\n\nä¸¤ç§ç­–ç•¥\n\n\n\nç›´æ¥è¿›å…¥ç­‰å¾…ï¼Œç›´åˆ°è¶…æ—¶ã€‚\n\n\nè¶…æ—¶æ—¶é—´å¯ä»¥é€šè¿‡ innodb_lock_wait_timeout è®¾ç½®\né»˜è®¤ 50sã€‚\n\n\n\n\nå‘èµ·æ­»é”æ£€æµ‹ï¼Œå‘ç°æ­»é”åï¼Œä¸»åŠ¨å›æ»šæ­»é”é“¾æ¡ä¸­çš„æŸä¸€ä¸ªäº‹åŠ¡ï¼Œè®©å…¶ä»–äº‹åŠ¡å¾—ä»¥ç»§ç»­æ‰§è¡Œã€‚\n\n\nå°†å‚æ•° innodb_deadlock_detect è®¾ç½®ä¸º onï¼Œè¡¨ç¤ºå¼€å¯è¿™ä¸ªé€»è¾‘ã€‚\næ­»é”ï¼šæ¯å½“ä¸€ä¸ªäº‹åŠ¡è¢«é”ï¼Œå°±è¦çœ‹çœ‹å®ƒæ‰€ä¾èµ–çš„çº¿ç¨‹æœ‰æ²¡æœ‰è¢«åˆ«çš„é”ä½ï¼Œå¦‚æ­¤å¾ªç¯ï¼Œæœ€ååˆ¤æ–­æ˜¯å¦å‡ºç°è¿å¾ªç¯ç­‰å¾…ã€‚\nå‡è®¾ç°åœ¨å·²ç»æœ‰ 999 ä¸ªçº¿ç¨‹åœ¨åŒä¸€è¡Œç­‰é”ï¼Œæ–°æ¥ä¸€ä¸ªè¯·æ±‚ä¹Ÿè¦è®¿é—®è¿™ä¸ªè¡Œï¼Œä»–è¦åˆ¤æ–­æœ‰æ²¡æœ‰æ­»é”è¦åˆ¤æ–­ 1000 æ¬¡ã€‚ç„¶åè¿™ä¸ªç»“æœä¹˜ä»¥ 1000ã€‚\n\n\næ­£å¸¸æƒ…å†µä¸‹é‡‡ç”¨ç¬¬äºŒç§ç­–ç•¥ï¼Œé»˜è®¤ä¹Ÿæ˜¯ç¬¬äºŒç§ã€‚\n\n\n\n\næ€ä¹ˆè§£å†³çƒ­ç‚¹è¡Œæ›´æ–°å¯¼è‡´çš„æ€§èƒ½é—®é¢˜ï¼Ÿ\n\né—®é¢˜çš„ç—‡ç»“ï¼šæ­»é”æ£€æµ‹è¦è€—è´¹å¤§é‡çš„ CPU èµ„æºã€‚\n\n\nç¡®ä¿ä¸šåŠ¡ä¸€å®šä¸ä¼šå‡ºç°æ­»é”ï¼Œå…³é—­æ­»é”æ£€æµ‹ï¼ˆä¸æ¨èï¼‰\n\n\n\n\næ§åˆ¶å¹¶å‘åº¦ã€‚\nåœ¨ä¸­é—´ä»¶æˆ–ä¿®æ”¹ MySQL æºç å®ç°ï¼šå¯¹äºç›¸åŒè¡Œçš„æ›´æ–°ï¼Œåœ¨è¿›å…¥å¼•æ“ä¹‹å‰æ’é˜Ÿï¼Œè¿™æ · InnoDB å°±ä¸ä¼šæœ‰å¤§é‡çš„æ­»é”æ£€æµ‹å·¥ä½œã€‚\nå¦‚æœåšä¸åˆ°ç¬¬ 1 ç‚¹ï¼Œå¯ä»¥è€ƒè™‘ä»è®¾è®¡ä¸Šä¼˜åŒ–\n\n\nè€ƒè™‘é€šè¿‡å°†ä¸€è¡Œæ”¹æˆé€»è¾‘ä¸Šçš„å¤šè¡Œæ¥å‡å°‘é”å†²çªã€‚\nä»¥å½±é™¢è´¦æˆ·ä¸ºä¾‹ï¼Œå¯ä»¥è€ƒè™‘æ”¾åœ¨å¤šæ¡è®°å½•ä¸Šï¼Œæ¯”å¦‚ 10 ä¸ªè®°å½•ï¼Œå½±é™¢çš„è´¦æˆ·æ€»é¢ç­‰äºè¿™ 10 ä¸ªè®°å½•çš„å€¼çš„æ€»å’Œã€‚è¿™æ ·æ¯æ¬¡è¦ç»™å½±é™¢è´¦æˆ·åŠ é‡‘é¢çš„æ—¶å€™ï¼Œéšæœºé€‰å…¶ä¸­ä¸€æ¡è®°å½•æ¥åŠ ã€‚è¿™æ ·æ¯æ¬¡å†²çªæ¦‚ç‡å˜æˆåŸæ¥çš„ 1/10ï¼Œå¯ä»¥å‡å°‘é”ç­‰å¾…ä¸ªæ•°ï¼Œä¹Ÿå°±å‡å°‘äº†æ­»é”æ£€æµ‹çš„ CPU æ¶ˆè€—ã€‚\n\n\n\n\n\næ€è€ƒé¢˜ Â§\n\nå¦‚æœè¦åˆ é™¤ä¸€ä¸ªè¡¨é‡Œé¢çš„å‰ 1w è¡Œæ•°æ®ï¼Œé€‰æ‹©å“ªä¸€ç§æ–¹æ³•ï¼ˆé€‰ 2ï¼‰\n\nç›´æ¥æ‰§è¡Œ delete from T limit 10000;\n\n\nå•ä¸ªè¯­å¥å ç”¨æ—¶é—´é•¿ï¼Œé”çš„æ—¶é—´ä¹Ÿæ¯”è¾ƒé•¿ï¼›\nå¤§äº‹åŠ¡ä¼šå¯¼è‡´ä¸»ä»å»¶è¿Ÿã€‚\n\n\nåœ¨ä¸€ä¸ªè¿æ¥ä¸­å¾ªç¯æ‰§è¡Œ 20 æ¬¡ delete from T limit 500;\nåœ¨ 20 ä¸ªè¿æ¥ä¸­åŒæ—¶æ‰§è¡Œ delete from T limit 500;\n\n\näººä¸ºé€ æˆé”å†²çªã€‚\n\n\n\nè¯„è®ºåŒº Â§\n\nå…³äºæ€è€ƒé¢˜\n\nç¬¬äºŒç§æ–¹æ³•éš¾é“ä¸ä¼šå¼•èµ·æ•°æ®ä¸€è‡´æ€§é—®é¢˜å—ï¼Ÿå¦‚æœåœ¨ InnoDB ä¸­å¼€å¯äº†è‡ªåŠ¨äº‹åŠ¡å¹¶ä¸”æ²¡æœ‰æ˜¾å¼ç”¨ begin, commit æ¥åšçš„è¯ï¼Œåœ¨ä¸Šä¸€æ¬¡å¾ªç¯ç»“æŸå’Œä¸‹ä¸€æ¬¡å¾ªç¯å¼€å§‹ä¹‹é—´å¦‚æœæœ‰å…¶ä»–äº‹åŠ¡æ’å…¥äº†æ–°æ•°æ®ï¼Œè€Œä¸”æ­£å¥½ä½ç½®ä¹Ÿåœ¨å‰é¢ 500æ¡ï¼Œé‚£ä¸å°±ä¸ä¸€è‡´äº†ä¹ˆ\n\nåŠ ä¸ª order by idï¼ˆå‡è®¾ id æ˜¯è¡¨çš„ä¸»é”®ï¼‰\næ’åºåæ–°å¢çš„ id è‚¯å®šå¤§äºè¦åˆ é™¤çš„æœ€å¤§ id\n\n\n\n\nå¦‚æœæœ‰å¤šç§é”ï¼Œå¿…é¡»å…¨éƒ¨ä¸äº’æ–¥æ‰èƒ½å¹¶è¡Œã€‚\nMySQL æ²¡æœ‰åµŒå¥—äº‹åŠ¡ï¼Œå¼€å¯ä¸‹ä¸€ä¸ªä¼šè‡ªåŠ¨æäº¤ä¸Šä¸€ä¸ª\n"},"å­¦ä¹ ç¬”è®°/MySQL-å®æˆ˜-45-è®²/08ï½œäº‹åŠ¡åˆ°åº•æ˜¯éš”ç¦»çš„è¿˜æ˜¯ä¸éš”ç¦»çš„ï¼Ÿ":{"title":"08ï½œäº‹åŠ¡åˆ°åº•æ˜¯éš”ç¦»çš„è¿˜æ˜¯ä¸éš”ç¦»çš„ï¼Ÿ","links":[],"tags":["mysql"],"content":"äº‹åŠ¡çš„å¯åŠ¨æ—¶æœº Â§\n\nbegin/start transaction å‘½ä»¤ä¹‹åçš„ç¬¬ä¸€ä¸ªæ“ä½œ InnoDB è¡¨çš„è¯­å¥ï¼Œäº‹åŠ¡æ‰çœŸæ­£å¯åŠ¨ã€‚\né©¬ä¸Šå¯åŠ¨ä¸€ä¸ªäº‹åŠ¡ï¼šstart transaction with consistent snapshotã€‚\näº‹åŠ¡è‡ªåŠ¨æäº¤è®¾ç½®ï¼Œé»˜è®¤ä¸º 1ï¼Œå³é™¤éæ˜¾ç¤ºå£°æ˜ä¸€ä¸ªäº‹åŠ¡çš„å¼€å§‹ï¼Œå¦åˆ™æ¯ä¸€ä¸ªæŸ¥è¯¢éƒ½ä¼šè¢«å½“åšç‹¬ç«‹çš„äº‹åŠ¡è¢«å¤„ç†ã€‚\næ•´ä¸ªä¸“æ ï¼Œå¦‚æœæ²¡æœ‰ç‰¹åˆ«è¯´æ˜ï¼Œéƒ½é»˜è®¤ autocommit = 1ã€‚\n\nMySQL é‡Œçš„ä¸¤ä¸ªâ€œè§†å›¾â€çš„æ¦‚å¿µ Â§\n\nä¸€ä¸ªæ˜¯ viewã€‚æ˜¯ä¸€ä¸ªç”¨æŸ¥è¯¢è¯­å¥å®šä¹‰çš„è™šæ‹Ÿè¡¨ï¼Œåœ¨è°ƒç”¨çš„æ—¶å€™æ‰§è¡ŒæŸ¥è¯¢è¯­å¥å¹¶ç”Ÿæˆç»“æœã€‚\n\nåˆ›å»ºè§†å›¾çš„è¯­æ³•æ˜¯ create view â€¦ï¼ŒæŸ¥è¯¢æ–¹æ³•å’Œè¡¨ä¸€æ ·ã€‚\n\n\nå¦ä¸€ä¸ªæ˜¯ InnoDB åœ¨å®ç° MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰ æ—¶ç”¨åˆ°çš„ä¸€è‡´æ€§è¯»è§†å›¾ï¼ˆconsistent read viewï¼‰ï¼Œç”¨äºæ”¯æŒ RCï¼ˆRead Committedï¼Œè¯»æäº¤ï¼‰å’Œ RRï¼ˆRepeatable Readï¼Œå¯é‡å¤è¯»ï¼‰éš”ç¦»çº§åˆ«çš„å®ç°ã€‚\nè§†å›¾æ²¡æœ‰ç‰©ç†ç»“æ„ï¼Œä½œç”¨æ˜¯äº‹åŠ¡æ‰§è¡ŒæœŸé—´ç”¨æ¥å®šä¹‰â€œæˆ‘èƒ½çœ‹åˆ°ä»€ä¹ˆæ•°æ®â€\n\nâ€œå¿«ç…§â€åœ¨ MVCC é‡Œæ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ Â§\n\nç§’çº§åˆ›å»ºå¿«ç…§çš„èƒ½åŠ›ï¼Œå¿«ç…§æ˜¯åŸºäºæ•´åº“çš„ã€‚\nInnoDB çš„è¡Œæ•°æ®æœ‰å¤šä¸ªç‰ˆæœ¬ï¼ˆrowï¼‰ï¼Œæ¯ä¸ªç‰ˆæœ¬æœ‰è‡ªå·±çš„ row trx_idï¼ˆä¸¥æ ¼é€’å¢ï¼‰ã€‚\n\n\nå›¾ä¸­çš„è™šçº¿å°±æ˜¯ undo logã€‚\n\n\nåœ¨å®ç°ä¸Šï¼ŒInnoDB ä¸ºæ¯ä¸ªäº‹åŠ¡æ„é€ äº†ä¸€ä¸ªæ•°ç»„ï¼Œç”¨æ¥ä¿å­˜è¿™ä¸ªäº‹åŠ¡å¯åŠ¨ç¬é—´ï¼Œå½“å‰æ­£åœ¨â€œæ´»è·ƒâ€çš„æ‰€æœ‰äº‹åŠ¡ IDã€‚\n\næ´»è·ƒï¼šå¯åŠ¨äº†ä½†è¿˜æ²¡æäº¤ã€‚\næ•°ç»„é‡Œäº‹åŠ¡ ID çš„æœ€å°å€¼è®°ä¸ºä½æ°´ä½ã€‚\nå½“å‰ç³»ç»Ÿé‡Œé¢å·²ç»åˆ›å»ºè¿‡çš„äº‹åŠ¡ ID çš„æœ€å¤§å€¼åŠ  1 è®°ä¸ºé«˜æ°´ä½ã€‚\nè¿™ä¸ªè§†å›¾æ•°ç»„å’Œé«˜æ°´ä½ï¼Œå°±ç»„æˆäº†å½“å‰äº‹åŠ¡çš„ä¸€è‡´æ€§è§†å›¾ï¼ˆread-viewï¼‰ã€‚\næ•°æ®ç‰ˆæœ¬çš„å¯è§æ€§è§„åˆ™ï¼šåŸºäºæ•°æ®çš„ row trx_id å’Œä¸€è‡´æ€§è§†å›¾çš„å¯¹æ¯”ç»“æœå¾—åˆ°çš„ã€‚\n\n\nç»¿è‰²ï¼šè¡¨ç¤ºè¿™ä¸ªç‰ˆæœ¬æ˜¯å·²æäº¤çš„äº‹åŠ¡æˆ–è€…æ˜¯å½“å‰äº‹åŠ¡è‡ªå·±ç”Ÿæˆçš„ï¼Œå¯è§ã€‚\nçº¢è‰²ï¼šè¡¨ç¤ºæ˜¯ç”±å°†æ¥å¯åŠ¨çš„äº‹åŠ¡ç”Ÿæˆçš„ï¼Œä¸å¯è§ã€‚\né»„è‰²\n\naï¼‰è‹¥ row trx_id åœ¨æ•°ç»„ä¸­ï¼Œè¡¨ç¤ºè¿™ä¸ªç‰ˆæœ¬æ˜¯ç”±è¿˜æ²¡æäº¤çš„äº‹åŠ¡ç”Ÿæˆçš„ï¼Œä¸å¯è§ï¼›\nbï¼‰è‹¥ row trx_id ä¸åœ¨æ•°ç»„ä¸­ï¼Œè¡¨ç¤ºè¿™ä¸ªç‰ˆæœ¬æ˜¯å·²ç»æäº¤äº†çš„äº‹åŠ¡ç”Ÿæˆçš„ï¼Œå¯è§ã€‚\n\n\n\n\n\n\nç¿»è¯‘ï¼šå¯¹äºä¸€ä¸ªäº‹åŠ¡è§†å›¾ï¼Œé™¤äº†è‡ªå·±çš„æ›´æ–°æ€»æ˜¯å¯è§ä»¥å¤–ï¼Œæœ‰ä¸‰ç§æƒ…å†µ\n\nç‰ˆæœ¬æœªæäº¤ï¼Œä¸å¯è§ï¼›\nç‰ˆæœ¬å·²æäº¤ï¼Œä½†æ˜¯æ˜¯åœ¨è§†å›¾åˆ›å»ºåæäº¤çš„ï¼Œä¸å¯è§ï¼›\nç‰ˆæœ¬å·²æäº¤ï¼Œè€Œä¸”æ˜¯åœ¨è§†å›¾åˆ›å»ºå‰æäº¤çš„ï¼Œå¯è§ã€‚\n\n\næ¯ä¸ªäº‹åŠ¡æˆ–è€…è¯­å¥æœ‰è‡ªå·±çš„ä¸€è‡´æ€§è§†å›¾ã€‚æ™®é€šæŸ¥è¯¢è¯­å¥æ˜¯ä¸€è‡´æ€§è¯»ï¼Œä¸€è‡´æ€§è¯»ä¼šæ ¹æ® row trx_id å’Œä¸€è‡´æ€§è§†å›¾ç¡®å®šæ•°æ®ç‰ˆæœ¬çš„å¯è§æ€§ã€‚\n\nå¯¹äºå¯é‡å¤è¯»ï¼ŒæŸ¥è¯¢åªæ‰¿è®¤åœ¨äº‹åŠ¡å¯åŠ¨å‰å°±å·²ç»æäº¤å®Œæˆçš„æ•°æ®ï¼›\nå¯¹äºè¯»æäº¤ï¼ŒæŸ¥è¯¢åªæ‰¿è®¤åœ¨è¯­å¥å¯åŠ¨å‰å°±å·²ç»æäº¤å®Œæˆçš„æ•°æ®ï¼›\n\n\n\næ›´æ–°é€»è¾‘ Â§\n\næ›´æ–°æ•°æ®éƒ½æ˜¯å…ˆè¯»åå†™ã€‚\nå½“å‰è¯»ï¼šæ€»æ˜¯è¯»å–å·²ç»æäº¤å®Œæˆçš„æœ€æ–°ç‰ˆæœ¬ã€‚\né™¤äº† update è¯­å¥ï¼Œselect è¯­å¥å¦‚æœåŠ é”ï¼Œä¹Ÿæ˜¯å½“å‰è¯»ã€‚\n\nåŠ ä¸Š lock in share mode æˆ– for updateã€‚\n\n\n\näº‹åŠ¡çš„å¯é‡å¤è¯»æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ Â§\n\nå¯é‡å¤è¯»çš„æ ¸å¿ƒæ˜¯ä¸€è‡´æ€§è¯»ï¼›è€Œäº‹åŠ¡æ›´æ–°æ•°æ®çš„æ—¶å€™ï¼Œåªèƒ½ç”¨å½“å‰è¯»ã€‚å¦‚æœå½“å‰çš„è®°å½•çš„è¡Œé”è¢«å…¶ä»–äº‹åŠ¡å ç”¨çš„è¯ï¼Œå°±éœ€è¦è¿›å…¥é”ç­‰å¾…ã€‚\nè¯»æäº¤çš„é€»è¾‘å’Œå¯é‡å¤è¯»çš„é€»è¾‘ç±»ä¼¼ï¼Œæœ€ä¸»è¦çš„åŒºåˆ«ï¼š\n\nåœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œåªéœ€è¦åœ¨äº‹åŠ¡å¼€å§‹çš„æ—¶å€™åˆ›å»ºä¸€è‡´æ€§è§†å›¾ï¼Œä¹‹åäº‹åŠ¡é‡Œçš„å…¶ä»–æŸ¥è¯¢éƒ½å…±ç”¨è¿™ä¸ªä¸€è‡´æ€§è§†å›¾ï¼›\nåœ¨è¯»æäº¤éš”ç¦»çº§åˆ«ä¸‹ï¼Œæ¯ä¸€ä¸ªè¯­å¥æ‰§è¡Œå‰éƒ½ä¼šé‡æ–°ç®—å‡ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ã€‚\n\n\n\nä¸ºä»€ä¹ˆè¡¨ç»“æ„ä¸æ”¯æŒâ€œå¯é‡å¤è¯»â€ï¼Ÿ Â§\n\nå› ä¸ºè¡¨ç»“æ„æ²¡æœ‰å¯¹åº”çš„è¡Œæ•°æ®ï¼Œä¹Ÿæ²¡æœ‰ row trx_idï¼Œå› æ­¤åªèƒ½éµå¾ªå½“å‰è¯»çš„é€»è¾‘ã€‚\nMySQL 8.0 å¯ä»¥æŠŠè¡¨ç»“æ„æ”¾åœ¨ InnoDB å­—å…¸é‡Œï¼Œä¹Ÿè®¸ä»¥åä¼šæ”¯æŒè¡¨ç»“æ„çš„å¯é‡å¤è¯»ã€‚\n\næ€è€ƒé¢˜ Â§\n\nè¡¨\n\nid 1 2 3 4\nc 1 2 3 4\nInnoDBï¼Œä¸»é”® id\n\n\næƒ³è¦æŠŠæ‰€æœ‰å­—æ®µ c å’Œ id å€¼ç›¸ç­‰çš„è¡Œçš„ c å€¼æ¸…é›¶ï¼Œå´æ”¹ä¸æ‰\n\n\n\nbeginï¼›2. select * from tï¼›3. update t set c=0 where id=cï¼›4. select * from tï¼›\n\n\n2ã€4 æŸ¥åˆ°çš„ç»“æœä¸€æ ·ã€‚\n\n\næ„é€ å‡ºè¿™ç§æƒ…å†µ\n\n\nç”¨å¦ä¸€ä¸ªäº‹åŠ¡åœ¨æ›´æ–°è¯­å¥å‰å…ˆè¿›è¡Œæ›´æ–°\n\n\nè¯´æ˜åŸç†\n\næ›´æ–°æ“ä½œæ˜¯å½“å‰è¯»ï¼Œè¢«æŠ¢å…ˆæ›´æ–°åçš„æ•°æ®ç‰ˆæœ¬å·ä¸å±äºè‡ªå·±ï¼Œçœ‹ä¸åˆ°ï¼Œåœ¨å¯é‡å¤è¯»ä¸‹è¿˜æ˜¯è¯»åˆ°æ—§å€¼ï¼Œæ­¤æ—¶å°±å‡ºç°ï¼šæ•°æ®æ­£ç¡®ï¼Œå´æ›´æ–°ä¸äº†\n\n\nåœ¨å®é™…ä¸šåŠ¡å¼€å‘ä¸­æœ‰æ²¡æœ‰å¯èƒ½ç¢°åˆ°è¿™ç§æƒ…å†µï¼Ÿ\n\næœ‰\n\n\næ€ä¹ˆè§£å†³ï¼Ÿ\n\næ ¹æ®æ›´æ–°è¯­å¥çš„ affected_rows åˆ¤æ–­æ˜¯å¦æ›´æ–°æˆåŠŸ\n\n\n\nè¯„è®ºåŒº Â§\n\nåœ¨åŒä¸€è¡Œæ•°æ®ï¼Œæœ€æ–°ç‰ˆæœ¬çš„ row trx_id æ˜¯å¯èƒ½ä¼šå°äºæ—§ç‰ˆæœ¬çš„ row trx_id çš„ã€‚å› ä¸ºåå¼€å¯çš„äº‹åŠ¡å¯èƒ½å…ˆæäº¤ã€‚\nåªè¯»äº‹åŠ¡â€œä¸åˆ†é… trx_idâ€\n\n5.6 ä»¥åçš„ä¼˜åŒ–\nå…¶å®ä¸æ˜¯ä¸åˆ†é…ï¼Œè€Œæ˜¯éšæœºåˆ†é…ã€‚\n\n\nè¯»æäº¤å’Œå½“å‰è¯»\n\nè¯»æäº¤ä¸åŠ é”\nè€ƒè™‘ä¸‹ï¼Œä¸€ä¸ªè¯­å¥å¼€å§‹æ‰§è¡Œä¹‹åï¼Œæ‰§è¡ŒæœŸé—´åˆ«çš„äº‹åŠ¡ä¿®æ”¹äº†æ•°æ®çš„æƒ…å†µã€‚\n\n\n"},"å­¦ä¹ ç¬”è®°/MySQL-å®æˆ˜-45-è®²/09ï½œæ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•ï¼Œåº”è¯¥æ€ä¹ˆé€‰æ‹©ï¼Ÿ":{"title":"09ï½œæ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•ï¼Œåº”è¯¥æ€ä¹ˆé€‰æ‹©ï¼Ÿ","links":[],"tags":["mysql"],"content":"æŸ¥è¯¢æ€§èƒ½ Â§\n\nã€Œwhere = ã€æ—¶ï¼Œå”¯ä¸€ç´¢å¼•æ‰¾åˆ°äº†ç«‹é©¬è¿”å›ï¼Œæ™®é€šç´¢å¼•éœ€è¦æ‰¾åˆ°ä¸‹ä¸€ä¸ªä¸ç­‰äºçš„å€¼\nå› ä¸º InnoDB çš„æ•°æ®æ˜¯æŒ‰æ•°æ®é¡µä¸ºå•ä½è¯»å†™ï¼Œæ‰€ä»¥æ€§èƒ½å·®è·å¾®ä¹å…¶å¾®\n\nå¯¹äºæ•´å½¢å­—æ®µï¼Œä¸€ä¸ª 16KB çš„æ•°æ®é¡µå¯ä»¥æ”¾è¿‘åƒä¸ª key\n\n\n\nChange Buffer Â§\n\nå½“éœ€è¦æ›´æ–°ä¸€ä¸ªæ•°æ®é¡µæ—¶ï¼Œå¦‚æœæ•°æ®é¡µåœ¨å†…å­˜ä¸­å°±ç›´æ¥æ›´æ–°\nå¦‚æœæ•°æ®é¡µè¿˜æ²¡æœ‰åœ¨å†…å­˜ä¸­ï¼Œåœ¨ä¸å½±å“æ•°æ®ä¸€è‡´æ€§çš„å‰æä¸‹ï¼ŒInnoDB ä¼šå°†è¿™äº›æ›´æ–°æ“ä½œç¼“å­˜åœ¨ change buffer ä¸­\nä¸‹æ¬¡æŸ¥è¯¢éœ€è¦è®¿é—®è¿™ä¸ªæ•°æ®é¡µçš„æ—¶å€™ï¼Œå°†æ•°æ®é¡µè¯»å…¥å†…å­˜ï¼Œç„¶åæ‰§è¡Œç¬¬ 2 æ­¥ç¼“å­˜åœ¨ change buffer ä¸­ä¸è¿™ä¸ªé¡µæœ‰å…³çš„æ“ä½œ\n\n\n\nè¿™ä¸ªè¿‡ç¨‹ç§°ä¸º merge\n\n\né™¤äº†è®¿é—®æ•°æ®é¡µä¼šè§¦å‘ mergeï¼Œç³»ç»Ÿæœ‰åå°çº¿ç¨‹ä¼šå®šæœŸ merge\n\n\nåœ¨æ•°æ®åº“æ­£å¸¸å…³é—­çš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿä¼šæ‰§è¡Œ merge æ“ä½œ\n\n\nchange buffer æ˜¯å¯ä»¥è¢«æŒä¹…åŒ–çš„æ•°æ®\n\nåœ¨å†…å­˜ä¸­æœ‰æ‹·è´ï¼Œä¹Ÿä¼šè¢«å†™åˆ°ç£ç›˜ä¸Š\n\n\n\nå‡å°‘è¯»ç£ç›˜çš„æ¬¡æ•°ï¼Œè¯­å¥çš„æ‰§è¡Œé€Ÿåº¦å¾—åˆ°æ˜æ˜¾æå‡\n\n\næ•°æ®è¯»å…¥å†…å­˜éœ€è¦å ç”¨ buffer poolï¼Œæ‰€ä»¥ change buffer è¿™ç§æ–¹å¼è¿˜èƒ½å¤Ÿé¿å…å ç”¨å†…å­˜ï¼Œæé«˜å†…å­˜åˆ©ç”¨ç‡\n\n\nä»€ä¹ˆæ¡ä»¶ä¸‹å¯ä»¥ä½¿ç”¨ change bufferï¼Ÿ\n\nåªæœ‰æ™®é€šç´¢å¼•å¯ä»¥ä½¿ç”¨\nå”¯ä¸€ç´¢å¼•çš„æ›´æ–°ä¸èƒ½ä½¿ç”¨\n\næ‰€æœ‰çš„æ›´æ–°æ“ä½œéƒ½è¦å…ˆåˆ¤æ–­æ˜¯å¦è¿åå”¯ä¸€æ€§çº¦ï¼Œå¿…é¡»è¦å°†æ•°æ®é¡µè¯»å…¥å†…å­˜æ‰èƒ½åˆ¤æ–­\n\n\n\n\n\nchange buffer ç”¨çš„æ˜¯ buffer pool é‡Œçš„å†…å­˜ï¼Œå› æ­¤ä¸èƒ½æ— é™å¢å¤§\n\né€šè¿‡å‚æ•° innodb_change_buffer_max_size åŠ¨æ€è®¾ç½®ï¼Œå¦‚ 50 è¡¨ç¤ºåªèƒ½å ç”¨ buffer pool çš„ 50%\n\n\n\næ›´æ–°æ•°æ®çš„å¤„ç†æµç¨‹\n\næ›´æ–°çš„ç›®æ ‡é¡µåœ¨å†…å­˜ä¸­\n\nå”¯ä¸€ç´¢å¼•ï¼šæ‰¾åˆ°è¦æ’å…¥çš„ä½ç½®ï¼Œåˆ¤æ–­æ²¡æœ‰å†²çªï¼Œæ’å…¥\næ™®é€šç´¢å¼•ï¼šæ‰¾åˆ°è¦æ’å…¥çš„ä½ç½®ï¼Œæ’å…¥\n\n\nä¸åœ¨å†…å­˜\n\nå”¯ä¸€ç´¢å¼•ï¼šè¯»å…¥å†…å­˜ï¼Œåˆ¤æ–­æ²¡æœ‰å†²çªï¼Œæ’å…¥\næ™®é€šç´¢å¼•ï¼šå°†æ›´æ–°è®°å½•åœ¨ change bufferï¼Œå®Œæˆ\n\n\n\n\n\nä½¿ç”¨åœºæ™¯\n\nå†™å¤šè¯»å°‘çš„ä¸šåŠ¡ï¼šæ•ˆæœæœ€å¥½ï¼Œå¦‚è´¦å•ç±»ã€æ—¥å¿—ç±»çš„ç³»ç»Ÿ\n\nè§†æƒ…å†µå¯ä»¥å°½é‡å¼€å¤§\n\n\nå†™å®Œé©¬ä¸ŠåšæŸ¥è¯¢çš„ä¸šåŠ¡ï¼šä¸é€‚ç”¨ï¼Œèµ·åä½œç”¨\n\n\n\nchange buffer å’Œ redo log\n\nredo log ä¸»è¦èŠ‚çœéšæœºå†™ç£ç›˜çš„ IO æ¶ˆè€—ï¼ˆè½¬æˆé¡ºåºå†™ï¼‰\nchange buffer ä¸»è¦èŠ‚çœéšæœºè¯»ç£ç›˜çš„ IO æ¶ˆè€—\n\n\n\nMerge çš„æ‰§è¡Œæµç¨‹ Â§\n\nä»ç£ç›˜è¯»å…¥æ•°æ®é¡µåˆ°å†…å­˜ï¼ˆè€ç‰ˆæœ¬çš„æ•°æ®é¡µï¼‰ï¼›\nä» change buffer é‡Œæ‰¾å‡ºè¿™ä¸ªæ•°æ®é¡µçš„ change buffer è®°å½•ï¼ˆå¯èƒ½æœ‰å¤šä¸ªï¼‰ï¼Œä¾æ¬¡åº”ç”¨ï¼Œå¾—åˆ°æ–°ç‰ˆæ•°æ®é¡µï¼›\nå†™ redo logã€‚è¿™ä¸ª redo log åŒ…å«äº†æ•°æ®çš„å˜æ›´å’Œ change buffer çš„å˜æ›´ã€‚\n\n\næ­¤æ—¶ merge è¿‡ç¨‹ç»“æŸï¼Œæ•°æ®é¡µå’Œå†…å­˜ä¸­ change buffer å¯¹åº”çš„ç£ç›˜ä½ç½®éƒ½è¿˜æ²¡æœ‰ä¿®æ”¹ï¼Œå±äºè„é¡µï¼Œä¹‹åå„è‡ªåˆ·å›è‡ªå·±çš„ç‰©ç†æ•°æ®çš„æ“ä½œå±äºå¦å¤–ä¸€ä¸ªè¿‡ç¨‹ã€‚\nå› ä¸º redo log ä¹Ÿè®°å½•äº† change buffer çš„æ“ä½œï¼Œæ‰€ä»¥å´©æºƒæ¢å¤çš„æ—¶å€™èƒ½æ‰¾å›ã€‚\n\nè¯„è®ºåŒº Â§\n\nç³»ç»Ÿè¡¨ç©ºé—´å’Œæ•°æ®è¡¨ç©ºé—´ä¸¤ä¸ªæ¦‚å¿µ\n\nç³»ç»Ÿè¡¨ç©ºé—´ç”¨æ¥æ”¾ç³»ç»Ÿä¿¡æ¯ï¼Œæ¯”å¦‚æ•°æ®å­—å…¸ï¼Œå¯¹åº”çš„ç£ç›˜æ–‡ä»¶æ˜¯ ibdata1\næ•°æ®è¡¨ç©ºé—´æ˜¯ä¸€ä¸ªä¸ªçš„è¡¨æ•°æ®æ–‡ä»¶ï¼Œå¯¹åº”çš„ç£ç›˜æ–‡ä»¶å°±æ˜¯ è¡¨å.ibd\n\n\nchange buffer ç›¸å½“äºæ¨è¿Ÿäº†æ›´æ–°æ“ä½œï¼Œé‚£å¯¹å¹¶å‘æ§åˆ¶æ˜¯å¦æœ‰å½±å“ï¼Œæ¯”å¦‚åŠ é”ï¼Ÿæˆ‘ä¸€ç›´ä»¥ä¸ºåŠ é”éœ€è¦æŠŠå…·ä½“çš„æ•°æ®é¡µè¯»åˆ°å†…å­˜ä¸­æ¥ï¼Œæ‰èƒ½åŠ é”ï¼Œç„¶è€Œå¹¶ä¸æ˜¯ï¼Ÿ\n\né”æ˜¯ä¸€ä¸ªå•ç‹¬çš„æ•°æ®ç»“æ„ï¼Œå¦‚æœæ•°æ®é¡µä¸Šæœ‰é”ï¼Œchange buffer åœ¨åˆ¤æ–­â€œæ˜¯å¦èƒ½ç”¨â€çš„æ—¶å€™ï¼Œå°±ä¼šè®¤ä¸ºå¦\n\n\nåœ¨ change buffer ä¸­æœ‰æ­¤è¡Œè®°å½•çš„æƒ…å†µä¸‹ï¼Œå†æ¬¡æ›´æ”¹ï¼Œå¢åŠ ä¸€æ¡è®°å½•\nmerge è¡Œä¸ºä¹‹ååº”è¯¥ä¸ä¼šå†äº§ç”Ÿ redo log äº†å§ï¼Ÿ\n\nåˆ†æˆä¸¤æ­¥è€ƒè™‘\n\nmerge æ˜¯ä»ç£ç›˜è¯»æ•°æ®é¡µåˆ°å†…å­˜ï¼Œç„¶ååº”ç”¨ï¼Œè¿™ä¸€æ­¥æ˜¯æ›´æ–°å†…å­˜ï¼ŒåŒæ—¶å†™ redolog\nå†…å­˜å˜æˆè„é¡µï¼Œè·Ÿç£ç›˜æ•°æ®ä¸ä¸€æ ·ã€‚ä¹‹åå°±èµ°åˆ·è„é¡µçš„æµç¨‹\n\n\n\n\nchange buffer è·Ÿæ™®é€šæ•°æ®é¡µä¸€æ ·å­˜åœ¨ç£ç›˜é‡Œï¼ŒåŒºåˆ«åœ¨äº change buffer æ˜¯åœ¨å…±äº«è¡¨ç©ºé—´ ibdata1 é‡Œã€‚\nredo log æœ‰ä¸¤ç§ï¼Œä¸€ç§è®°å½•æ™®é€šæ•°æ®é¡µçš„æ”¹åŠ¨ï¼Œä¸€ç§è®°å½• change buffer çš„æ”¹åŠ¨ã€‚\nå¯¹æ•°æ®çš„ä¿®æ”¹è®°å½•åœ¨ change buffer é‡Œçš„æ—¶å€™ï¼Œå†…å­˜é‡Œæ²¡æœ‰è¿™ä¸ªç‰©ç†é¡µï¼Œä¸å­˜åœ¨è„é¡µã€‚\nçœŸæ­£å¯¹ç£ç›˜æ•°æ®é¡µçš„ä¿®æ”¹æ˜¯é€šè¿‡å†…å­˜é‡Œè„é¡µçš„æ•°æ®åˆ·å›ç£ç›˜æ¥å®Œæˆçš„ï¼Œè€Œä¸æ˜¯æ ¹æ® redo logã€‚\nchange buffer å’Œæ•°æ®é¡µä¸€æ ·ï¼Œä¹Ÿæ˜¯ç‰©ç†é¡µçš„ä¸€ä¸ªç»„æˆéƒ¨åˆ†ï¼Œæ•°æ®ç»“æ„ä¹Ÿæ˜¯ä¸€é¢— B+ æ ‘ï¼Œè¿™æ£µ B+ æ ‘æ”¾åœ¨å…±äº«è¡¨ç©ºé—´ï¼Œé»˜è®¤åœ¨ ibdata1 ä¸­ã€‚\nchange buffer çš„å†™ç›˜ç­–ç•¥è·Ÿæ•°æ®ä¸€æ ·ï¼Œå†…å­˜æ”¾ä¸ä¸‹ä¼šè§¦å‘è½ç›˜ï¼Œè¿˜æœ‰ checkpoint æ¨è¿›çš„æ—¶å€™ä¹Ÿå¯èƒ½ä¼šè§¦å‘ã€‚\n"},"å­¦ä¹ ç¬”è®°/MySQL-å®æˆ˜-45-è®²/10ï½œMySQL-ä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä¼šé€‰é”™ç´¢å¼•ï¼Ÿ":{"title":"10ï½œMySQL ä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä¼šé€‰é”™ç´¢å¼•ï¼Ÿ","links":[],"tags":["mysql"],"content":"ä¼˜åŒ–å™¨çš„é€»è¾‘ Â§\n\næ‰«æè¡Œæ•°\n\nä¸€ä¸ªç´¢å¼•ä¸Šä¸åŒçš„å€¼è¶Šå¤šï¼Œè¿™ä¸ªç´¢å¼•çš„åŒºåˆ†åº¦è¶Šå¥½\nåŸºæ•°ï¼ˆcardinalityï¼‰ï¼šä¸€ä¸ªç´¢å¼•ä¸Šä¸åŒçš„å€¼çš„ä¸ªæ•°ã€‚\n\né‡‡æ ·ç»Ÿè®¡ï¼šInnoDB é»˜è®¤é€‰æ‹©ç´¢å¼•çš„ N ä¸ªæ•°æ®é¡µï¼Œç»Ÿè®¡è¿™äº›é¡µé¢ä¸Šçš„ä¸åŒå€¼ï¼Œå¾—åˆ°ä¸€ä¸ªå¹³å‡å€¼ï¼Œç„¶åä¹˜ä»¥è¿™ä¸ªç´¢å¼•çš„é¡µé¢æ ‘ï¼Œå°±å¾—åˆ°è¿™ä¸ªç´¢å¼•çš„åŸºæ•°ã€‚\nå½“å˜æ›´çš„æ•°æ®è¡Œæ•°è¶…è¿‡ 1/M çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨è§¦å‘é‡æ–°åšä¸€æ¬¡ç´¢å¼•ç»Ÿè®¡ã€‚\nä¸¤ç§å­˜å‚¨ç´¢å¼•ç»Ÿè®¡çš„æ–¹å¼ï¼Œé€šè¿‡è®¾ç½®å‚æ•° innodb_stats_persistent çš„å€¼é€‰æ‹©\n\nè®¾ç½®ä¸º on çš„æ—¶å€™ï¼Œè¡¨ç¤ºç»Ÿè®¡ä¿¡æ¯ä¼šæŒä¹…åŒ–å­˜å‚¨ã€‚è¿™æ—¶ï¼Œé»˜è®¤çš„ N æ˜¯ 20ï¼ŒM æ˜¯ 10ã€‚\nè®¾ç½®ä¸º off çš„æ—¶å€™ï¼Œè¡¨ç¤ºç»Ÿè®¡ä¿¡æ¯åªå­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚è¿™æ—¶ï¼Œé»˜è®¤çš„ N æ˜¯ 8ï¼ŒM æ˜¯ 16ã€‚\n\n\n\n\nä»æ™®é€šç´¢å¼•æ‹¿åˆ°ä¸€ä¸ªå€¼åï¼Œå›åˆ°ä¸»é”®ç´¢å¼•æŸ¥å‡ºæ•´è¡Œæ•°æ®çš„ä»£ä»·ä¹Ÿè¦ç®—ã€‚\nç”±äºç´¢å¼•ç»Ÿè®¡ä¿¡æ¯ä¸å‡†ç¡®å¯¼è‡´çš„é—®é¢˜ï¼Œç”¨ analyze table å‘½ä»¤æ¥è§£å†³ã€‚\n\n\næ˜¯å¦ä½¿ç”¨ä¸´æ—¶è¡¨\næ˜¯å¦æ’åº\n\nè§£å†³å…¶ä»–ä¼˜åŒ–å™¨è¯¯åˆ¤çš„æƒ…å†µ Â§\n\nå¯ä»¥åœ¨åº”ç”¨ç«¯ç”¨ force index æ¥å¼ºè¡ŒæŒ‡å®šç´¢å¼•ï¼›\nä¹Ÿå¯ä»¥é€šè¿‡ä¿®æ”¹è¯­å¥æ¥å¼•å¯¼ä¼˜åŒ–å™¨ï¼›\n\nå¦‚ï¼Œå½“ xxx order by b limit 1; æœ€ç»ˆé€‰æ‹© b ç´¢å¼•è€Œä¸æ˜¯ a ç´¢å¼•ï¼Œå¯èƒ½æ˜¯å› ä¸ºåˆ¤æ–­ä½¿ç”¨ b å°±å¯ä»¥ä¸ç”¨å†æ’åºï¼Œæ­¤æ—¶å°†è¯­å¥æ”¹æˆ xxx order by b, a limit 1; æ˜¯ä¸€ä¸ªå¯è€ƒè™‘çš„è§£å†³æ–¹æ³•\nå‰ææ˜¯ SQL è¯­å¥è¯­ä¹‰ä¸å˜\n\n\nè¿˜å¯ä»¥å¢åŠ æˆ–è€…åˆ é™¤ç´¢å¼•ç»•è¿‡é—®é¢˜\n\næ€è€ƒé¢˜ Â§\n\nå‰é¢æˆ‘ä»¬åœ¨æ„é€ ç¬¬ä¸€ä¸ªä¾‹å­çš„è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡ session A çš„é…åˆï¼Œè®© session B åˆ é™¤æ•°æ®ååˆé‡æ–°æ’å…¥äº†ä¸€éæ•°æ®ï¼Œç„¶åå°±å‘ç° explain ç»“æœä¸­ï¼Œrows å­—æ®µä» 10001 å˜æˆ 37000 å¤šã€‚è€Œå¦‚æœæ²¡æœ‰ session A çš„é…åˆï¼Œåªæ˜¯å•ç‹¬æ‰§è¡Œ delete from tã€call idata()ã€explain è¿™ä¸‰å¥è¯ï¼Œä¼šçœ‹åˆ° rows å­—æ®µå…¶å®è¿˜æ˜¯ 10000 å·¦å³ã€‚ä½ å¯ä»¥è‡ªå·±éªŒè¯ä¸€ä¸‹è¿™ä¸ªç»“æœã€‚\nè¿™æ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Ÿä¹Ÿè¯·ä½ åˆ†æä¸€ä¸‹å§ã€‚\n\nsession A è¿˜æ²¡æœ‰æäº¤ï¼Œæ‰€ä»¥ä¹‹å‰æ’å…¥çš„ 10 ä¸‡è¡Œæ•°æ®è¿˜ä¸èƒ½åˆ é™¤ã€‚\næ‰€ä»¥ä¹‹å‰çš„æ•°æ®æ¯ä¸€è¡Œéƒ½æœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼Œæ—§ç‰ˆæœ¬æ˜¯ delete ä¹‹å‰çš„æ•°æ®ï¼Œæ–°ç‰ˆæœ¬æ˜¯æ ‡è®°ä¸º deleted çš„æ•°æ®ã€‚\nå› ä¸ºè¿™ä¸ªæ˜¯ä¸»é”®ï¼Œä¸»é”®æ˜¯ç›´æ¥æŒ‰ç…§è¡¨çš„è¡Œæ•°æ¥ä¼°è®¡çš„ï¼Œè€Œè¡¨çš„è¡Œæ•°ï¼Œä¼˜åŒ–å™¨ç›´æ¥ç”¨çš„æ˜¯ show table status çš„å€¼ï¼ˆåé¢æœ‰ç« èŠ‚è¯¦ç»†è®²è§£ï¼‰ã€‚\n\n\n"},"å­¦ä¹ ç¬”è®°/MySQL-å®æˆ˜-45-è®²/11ï½œæ€ä¹ˆç»™å­—ç¬¦ä¸²å­—æ®µåŠ ç´¢å¼•ï¼Ÿ":{"title":"11ï½œæ€ä¹ˆç»™å­—ç¬¦ä¸²å­—æ®µåŠ ç´¢å¼•ï¼Ÿ","links":[],"tags":["mysql"],"content":"\nç›´æ¥åˆ›å»ºå®Œæ•´ç´¢å¼•ï¼Œæ¯”è¾ƒå ç”¨ç©ºé—´ï¼›\nåˆ›å»ºå‰ç¼€ç´¢å¼•ï¼ŒèŠ‚çœç©ºé—´ï¼Œä½†ä¼šå¢åŠ æŸ¥è¯¢æ‰«ææ¬¡æ•°ï¼Œå¹¶ä¸”ä¸èƒ½ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼›\n\n\nåœ¨ç´¢å¼•ä¸Šæ‰¾åˆ°æ•°æ®åéœ€è¦å›åˆ°ä¸»é”®ä¸Šæ‹¿åˆ°å®Œæ•´æ•°æ®è¿›è¡Œåˆ¤æ–­\nå³ä½¿å‰ç¼€å®Œå…¨è¦†ç›–äº†å­—æ®µå†…å®¹ä¹Ÿä¼šå›è¡¨ï¼Œå› ä¸ºä¸ç¡®å®šæ˜¯ä¸æ˜¯çœŸçš„å®Œæ•´æ•°æ®\n\n\nå€’åºå­˜å‚¨ï¼Œå†åˆ›å»ºå‰ç¼€ç´¢å¼•ï¼Œç”¨äºç»•è¿‡å­—ç¬¦ä¸²æœ¬èº«å‰ç¼€çš„åŒºåˆ†åº¦ä¸å¤Ÿçš„é—®é¢˜ï¼Œä¸æ”¯æŒèŒƒå›´æ‰«æï¼›\n\n\nindex index_name(email(6));\n\n\nåˆ›å»º hash å­—æ®µç´¢å¼•ï¼ŒæŸ¥è¯¢æ€§èƒ½ç¨³å®šï¼Œæœ‰é¢å¤–çš„å­˜å‚¨å’Œè®¡ç®—æ¶ˆè€—ï¼Œéœ€è¦å¤šä¸€ä¸ªå­—æ®µä¿å­˜ hash å­—æ®µï¼Œä¸æ”¯æŒèŒƒå›´æ‰«æã€‚\n\n\næ¯”å¦‚é€šè¿‡ crc32() å‡½æ•°å¾—åˆ° hash å€¼\n"},"å­¦ä¹ ç¬”è®°/MySQL-å®æˆ˜-45-è®²/12ï½œä¸ºä»€ä¹ˆæˆ‘çš„-MySQL-ä¼šâ€œæŠ–â€ä¸€ä¸‹ï¼Ÿ":{"title":"12ï½œä¸ºä»€ä¹ˆæˆ‘çš„ MySQL ä¼šâ€œæŠ–â€ä¸€ä¸‹ï¼Ÿ","links":[],"tags":["mysql"],"content":"æ¦‚å¿µ Â§\n\nè„é¡µï¼šè·Ÿç£ç›˜æ•°æ®é¡µå†…å®¹ä¸ä¸€è‡´çš„å†…å­˜æ•°æ®é¡µ\nå¹²å‡€é¡µï¼šè·Ÿç£ç›˜æ•°æ®é¡µå†…å®¹ä¸€è‡´çš„å†…å­˜æ•°æ®é¡µ\n\nä½•æ—¶å†…å­˜ä¸­çš„è„é¡µå¾€ç¡¬ç›˜ä¸Šåˆ·ï¼Ÿ Â§\n\nredo log æ»¡\n\n\n\næŠŠç»¿è‰²éƒ¨åˆ†çš„æ—¥å¿—å¯¹åº”çš„æ‰€æœ‰è„é¡µéƒ½ flush åˆ°ç£ç›˜ä¸Š\nä¹‹åï¼Œwrite pos åˆ° cpâ€™ ä¹‹é—´æ˜¯å¯ä»¥å†å†™å…¥çš„ redo log çš„åŒºåŸŸ\n\n\nå½“éœ€è¦æ–°çš„å†…å­˜é¡µï¼Œè€Œå†…å­˜ä¸å¤Ÿç”¨çš„æ—¶å€™ï¼Œå°±è¦æ·˜æ±°ä¸€äº›æ•°æ®é¡µï¼Œç©ºå‡ºå†…å­˜ç»™åˆ«çš„æ•°æ®é¡µä½¿ç”¨ã€‚å¦‚æœæ·˜æ±°çš„æ˜¯â€œè„é¡µâ€ï¼Œå°±è¦å…ˆå°†è„é¡µå†™åˆ°ç£ç›˜\n\n\nä¸ç›´æ¥æŠŠå†…å­˜æ·˜æ±°æ‰ï¼Œä¸‹æ¬¡éœ€æ±‚è¯·æ±‚çš„æ—¶å€™ä»ç£ç›˜è¯»å…¥æ•°æ®é¡µï¼Œç„¶åæ‹¿ redo log å‡ºæ¥åº”ç”¨çš„åŸå› ï¼šä¸ºäº†ä¿è¯æ¯ä¸ªæ•°æ®é¡µæœ‰ä¸¤ç§çŠ¶æ€\n\nå†…å­˜é‡Œå­˜åœ¨ï¼Œå†…å­˜é‡Œè‚¯å®šæ˜¯æ­£ç¡®çš„ç»“æœï¼Œç›´æ¥è¿”å›ï¼›\nå†…å­˜é‡Œæ²¡æœ‰æ•°æ®ï¼Œå¯ä»¥è‚¯å®šæ•°æ®æ–‡ä»¶ä¸Šæ˜¯æ­£ç¡®çš„ç»“æœï¼Œè¯»å…¥å†…å­˜åè¿”å›ã€‚\n\n\n\n\nMySQL è®¤ä¸ºç³»ç»Ÿâ€œç©ºé—²â€çš„æ—¶å€™ä¼šåˆ·ï¼Œå¿™çš„æ—¶å€™ä¹Ÿä¼šæ‰¾æœºä¼šåˆ·\næ­£å¸¸å…³é—­æ•°æ®åº“æ—¶ï¼Œä¼šæŠŠå†…å­˜çš„è„é¡µéƒ½ flush åˆ°ç£ç›˜ä¸Šï¼Œä¸‹æ¬¡å¯åŠ¨æ—¶ç›´æ¥ä»ç£ç›˜è¯»æ•°æ®ï¼Œå¯åŠ¨é€Ÿåº¦å¿«\n\n\nç¬¬ 2 ç§æƒ…å†µæ˜¯å¸¸æ€\n\nInnoDB ç”¨ç¼“å†²æ± ç®¡ç†å†…å­˜ï¼Œç¼“å†²æ± ä¸­çš„å†…å­˜é¡µæœ‰ä¸‰ç§çŠ¶æ€\n\nè¿˜æ²¡æœ‰ä½¿ç”¨ï¼šå¾ˆå°‘\nä½¿ç”¨äº†å¹¶ä¸”æ˜¯å¹²å‡€é¡µ\nä½¿ç”¨äº†å¹¶ä¸”æ˜¯è„é¡µã€‚\n\n\n\n\nå½“è¦è¯»å…¥çš„æ•°æ®é¡µæ²¡æœ‰åœ¨å†…å­˜çš„æ—¶å€™ï¼Œå¿…é¡»åˆ°ç¼“å†²æ± ç”³è¯·ä¸€ä¸ªæ•°æ®é¡µ\n\næŠŠæœ€ä¹…ä¸ä½¿ç”¨çš„æ•°æ®é¡µä»å†…å­˜ä¸­æ·˜æ±°æ‰\nå½±å“æ€§èƒ½çš„æƒ…å†µ\n\nä¸€ä¸ªæŸ¥è¯¢è¦æ·˜æ±°çš„è„é¡µä¸ªæ•°å¤ªå¤šï¼Œä¼šå¯¼è‡´æŸ¥è¯¢çš„å“åº”æ—¶é—´æ˜æ˜¾å˜é•¿ï¼›\næ—¥å¿—å†™æ»¡ï¼Œæ›´æ–°å…¨éƒ¨å µä½ï¼Œå†™æ€§èƒ½è·Œä¸º 0\n\n\n\n\nInnoDB åˆ·è„é¡µçš„æ§åˆ¶ç­–ç•¥\n\ninnodb_io_capacity\n\nå»ºè®®è®¾ç½®æˆç£ç›˜çš„ IOPS\né€šè¿‡ fio å·¥å…·æµ‹è¯• IOPS\n\n\nfio -filename=$filename -direct=1 -iodepth 1 -thread -rw=randrw -ioengine=psync -bs=16k -size=500M -numjobs=10 -runtime=10 -group_reporting -name=mytest\n\n\nInnoDB åˆ·ç›˜é€Ÿåº¦ä¸»è¦å‚è€ƒä¸¤ä¸ªå› ç´ \n\nè„é¡µæ¯”ä¾‹\n- innodb_max_dirty_pages_pct è„é¡µæ¯”ä¾‹ï¼Œé»˜è®¤å€¼ 75%\n- å¹³æ—¶å¤šå…³æ³¨è„é¡µæ¯”ä¾‹ï¼Œä¸è¦è®©å®ƒç»å¸¸æ¥è¿‘ 75%\n- è„é¡µæ¯”ä¾‹é€šè¿‡ Innodb_buffer_pool_pages_dirty/Innodb_buffer_pool_pages_total å¾—åˆ°ï¼Œå…·ä½“çš„å‘½ä»¤å‚è€ƒä¸‹é¢çš„ä»£ç \n\nmysql&gt; select VARIABLE_VALUE into @a from global_status where VARIABLE_NAME = &#039;Innodb_buffer_pool_pages_dirty&#039;;select VARIABLE_VALUE into @b from global_status where VARIABLE_NAME = &#039;Innodb_buffer_pool_pages_total&#039;;select @a/@b;\n- InnoDB ä¼šæ ¹æ®å½“å‰çš„è„é¡µæ¯”ä¾‹ï¼ˆå‡è®¾ä¸º Mï¼‰ï¼Œç®—å‡ºä¸€ä¸ªèŒƒå›´åœ¨ 0 åˆ° 100 ä¹‹é—´çš„æ•°å­—ï¼Œè®¡ç®—è¿™ä¸ªæ•°å­—çš„ä¼ªä»£ç ç±»ä¼¼è¿™æ ·\nä¼ªä»£ç \n\nF1(M){ if M&gt;=innodb_max_dirty_pages_pct then return 100; return 100*M/innodb_max_dirty_pages_pct;}\n\n\n\n\nredo log å†™ç›˜é€Ÿåº¦\n- InnoDB æ¯æ¬¡å†™å…¥çš„æ—¥å¿—éƒ½æœ‰ä¸€ä¸ªåºå·ï¼Œå½“å‰å†™å…¥çš„åºå·è·Ÿ checkpoint å¯¹åº”çš„åºå·ä¹‹é—´çš„å·®å€¼ï¼Œæˆ‘ä»¬å‡è®¾ä¸º Nã€‚InnoDB ä¼šæ ¹æ®è¿™ä¸ª N ç®—å‡ºä¸€ä¸ªèŒƒå›´åœ¨ 0 åˆ° 100 ä¹‹é—´çš„æ•°å­—ï¼Œè¿™ä¸ªè®¡ç®—å…¬å¼å¯ä»¥è®°ä¸º F2(N)ã€‚F2(N) ç®—æ³•æ¯”è¾ƒå¤æ‚ï¼Œä½ åªè¦çŸ¥é“ N è¶Šå¤§ï¼Œç®—å‡ºæ¥çš„å€¼è¶Šå¤§å°±å¥½äº†ã€‚\n- æ ¹æ®ä¸Šè¿°ç®—å¾—çš„ F1(M) å’Œ F2(N) ä¸¤ä¸ªå€¼ï¼Œå–å…¶ä¸­è¾ƒå¤§çš„å€¼è®°ä¸º Rï¼Œä¹‹åå¼•æ“å°±å¯ä»¥æŒ‰ç…§ innodb_io_capacity å®šä¹‰çš„èƒ½åŠ›ä¹˜ä»¥ R% æ¥æ§åˆ¶åˆ·è„é¡µçš„é€Ÿåº¦ã€‚\n- \n\n\n\n\nåœ¨ InnoDB ä¸­ï¼Œinnodb_flush_neighbors å‚æ•°å°±æ˜¯ç”¨æ¥æ§åˆ¶è¿™ä¸ªè¡Œä¸ºçš„ï¼Œå€¼ä¸º 1 çš„æ—¶å€™ä¼šæœ‰ä¸Šè¿°çš„â€œè¿åâ€æœºåˆ¶ï¼Œå€¼ä¸º 0 æ—¶è¡¨ç¤ºä¸æ‰¾é‚»å±…ï¼Œè‡ªå·±åˆ·è‡ªå·±çš„ã€‚\n\nä½¿ç”¨ SSD è¿™ç±» IOPS æ¯”è¾ƒé«˜çš„è®¾å¤‡æ—¶ï¼Œå»ºè®®è®¾ä¸º 0\nMySQL 8.0 ä¸­é»˜è®¤å€¼ä¸º 0\n\n\n\næ€è€ƒé¢˜ Â§\n\nä¸€ä¸ªå†…å­˜é…ç½®ä¸º 128GBã€innodb_io_capacity è®¾ç½®ä¸º 20000 çš„å¤§è§„æ ¼å®ä¾‹ï¼Œæ­£å¸¸ä¼šå»ºè®®ä½ å°† redo log è®¾ç½®æˆ 4 ä¸ª 1GB çš„æ–‡ä»¶ã€‚\nä½†å¦‚æœä½ åœ¨é…ç½®çš„æ—¶å€™ä¸æ…å°† redo log è®¾ç½®æˆäº† 1 ä¸ª 100M çš„æ–‡ä»¶ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿåˆä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™æ ·çš„æƒ…å†µå‘¢ï¼Ÿ\n\næ¯æ¬¡äº‹åŠ¡æäº¤éƒ½è¦å†™ redo logï¼Œå¦‚æœè®¾ç½®å¤ªå°ï¼Œå¾ˆå¿«å°±ä¼šè¢«å†™æ»¡ï¼Œwrite pos ä¸€ç›´è¿½ç€ CP\nç³»ç»Ÿä¸å¾—ä¸åœæ­¢æ‰€æœ‰æ›´æ–°ï¼Œæ¨è¿› checkpoint\nç°è±¡ï¼šç£ç›˜å‹åŠ›å¾ˆå°ï¼Œä½†æ˜¯æ•°æ®åº“å‡ºç°é—´æ­‡æ€§çš„æ€§èƒ½ä¸‹è·Œ\n\n\n\nè¯„è®ºåŒº Â§\n\nredo log åœ¨â€œé‡æ”¾â€çš„æ—¶å€™ï¼Œå¦‚æœä¸€ä¸ªæ•°æ®é¡µå·²ç»åˆ·è¿‡ï¼Œä¼šè¯†åˆ«å‡ºæ¥å¹¶è·³è¿‡\n\nåŸºäº LSNï¼ˆlog sequence number æ—¥å¿—åºåˆ—å·ï¼‰\næ¯ä¸ªæ•°æ®é¡µå¤´éƒ¨æœ‰ LSNï¼Œ8 å­—èŠ‚ï¼Œæ¯æ¬¡ä¿®æ”¹éƒ½ä¼šå˜å¤§ã€‚\nå¯¹æ¯”è¿™ä¸ª LSN è·Ÿ checkpoint çš„ LSNï¼Œæ¯” checkpoint å°çš„ä¸€å®šæ˜¯å¹²å‡€é¡µ\n\n\nå°†è„é¡µ flush åˆ°ç£ç›˜ä¸Šæ˜¯ç›´æ¥å°†è„é¡µæ•°æ®è¦†ç›–åˆ°å¯¹åº”ç£ç›˜ä¸Šçš„æ•°æ®\næ–­ç”µé‡å¯åä» checkpoint çš„ä½ç½®å¾€åæ‰«ï¼Œå·²ç»æ‰«è¿‡ç›˜çš„ä¸ä¼šé‡å¤åº”ç”¨ redo log\nåè¯è§£é‡Š\n\nplushï¼šåˆ·è„é¡µ\npurgeï¼šæ¸… undo log\nmergeï¼šåº”ç”¨ change buffer\n\nchange buffer åªå¯¹éå”¯ä¸€ç´¢å¼•æœ‰æ•ˆ\n\n\n\n\nå¸¸è§çš„è¯¯ç”¨åœºæ™¯\n\nå¾ˆå¤šæµ‹è¯•äººå‘˜åœ¨åšå‹åŠ›æµ‹è¯•çš„æ—¶å€™ å‡ºç°åˆšå¼€å§‹ insert update å¾ˆå¿« ä¸€ä¼š å°±å‡ºç°å¾ˆæ…¢,å¹¶ä¸”å»¶è¿Ÿå¾ˆå¤§ï¼Œå¤§éƒ¨åˆ†æ˜¯å› ä¸º redo log è®¾ç½®å¤ªå°ï¼ˆè·Ÿä¸Šé¢æ€è€ƒé¢˜ç›¸åŒåŸç†ï¼‰\n\n\n"},"å­¦ä¹ ç¬”è®°/MySQL-å®æˆ˜-45-è®²/13ï½œä¸ºä»€ä¹ˆè¡¨æ•°æ®åˆ æ‰ä¸€åŠï¼Œè¡¨æ–‡ä»¶å¤§å°ä¸å˜ï¼Ÿ":{"title":"13ï½œä¸ºä»€ä¹ˆè¡¨æ•°æ®åˆ æ‰ä¸€åŠï¼Œè¡¨æ–‡ä»¶å¤§å°ä¸å˜ï¼Ÿ","links":[],"tags":["mysql"],"content":"å‚æ•° innodb_file_per_table Â§\n\nOFFï¼šè¡¨çš„æ•°æ®æ”¾åœ¨ç³»ç»Ÿå…±äº«è¡¨ç©ºé—´ï¼Œè·Ÿæ•°æ®å­—å…¸æ”¾åœ¨ä¸€èµ·\nONï¼šæ¯ä¸ª InnoDB è¡¨æ•°æ®å­˜å‚¨åœ¨ä¸€ä¸ªä»¥ .ibd ä¸ºåç¼€çš„æ–‡ä»¶ä¸­\n\nä» 5.6.6 ç‰ˆæœ¬å¼€å§‹æ˜¯é»˜è®¤å€¼\n\n\nå»ºè®®æ— è®ºä½¿ç”¨å“ªä¸ªç‰ˆæœ¬éƒ½å°†è¿™ä¸ªå€¼è®¾ç½®ä¸º ON\nå› ä¸ºä¸€ä¸ªè¡¨å•ç‹¬å­˜å‚¨ä¸ºä¸€ä¸ªæ–‡ä»¶æ›´å®¹æ˜“ç®¡ç†\nåœ¨ä¸éœ€è¦è¿™ä¸ªè¡¨çš„æ—¶å€™ï¼Œé€šè¿‡ drop table å‘½ä»¤å¯ä»¥ç›´æ¥åˆ é™¤è¿™ä¸ªæ–‡ä»¶ï¼Œè€Œå¦‚æœæ”¾åœ¨å…±äº«è¡¨ç©ºé—´ï¼Œå³ä½¿è¡¨åˆ æ‰äº†ï¼Œç©ºé—´ä¹Ÿä¸ä¼šå›æ”¶ã€‚\nä¸‹é¢çš„å†…å®¹åŸºäº ON å±•å¼€\n\næ•°æ®åˆ é™¤æµç¨‹ Â§\n\nåˆ é™¤ä¸€è¡Œè®°å½•ï¼ŒInnoDB å¼•æ“åªä¼šæŠŠè¿™ä¸ªè®°å½•æ ‡è®°ä¸ºåˆ é™¤\n\nå½“å†æ’å…¥ä¸€ä¸ªåœ¨è¢«åˆ è®°å½•ä½ç½®çš„è®°å½•æ—¶ï¼Œå¯èƒ½å¤ç”¨è¯¥ä½ç½®\n\n\nå¦‚æœåˆ æ‰ä¸€æ•´ä¸ªæ•°æ®é¡µä¸Šçš„æ‰€æœ‰è®°å½•ï¼Œåˆ™æ•´ä¸ªæ•°æ®é¡µå¯ä»¥è¢«å¤ç”¨\næ•°æ®é¡µçš„å¤ç”¨è·Ÿè®°å½•çš„å¤ç”¨ä¸åŒ\n\nè®°å½•çš„å¤ç”¨åªé™äºç¬¦åˆèŒƒå›´æ¡ä»¶çš„æ•°æ®\næ•°æ®é¡µçš„å¤ç”¨å¯ä»¥å¤ç”¨åˆ°ä»»ä½•ä½ç½®\n\n\nå¦‚æœç›¸é‚»çš„ä¸¤ä¸ªæ•°æ®é¡µåˆ©ç”¨ç‡éƒ½å¾ˆå°ï¼Œç³»ç»Ÿä¼šæŠŠä¸¤ä¸ªé¡µçš„æ•°æ®åˆåˆ°å…¶ä¸­ä¸€ä¸ªé¡µï¼Œå¦ä¸€ä¸ªè¢«æ ‡è®°ä¸ºå¯å¤ç”¨\nå¦‚æœç”¨ delete å‘½ä»¤åˆ é™¤æ•´ä¸ªè¡¨çš„æ•°æ®ï¼Œåˆ™æ‰€æœ‰çš„æ•°æ®é¡µéƒ½ä¼šè¢«æ ‡è®°ä¸ºå¯å¤ç”¨ï¼Œä½†æ˜¯ç£ç›˜ä¸Šæ–‡ä»¶ä¸ä¼šå˜å°\n\né‡å»ºè¡¨ Â§\n\nalter table A engine=InnoDB\n\nèµ·åˆ°æ”¶ç¼©è¡¨ A çš„ä½œç”¨\n\n\n5.5 ç‰ˆæœ¬ä¹‹å‰\n\næ–°å»ºè·Ÿ A ç»“æ„ç›¸åŒçš„è¡¨ Bï¼Œå°† A çš„æ•°æ®æŒ‰ç…§ä¸»é”® ID é€’å¢çš„é¡ºåºä¸€è¡Œè¡Œåœ°è¯»å‡ºæ¥æ’å…¥è¡¨ Bï¼Œç„¶åç”¨ B æ›¿æ¢ A\néšå«æ„æ€ï¼šalter table t engine=innodb, ALGORITHM=copy;\n\n\n5.6 ç‰ˆæœ¬å¼€å§‹å¼•å…¥ Online DDLï¼Œå¯¹ä¸Šé¢çš„æµç¨‹åšäº†ä¼˜åŒ–\n\n\n\n\n\n\nå»ºç«‹ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œæ‰«æè¡¨ A ä¸»é”®çš„æ‰€æœ‰æ•°æ®é¡µï¼›\n\n\n\n\nç”¨æ•°æ®é¡µä¸­è¡¨ A çš„è®°å½•ç”Ÿæˆ B+ æ ‘ï¼Œå­˜å‚¨åˆ°ä¸´æ—¶æ–‡ä»¶ä¸­ï¼›\n\n\n\n\nç”Ÿæˆä¸´æ—¶æ–‡ä»¶çš„è¿‡ç¨‹ä¸­ï¼Œå°†æ‰€æœ‰å¯¹ A çš„æ“ä½œè®°å½•åœ¨ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ï¼ˆrow logï¼‰ä¸­ï¼Œå¯¹åº”çš„æ˜¯å›¾ä¸­ state2 çš„çŠ¶æ€ï¼›\n\n\n\n\nä¸´æ—¶æ–‡ä»¶ç”Ÿæˆåï¼Œå°†æ—¥å¿—æ–‡ä»¶ä¸­çš„æ“ä½œåº”ç”¨åˆ°ä¸´æ—¶æ–‡ä»¶ï¼Œå¾—åˆ°ä¸€ä¸ªé€»è¾‘æ•°æ®ä¸Šä¸è¡¨ A ç›¸åŒçš„æ•°æ®æ–‡ä»¶ï¼Œå¯¹åº”çš„å°±æ˜¯å›¾ä¸­ state3 çš„çŠ¶æ€ï¼›\n\n\n\n\nç”¨ä¸´æ—¶æ–‡ä»¶æ›¿æ¢è¡¨ A çš„æ•°æ®æ–‡ä»¶ã€‚\n\n\n\néšå«æ„æ€ï¼šalter table t engine=innodb, ALGORITHM=inplace;\n\n\n\nDDL ä¹‹å‰éœ€è¦æ‹¿ MDL å†™é”\n\nåœ¨çœŸæ­£æ‹·è´æ•°æ®ä¹‹å‰ä¼šé€€åŒ–æˆè¯»é”\nMDL è¯»é”ä¸ä¼šé˜»å¡å¢åˆ æ”¹æ“ä½œ\nä¸ç›´æ¥è§£é”çš„åŸå› æ˜¯ä¸ºäº†ç¦æ­¢å…¶ä»–çº¿ç¨‹å¯¹è¿™ä¸ªè¡¨åŒæ—¶åš DDL\nå†™é”æ—¶é—´å¾ˆçŸ­ï¼Œå¯¹ä¸šåŠ¡æ¥è¯´å¯ä»¥è®¤ä¸ºæ˜¯ Online çš„\n\n\nâš ï¸ ä¸Šè¿°æ“ä½œéƒ½ä¼šæ‰«æåŸè¡¨æ•°æ®å’Œæ„å»ºä¸´æ—¶æ–‡ä»¶ï¼Œå¯¹äºå¤§è¡¨ï¼Œå¾ˆæ¶ˆè€— IO å’Œ CPU èµ„æº\n\nå¦‚æœæ˜¯çº¿ä¸ŠæœåŠ¡ï¼Œè¦å°å¿ƒåœ°æ§åˆ¶æ“ä½œæ—¶é—´\næ¨èä½¿ç”¨ gh-ost\n\n\n\nOnline å’Œ Inplace Â§\n\n5.6 ç‰ˆæœ¬ä¹‹åï¼Œæ ¹æ®è¡¨ A é‡å»ºå‡ºæ¥çš„æ•°æ®æ˜¯æ”¾åœ¨â€œtmp_fileâ€é‡Œçš„ï¼Œè¿™ä¸ªä¸´æ—¶æ–‡ä»¶æ˜¯ InnoDB åœ¨å†…éƒ¨åˆ›å»ºå‡ºæ¥çš„ã€‚æ•´ä¸ª DDL è¿‡ç¨‹éƒ½åœ¨ InnoDB å†…éƒ¨å®Œæˆã€‚å¯¹äº server å±‚æ¥è¯´ï¼Œæ²¡æœ‰æŠŠæ•°æ®æŒªåŠ¨åˆ°ä¸´æ—¶è¡¨ï¼Œæ˜¯ä¸€ä¸ªâ€œåŸåœ°â€æ“ä½œï¼Œè¿™å°±æ˜¯â€œinplaceâ€åç§°çš„æ¥æºã€‚\n\nä¸´æ—¶æ–‡ä»¶ä¹Ÿè¦å ç”¨ä¸´æ—¶ç©ºé—´\n\n\nå…³ç³»\n\n\n\nDDL è¿‡ç¨‹å¦‚æœæ˜¯ Online çš„ï¼Œå°±ä¸€å®šæ˜¯ inplace çš„ï¼›\n\n\n\n\nåè¿‡æ¥æœªå¿…ï¼Œinplace çš„ DDLï¼Œæœ‰å¯èƒ½ä¸æ˜¯ Online çš„ã€‚\n\næˆªæ­¢åˆ° MySQL 8.0ï¼Œæ·»åŠ å…¨æ–‡ç´¢å¼•ï¼ˆFULLTEXT indexï¼‰å’Œç©ºé—´ç´¢å¼•ï¼ˆSPATIAL indexï¼‰å°±å±äºè¿™ç§æƒ…å†µ\n\n\n\n\n\n\noptimize tableã€analyze table å’Œ alter table è¿™ä¸‰ç§æ–¹å¼é‡å»ºè¡¨çš„åŒºåˆ«\nä» MySQL 5.6 ç‰ˆæœ¬å¼€å§‹ï¼Œalter table t engine = InnoDBï¼ˆä¹Ÿå°±æ˜¯ recreateï¼‰é»˜è®¤çš„å°±æ˜¯ä¸Šé¢ä¼˜åŒ–åçš„æµç¨‹äº†ï¼›\nanalyze table t å…¶å®ä¸æ˜¯é‡å»ºè¡¨ï¼Œåªæ˜¯å¯¹è¡¨çš„ç´¢å¼•ä¿¡æ¯åšé‡æ–°ç»Ÿè®¡ï¼Œæ²¡æœ‰ä¿®æ”¹æ•°æ®ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­åŠ äº† MDL è¯»é”ï¼›\noptimize table t ç­‰äº recreate + analyzeã€‚\n\næ–°çš„è¡¨åŸºæœ¬ä¸Šç»Ÿè®¡ä¿¡æ¯æ˜¯å…¨æ–°çš„ï¼Œå»ºè®®ç›´æ¥ç”¨ alter\n\n\n\næ€è€ƒé¢˜ Â§\n\n\n\nä¸€ä¸ªè¡¨ t æ–‡ä»¶å¤§å°ä¸º 1TBï¼›\n\n\n\n\nå¯¹è¿™ä¸ªè¡¨æ‰§è¡Œ alter table t engine=InnoDBï¼›\n\n\n\n\nå‘ç°æ‰§è¡Œå®Œæˆåï¼Œç©ºé—´ä¸ä»…æ²¡å˜å°ï¼Œè¿˜ç¨å¾®å¤§äº†ä¸€ç‚¹å„¿ï¼Œæ¯”å¦‚å˜æˆäº† 1.01TBã€‚\n\n\nåŸå› \n\næœ¬æ¥å°±å¾ˆç´§å‡‘ï¼Œæ²¡èƒ½æ•´å‡ºå¤šå°‘å‰©ä½™ç©ºé—´ã€‚é‡æ–°æ”¶ç¼©çš„è¿‡ç¨‹ä¸­ï¼Œé¡µä¼šæŒ‰ 90% æ»¡çš„æ¯”ä¾‹æ¥é‡æ–°æ•´ç†é¡µæ•°æ®ï¼ˆ10% ç•™ç»™ UPDATE ä½¿ç”¨ï¼‰ï¼Œæœªæ•´ç†ä¹‹å‰é¡µå·²ç»å ç”¨ 90% ä»¥ä¸Šï¼Œæ”¶ç¼©ä¹‹åï¼Œæ–‡ä»¶å°±åè€Œå˜å¤§äº†ã€‚\n\n\n\nè¯„è®ºåŒº Â§\n\næ—¢ç„¶ MySQL æ”¯æŒäº†æ‰“åŒ…æ•°æ®æ’åºæ¨¡å¼ï¼Œèƒ½å¤Ÿæ›´ç´§å‡‘çš„åˆ†é…å†…å­˜è¿›è¡Œæ’åºï¼Œé‚£å®šä¹‰è¡¨ç»“æ„çš„æ—¶å€™ï¼Œvarchar(10) å­˜å‚¨ hello å’Œ varchar(100) å­˜å‚¨ hello çš„ä¼˜åŠ¿åœ¨å“ªé‡Œå‘¢ï¼Ÿ\n\nä»¥å‰ä¸æ”¯æŒç´§å‡‘æ’åºçš„æ—¶å€™æœ‰ï¼Œç°åœ¨æ²¡å•¥äº†å·®åˆ«äº†ï¼Œå°äº256éƒ½å·®ä¸å¤š\n\n\n"},"å­¦ä¹ ç¬”è®°/MySQL-å®æˆ˜-45-è®²/14ï½œcount(*)-è¿™ä¹ˆæ…¢ï¼Œæˆ‘è¯¥æ€ä¹ˆåŠï¼Ÿ":{"title":"14ï½œcount(*) è¿™ä¹ˆæ…¢ï¼Œæˆ‘è¯¥æ€ä¹ˆåŠï¼Ÿ","links":[],"tags":["mysql"],"content":"count(*) çš„å®ç°æ–¹å¼ Â§\n\nMyISAM å¼•æ“æŠŠä¸€ä¸ªè¡¨çš„æ€»è¡Œæ•°å­˜åœ¨ç£ç›˜ä¸Šï¼Œæ‰§è¡Œæ—¶ç›´æ¥è¿”å›è¿™ä¸ªæ•°\nInnoDB å¼•æ“æ¯æ¬¡éƒ½éœ€è¦æŠŠæ•°æ®ä¸€è¡Œè¡Œåœ°ä»å¼•æ“é‡Œé¢è¯»å‡ºæ¥ï¼Œç´¯è®¡è¡Œæ•°\nä»¥ä¸Šéƒ½æ˜¯åœ¨è¯´æ²¡æœ‰è¿‡æ»¤æ¡ä»¶çš„ `count(*)\ncount æ˜¯ä¸€è¡Œè¡Œè¯»æ•°æ®ï¼Œæ˜¯ä¸€è‡´æ€§è¯»ï¼ˆå¿«ç…§è¯»ï¼‰ï¼Œä¸åŠ é”\n\nå…¶ä»–è®¡æ•°æ–¹å¼ Â§\n\nåœ¨æ•°æ®åº“ä¿å­˜è®¡æ•°\n\næ–°å»ºä¸€ä¸ªè¡¨ä¸“é—¨ç”¨äºè®¡æ•°\nå…¨éƒ¨ç”¨ InnoDB å¼•æ“\nåœ¨ä¿®æ”¹è®¡æ•°æ—¶ä½¿ç”¨äº‹åŠ¡\n\n\nshow table status å‘½ä»¤ï¼šè¾“å‡ºç»“æœæœ‰ä¸€ä¸ª TABLE_ROWS ç”¨äºæ˜¾ç¤ºè¿™ä¸ªè¡¨å½“å‰è¡Œæ•°ï¼Œæ‰§è¡Œå¾ˆå¿«ï¼Œä½†è¿™ä¸ªç»“æœæ˜¯é‡‡æ ·ä¼°ç®—çš„ï¼ˆè¯¯å·®å¯èƒ½è¾¾åˆ° 40% åˆ° 50%ï¼‰\nç”¨ç¼“å­˜ç³»ç»Ÿä¿å­˜è®¡æ•°\n\næ¯”å¦‚ç”¨ Redis\nå°†è®¡æ•°ä¿å­˜åœ¨ç¼“å­˜ç³»ç»Ÿä¸­çš„æ–¹å¼ï¼Œè¿˜ä¸åªæ˜¯ä¸¢å¤±æ›´æ–°çš„é—®é¢˜ã€‚å³ä½¿ Redis æ­£å¸¸å·¥ä½œï¼Œè¿™ä¸ªå€¼è¿˜æ˜¯é€»è¾‘ä¸Šä¸ç²¾ç¡®çš„ã€‚\n\nä¸¤ä¸ªç³»ç»Ÿé—´å­˜åœ¨æ•°æ®ä¸ä¸€è‡´çš„æ—¶åˆ»\n\n\n\n\n\nä¸åŒçš„ Count ç”¨æ³•ï¼ˆInnoDBï¼‰ Â§\n\ncount() æ˜¯ä¸€ä¸ªèšåˆå‡½æ•°ï¼Œå¯¹äºè¿”å›çš„ç»“æœé›†ï¼Œä¸€è¡Œè¡Œåœ°åˆ¤æ–­ï¼Œå¦‚æœ count å‡½æ•°çš„å‚æ•°ä¸æ˜¯ NULLï¼Œç´¯è®¡å€¼å°±åŠ  1ï¼Œå¦åˆ™ä¸åŠ ã€‚æœ€åè¿”å›ç´¯è®¡å€¼ã€‚\ncount(*)ã€count(ä¸»é”® id) å’Œ count(1) éƒ½è¡¨ç¤ºè¿”å›æ»¡è¶³æ¡ä»¶çš„ç»“æœé›†çš„æ€»è¡Œæ•°ï¼›è€Œ count(å­—æ®µï¼‰ åˆ™è¡¨ç¤ºè¿”å›æ»¡è¶³æ¡ä»¶çš„æ•°æ®è¡Œé‡Œé¢ï¼Œå‚æ•°â€œå­—æ®µâ€ä¸ä¸º NULL çš„æ€»ä¸ªæ•°ã€‚\nåˆ†ææ€§èƒ½å·®åˆ«çš„æ—¶å€™çš„åŸåˆ™\n\nserver å±‚è¦ä»€ä¹ˆå°±ç»™ä»€ä¹ˆï¼›\nInnoDB åªç»™å¿…è¦çš„å€¼ï¼›\nç°åœ¨çš„ä¼˜åŒ–å™¨åªä¼˜åŒ–äº† count(*) çš„è¯­ä¹‰ä¸ºâ€œå–è¡Œæ•°â€ï¼Œå…¶ä»–â€œæ˜¾è€Œæ˜“è§â€çš„ä¼˜åŒ–å¹¶æ²¡æœ‰åšã€‚\n\n\ncount(ä¸»é”® id)ï¼šéå†æ•´å¼ è¡¨ï¼ŒæŠŠæ¯ä¸€è¡Œçš„ id å€¼éƒ½å–å‡ºæ¥ï¼Œè¿”å›ç»™ server å±‚ï¼Œserver å±‚æ‹¿åˆ°ååˆ¤æ–­æ˜¯ä¸å¯èƒ½ä¸ºç©ºçš„ï¼Œå°±æŒ‰è¡Œç´¯åŠ ã€‚\ncount(1)ï¼šéå†æ•´å¼ è¡¨ï¼Œä½†ä¸å–å€¼ï¼Œserver å±‚å¯¹äºè¿”å›çš„æ¯ä¸€è¡Œï¼Œæ”¾ä¸€ä¸ªæ•°å­—â€œ1â€è¿›å»ï¼Œåˆ¤æ–­æ˜¯ä¸å¯èƒ½ä¸ºç©ºçš„ï¼ŒæŒ‰è¡Œç´¯åŠ ã€‚\ncount(å­—æ®µ)\n\nå¦‚æœè¿™ä¸ªâ€œå­—æ®µâ€æ˜¯å®šä¹‰ä¸º not null çš„è¯ï¼Œä¸€è¡Œè¡Œåœ°ä»è®°å½•é‡Œé¢è¯»å‡ºè¿™ä¸ªå­—æ®µï¼Œåˆ¤æ–­ä¸èƒ½ä¸º nullï¼ŒæŒ‰è¡Œç´¯åŠ ï¼›\nå¦‚æœè¿™ä¸ªâ€œå­—æ®µâ€å®šä¹‰å…è®¸ä¸º nullï¼Œé‚£ä¹ˆæ‰§è¡Œçš„æ—¶å€™ï¼Œåˆ¤æ–­åˆ°æœ‰å¯èƒ½æ˜¯ nullï¼Œè¿˜è¦æŠŠå€¼å–å‡ºæ¥å†åˆ¤æ–­ä¸€ä¸‹ï¼Œä¸æ˜¯ null æ‰ç´¯åŠ ã€‚\n\n\ncount(*)ï¼šä¾‹å¤–ï¼Œå¹¶ä¸ä¼šæŠŠå…¨éƒ¨å­—æ®µå–å‡ºæ¥ï¼Œè€Œæ˜¯ä¸“é—¨åšäº†ä¼˜åŒ–ï¼Œä¸å–å€¼ã€‚count(*) è‚¯å®šä¸æ˜¯ nullï¼ŒæŒ‰è¡Œç´¯åŠ ã€‚\n\nMySQL ç‰ˆæœ¬ &gt;= 5.5\n\n\næ•ˆç‡ï¼šcount(*) â‰ˆ count(1) &gt; count(ä¸»é”® id) &gt; count(å­—æ®µ)\n\n\n\næ€è€ƒé¢˜ Â§\n\nåœ¨åˆšåˆšè®¨è®ºçš„æ–¹æ¡ˆä¸­ï¼Œæˆ‘ä»¬ç”¨äº†äº‹åŠ¡æ¥ç¡®ä¿è®¡æ•°å‡†ç¡®ã€‚ç”±äºäº‹åŠ¡å¯ä»¥ä¿è¯ä¸­é—´ç»“æœä¸è¢«åˆ«çš„äº‹åŠ¡è¯»åˆ°ï¼Œå› æ­¤ä¿®æ”¹è®¡æ•°å€¼å’Œæ’å…¥æ–°è®°å½•çš„é¡ºåºæ˜¯ä¸å½±å“é€»è¾‘ç»“æœçš„ã€‚ä½†æ˜¯ï¼Œä»å¹¶å‘ç³»ç»Ÿæ€§èƒ½çš„è§’åº¦è€ƒè™‘ï¼Œä½ è§‰å¾—åœ¨è¿™ä¸ªäº‹åŠ¡åºåˆ—é‡Œï¼Œåº”è¯¥å…ˆæ’å…¥æ“ä½œè®°å½•ï¼Œè¿˜æ˜¯åº”è¯¥å…ˆæ›´æ–°è®¡æ•°è¡¨å‘¢ï¼Ÿ\n\nåº”è¯¥å…ˆæ’å…¥è®°å½•å†æ›´æ–°è®¡æ•°è¡¨\nå› ä¸ºæ›´æ–°è®¡æ•°è¡¨æ¶‰åŠåˆ°è¡Œé”çš„ç«äº‰ï¼Œå…ˆæ’å…¥å†æ›´æ–°èƒ½æœ€å¤§ç¨‹åº¦åœ°å‡å°‘äº†äº‹åŠ¡ä¹‹é—´çš„é”ç­‰å¾…ï¼Œæå‡äº†å¹¶å‘åº¦ã€‚\n\n\n"},"å­¦ä¹ ç¬”è®°/MySQL-å®æˆ˜-45-è®²/15ï½œç­”ç–‘æ–‡ç« ï¼ˆä¸€ï¼‰ï¼šæ—¥å¿—å’Œç´¢å¼•ç›¸å…³é—®é¢˜":{"title":"15ï½œç­”ç–‘æ–‡ç« ï¼ˆä¸€ï¼‰ï¼šæ—¥å¿—å’Œç´¢å¼•ç›¸å…³é—®é¢˜","links":["%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/08%EF%BD%9C%E4%BA%8B%E5%8A%A1%E5%88%B0%E5%BA%95%E6%98%AF%E9%9A%94%E7%A6%BB%E7%9A%84%E8%BF%98%E6%98%AF%E4%B8%8D%E9%9A%94%E7%A6%BB%E7%9A%84%EF%BC%9F"],"tags":["mysql"],"content":"ä¸šåŠ¡è®¾è®¡é—®é¢˜ Â§\n\nä¸šåŠ¡ä¸Šæœ‰è¿™æ ·çš„éœ€æ±‚ï¼ŒAã€B ä¸¤ä¸ªç”¨æˆ·ï¼Œå¦‚æœäº’ç›¸å…³æ³¨ï¼Œåˆ™æˆä¸ºå¥½å‹ã€‚è®¾è®¡ä¸Šæ˜¯æœ‰ä¸¤å¼ è¡¨ï¼Œä¸€ä¸ªæ˜¯ like è¡¨ï¼Œä¸€ä¸ªæ˜¯ friend è¡¨ï¼Œlike è¡¨æœ‰ user_idã€liker_id ä¸¤ä¸ªå­—æ®µï¼Œæˆ‘è®¾ç½®ä¸ºå¤åˆå”¯ä¸€ç´¢å¼• uk_user_id_liker_idã€‚è¯­å¥æ‰§è¡Œé€»è¾‘æ˜¯è¿™æ ·çš„ï¼šä»¥ A å…³æ³¨ B ä¸ºä¾‹ï¼šç¬¬ä¸€æ­¥ï¼Œå…ˆæŸ¥è¯¢å¯¹æ–¹æœ‰æ²¡æœ‰å…³æ³¨è‡ªå·±ï¼ˆB æœ‰æ²¡æœ‰å…³æ³¨ Aï¼‰select * from like where user_id = B and liker_id = A; å¦‚æœæœ‰ï¼Œåˆ™æˆä¸ºå¥½å‹insert into friend; æ²¡æœ‰ï¼Œåˆ™åªæ˜¯å•å‘å…³æ³¨å…³ç³» insert into like; ä½†æ˜¯å¦‚æœ Aã€B åŒæ—¶å…³æ³¨å¯¹æ–¹ï¼Œä¼šå‡ºç°ä¸ä¼šæˆä¸ºå¥½å‹çš„æƒ…å†µã€‚å› ä¸ºä¸Šé¢ç¬¬ 1 æ­¥ï¼ŒåŒæ–¹éƒ½æ²¡å…³æ³¨å¯¹æ–¹ã€‚ç¬¬ 1 æ­¥å³ä½¿ä½¿ç”¨äº†æ’ä»–é”ä¹Ÿä¸è¡Œï¼Œå› ä¸ºè®°å½•ä¸å­˜åœ¨ï¼Œè¡Œé”æ— æ³•ç”Ÿæ•ˆã€‚è¯·é—®è¿™ç§æƒ…å†µï¼Œåœ¨ MySQL é”å±‚é¢æœ‰æ²¡æœ‰åŠæ³•å¤„ç†ï¼Ÿ\n\nCREATE TABLElike(idint(11) NOT NULL AUTO_INCREMENT,user_idint(11) NOT NULL,liker_idint(11) NOT NULL, PRIMARY KEY (id), UNIQUE KEYuk_user_id_liker_id(user_id,liker_id)) ENGINE=InnoDB;CREATE TABLEfriend(idint(11) NOT NULL AUTO_INCREMENT,friend_1_idint(11) NOT NULL,friend_2_idint(11) NOT NULL, UNIQUE KEYuk_friend(friend_1_id,friend_2_id), PRIMARY KEY (id)) ENGINE=InnoDB;\n\n\né¦–å…ˆï¼Œè¦ç»™â€œlikeâ€è¡¨å¢åŠ ä¸€ä¸ªå­—æ®µï¼Œæ¯”å¦‚å«ä½œ relation_shipï¼Œå¹¶è®¾ä¸ºæ•´å‹ï¼Œå–å€¼ 1ã€2ã€3ã€‚å€¼æ˜¯ 1 çš„æ—¶å€™ï¼Œè¡¨ç¤º user_id å…³æ³¨ liker_idï¼›å€¼æ˜¯ 2 çš„æ—¶å€™ï¼Œè¡¨ç¤º liker_id å…³æ³¨ user_idï¼›å€¼æ˜¯ 3 çš„æ—¶å€™ï¼Œè¡¨ç¤ºäº’ç›¸å…³æ³¨ã€‚\nç„¶åï¼Œå½“ A å…³æ³¨ B çš„æ—¶å€™ï¼Œé€»è¾‘æ”¹æˆå¦‚ä¸‹æ‰€ç¤ºçš„æ ·å­ï¼šåº”ç”¨ä»£ç é‡Œé¢ï¼Œæ¯”è¾ƒ A å’Œ B çš„å¤§å°ï¼Œå¦‚æœ A &lt; Bï¼Œå°±æ‰§è¡Œä¸‹é¢çš„é€»è¾‘\n\nmysql&gt; begin; /*å¯åŠ¨äº‹åŠ¡*/insert intolike(user_id, liker_id, relation_ship) values(A, B, 1) on duplicate key update relation_ship=relation_ship | 1;select relation_ship fromlikewhere user_id=A and liker_id=B;/*ä»£ç ä¸­åˆ¤æ–­è¿”å›çš„ relation_shipï¼Œ å¦‚æœæ˜¯1ï¼Œäº‹åŠ¡ç»“æŸï¼Œæ‰§è¡Œ commit å¦‚æœæ˜¯3ï¼Œåˆ™æ‰§è¡Œä¸‹é¢è¿™ä¸¤ä¸ªè¯­å¥ï¼š */insert ignore into friend(friend_1_id, friend_2_id) values(A,B);commit;\n\n\nå¦‚æœ A &gt; Bï¼Œåˆ™æ‰§è¡Œä¸‹é¢çš„é€»è¾‘\n\nmysql&gt; begin; /*å¯åŠ¨äº‹åŠ¡*/insert intolike(user_id, liker_id, relation_ship) values(B, A, 2) on duplicate key update relation_ship=relation_ship | 2;select relation_ship fromlikewhere user_id=B and liker_id=A;/*ä»£ç ä¸­åˆ¤æ–­è¿”å›çš„ relation_shipï¼Œ å¦‚æœæ˜¯2ï¼Œäº‹åŠ¡ç»“æŸï¼Œæ‰§è¡Œ commit å¦‚æœæ˜¯3ï¼Œåˆ™æ‰§è¡Œä¸‹é¢è¿™ä¸¤ä¸ªè¯­å¥ï¼š*/insert ignore into friend(friend_1_id, friend_2_id) values(B,A);commit;\n\n\nè¿™ä¸ªè®¾è®¡é‡Œï¼Œè®©â€œlikeâ€è¡¨é‡Œçš„æ•°æ®ä¿è¯ user_id &lt; liker_idï¼Œè¿™æ ·ä¸è®ºæ˜¯ A å…³æ³¨ Bï¼Œè¿˜æ˜¯ B å…³æ³¨ Aï¼Œåœ¨æ“ä½œâ€œlikeâ€è¡¨çš„æ—¶å€™ï¼Œå¦‚æœåå‘çš„å…³ç³»å·²ç»å­˜åœ¨ï¼Œå°±ä¼šå‡ºç°è¡Œé”å†²çªã€‚ç„¶åï¼Œinsert â€¦ on duplicate è¯­å¥ï¼Œç¡®ä¿äº†åœ¨äº‹åŠ¡å†…éƒ¨ï¼Œæ‰§è¡Œäº†è¿™ä¸ª SQL è¯­å¥åï¼Œå°±å¼ºè¡Œå ä½äº†è¿™ä¸ªè¡Œé”ï¼Œä¹‹åçš„ select åˆ¤æ–­ relation_ship è¿™ä¸ªé€»è¾‘æ—¶å°±ç¡®ä¿äº†æ˜¯åœ¨è¡Œé”ä¿æŠ¤ä¸‹çš„è¯»æ“ä½œã€‚æ“ä½œç¬¦ â€œ|â€ æ˜¯æŒ‰ä½æˆ–ï¼Œè¿åŒæœ€åä¸€å¥ insert è¯­å¥é‡Œçš„ ignoreï¼Œæ˜¯ä¸ºäº†ä¿è¯é‡å¤è°ƒç”¨æ—¶çš„å¹‚ç­‰æ€§ã€‚è¿™æ ·ï¼Œå³ä½¿åœ¨åŒæ–¹â€œåŒæ—¶â€æ‰§è¡Œå…³æ³¨æ“ä½œï¼Œæœ€ç»ˆæ•°æ®åº“é‡Œçš„ç»“æœï¼Œä¹Ÿæ˜¯ like è¡¨é‡Œé¢æœ‰ä¸€æ¡å…³äº A å’Œ B çš„è®°å½•ï¼Œè€Œä¸” relation_ship çš„å€¼æ˜¯ 3ï¼Œ å¹¶ä¸” friend è¡¨é‡Œé¢ä¹Ÿæœ‰äº† A å’Œ B çš„è¿™æ¡è®°å½•ã€‚\n\næ€è€ƒé¢˜ Â§\n\n\nåˆ›å»ºä¸€ä¸ªç®€å•çš„è¡¨ tï¼Œå¹¶æ’å…¥ä¸€è¡Œï¼Œç„¶åå¯¹è¿™ä¸€è¡Œåšä¿®æ”¹ã€‚\n\nmysql&gt; CREATE TABLEt(idint(11) NOT NULL primary key auto_increment,aint(11) DEFAULT NULL) ENGINE=InnoDB;\ninsert into t values(1,2);\n\n\n\nå‡è®¾ï¼Œæ‰§è¡Œï¼šmysql&gt; update t set a=2 where id=1;\n\n\n\n\n\nä»…ä»ç°è±¡ä¸Šçœ‹ï¼ŒMySQL å†…éƒ¨åœ¨å¤„ç†è¿™ä¸ªå‘½ä»¤çš„æ—¶å€™ï¼Œå¯ä»¥æœ‰ä»¥ä¸‹ä¸‰ç§é€‰æ‹©ï¼š\n\n\n\næ›´æ–°éƒ½æ˜¯å…ˆè¯»åå†™çš„ï¼ŒMySQL è¯»å‡ºæ•°æ®ï¼Œå‘ç° a çš„å€¼æœ¬æ¥å°±æ˜¯ 2ï¼Œä¸æ›´æ–°ï¼Œç›´æ¥è¿”å›ï¼Œæ‰§è¡Œç»“æŸï¼›\n\n\n\nsession B çš„ update è¯­å¥è¢« blocked äº†ï¼ŒåŠ é”è¿™ä¸ªåŠ¨ä½œæ˜¯ InnoDB æ‰èƒ½åšçš„ï¼Œæ‰€ä»¥æ’é™¤é€‰é¡¹ 1ã€‚\n\n\n\n\nMySQL è°ƒç”¨äº† InnoDB å¼•æ“æä¾›çš„â€œä¿®æ”¹ä¸º (1,2)â€è¿™ä¸ªæ¥å£ï¼Œä½†æ˜¯å¼•æ“å‘ç°å€¼ä¸åŸæ¥ç›¸åŒï¼Œä¸æ›´æ–°ï¼Œç›´æ¥è¿”å›ï¼›\n\n\n\nsession A çš„ç¬¬äºŒä¸ª select è¯­å¥æ˜¯ä¸€è‡´æ€§è¯»ï¼ˆå¿«ç…§è¯»)ï¼Œå®ƒæ˜¯ä¸èƒ½çœ‹è§ session B çš„æ›´æ–°çš„ã€‚\nç°åœ¨å®ƒè¿”å›çš„æ˜¯ (1,3)ï¼Œè¡¨ç¤ºå®ƒçœ‹è§äº†æŸä¸ªæ–°çš„ç‰ˆæœ¬ï¼Œè¿™ä¸ªç‰ˆæœ¬åªèƒ½æ˜¯ session A è‡ªå·±çš„ update è¯­å¥åšæ›´æ–°çš„æ—¶å€™ç”Ÿæˆã€‚æ‰€ä»¥æ’é™¤é€‰é¡¹ 2ã€‚\n\nå¯ä»¥å›é¡¾ 08ï½œäº‹åŠ¡åˆ°åº•æ˜¯éš”ç¦»çš„è¿˜æ˜¯ä¸éš”ç¦»çš„ï¼Ÿ\n\n\n\n\n\n\nInnoDB è®¤çœŸæ‰§è¡Œäº†â€œæŠŠè¿™ä¸ªå€¼ä¿®æ”¹æˆ (1,2)â€œè¿™ä¸ªæ“ä½œï¼Œè¯¥åŠ é”çš„åŠ é”ï¼Œè¯¥æ›´æ–°çš„æ›´æ–°ã€‚\n\n\n\n\n\n\n\n\nä½ è§‰å¾—å®é™…æƒ…å†µä¼šæ˜¯ä»¥ä¸Šå“ªç§å‘¢ï¼Ÿä½ å¯å¦ç”¨æ„é€ å®éªŒçš„æ–¹å¼ï¼Œæ¥è¯æ˜ä½ çš„ç»“è®ºï¼Ÿè¿›ä¸€æ­¥åœ°ï¼Œå¯ä»¥æ€è€ƒä¸€ä¸‹ï¼ŒMySQL ä¸ºä»€ä¹ˆè¦é€‰æ‹©è¿™ç§ç­–ç•¥å‘¢ï¼Ÿ\n\néªŒè¯ç»“æœéƒ½åœ¨ binlog_format=statement æ ¼å¼ä¸‹è¿›è¡Œ\n\n\n"},"å­¦ä¹ ç¬”è®°/MySQL-å®æˆ˜-45-è®²/16ï½œâ€œorder-byâ€æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ":{"title":"16ï½œâ€œorder byâ€æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ","links":["%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/13%EF%BD%9C%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A1%A8%E6%95%B0%E6%8D%AE%E5%88%A0%E6%8E%89%E4%B8%80%E5%8D%8A%EF%BC%8C%E8%A1%A8%E6%96%87%E4%BB%B6%E5%A4%A7%E5%B0%8F%E4%B8%8D%E5%8F%98%EF%BC%9F"],"tags":["mysql"],"content":"\n\nMySQL ä¼šç»™æ¯ä¸ªçº¿ç¨‹åˆ†é…ä¸€å—å†…å­˜ç”¨äºæ’åºï¼Œç§°ä¸º sort_buffer\n\n\nselect city,name,age from t where city=&#039;æ­å·&#039; order by name limit 1000;\n\n\ncity varchar 16ï¼ŒnameÂ varchar 16ï¼Œage int 11ï¼Œcity æœ‰ç´¢å¼•\n\n\n\nåˆå§‹åŒ– sort_bufferï¼Œç¡®å®šæ”¾å…¥ nameã€cityã€age è¿™ä¸‰ä¸ªå­—æ®µï¼›\n\n\n\n\nä»ç´¢å¼• city æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³ city=&#039;æ­å·&#039; æ¡ä»¶çš„ä¸»é”® idï¼›\n\n\n\n\nåˆ°ä¸»é”® id ç´¢å¼•å–å‡ºæ•´è¡Œï¼Œå– nameã€cityã€age ä¸‰ä¸ªå­—æ®µçš„å€¼ï¼Œå­˜å…¥ sort_buffer ä¸­ï¼›\n\n\n\n\nä»ç´¢å¼• city å–ä¸‹ä¸€ä¸ªè®°å½•çš„ä¸»é”® idï¼›\n\n\n\n\né‡å¤æ­¥éª¤ 3ã€4 ç›´åˆ° city çš„å€¼ä¸æ»¡è¶³æŸ¥è¯¢æ¡ä»¶ä¸ºæ­¢ï¼›\n\n\n\n\n\nå¯¹ sort_buffer ä¸­çš„æ•°æ®æŒ‰ç…§å­—æ®µ name åšå¿«é€Ÿæ’åºï¼›\n\n\n\nå¯èƒ½åœ¨å†…å­˜ä¸­å®Œæˆï¼Œä¹Ÿå¯èƒ½éœ€è¦ä½¿ç”¨å¤–éƒ¨æ’åºï¼Œè¿™å–å†³äºæ’åºæ‰€éœ€çš„å†…å­˜å’Œå‚æ•° sort_buffer_sizeã€‚\n\n\n\n\næŒ‰ç…§æ’åºç»“æœå–å‰ 1000 è¡Œè¿”å›ç»™å®¢æˆ·ç«¯ã€‚\n\n\n\nå…¨å­—æ®µæ’åº\n\n\n\n\n\n\n\nsort_buffer_sizeï¼Œæ˜¯ MySQL ä¸ºæ’åºå¼€è¾Ÿçš„å†…å­˜ï¼ˆsort_bufferï¼‰çš„å¤§å°ã€‚å¦‚æœè¦æ’åºçš„æ•°æ®é‡å°äº sort_buffer_sizeï¼Œæ’åºå°±åœ¨å†…å­˜ä¸­å®Œæˆã€‚ä½†å¦‚æœæ’åºæ•°æ®é‡å¤ªå¤§ï¼Œå†…å­˜æ”¾ä¸ä¸‹ï¼Œåˆ™ä¸å¾—ä¸åˆ©ç”¨ç£ç›˜ä¸´æ—¶æ–‡ä»¶è¾…åŠ©æ’åºã€‚\n\n\nç¡®å®šä¸€ä¸ªæ’åºè¯­å¥æ˜¯å¦ä½¿ç”¨äº†ä¸´æ—¶æ–‡ä»¶\n\n\n/* æ‰“å¼€ optimizer_traceï¼Œåªå¯¹æœ¬çº¿ç¨‹æœ‰æ•ˆ */\nSET optimizer_trace=&#039;enabled=on&#039;;\n\n/* @a ä¿å­˜ Innodb_rows_read çš„åˆå§‹å€¼ */\nselect VARIABLE_VALUE into @a from  performance_schema.session_status where variable_name = &#039;Innodb_rows_read&#039;;\n\n/* æ‰§è¡Œè¯­å¥ */\nselect city, name,age from t where city=&#039;æ­å·&#039; order by name limit 1000;\n\n/* æŸ¥çœ‹ OPTIMIZER_TRACE è¾“å‡º */\nSELECT * FROM `information_schema`.`OPTIMIZER_TRACE`\\G\n\n/* @b ä¿å­˜ Innodb_rows_read çš„å½“å‰å€¼ */\nselect VARIABLE_VALUE into @b from performance_schema.session_status where variable_name = &#039;Innodb_rows_read&#039;;\n\n/* è®¡ç®— Innodb_rows_read å·®å€¼ */\nselect @b-@a;\n\n\nå¤–éƒ¨æ’åºæ—¶ï¼Œä¸€èˆ¬ä½¿ç”¨å½’å¹¶æ’åºç®—æ³•\n\n\nå¦‚æœ MySQL è®¤ä¸ºæ’åºçš„å•è¡Œé•¿åº¦å¤ªå¤§ä¼šæ€ä¹ˆåšå‘¢ï¼Ÿ\n\n\nmax_length_for_sort_dataï¼Œåœ¨ MySQL ä¸­æ§åˆ¶ç”¨äºæ’åºçš„è¡Œæ•°æ®çš„é•¿åº¦ã€‚å¦‚æœå•è¡Œçš„é•¿åº¦è¶…è¿‡è¿™ä¸ªå€¼ï¼ŒMySQL å°±è®¤ä¸ºå•è¡Œå¤ªå¤§ï¼Œè¦æ¢ä¸€ä¸ªç®—æ³•ã€‚\n\nå¦‚æœåªç®— rowid è¿˜æ˜¯å°äºæ­¤è®¾ç½®ï¼Œä¸€æ ·æ˜¯ rowid æ’åºï¼Œä½†æ˜¯ä¼šè½¬ç”¨ç£ç›˜æ’åº\n\n\n\nè®¾ç½®å€¼ä¸º 16ï¼Œå°äºå‰é¢æŸ¥è¯¢è¯­å¥æ’åºçš„ä¸‰ä¸ªå­—æ®µçš„æ€»å’Œ\n\n\næ­¤æ—¶å› ä¸ºæ— æ³•ç›´æ¥è¿”å›äº†ï¼Œæ•´ä¸ªæ‰§è¡Œæµç¨‹å˜æˆä¸‹é¢çš„æ ·å­\n\n\n\nåˆå§‹åŒ– sort_bufferï¼Œç¡®å®šæ”¾å…¥ä¸¤ä¸ªå­—æ®µï¼Œå³ name å’Œ idï¼›\n\n\n\n\nä»ç´¢å¼• city æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³ city=&#039;æ­å·&#039; æ¡ä»¶çš„ä¸»é”® idï¼›\n\n\n\n\nåˆ°ä¸»é”® id ç´¢å¼•å–å‡ºæ•´è¡Œï¼Œå– nameã€id è¿™ä¸¤ä¸ªå­—æ®µï¼Œå­˜å…¥ sort_buffer ä¸­ï¼›\n\n\n\n\nä»ç´¢å¼• city å–ä¸‹ä¸€ä¸ªè®°å½•çš„ä¸»é”® idï¼›\n\n\n\n\né‡å¤æ­¥éª¤ 3ã€4 ç›´åˆ°ä¸æ»¡è¶³ city=&#039;æ­å·&#039; æ¡ä»¶ä¸ºæ­¢ï¼›\n\n\n\n\nå¯¹ sort_buffer ä¸­çš„æ•°æ®æŒ‰ç…§å­—æ®µ name è¿›è¡Œæ’åºï¼›\n\n\n\n\n\néå†æ’åºç»“æœï¼Œå–å‰ 1000 è¡Œï¼Œå¹¶æŒ‰ç…§ id çš„å€¼å›åˆ°åŸè¡¨ä¸­å–å‡º cityã€name å’Œ age ä¸‰ä¸ªå­—æ®µè¿”å›ç»™å®¢æˆ·ç«¯ã€‚\n\n\n\nä¸éœ€è¦åœ¨æœåŠ¡ç«¯å†è€—è´¹å†…å­˜å­˜å‚¨ç»“æœï¼Œç›´æ¥è¿”å›ç»™å®¢æˆ·ç«¯\n\n\n\nrowid æ’åº\n\n\n\n\n\n\n\nå…¨å­—æ®µæ’åº VS rowid æ’åº\n\nMySQL çš„ä¸€ä¸ªè®¾è®¡æ€æƒ³ï¼šå¦‚æœå†…å­˜å¤Ÿï¼Œå°±è¦å¤šåˆ©ç”¨å†…å­˜ï¼Œå°½é‡å‡å°‘ç£ç›˜è®¿é—®ã€‚\nå¯¹äº InnoDB è¡¨æ¥è¯´ï¼Œrowid æ’åºä¼šè¦æ±‚å›è¡¨å¤šé€ æˆç£ç›˜è¯»ï¼Œå› æ­¤ä¸ä¼šè¢«ä¼˜å…ˆé€‰æ‹©ã€‚\n\n\n\nå¦‚æœæ•°æ®å¤©ç„¶æœ‰åºï¼Œåˆ™ order by å¹¶ä¸éœ€è¦ä¸Šé¢çš„æ’åºæ“ä½œï¼Œä¼šæ‰§è¡Œå¿«å¾ˆå¤š\n\næ¯”å¦‚å°† city ç´¢å¼•æ”¹æˆ city + name çš„è”åˆç´¢å¼•\n\n\n\nå¦‚æœå»ºç«‹ä¸‰ä¸ªå­—æ®µçš„è”åˆç´¢å¼•ï¼Œè¿˜èƒ½çœå»å›è¡¨è¿‡ç¨‹\n\nExplain ç»“æœçš„ Extra å­—æ®µå¦‚æœæœ‰ Using index åˆ™è¡¨ç¤ºä½¿ç”¨äº†è¦†ç›–ç´¢å¼•\nå›è¡¨çš„æ“ä½œæ˜¯éšæœº IOï¼Œä¼šé€ æˆå¤§é‡çš„éšæœºè¯»ï¼Œä¸ä¸€å®šæ¯”å…¨å­—æ®µæ’åºå¯¹ç£ç›˜çš„è®¿é—®å°‘\n\n\n\næ€è€ƒé¢˜ Â§\n\nå‡è®¾ä½ çš„è¡¨é‡Œé¢å·²ç»æœ‰äº† city_name(city, name) è¿™ä¸ªè”åˆç´¢å¼•ï¼Œç„¶åä½ è¦æŸ¥æ­å·å’Œè‹å·ä¸¤ä¸ªåŸå¸‚ä¸­æ‰€æœ‰çš„å¸‚æ°‘çš„å§“åï¼Œå¹¶ä¸”æŒ‰åå­—æ’åºï¼Œæ˜¾ç¤ºå‰ 100 æ¡è®°å½•ã€‚å¦‚æœ SQL æŸ¥è¯¢è¯­å¥æ˜¯è¿™ä¹ˆå†™çš„ ï¼š\nmysql&gt; select * from t where city in (&#039;æ­å·&#039;,&quot;è‹å·&quot;) order by name limit 100;\nè¿™ä¸ªè¯­å¥æ‰§è¡Œçš„æ—¶å€™ä¼šæœ‰æ’åºè¿‡ç¨‹å—ï¼Œä¸ºä»€ä¹ˆï¼Ÿ\n\næœ‰ï¼Œå•ä¸ª city å†…éƒ¨çš„ name æ‰æ˜¯é€’å¢çš„\n\n\nå¦‚æœä¸šåŠ¡ç«¯ä»£ç ç”±ä½ æ¥å¼€å‘ï¼Œéœ€è¦å®ç°ä¸€ä¸ªåœ¨æ•°æ®åº“ç«¯ä¸éœ€è¦æ’åºçš„æ–¹æ¡ˆï¼Œä½ ä¼šæ€ä¹ˆå®ç°å‘¢ï¼Ÿ\n\nåˆ†æˆä¸¤ä¸ªæŸ¥è¯¢è¯­å¥åˆ†åˆ«æŸ¥ä¸€ç™¾æ¡ï¼Œç„¶ååœ¨ä¸šåŠ¡ä»£ç ä¸­åˆå¹¶æŸ¥è¯¢ç»“æœ\n\n\nè¿›ä¸€æ­¥åœ°ï¼Œå¦‚æœæœ‰åˆ†é¡µéœ€æ±‚ï¼Œè¦æ˜¾ç¤ºç¬¬ 101 é¡µï¼Œä¹Ÿå°±æ˜¯è¯´è¯­å¥æœ€åè¦æ”¹æˆ â€œlimit 10000,100â€ï¼Œ ä½ çš„å®ç°æ–¹æ³•åˆä¼šæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ\n\nselect * from t where city=&quot;æ­å·&quot; order by name limit 10100;Â select * from t where city=&quot;è‹å·&quot; order by name limit 10100ã€‚\n\næ•°æ®é‡å¤ªå¤§æ—¶å¯ä»¥æŠŠ * æ”¹å†™æˆåªè¿”å›å¿…è¦çš„æ•°æ®\n\n\n\n\n\nè¯„è®ºåŒº Â§\n\n\nvarchar(n)ï¼Œn çš„å€¼ä¸­ï¼Œ255 æ˜¯ä¸ªè¾¹ç•Œï¼Œå°äºç­‰äº 255 éœ€è¦ä¸€ä¸ªå­—èŠ‚è®°å½•é•¿åº¦ï¼Œè¶…è¿‡å°±éœ€è¦ä¸¤ä¸ªå­—èŠ‚\n\n\næ’åºç›¸å…³çš„å†…å­˜åœ¨æ’åºåå°±ä¼šè¢«é‡Šæ”¾\n\n\nå‡è®¾ç»™ä¸€è¡Œçš„ a å€¼åŠ  1ï¼Œæ‰§è¡Œå™¨å…ˆæ‰¾å¼•æ“å–è¡Œï¼Œæ­¤æ—¶å·²ç»åŠ äº†å†™é”\n\n\nå¼•æ“å†…éƒ¨è‡ªå·±è°ƒç”¨ï¼Œè¯»å–è¡Œï¼Œä¸åŠ æ‰«æè¡Œæ•°\n\nå¯¹äº using index condition çš„åœºæ™¯ï¼Œæ‰§è¡Œå™¨åªè°ƒç”¨äº†ä¸€æ¬¡æŸ¥è¯¢æ¥å£ï¼Œå›è¡¨æ˜¯ç”±å­˜å‚¨å±‚æ¥å®Œæˆçš„ï¼Œæ‰€ä»¥æ‰«æè¡Œæ•°åªç®—ä¸€æ¬¡ï¼Œå³åªç®—èµ°ç´¢å¼•æœç´¢çš„è¿‡ç¨‹ä¸­æ‰«æçš„è¡Œæ•°ã€‚\nåŠ ç´¢å¼•çš„æ—¶å€™ï¼Œè¦æ‰«æå…¨è¡¨ï¼Œä½†å¦‚æœæ˜¯inplace DDLï¼ˆ13ï½œä¸ºä»€ä¹ˆè¡¨æ•°æ®åˆ æ‰ä¸€åŠï¼Œè¡¨æ–‡ä»¶å¤§å°ä¸å˜ï¼Ÿï¼‰ï¼Œä½ ä¼šçœ‹åˆ°æ‰«æè¡Œæ•°æ˜¯ 0ï¼Œä¹Ÿæ˜¯å› ä¸ºè¿™äº›æ‰«æåŠ¨ä½œéƒ½æ˜¯å¼•æ“å†…éƒ¨è‡ªå·±è°ƒç”¨çš„ã€‚\n\n\n\nUsing where åŒ…å«äº†ä¸€ä¸ªâ€œå€¼æ¯”è¾ƒâ€çš„è¿‡ç¨‹ã€‚\n\nusing index condiction ç´¢å¼•ä¸‹æ¨\nusing index ç´¢å¼•è¦†ç›–\nusing where ä»£è¡¨è¿‡æ»¤å…ƒç»„ï¼Œå¯ä»¥ç†è§£ä¸ºä½¿ç”¨äº† where\nusing where å’Œ using indexä¸€èµ·å‡ºç°ä»£è¡¨ä½¿ç”¨äº†ç´¢å¼•è¿‡æ»¤æ•°æ®\n\n\n"},"å­¦ä¹ ç¬”è®°/MySQL-å®æˆ˜-45-è®²/17ï½œå¦‚ä½•æ­£ç¡®åœ°æ˜¾ç¤ºéšæœºæ¶ˆæ¯ï¼Ÿ":{"title":"17ï½œå¦‚ä½•æ­£ç¡®åœ°æ˜¾ç¤ºéšæœºæ¶ˆæ¯ï¼Ÿ","links":[],"tags":["mysql"],"content":"å†…å­˜ä¸´æ—¶è¡¨ Â§\n\n\nexplain ç»“æœä¸­ extra åŒ…å« Using temporaryï¼Œè¡¨ç¤ºéœ€è¦ä½¿ç”¨ä¸´æ—¶è¡¨\n\n\nUsing filesort è¡¨ç¤ºéœ€è¦æ‰§è¡Œæ’åºæ“ä½œ\n\n\næ¯”å¦‚æ‰§è¡Œ order by rand() çš„æ—¶å€™å°±éœ€è¦ç”¨åˆ°ä¸Šé¢ä¸¤ä¸ª\n\n\néšæœºæ’åºå®Œæ•´æ‰§è¡Œæµç¨‹å›¾\n\n\n\n\n\npos æ˜¯æ•°æ®çš„ä½ç½®ä¿¡æ¯\n\n\n\n\nå¯¹äºå†…å­˜è¡¨ï¼Œå›è¡¨è¿‡ç¨‹åªæ˜¯ç®€å•åœ°æ ¹æ®æ•°æ®è¡Œçš„ä½ç½®ç›´æ¥è®¿é—®å†…å­˜å¾—åˆ°æ•°æ®ï¼ŒMySQL ä¼˜åŒ–å™¨æ²¡æœ‰å¤šè®¿é—®ç£ç›˜çš„é¡¾è™‘ï¼Œä¼šç›´æ¥é€‰æ‹© rowid æ’åºï¼ˆæ’åºçš„è¡Œè¶Šå°è¶Šå¥½ï¼‰\n\n\nå­¦ä¹ æŠ€å·§ï¼šå…ˆé€šè¿‡åŸç†åˆ†æç®—å‡ºæ‰«æè¡Œæ•°ï¼Œç„¶åå†é€šè¿‡æŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œæ¥éªŒè¯è‡ªå·±çš„ç»“è®º\n\n\nrowid çš„å«ä¹‰ï¼šæ¯ä¸ªå¼•æ“ç”¨æ¥å”¯ä¸€æ ‡è¯†æ•°æ®è¡Œçš„ä¿¡æ¯\n\nå¯¹äºæœ‰ä¸»é”®çš„ InnoDB è¡¨ï¼Œrowid æ˜¯ä¸»é”® IDï¼›\nå¯¹äºæ²¡æœ‰ä¸»é”®çš„ InnoDB è¡¨ï¼Œrowid æ˜¯ç”±ç³»ç»Ÿç”Ÿæˆçš„ï¼›\nMEMORY å¼•æ“ä¸æ˜¯ç´¢å¼•ç»„ç»‡è¡¨ã€‚åœ¨è¿™ä¸ªä¾‹å­é‡Œé¢ï¼Œå¯ä»¥è®¤ä¸ºå®ƒå°±æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚å› æ­¤ï¼Œè¿™ä¸ª rowid å…¶å®å°±æ˜¯æ•°ç»„çš„ä¸‹æ ‡ã€‚\n\n\n\nç£ç›˜ä¸´æ—¶è¡¨ Â§\n\n\ntmp_table_size é…ç½®é™åˆ¶å†…å­˜è¡¨çš„å¤§å°ï¼Œé»˜è®¤å€¼ 16M\n\n\nå¦‚æœä¸´æ—¶è¡¨è¿‡å¤§ï¼Œå°±ä¼šè½¬æˆç£ç›˜ä¸´æ—¶è¡¨\n\n\nå½“ä½¿ç”¨ç£ç›˜ä¸´æ—¶è¡¨çš„æ—¶å€™ï¼Œå¯¹åº”çš„å°±æ˜¯ä¸€ä¸ªæ²¡æœ‰æ˜¾å¼ç´¢å¼•çš„ InnoDB è¡¨çš„æ’åºè¿‡ç¨‹ã€‚\n\n\nå¯¹äºä½¿ç”¨ç£ç›˜ä¸´æ—¶è¡¨çš„ order by rand()ï¼ŒMySQL 5.6 ç‰ˆæœ¬å¼•å…¥äº†ä¸€ä¸ªæ–°çš„æ’åºç®—æ³•ï¼šä¼˜å…ˆé˜Ÿåˆ—æ’åºç®—æ³•\n \n\n\nset tmp_table_size=1024;\nset sort_buffer_size=32768;\nset max_length_for_sort_data=16;\n/æ‰“å¼€ optimizer_traceï¼Œåªå¯¹æœ¬çº¿ç¨‹æœ‰æ•ˆ/\nSET optimizer_trace=â€˜enabled=onâ€™;\n/æ‰§è¡Œè¯­å¥/\nselect word from words order by rand() limit 3;\n/æŸ¥çœ‹ OPTIMIZER_TRACE è¾“å‡º/\nSELECT * FROM information_schema.OPTIMIZER_TRACE\\G\n\n  - ![image.png](https://cdn.jsdelivr.net/gh/11ze/static/images/mysql45-17-2.png)\n\n\n  - ç»“æœä¸­ï¼Œchosen è¡¨ç¤ºä½¿ç”¨äº†ä¼˜å…ˆé˜Ÿåˆ—æ’åºç®—æ³•\n\n    - å› ä¸ºæ²¡ç”¨åˆ°ä¸´æ—¶æ–‡ä»¶ï¼Œæ‰€ä»¥ number_of_tmp_files æ˜¯ 0\n\n- 1. å¯¹äºè¿™ 10000 ä¸ªå‡†å¤‡æ’åºçš„ (R,rowid)ï¼Œå…ˆå–å‰ä¸‰è¡Œï¼Œæ„é€ æˆä¸€ä¸ªå †ï¼›\n\n  - å¦‚æœæ„æˆçš„å †å¤§å°è¶…è¿‡ sort_buffer_size çš„å¤§å°ï¼Œåªèƒ½ä½¿ç”¨å½’å¹¶æ’åºç®—æ³•\n\n- 2. å–ä¸‹ä¸€ä¸ªè¡Œ (Râ€™,rowidâ€™)ï¼Œè·Ÿå½“å‰å †é‡Œé¢æœ€å¤§çš„ R æ¯”è¾ƒï¼Œå¦‚æœ Râ€™å°äº Rï¼ŒæŠŠè¿™ä¸ª (R,rowid) ä»å †ä¸­å»æ‰ï¼Œæ¢æˆ (Râ€™,rowidâ€™)ï¼›\n- 3. é‡å¤ç¬¬ 2 æ­¥ï¼Œç›´åˆ°ç¬¬ 10000 ä¸ª (Râ€™,rowidâ€™) å®Œæˆæ¯”è¾ƒã€‚\n\n- ä¸ç”¨ order by rand() çš„éšæœºæ’åºæ–¹æ³•ï¼ˆæ¨èï¼‰\n\n- éšæœºç®—æ³• 1\n    ```sql\nmysql&gt; select max(id),min(id) into @M,@N from t ;\nset @X= floor((@M-@N+1)*rand() + @N);\nselect * from t where id &gt;= @X limit 1;\n    ```\n\n  - 1. å–å¾—è¡¨çš„ä¸»é”®çš„æœ€å¤§å’Œæœ€å°å€¼ï¼›\n\n    - æ­¤æ“ä½œä¸éœ€è¦æ‰«æç´¢å¼•\n\n  - 2. ç”¨éšæœºå‡½æ•°ç”Ÿæˆä¸€ä¸ªæœ€å¤§åˆ°æœ€å°å€¼ä¹‹é—´çš„æ•° X = (M-N)*rand() + Nï¼›\n  - 3. å–ä¸å°äº X çš„ç¬¬ä¸€ä¸ª ID çš„è¡Œã€‚\n\n    - å¯ä»¥ç”¨ç´¢å¼•å¿«é€Ÿå®šä½\n\n  - æ•ˆç‡é«˜ï¼Œé€‚ç”¨äº ID ä¸¥æ ¼é€’å¢çš„æƒ…å†µ\n\n    - å³æ²¡æœ‰ç©ºæ´\n    - å¯ä»¥äººä¸ºå¯¹æ•°æ®è¿›è¡Œå¤„ç†ï¼Œä½¿æ•°æ®ç¬¦åˆæ¡ä»¶\n\n- éšæœºç®—æ³• 2\n\n    ```sql\nmysql&gt; select count(*) into @C from t;\nset @Y = floor(@C * rand());\nset @sql = concat(&quot;select * from t limit &quot;, @Y, &quot;,1&quot;);\nprepare stmt from @sql;\nexecute stmt;\nDEALLOCATE prepare stmt;\n    ```\n  - 1. å–å¾—æ•´ä¸ªè¡¨çš„è¡Œæ•°ï¼Œè®°ä¸º Cï¼›\n  - 2. å–å¾— Y = floor(C * rand())ã€‚ floor å‡½æ•°åœ¨è¿™é‡Œçš„ä½œç”¨ï¼Œå°±æ˜¯å–æ•´æ•°éƒ¨åˆ†ã€‚\n  - 3. å†ç”¨ limit Y,1 å–å¾—ä¸€è¡Œã€‚\n  - æ¯”ç®—æ³• 1 ä»£ä»·é«˜ï¼Œä½†è¿˜æ˜¯æ¯” order by rand() å°å¾ˆå¤š\n\n- éšæœºç®—æ³• 3\n\n    ```sql\nmysql&gt; select count(*) into @C from t;\nset @Y1 = floor(@C * rand());\nset @Y2 = floor(@C * rand());\nset @Y3 = floor(@C * rand());\nselect * from t limit @Y1ï¼Œ1ï¼› //åœ¨åº”ç”¨ä»£ç é‡Œé¢å–Y1ã€Y2ã€Y3å€¼ï¼Œæ‹¼å‡ºSQLåæ‰§è¡Œ\nselect * from t limit @Y2ï¼Œ1ï¼›\nselect * from t limit @Y3ï¼Œ1ï¼›\n    ```\n\n## æ€è€ƒé¢˜\n\n- ä¼˜åŒ–ç®—æ³• 3\n\n- å°†ä¸‰ä¸ª Y æ’åºï¼Œä»å°çš„å¼€å§‹æŸ¥ï¼Œä¸‹ä¸€ä¸ª Y ä»ä¸­æ–­çš„åœ°æ–¹æ¥ç€æŸ¥\n- ä¹Ÿå¯ä»¥å…ˆå–å› id å€¼ï¼Œåœ¨åº”ç”¨ä¸­ç¡®å®šä¸‰ä¸ª id å€¼ä»¥åï¼Œæ‰§è¡Œä¸‰æ¬¡ where id=X çš„è¯­å¥\n- ä¸‹ä¸€ç« ç»™çš„ç­”æ¡ˆ\n\n  - å– Y1ã€Y2 å’Œ Y3 é‡Œé¢æœ€å¤§çš„ä¸€ä¸ªæ•°ï¼Œè®°ä¸º Mï¼Œæœ€å°çš„ä¸€ä¸ªæ•°è®°ä¸º Nï¼Œç„¶åæ‰§è¡Œä¸‹é¢è¿™æ¡ SQL è¯­å¥ï¼š`mysql&gt; select * from t limit N, M-N+1;` å–å‡ºæ¥åå†æ‹¿åˆ°ä¸‰ä¸ª Yï¼›å†åŠ ä¸Šå–æ•´ä¸ªè¡¨æ€»è¡Œæ•°çš„ C è¡Œï¼Œè¿™ä¸ªæ–¹æ¡ˆçš„æ‰«æè¡Œæ•°æ€»å…±åªéœ€è¦ C+M+1 è¡Œã€‚\n\n## è¯„è®ºåŒº\n\n- æ’åºæ“ä½œæ˜¯åœ¨ server å±‚åšçš„\n- æ’åºè¿‡ç¨‹æœ¬èº«ä¸å¢åŠ æ‰«æè¡Œæ•°ï¼Œæ‰«æåŸè¡¨å’Œå†…å­˜è¡¨ä¼šå¢åŠ \n- åªè¦ sort buffer è¶³å¤Ÿï¼Œå°±é‡‡ç”¨ä¼˜å…ˆé˜Ÿåˆ—æ’åºï¼Œè€Œä¸ç”¨ç®¡åˆ°åº•æ˜¯å…¨å­—æ®µæ’åºè¿˜æ˜¯ rowid æ’åºï¼Œå‰ææ˜¯æœ‰ limit å­å¥\n"},"å­¦ä¹ ç¬”è®°/MySQL-å®æˆ˜-45-è®²/18ï½œä¸ºä»€ä¹ˆè¿™äº›-SQL-è¯­å¥é€»è¾‘ç›¸åŒï¼Œæ€§èƒ½å´å·®å¼‚å·¨å¤§ï¼Ÿ":{"title":"18ï½œä¸ºä»€ä¹ˆè¿™äº› SQL è¯­å¥é€»è¾‘ç›¸åŒï¼Œæ€§èƒ½å´å·®å¼‚å·¨å¤§ï¼Ÿ","links":[],"tags":["mysql"],"content":"æ¡ˆä¾‹ä¸€ï¼šæ¡ä»¶å­—æ®µå‡½æ•°æ“ä½œ Â§\n\nåŸè¯­å¥ï¼šmysql&gt; select count(*) from tradelog where month(t_modified)=7;\n\nå­—æ®µå€¼å¦‚ï¼š2017-7-1\n\n\nå¯¹ç´¢å¼•å­—æ®µåšå‡½æ•°æ“ä½œï¼Œå¯èƒ½ä¼šç ´åç´¢å¼•å€¼çš„æœ‰åºæ€§ï¼Œå› æ­¤ä¼˜åŒ–å™¨å°±å†³å®šæ”¾å¼ƒèµ°æ ‘æœç´¢åŠŸèƒ½\nä½†æ˜¯ï¼Œä¼˜åŒ–å™¨å¹¶ä¸æ˜¯è¦æ”¾å¼ƒä½¿ç”¨è¿™ä¸ªç´¢å¼•ï¼Œè¿˜å¯ä»¥é€‰æ‹©éå†ä¸»é”®ç´¢å¼•ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©éå†ç´¢å¼• t_modified\nä¼˜åŒ–æ–¹æ¡ˆï¼šmysql&gt; select count(*) from tradelog whereÂ  Â  -&gt; (t_modified &gt;= &#039;2016-7-1&#039; and t_modified&lt;&#039;2016-8-1&#039;) orÂ  Â  -&gt; (t_modified &gt;= &#039;2017-7-1&#039; and t_modified&lt;&#039;2017-8-1&#039;) orÂ Â  Â  -&gt; (t_modified &gt;= &#039;2018-7-1&#039; and t_modified&lt;&#039;2018-8-1&#039;);\n\næ¡ˆä¾‹äºŒï¼šéšå¼ç±»å‹è½¬æ¢ Â§\n\nmysql&gt; select * from tradelog where tradeid=110717;\n\nç›¸å½“äºï¼šmysql&gt; select * from tradelog where CAST(tradid AS signed int) = 110717;\n\n\nå› ä¸º tradeid çš„å­—æ®µç±»å‹æ˜¯ varchar(32)ï¼Œè¾“å…¥çš„å‚æ•°æ˜¯æ•´å½¢ï¼Œæ‰€ä»¥è¯¥è¯­å¥éœ€è¦èµ°å…¨è¡¨æ‰«æ\n\nå¦‚æœå­—æ®µæ˜¯æ•´å½¢ï¼Œè¾“å…¥æ˜¯å­—ç¬¦ä¸²ï¼Œåˆ™å¯ä»¥èµ°ç´¢å¼•\n\n\næ•°æ®ç±»å‹è½¬æ¢çš„è§„åˆ™\nä¸ºä»€ä¹ˆæœ‰æ•°æ®ç±»å‹è½¬æ¢å°±éœ€è¦èµ°å…¨ç´¢å¼•æ‰«æ\n\nè¿™æ¡è¯­å¥è§¦å‘äº†æˆ‘ä»¬ä¸Šé¢è¯´åˆ°çš„è§„åˆ™ï¼šå¯¹ç´¢å¼•å­—æ®µåšå‡½æ•°æ“ä½œï¼Œä¼˜åŒ–å™¨ä¼šæ”¾å¼ƒèµ°æ ‘æœç´¢åŠŸèƒ½ã€‚\n\n\n\næ¡ˆä¾‹ä¸‰ï¼šéšå¼å­—ç¬¦ç¼–ç è½¬æ¢ Â§\n\nä¸¤ä¸ªè¡¨çš„å­—ç¬¦é›†ä¸åŒï¼Œä¸€ä¸ªæ˜¯ utf8ï¼Œä¸€ä¸ªæ˜¯ utf8mb4ï¼Œæ‰€ä»¥åšè¡¨è¿æ¥æŸ¥è¯¢çš„æ—¶å€™ç”¨ä¸ä¸Šå…³è”å­—æ®µçš„ç´¢å¼•\n\nutf8mb4 æ˜¯ utf8 çš„è¶…é›†ã€‚ç±»ä¼¼åœ°ï¼Œåœ¨ç¨‹åºè®¾è®¡è¯­è¨€é‡Œé¢ï¼Œåšè‡ªåŠ¨ç±»å‹è½¬æ¢çš„æ—¶å€™ï¼Œä¸ºäº†é¿å…æ•°æ®åœ¨è½¬æ¢è¿‡ç¨‹ä¸­ç”±äºæˆªæ–­å¯¼è‡´æ•°æ®é”™è¯¯ï¼Œä¹Ÿéƒ½æ˜¯â€œæŒ‰æ•°æ®é•¿åº¦å¢åŠ çš„æ–¹å‘â€è¿›è¡Œè½¬æ¢çš„ã€‚\nä¾‹å­ï¼šselect * from trade_detail where CONVERT(traideid USING utf8mb4)=$L2.tradeid.value;\n\n\nä¼˜åŒ–æ–¹æ¡ˆ\n\næŠŠä¸¤ä¸ªè¡¨çš„å­—æ®µçš„å­—ç¬¦é›†æ”¹æˆ utf8mb4\n\næ¨èåšæ³•\n\n\nå¦‚æœè¡¨æ•°æ®é‡å¤ªå¤§ï¼Œæˆ–è€…ä¸šåŠ¡ä¸Šæš‚æ—¶ä¸èƒ½åšè¿™ä¸ª DDL çš„è¯ï¼Œåªèƒ½é‡‡ç”¨ä¿®æ”¹ SQL è¯­å¥çš„æ–¹æ³•\n\n\nmysql&gt; select d.* from tradelog l , trade_detail d where d.tradeid=CONVERT(l.tradeid USING utf8) and l.id=2;\n\n\n\næ¡ˆä¾‹è¯´æ˜ Â§\n\næ¡ˆä¾‹éƒ½åœ¨è¯´åŒä¸€ä»¶äº‹ï¼šå¯¹ç´¢å¼•å­—æ®µåšå‡½æ•°æ“ä½œï¼Œå¯èƒ½ä¼šç ´åç´¢å¼•å€¼çš„æœ‰åºæ€§ï¼Œå› æ­¤ä¼˜åŒ–å™¨å°±å†³å®šæ”¾å¼ƒèµ°æ ‘æœç´¢åŠŸèƒ½ã€‚\nè™½ç„¶æ‰§è¡Œè¿‡ç¨‹ä¸­å¯èƒ½ç»è¿‡å‡½æ•°æ“ä½œï¼Œä½†æ˜¯æœ€ç»ˆåœ¨æ‹¿åˆ°ç»“æœåï¼Œserver å±‚è¿˜è¦åšä¸€è½®åˆ¤æ–­ã€‚\n\nè¯„è®ºåŒº Â§\n\nè¡¨çš„è®¿é—®é¡ºåºä¸è¿æ¥æ–¹å¼ã€æ¡ä»¶å­—æ®µæœ‰å…³ï¼Œè·Ÿä¹¦å†™é¡ºåºæ— å…³\n\nå¯å‚è€ƒã€Šæ•°æ®åº“ç´¢å¼•è®¾è®¡ä¸ä¼˜åŒ–ã€‹ç¬¬å…«ç« çš„è¡¨è®¿é—®é¡ºåºå¯¹ç´¢å¼•è®¾è®¡çš„å½±å“\n\n\nå…ˆ whereï¼Œå† order byï¼Œæœ€å limitã€‚\nå­—ç¬¦ä¸²éƒ½é€‰ utf8mb4\n"},"å­¦ä¹ ç¬”è®°/MySQL-å®æˆ˜-45-è®²/19ï½œä¸ºä»€ä¹ˆæˆ‘åªæŸ¥ä¸€è¡Œçš„è¯­å¥ï¼Œä¹Ÿæ‰§è¡Œè¿™ä¹ˆæ…¢ï¼Ÿ":{"title":"19ï½œä¸ºä»€ä¹ˆæˆ‘åªæŸ¥ä¸€è¡Œçš„è¯­å¥ï¼Œä¹Ÿæ‰§è¡Œè¿™ä¹ˆæ…¢ï¼Ÿ","links":[],"tags":["mysql"],"content":"\næœ‰ä¸ªè¡¨ tï¼šmysql&gt; CREATE TABLEt(idint(11) NOT NULL,cint(11) DEFAULT NULL,Â  PRIMARY KEY (id)) ENGINE=InnoDB;\n\nç¬¬ä¸€ç±»ï¼šæŸ¥è¯¢é•¿æ—¶é—´ä¸è¿”å› Â§\nç­‰ MDL é” Â§\n\n\nä½¿ç”¨ show processlist å‘½ä»¤æŸ¥çœ‹ Waiting for table metadata lock çš„ç¤ºæ„å›¾\n\n\n\n\n\nå‡ºç°è¿™ä¸ªçŠ¶æ€è¡¨ç¤ºçš„æ˜¯ï¼Œç°åœ¨æœ‰ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨è¡¨ t ä¸Šè¯·æ±‚æˆ–æŒæœ‰ MDL å†™é”ï¼ŒæŠŠ select è¯­å¥å µä½äº†\n\n\nç®€å•çš„å¤ç°æ­¥éª¤\n\n\n\n\n\nå¤„ç†æ–¹å¼ï¼šæ‰¾åˆ°è°æŒæœ‰ MDL å†™é”ï¼Œkill æ‰\n\n\nä½†æ˜¯ï¼Œç”±äºåœ¨ show processlist çš„ç»“æœé‡Œé¢ï¼Œsession A çš„ Command åˆ—æ˜¯â€œSleepâ€ï¼Œå¯¼è‡´æŸ¥æ‰¾èµ·æ¥å¾ˆä¸æ–¹ä¾¿ã€‚ä¸è¿‡æœ‰äº† performance_schema å’Œ sys ç³»ç»Ÿåº“ä»¥åï¼Œå°±æ–¹ä¾¿å¤šäº†ã€‚ï¼ˆMySQL å¯åŠ¨æ—¶éœ€è¦è®¾ç½® performance_schema=onï¼Œç›¸æ¯”äºè®¾ç½®ä¸º off ä¼šæœ‰ 10% å·¦å³çš„æ€§èƒ½æŸå¤±)\n\n\né€šè¿‡æŸ¥è¯¢ sys.schema_table_lock_waits è¿™å¼ è¡¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥æ‰¾å‡ºé€ æˆé˜»å¡çš„ process idï¼ŒæŠŠè¿™ä¸ªè¿æ¥ç”¨ kill å‘½ä»¤æ–­å¼€å³å¯ã€‚\n\n\n\n\n\nç­‰ flush Â§\n\n\nmysql&gt; select * from information_schema.processlist where id=1;\n\n\nWaiting for table flush çŠ¶æ€ç¤ºæ„å›¾\n\n\n\n\n\nç°åœ¨æœ‰ä¸€ä¸ªçº¿ç¨‹æ­£è¦å¯¹è¡¨ t åš flush æ“ä½œã€‚MySQL é‡Œé¢å¯¹è¡¨åš flush æ“ä½œçš„ç”¨æ³•ï¼Œä¸€èˆ¬æœ‰ä»¥ä¸‹ä¸¤ä¸ªï¼š\n\n\nflush tables t with read lock;\n\n\nflush tables with read lock;\n\n\nå¦‚æœæŒ‡å®šè¡¨ t çš„è¯ï¼Œä»£è¡¨çš„æ˜¯åªå…³é—­è¡¨ tï¼›å¦‚æœæ²¡æœ‰æŒ‡å®šå…·ä½“çš„è¡¨åï¼Œåˆ™è¡¨ç¤ºå…³é—­ MySQL é‡Œæ‰€æœ‰æ‰“å¼€çš„è¡¨ã€‚\n\n\nä½†æ˜¯æ­£å¸¸è¿™ä¸¤ä¸ªè¯­å¥æ‰§è¡Œèµ·æ¥éƒ½å¾ˆå¿«ï¼Œé™¤éå®ƒä»¬ä¹Ÿè¢«åˆ«çš„çº¿ç¨‹å µä½äº†ã€‚\n\n\næ‰€ä»¥ï¼Œå‡ºç° Waiting for table flush çŠ¶æ€çš„å¯èƒ½æƒ…å†µæ˜¯ï¼šæœ‰ä¸€ä¸ª flush tables å‘½ä»¤è¢«åˆ«çš„è¯­å¥å µä½äº†ï¼Œç„¶åå®ƒåˆå µä½äº†æˆ‘ä»¬çš„ select è¯­å¥ã€‚\n\n\n\n\næ’æŸ¥\n\n\nå›¾ 7\n\n\n\n\n\nè¿™ä¸ªä¾‹å­çš„æ’æŸ¥ä¹Ÿå¾ˆç®€å•ï¼Œä½ çœ‹åˆ°è¿™ä¸ª show processlist çš„ç»“æœï¼Œè‚¯å®šå°±çŸ¥é“åº”è¯¥æ€ä¹ˆåšäº†ã€‚\n\n\n\n\nç­‰è¡Œé” Â§\n\n\nmysql&gt; select * from t where id=1 lock in share mode;\n\n\nç”±äºè®¿é—® id=1 è¿™ä¸ªè®°å½•æ—¶è¦åŠ è¯»é”ï¼Œå¦‚æœè¿™æ—¶å€™å·²ç»æœ‰ä¸€ä¸ªäº‹åŠ¡åœ¨è¿™è¡Œè®°å½•ä¸ŠæŒæœ‰ä¸€ä¸ªå†™é”ï¼Œæˆ‘ä»¬çš„ select è¯­å¥å°±ä¼šè¢«å µä½ã€‚\n\n\n\n\n\nè¡Œé” show processlist\n\n\nsession A å¯åŠ¨äº†äº‹åŠ¡ï¼Œå æœ‰å†™é”ï¼Œè¿˜ä¸æäº¤ï¼Œæ˜¯å¯¼è‡´ session B è¢«å µä½çš„åŸå› ã€‚\n\n\n\nMySQL 5.7 ç‰ˆæœ¬ï¼Œå¯ä»¥é€šè¿‡ sys.innodb_lock_waits è¡¨æŸ¥åˆ°æ˜¯è°å ç€è¡Œé” mysql&gt; select * from t sys.innodb_lock_waits where locked_table=&#039;test.t&#039;\\G\n\n\n\n\n\nå¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªä¿¡æ¯å¾ˆå…¨ï¼Œ4 å·çº¿ç¨‹æ˜¯é€ æˆå µå¡çš„ç½ªé­ç¥¸é¦–ã€‚è€Œå¹²æ‰è¿™ä¸ªç½ªé­ç¥¸é¦–çš„æ–¹å¼ï¼Œå°±æ˜¯ KILL QUERY 4 æˆ– KILL 4ã€‚ä¸è¿‡ï¼Œè¿™é‡Œä¸åº”è¯¥æ˜¾ç¤ºâ€œKILL QUERY 4â€ã€‚è¿™ä¸ªå‘½ä»¤è¡¨ç¤ºåœæ­¢ 4 å·çº¿ç¨‹å½“å‰æ­£åœ¨æ‰§è¡Œçš„è¯­å¥ï¼Œè€Œè¿™ä¸ªæ–¹æ³•å…¶å®æ˜¯æ²¡æœ‰ç”¨çš„ã€‚å› ä¸ºå æœ‰è¡Œé”çš„æ˜¯ update è¯­å¥ï¼Œè¿™ä¸ªè¯­å¥å·²ç»æ˜¯ä¹‹å‰æ‰§è¡Œå®Œæˆäº†çš„ï¼Œç°åœ¨æ‰§è¡Œ KILL QUERYï¼Œæ— æ³•è®©è¿™ä¸ªäº‹åŠ¡å»æ‰ id=1 ä¸Šçš„è¡Œé”ã€‚å®é™…ä¸Šï¼ŒKILL 4 æ‰æœ‰æ•ˆï¼Œä¹Ÿå°±æ˜¯è¯´ç›´æ¥æ–­å¼€è¿™ä¸ªè¿æ¥ã€‚è¿™é‡Œéšå«çš„ä¸€ä¸ªé€»è¾‘å°±æ˜¯ï¼Œè¿æ¥è¢«æ–­å¼€çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨å›æ»šè¿™ä¸ªè¿æ¥é‡Œé¢æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ï¼Œä¹Ÿå°±é‡Šæ”¾äº† id=1 ä¸Šçš„è¡Œé”ã€‚\n\n\nç¬¬äºŒç±»ï¼šæŸ¥è¯¢æ…¢ Â§\n\nåœ¨è¿æ¥åæ‰§è¡Œ set long_query_time=0 å¯ä»¥å°†æ…¢æŸ¥è¯¢æ—¥å¿—çš„æ—¶é—´é˜ˆå€¼è®¾ç½®ä¸º 0\nä¸€ä¸ªä¾‹å­\n\n\n800 æ¯«ç§’ mysql&gt; select * from t where id=1\n\nid ä¸Šæœ‰ç´¢å¼•\n\n\n\n0.2 æ¯«ç§’ mysql&gt; select * from t where id=1 lock in share mode\n\n\næç¤º\n\n\n\n\n\nå¤ç°\n\n\n\n\n\nå¸¦ lock in share mode çš„ SQL è¯­å¥ï¼Œæ˜¯å½“å‰è¯»ï¼Œå› æ­¤ä¼šç›´æ¥è¯»åˆ° 1000001 è¿™ä¸ªç»“æœï¼Œæ‰€ä»¥é€Ÿåº¦å¾ˆå¿«ï¼›è€Œ select * from t where id=1 è¿™ä¸ªè¯­å¥ï¼Œæ˜¯ä¸€è‡´æ€§è¯»ï¼Œå› æ­¤éœ€è¦ä» 1000001 å¼€å§‹ï¼Œä¾æ¬¡æ‰§è¡Œ undo logï¼Œæ‰§è¡Œäº† 100 ä¸‡æ¬¡ä»¥åï¼Œæ‰å°† 1 è¿™ä¸ªç»“æœè¿”å›ã€‚\n\n\n\n\næ€è€ƒé¢˜ Â§\n\n\nbegin;select * from t where c=5 for update;commit;\n\nc ä¸Šæ²¡ç´¢å¼•\n\n\n\nè¿™ä¸ªè¯­å¥åºåˆ—æ˜¯æ€ä¹ˆåŠ é”çš„å‘¢ï¼Ÿ\n\nRR éš”ç¦»çº§åˆ«ä¸‹ï¼Œä¸ºä¿è¯ binlog è®°å½•é¡ºåºï¼Œéç´¢å¼•æ›´æ–°ä¼šé”ä½å…¨è¡¨è®°å½•ï¼Œä¸”äº‹åŠ¡ç»“æŸå‰ä¸ä¼šå¯¹ä¸ç¬¦åˆæ¡ä»¶è®°å½•æœ‰é€æ­¥é‡Šæ”¾çš„è¿‡ç¨‹ã€‚\nåœ¨ Read Committed éš”ç¦»çº§åˆ«ä¸‹ï¼Œä¼šé”ä¸Šèšç°‡ç´¢å¼•ä¸­çš„æ‰€æœ‰è®°å½•ï¼›\nåœ¨ Repeatable Read éš”ç¦»çº§åˆ«ä¸‹ï¼Œä¼šé”ä¸Šèšç°‡ç´¢å¼•ï¼ˆä¸»é”®ç´¢å¼•ï¼‰ä¸­çš„æ‰€æœ‰è®°å½•ï¼Œå¹¶ä¸”ä¼šé”ä¸Šèšç°‡ç´¢å¼•å†…çš„æ‰€æœ‰ GAPï¼ˆé—´éš™é”ï¼‰ï¼›\n\n\n\nåŠ çš„é”åˆæ˜¯ä»€ä¹ˆæ—¶å€™é‡Šæ”¾å‘¢ï¼Ÿ\n\ncommit çš„æ—¶å€™é‡Šæ”¾\nåœ¨ä¸Šé¢ä¸¤ä¸ªéš”ç¦»çº§åˆ«çš„æƒ…å†µä¸‹ï¼Œå¦‚æœè®¾ç½®äº† innodb_locks_unsafe_for_binlog å¼€å¯ semi-consistent read çš„è¯ï¼Œå¯¹äºä¸æ»¡è¶³æŸ¥è¯¢æ¡ä»¶çš„è®°å½•ï¼ŒMySQL ä¼šæå‰æ”¾é”ï¼Œä¸è¿‡åŠ é”çš„è¿‡ç¨‹æ˜¯ä¸å¯é¿å…çš„ã€‚\n\n\n"},"å­¦ä¹ ç¬”è®°/MySQL-å®æˆ˜-45-è®²/20ï½œå¹»è¯»æ˜¯ä»€ä¹ˆï¼Œå¹»è¯»æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ":{"title":"20ï½œå¹»è¯»æ˜¯ä»€ä¹ˆï¼Œå¹»è¯»æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ","links":[],"tags":["mysql"],"content":"\n\nInnoDB çš„é»˜è®¤äº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯å¯é‡å¤è¯»\n\n\nå’Œä¸‹ä¸€ç« å…±ç”¨çš„è¡¨ï¼š\nCREATE TABLE `t` (\nÂ  `id` int(11) NOT NULL,Â \nÂ  `c` int(11) DEFAULT NULL,Â \nÂ  `d` int(11) DEFAULT NULL,Â \nÂ  PRIMARY KEY (`id`),Â \nÂ  KEY `c` (`c`)\n) ENGINE=InnoDB;\ninsert into t values(0,0,0),(5,5,5),(10,10,10),(15,15,15),(20,20,20),(25,25,25);\n\n\nå¹»è¯» Â§\n\n\nå¹»è¯»æŒ‡çš„æ˜¯ä¸€ä¸ªäº‹åŠ¡åœ¨å‰åä¸¤æ¬¡æŸ¥è¯¢åŒä¸€ä¸ªèŒƒå›´çš„æ—¶å€™ï¼Œåä¸€æ¬¡æŸ¥è¯¢çœ‹åˆ°äº†å‰ä¸€æ¬¡æŸ¥è¯¢æ²¡æœ‰çœ‹åˆ°çš„è¡Œã€‚\n\nâš ï¸ åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œæ™®é€šçš„æŸ¥è¯¢æ˜¯å¿«ç…§è¯»ï¼Œæ˜¯ä¸ä¼šçœ‹åˆ°åˆ«çš„äº‹åŠ¡æ’å…¥çš„æ•°æ®çš„ã€‚å› æ­¤ï¼Œå¹»è¯»åœ¨â€œå½“å‰è¯»â€ä¸‹æ‰ä¼šå‡ºç°ã€‚\nå¹»è¯»ä¸“æŒ‡â€œæ–°æ’å…¥çš„è¡Œâ€ã€‚\n\n\n\nåŸå› ï¼šè¡Œé”åªèƒ½é”ä½è¡Œï¼Œä½†æ˜¯æ–°æ’å…¥è®°å½•è¿™ä¸ªåŠ¨ä½œï¼Œè¦æ›´æ–°çš„æ˜¯è®°å½•ä¹‹é—´çš„â€œé—´éš™â€\n\n\nå¹»è¯»æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ\n\nè¯­ä¹‰ä¸Šè¢«ç ´åï¼Œæ¯”å¦‚ï¼Œå‡è®¾åªæŠŠæ‰€æœ‰ d = 5 çš„è¡Œé”ä½ï¼Œä¸å‡†åˆ«çš„äº‹åŠ¡è¿›è¡Œè¯»å†™æ“ä½œï¼Œæ­¤æ—¶æ›´æ–°åˆ«çš„æœªè¢«é”ä½çš„ d != 5 çš„è¡Œï¼Œè®© d = 5\næ•°æ®ä¸€è‡´æ€§é—®é¢˜\n\nå³ä½¿æŠŠå³å°†è¦æ”¹æˆ d = 5 çš„è¡Œä¹Ÿé”ä½ï¼Œè¿˜æ˜¯æ‹¦ä¸ä½æ’å…¥ d = 5 çš„è¡Œ\n\n\n\n\n\nè§£å†³ Â§\n\n\nInnoDB åªå¥½å¼•å…¥æ–°çš„é”ï¼Œä¹Ÿå°±æ˜¯é—´éš™é” (Gap Lock)ã€‚\n\n\né—´éš™é”ï¼Œé”çš„å°±æ˜¯ä¸¤ä¸ªå€¼ä¹‹é—´çš„ç©ºéš™ã€‚æ¯”å¦‚æ–‡ç« å¼€å¤´çš„è¡¨ tï¼Œåˆå§‹åŒ–æ’å…¥äº† 6 ä¸ªè®°å½•ï¼Œè¿™å°±äº§ç”Ÿäº† 7 ä¸ªé—´éš™ã€‚\n\n\n\n\n\né—´éš™é”è®°ä¸ºå¼€åŒºé—´\n\n\n\n\nè·Ÿé—´éš™é”å­˜åœ¨å†²çªå…³ç³»çš„ï¼Œæ˜¯â€œå¾€è¿™ä¸ªé—´éš™ä¸­æ’å…¥ä¸€ä¸ªè®°å½•â€è¿™ä¸ªæ“ä½œã€‚é—´éš™é”ä¹‹é—´éƒ½ä¸å­˜åœ¨å†²çªå…³ç³»ã€‚\n\n\né—´éš™é”å’Œè¡Œé”åˆç§° next-key lockï¼Œæ˜¯å‰å¼€åé—­åŒºé—´ã€‚\n\nå¦‚æœç”¨ select * from t for update è¦æŠŠæ•´ä¸ªè¡¨æ‰€æœ‰è®°å½•é”èµ·æ¥ï¼Œå°±å½¢æˆäº† 7 ä¸ª next-key lockï¼Œåˆ†åˆ«æ˜¯ (-âˆ,0]ã€(0,5]ã€(5,10]ã€(10,15]ã€(15,20]ã€(20, 25]ã€(25, +supremum]ã€‚\n\n\n\né—´éš™é”å’Œ next-key lock çš„å¼•å…¥å¸¦æ¥çš„é—®é¢˜\n\nåŠ å¤§äº†åŠ é”èŒƒå›´ï¼Œé™ä½å¹¶å‘åº¦\n\n\n\nä¸Šé¢çš„è®¨è®ºéƒ½æ˜¯åœ¨å¯é‡å¤åº¦éš”ç¦»çº§åˆ«ä¸‹çš„ï¼Œé—´éš™é”åœ¨æ­¤çº§åˆ«ä¸‹æ‰ä¼šç”Ÿæ•ˆ\n\n\nå¦‚æœæ”¹æˆè¯»æäº¤ï¼Œå°±æ²¡æœ‰é—´éš™é”ï¼ŒåŒæ—¶ä¹Ÿä¸ä¼šæœ‰ä¸Šé¢çš„é—®é¢˜ï¼Œä½†åŒæ—¶ä¹Ÿéœ€è¦æŠŠ binlog æ ¼å¼è®¾ç½®ä¸º row\n\nå¸¸è§çš„é…ç½®ç»„åˆï¼šè¯»æäº¤ + binlog_format=row\n\n\n\næ€è€ƒé¢˜ Â§\n\n\n\nB å’Œ C éƒ½ä¼šè¿›å…¥é”ç­‰å¾…çŠ¶æ€\n\n\nåŸå› æ˜¯ä»€ä¹ˆ\n\ndescï¼Œå‘å³æ‰«æå˜æˆå‘å·¦æ‰«æ\nå‰å¼€åé—­æ²¡å˜\nåŠ é”èŒƒå›´\n\n(20, 25) (15, 20] (5, 10]\n\n\n\n\n\nè¯„è®ºåŒº Â§\n\nMySQL é‡Œå•å¼•å·åŒå¼•å·ä¸€æ ·\n&lt;= æ˜¯é—´éš™é”è¿˜æ˜¯è¡Œé”ï¼Ÿ\n\næ‰¾ç¬¬ä¸€ä¸ªå€¼æ˜¯ï¼ŒæŒ‰ç­‰å€¼ï¼Œæ‰¾ä¸‹ä¸€ä¸ªå€¼ï¼ŒæŒ‰èŒƒå›´æŸ¥æ‰¾\n\n\n"},"å­¦ä¹ ç¬”è®°/MySQL-å®æˆ˜-45-è®²/21ï½œä¸ºä»€ä¹ˆæˆ‘åªæ”¹ä¸€è¡Œçš„è¯­å¥ï¼Œé”è¿™ä¹ˆå¤šï¼Ÿ":{"title":"21ï½œä¸ºä»€ä¹ˆæˆ‘åªæ”¹ä¸€è¡Œçš„è¯­å¥ï¼Œé”è¿™ä¹ˆå¤šï¼Ÿ","links":[],"tags":["mysql"],"content":"\n\næ­¤ç« èŠ‚çš„è§„åˆ™æœ‰æ•ˆçš„å‰æ\n\nåŠ é”ç­–ç•¥å¯èƒ½æ”¹å˜ï¼Œä¸‹é¢çš„åªé™äº\n\n5.x ç³»åˆ— &lt;= 5.7.24\n8.0 ç³»åˆ— &lt;= 8.0.13\n\n\n\n\n\né—´éš™é”åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹æ‰æœ‰æ•ˆ\n\nè¯»æäº¤åœ¨å¤–é”®åœºæ™¯ä¸‹ä¹Ÿæœ‰\n\n\n\nä¸¤ä¸ªåŸåˆ™ã€ä¸¤ä¸ªä¼˜åŒ–ã€ä¸€ä¸ª bug\n\nåŸåˆ™ 1ï¼šåŠ é”çš„åŸºæœ¬å•ä½æ˜¯ next-key lockã€‚å¸Œæœ›ä½ è¿˜è®°å¾—ï¼Œnext-key lock æ˜¯å‰å¼€åé—­åŒºé—´ã€‚\nåŸåˆ™ 2ï¼šæŸ¥æ‰¾è¿‡ç¨‹ä¸­è®¿é—®åˆ°çš„å¯¹è±¡æ‰ä¼šåŠ é”ã€‚é€ä¸ªåŠ \nä¼˜åŒ– 1ï¼šç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢ï¼Œç»™å”¯ä¸€ç´¢å¼•åŠ é”çš„æ—¶å€™ï¼Œnext-key lock é€€åŒ–ä¸ºè¡Œé”ã€‚\nä¼˜åŒ– 2ï¼šç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢ï¼Œå‘å³éå†æ—¶ä¸”æœ€åä¸€ä¸ªå€¼ä¸æ»¡è¶³ç­‰å€¼æ¡ä»¶çš„æ—¶å€™ï¼Œnext-key lock é€€åŒ–ä¸ºé—´éš™é”ã€‚\nä¸€ä¸ª bugï¼šå”¯ä¸€ç´¢å¼•ä¸Šçš„èŒƒå›´æŸ¥è¯¢ä¼šè®¿é—®åˆ°ä¸æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªå€¼ä¸ºæ­¢ã€‚\n\nMySQL 8.0.18 ç‰ˆæœ¬å·²ä¿®å¤\n\n\n\n\n\nå…«ä¸ªæ¡ˆä¾‹\n\nlock in share mode åªé”è¦†ç›–ç´¢å¼•ï¼Œè€Œæ‰§è¡Œ for update æ—¶ï¼Œç³»ç»Ÿè®¤ä¸ºæ¥ä¸‹æ¥è¦æ›´æ–°æ•°æ®ï¼Œå› æ­¤ä¼šé¡ºä¾¿ç»™ä¸»é”®ç´¢å¼•ä¸Šæ»¡è¶³æ¡ä»¶çš„è¡ŒåŠ ä¸Šè¡Œé”ï¼›\n\nè¯´æ˜é”æ˜¯åŠ åœ¨ç´¢å¼•ä¸Šçš„\n\n\nè¦ç”¨ lock in share mode ç»™è¡ŒåŠ è¯»é”é¿å…æ•°æ®è¢«æ›´æ–°çš„è¯ï¼Œå¿…é¡»å¾—ç»•è¿‡è¦†ç›–ç´¢å¼•çš„ä¼˜åŒ–ï¼Œåœ¨æŸ¥è¯¢å­—æ®µä¸­åŠ å…¥ç´¢å¼•ä¸­ä¸å­˜åœ¨çš„å­—æ®µ\n\næ¯”å¦‚ï¼Œå°†æŸ¥è¯¢è¯­å¥ select id from t where c=5; æ”¹æˆ select d from t where c=5 lock in share mode;\n\n\nç­‰ä»·çš„è¯­å¥åŠ é”èŒƒå›´ä¸ä¸€å®šç›¸åŒ\n\næ¯”å¦‚ç­‰å€¼æŸ¥è¯¢å’ŒèŒƒå›´æŸ¥è¯¢\n\n\ndelete è¯­å¥åŠ é”çš„é€»è¾‘è·Ÿ select â€¦ for update ç±»ä¼¼\nâš ï¸ åœ¨åˆ é™¤æ•°æ®çš„æ—¶å€™å°½é‡åŠ  limit\n\nä¸ä»…å¯ä»¥æ§åˆ¶åˆ é™¤æ•°æ®çš„æ¡æ•°ï¼Œè¿˜å¯ä»¥å‡å°åŠ é”çš„èŒƒå›´\n\n\nåŠ  next-key lock å®é™…ä¸Šæ˜¯åˆ†æˆæ¥ä¸¤æ­¥ï¼Œå…ˆåŠ é—´éš™é”ï¼Œç„¶åå†åŠ è¡Œé”\n\n\n\nå°ç»“\n\nè¯»æäº¤éš”ç¦»çº§åˆ«ä¸‹è¿˜æœ‰ä¸€ä¸ªä¼˜åŒ–ï¼šè¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­åŠ ä¸Šçš„è¡Œé”ï¼Œåœ¨è¯­å¥æ‰§è¡Œå®Œæˆåï¼Œå°±è¦æŠŠâ€œä¸æ»¡è¶³æ¡ä»¶çš„è¡Œâ€ä¸Šçš„è¡Œé”ç›´æ¥é‡Šæ”¾ï¼Œä¸éœ€è¦ç­‰åˆ°äº‹åŠ¡æäº¤\n\né”çš„èŒƒå›´æ›´å°ï¼Œé”çš„æ—¶é—´æ›´çŸ­\nä¸å°‘ä¸šåŠ¡é»˜è®¤ä½¿ç”¨è¯»æäº¤éš”ç¦»çº§åˆ«çš„åŸå› \nåªå¯¹ update æœ‰æ•ˆï¼Œdelete æ— æ•ˆ\n\n\n\n\n"},"å­¦ä¹ ç¬”è®°/MySQL-å®æˆ˜-45-è®²/22ï½œMySQLæœ‰å“ªäº›â€œé¥®é¸©æ­¢æ¸´â€æé«˜æ€§èƒ½çš„æ–¹æ³•ï¼Ÿ":{"title":"22ï½œMySQLæœ‰å“ªäº›â€œé¥®é¸©æ­¢æ¸´â€æé«˜æ€§èƒ½çš„æ–¹æ³•ï¼Ÿ","links":[],"tags":["mysql"],"content":"çŸ­è¿æ¥é£æš´ Â§\n\n\nmax_connections å‚æ•°æ§åˆ¶ä¸€ä¸ª MySQL å®ä¾‹åŒæ—¶å­˜åœ¨çš„è¿æ¥æ•°ä¸Šé™\n\nè¶…è¿‡è¿™ä¸ªæ•°ï¼Œç³»ç»Ÿå°±ä¼šæ‹’ç»æ¥ä¸‹æ¥çš„è¿æ¥è¯·æ±‚ï¼Œå¹¶æŠ¥é”™æç¤ºâ€œToo many connectionsâ€\nåªè¦è¿ç€å°±ä¼šè®¡æ•°\n\n\n\nè§£å†³æ–¹æ¡ˆ\n\n\nä¸€ã€å…ˆå¤„ç†æ‰é‚£äº›å ç€è¿æ¥ä½†æ˜¯ä¸å·¥ä½œçš„çº¿ç¨‹\n\n\nwait_timeout å‚æ•°è®¾ç½®ä¸€ä¸ªçº¿ç¨‹åœ¨å¤šå°‘ç§’åä¼šè¢« MySQL ç›´æ¥æ–­å¼€è¿æ¥\n\n\nåœ¨æœåŠ¡ç«¯æ‰§è¡Œå‘½ä»¤ï¼škill connection + id\n\nç›´åˆ°å®¢æˆ·ç«¯åœ¨å‘èµ·ä¸‹ä¸€ä¸ªè¯·æ±‚çš„æ—¶å€™ï¼Œæ‰ä¼šæ”¶åˆ°è¿™æ ·çš„æŠ¥é”™â€œERROR 2013 (HY000): Lost connection to MySQL server during queryâ€ã€‚\n\n\n\nåœ¨ show processlist çš„ç»“æœé‡Œæ‰¾åˆ°å¯ä»¥è¸¢æ‰çš„è¿æ¥\n\n\nå…ˆæ–­å¼€äº‹åŠ¡å¤–ç©ºé—²çš„è¿æ¥\n\n\nè¿˜ä¸å¤Ÿçš„æƒ…å†µä¸‹å†è€ƒè™‘æ–­å¼€äº‹åŠ¡å†…ç©ºé—²å¤ªä¹…çš„è¿æ¥\n\n\nä¼šå¯¼è‡´äº‹åŠ¡å›æ»š\n\n\næŸ¥çœ‹äº‹åŠ¡å…·ä½“çŠ¶æ€\n\n\næŸ¥ information_schema åº“çš„ innodb_trx è¡¨\n\n\n\n\n\n\näºŒã€å‡å°‘è¿æ¥è¿‡ç¨‹çš„æ¶ˆè€—\n\nä½¿ç”¨ â€”skip-grant-tables å‚æ•°å¯åŠ¨ MySQLï¼Œæ•´ä¸ª MySQL ä¼šè·³è¿‡æ‰€æœ‰çš„æƒé™éªŒè¯é˜¶æ®µï¼ŒåŒ…æ‹¬è¿æ¥è¿‡ç¨‹å’Œè¯­å¥æ‰§è¡Œè¿‡ç¨‹åœ¨å†…\né£é™©æé«˜ï¼ŒMySQL 8.0 ä¼šé»˜è®¤æŠŠ â€”skip-networking å‚æ•°æ‰“å¼€ï¼Œè¡¨ç¤ºåªèƒ½è¢«æœ¬åœ°å®¢æˆ·ç«¯è¿æ¥\n\n\n\n\n\næ…¢æŸ¥è¯¢æ€§èƒ½é—®é¢˜ Â§\n\n\n\n\nç´¢å¼•æ²¡æœ‰è®¾è®¡å¥½\n\n\n\n\nMySQL 5.6 ååˆ›å»ºç´¢å¼•æ”¯æŒ Online DDLï¼Œå¯¹äºé«˜å³°æœŸæ•°æ®åº“ï¼Œæœ€é«˜æ•ˆçš„åšæ³•æ˜¯ç›´æ¥ alter table\n\n\nç†æƒ³æµç¨‹\n\nåœ¨å¤‡åº“ B ä¸Šæ‰§è¡Œ set sql_log_bin=offï¼Œä¹Ÿå°±æ˜¯ä¸å†™ binlogï¼Œç„¶åæ‰§è¡Œ alter table è¯­å¥åŠ ä¸Šç´¢å¼•ï¼›\næ‰§è¡Œä¸»å¤‡åˆ‡æ¢ï¼›\nè¿™æ—¶å€™ä¸»åº“æ˜¯ Bï¼Œå¤‡åº“æ˜¯ Aã€‚åœ¨ A ä¸Šæ‰§è¡Œ set sql_log_bin=offï¼Œç„¶åæ‰§è¡Œ alter table è¯­å¥åŠ ä¸Šç´¢å¼•ã€‚\n\n\n\n\n\nä¼šæœ‰å¤§é‡ binlog æ—¥å¿—ï¼Œæ‰€ä»¥éœ€è¦å…ˆå…³é—­\n\n\nâš ï¸ ï¼ˆå¾…æ•´ç†å‡ºæœ€è¿‘æ–¹æ¡ˆï¼‰ä½†æ˜¯ï¼Œä¼šå¯¼è‡´ binlog ç¼ºå°‘è¿™ä¸ª DDL è¯­å¥ï¼Œéœ€è¦å¦ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼ˆä¸»å¤‡åŒæ­¥åè®®ï¼‰ï¼Œåœ¨åé¢çš„æ–‡ç« æœ‰è¯´æ˜\n\n\nå‡è®¾ï¼Œè¿™ä¸¤ä¸ªäº’ä¸ºä¸»å¤‡å…³ç³»çš„åº“è¿˜æ˜¯å®ä¾‹ X å’Œå®ä¾‹ Yï¼Œä¸”å½“å‰ä¸»åº“æ˜¯ Xï¼Œå¹¶ä¸”éƒ½æ‰“å¼€äº† GTID æ¨¡å¼ã€‚è¿™æ—¶çš„ä¸»å¤‡åˆ‡æ¢æµç¨‹å¯ä»¥å˜æˆä¸‹é¢è¿™æ ·ï¼š\n\n\nåœ¨å®ä¾‹ X ä¸Šæ‰§è¡Œ stop slaveã€‚\n\n\nåœ¨å®ä¾‹ Y ä¸Šæ‰§è¡Œ DDL è¯­å¥ã€‚æ³¨æ„ï¼Œè¿™é‡Œå¹¶ä¸éœ€è¦å…³é—­ binlogã€‚\n\n\næ‰§è¡Œå®Œæˆåï¼ŒæŸ¥å‡ºè¿™ä¸ª DDL è¯­å¥å¯¹åº”çš„ GTIDï¼Œå¹¶è®°ä¸º server_uuid_of_Y:gnoã€‚\n\n\nåˆ°å®ä¾‹ X ä¸Šæ‰§è¡Œä»¥ä¸‹è¯­å¥åºåˆ—ï¼š\n \n\n\nset GTID_NEXT=â€œserver_uuid_of_Y:gnoâ€;\nbegin;commit;\nset gtid_next=automatic;\nstart slave;\n```\n\nè¿™æ ·åšçš„ç›®çš„åœ¨äºï¼Œæ—¢å¯ä»¥è®©å®ä¾‹ Y çš„æ›´æ–°æœ‰ binlog è®°å½•ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ç¡®ä¿ä¸ä¼šåœ¨å®ä¾‹ X ä¸Šæ‰§è¡Œè¿™æ¡æ›´æ–°ã€‚æ¥ä¸‹æ¥ï¼Œæ‰§è¡Œå®Œä¸»å¤‡åˆ‡æ¢ï¼Œç„¶åç…§ç€ä¸Šè¿°æµç¨‹å†æ‰§è¡Œä¸€éå³å¯ã€‚\n\n\n\n\n\næ›´ç¨³å¦¥çš„åšæ³•æ˜¯è€ƒè™‘ç±»ä¼¼ gh-ost çš„æ–¹æ¡ˆ\n\n\n\n\n\n\nSQL è¯­å¥æ²¡å†™å¥½\n\n\n\n5.7 æä¾›äº† query_rewrite åŠŸèƒ½ï¼Œå¯ä»¥æŠŠè¾“å…¥çš„ä¸€ç§è¯­å¥æ”¹å†™æˆå¦å¤–ä¸€ç§æ¨¡å¼\næŸ¥çœ‹æ˜¯å¦é‡å†™æˆåŠŸ\n\n\n\n\n\n\n\n\n\nMySQL é€‰é”™äº†ç´¢å¼•\n\n\n\nåœ¨åŸè¯­å¥åŠ ä¸Š force index\nä½¿ç”¨æŸ¥è¯¢é‡å†™åŠŸèƒ½ç»™è¯­å¥åŠ ä¸Š force index\n\n\n\né€šè¿‡ä»¥ä¸‹æ“ä½œå¯ä»¥é¢„å…ˆå‘ç°é—®é¢˜\n\n\n\nä¸Šçº¿å‰ï¼Œåœ¨æµ‹è¯•ç¯å¢ƒï¼ŒæŠŠæ…¢æŸ¥è¯¢æ—¥å¿—ï¼ˆslow logï¼‰æ‰“å¼€ï¼Œå¹¶ä¸”æŠŠ long_query_time è®¾ç½®æˆ 0ï¼Œç¡®ä¿æ¯ä¸ªè¯­å¥éƒ½ä¼šè¢«è®°å½•å…¥æ…¢æŸ¥è¯¢æ—¥å¿—ï¼›\n\n\n\n\nåœ¨æµ‹è¯•è¡¨é‡Œæ’å…¥æ¨¡æ‹Ÿçº¿ä¸Šçš„æ•°æ®ï¼Œåšä¸€éå›å½’æµ‹è¯•ï¼›\n\n\n\n\nè§‚å¯Ÿæ…¢æŸ¥è¯¢æ—¥å¿—é‡Œæ¯ç±»è¯­å¥çš„è¾“å‡ºï¼Œç‰¹åˆ«ç•™æ„ Rows_examined å­—æ®µæ˜¯å¦ä¸é¢„æœŸä¸€è‡´ã€‚\n\n\n\n\n\nå…¨é‡æµ‹è¯•æ—¶ï¼Œä½¿ç”¨å·¥å…·æ£€æŸ¥æ‰€æœ‰çš„ SQL è¯­å¥çš„è¿”å›ç»“æœ\n\næ¯”å¦‚ pt-query-digest\n\n\n\nQPS çªå¢é—®é¢˜ Â§\n\n\næœ€ç†æƒ³çš„æƒ…å†µæ˜¯è®©ä¸šåŠ¡æŠŠåŠŸèƒ½ä¸‹æ‰\n\n\nå¯¹äºä»æ•°æ®åº“ç«¯å¤„ç†\n\n\n\nä¸€ç§æ˜¯ç”±å…¨æ–°ä¸šåŠ¡çš„ bug å¯¼è‡´çš„ã€‚å‡è®¾ä½ çš„ DB è¿ç»´æ˜¯æ¯”è¾ƒè§„èŒƒçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ç™½åå•æ˜¯ä¸€ä¸ªä¸ªåŠ çš„ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœä½ èƒ½å¤Ÿç¡®å®šä¸šåŠ¡æ–¹ä¼šä¸‹æ‰è¿™ä¸ªåŠŸèƒ½ï¼Œåªæ˜¯æ—¶é—´ä¸Šæ²¡é‚£ä¹ˆå¿«ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä»æ•°æ®åº“ç«¯ç›´æ¥æŠŠç™½åå•å»æ‰ã€‚\n\n\n\n\nå¦‚æœè¿™ä¸ªæ–°åŠŸèƒ½ä½¿ç”¨çš„æ˜¯å•ç‹¬çš„æ•°æ®åº“ç”¨æˆ·ï¼Œå¯ä»¥ç”¨ç®¡ç†å‘˜è´¦å·æŠŠè¿™ä¸ªç”¨æˆ·åˆ æ‰ï¼Œç„¶åæ–­å¼€ç°æœ‰è¿æ¥ã€‚è¿™æ ·ï¼Œè¿™ä¸ªæ–°åŠŸèƒ½çš„è¿æ¥ä¸æˆåŠŸï¼Œç”±å®ƒå¼•å‘çš„ QPS å°±ä¼šå˜æˆ 0ã€‚\n\n\n\n\n\nå¦‚æœè¿™ä¸ªæ–°å¢çš„åŠŸèƒ½è·Ÿä¸»ä½“åŠŸèƒ½æ˜¯éƒ¨ç½²åœ¨ä¸€èµ·çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªèƒ½é€šè¿‡å¤„ç†è¯­å¥æ¥é™åˆ¶ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸Šé¢æåˆ°çš„æŸ¥è¯¢é‡å†™åŠŸèƒ½ï¼ŒæŠŠå‹åŠ›æœ€å¤§çš„ SQL è¯­å¥ç›´æ¥é‡å†™æˆâ€select 1â€è¿”å›ã€‚\n\n\n\na. å¦‚æœåˆ«çš„åŠŸèƒ½é‡Œé¢ä¹Ÿç”¨åˆ°äº†è¿™ä¸ª SQL è¯­å¥æ¨¡æ¿ï¼Œä¼šæœ‰è¯¯ä¼¤ï¼›\nb. å¾ˆå¤šä¸šåŠ¡å¹¶ä¸æ˜¯é è¿™ä¸€ä¸ªè¯­å¥å°±èƒ½å®Œæˆé€»è¾‘çš„ï¼Œæ‰€ä»¥å¦‚æœå•ç‹¬æŠŠè¿™ä¸€ä¸ªè¯­å¥ä»¥ select 1 çš„ç»“æœè¿”å›çš„è¯ï¼Œå¯èƒ½ä¼šå¯¼è‡´åé¢çš„ä¸šåŠ¡é€»è¾‘ä¸€èµ·å¤±è´¥ã€‚\n\n\n\n\n\næ€è€ƒé¢˜ Â§\n\n\nä½ æ˜¯å¦ç¢°åˆ°è¿‡ï¼Œåœ¨ä¸šåŠ¡é«˜å³°æœŸéœ€è¦ä¸´æ—¶æ•‘ç«çš„åœºæ™¯ï¼Ÿä½ åˆæ˜¯æ€ä¹ˆå¤„ç†çš„å‘¢ï¼Ÿ\n\n\nå¦‚æœä¸€ä¸ªæ•°æ®åº“æ˜¯è¢«å®¢æˆ·ç«¯çš„å‹åŠ›æ‰“æ»¡å¯¼è‡´æ— æ³•å“åº”çš„ï¼Œé‡å¯æ•°æ®åº“æ˜¯æ²¡ç”¨çš„ã€‚å› ä¸ºé‡å¯ä¹‹åï¼Œä¸šåŠ¡è¯·æ±‚è¿˜ä¼šå†å‘ã€‚è€Œä¸”ç”±äºæ˜¯é‡å¯ï¼Œbuffer pool è¢«æ¸…ç©ºï¼Œå¯èƒ½ä¼šå¯¼è‡´è¯­å¥æ‰§è¡Œå¾—æ›´æ…¢ã€‚\n\n\næœ‰æ—¶å€™ä¸€ä¸ªè¡¨ä¸Šä¼šå‡ºç°å¤šä¸ªå•å­—æ®µç´¢å¼•ï¼ˆè€Œä¸”å¾€å¾€è¿™æ˜¯å› ä¸ºè¿ç»´å·¥ç¨‹å¸ˆå¯¹ç´¢å¼•åŸç†ä¸å¤Ÿæ¸…æ™°åšçš„è®¾è®¡ï¼‰ï¼Œè¿™æ ·å°±å¯èƒ½å‡ºç°ä¼˜åŒ–å™¨é€‰æ‹©ç´¢å¼•åˆå¹¶ç®—æ³•çš„ç°è±¡ã€‚ä½†å®é™…ä¸Šï¼Œç´¢å¼•åˆå¹¶ç®—æ³•çš„æ•ˆç‡å¹¶ä¸å¥½ã€‚è€Œé€šè¿‡å°†å…¶ä¸­çš„ä¸€ä¸ªç´¢å¼•æ”¹æˆè”åˆç´¢å¼•çš„æ–¹æ³•ï¼Œæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„åº”å¯¹æ–¹æ¡ˆã€‚\n\n\nå®¢æˆ·ç«¯ç¨‹åºçš„è¿æ¥å™¨ï¼Œè¿æ¥å®Œæˆåä¼šåšä¸€äº›è¯¸å¦‚ show columns çš„æ“ä½œï¼Œåœ¨çŸ­è¿æ¥æ¨¡å¼ä¸‹è¿™ä¸ªå½±å“å°±éå¸¸å¤§äº†ã€‚\n\nè¿™ä¸ªæé†’æˆ‘ä»¬ï¼Œåœ¨ review é¡¹ç›®çš„æ—¶å€™ï¼Œä¸æ­¢è¦ review æˆ‘ä»¬è‡ªå·±ä¸šåŠ¡çš„ä»£ç ï¼Œä¹Ÿè¦ review è¿æ¥å™¨çš„è¡Œä¸ºã€‚ä¸€èˆ¬åšæ³•å°±æ˜¯åœ¨æµ‹è¯•ç¯å¢ƒï¼ŒæŠŠ general_log æ‰“å¼€ï¼Œç”¨ä¸šåŠ¡è¡Œä¸ºè§¦å‘è¿æ¥ï¼Œç„¶åé€šè¿‡ general log åˆ†æè¿æ¥å™¨çš„è¡Œä¸ºã€‚\n\n\n\nâš ï¸ å¦‚æœä½ çš„æ•°æ®åº“è¯·æ±‚æ¨¡å¼ç›´æ¥å¯¹åº”äºå®¢æˆ·è¯·æ±‚ï¼Œè¿™å¾€å¾€æ˜¯ä¸€ä¸ªå±é™©çš„è®¾è®¡ã€‚å› ä¸ºå®¢æˆ·è¡Œä¸ºä¸å¯æ§ï¼Œå¯èƒ½çªç„¶å› ä¸ºä½ ä»¬å…¬å¸çš„ä¸€ä¸ªè¿è¥æ¨å¹¿ï¼Œå‹åŠ›æš´å¢ï¼Œè¿™æ ·å¾ˆå®¹æ˜“æŠŠæ•°æ®åº“æ‰“æŒ‚ã€‚åœ¨è®¾è®¡æ¨¡å‹é‡Œé¢è®¾è®¡ä¸€å±‚ï¼Œä¸“é—¨è´Ÿè´£ç®¡ç†è¯·æ±‚å’Œæ•°æ®åº“æœåŠ¡èµ„æºï¼Œå¯¹äºæ¯”è¾ƒé‡è¦å’Œå¤§æµé‡çš„ä¸šåŠ¡ï¼Œæ˜¯ä¸€ä¸ªå¥½çš„è®¾è®¡æ–¹å‘ã€‚\n\n\n\n"},"å­¦ä¹ ç¬”è®°/MySQL-å®æˆ˜-45-è®²/23ï½œMySQL-æ˜¯æ€ä¹ˆä¿è¯æ•°æ®ä¸ä¸¢çš„ï¼Ÿ":{"title":"23ï½œMySQL æ˜¯æ€ä¹ˆä¿è¯æ•°æ®ä¸ä¸¢çš„ï¼Ÿ","links":[],"tags":["mysql"],"content":"åªè¦ redo log å’Œ binlog ä¿è¯æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œå°±èƒ½ç¡®ä¿ MySQL å¼‚å¸¸é‡å¯åï¼Œæ•°æ®å¯ä»¥æ¢å¤ã€‚\nbinlog çš„å†™å…¥æœºåˆ¶ Â§\n\n\nå†™å…¥é€»è¾‘ï¼šäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå…ˆæŠŠæ—¥å¿—å†™åˆ° binlog cacheï¼Œäº‹åŠ¡æäº¤æ—¶å†æŠŠ binlog cache å†™åˆ° binlog æ–‡ä»¶ã€‚\n\nä¸€ä¸ªäº‹åŠ¡çš„ binlog æ˜¯è¦ç¡®ä¿ä¸€æ¬¡æ€§å†™å…¥ï¼Œä¸èƒ½è¢«æ‰“æ–­\nç³»ç»Ÿç»™ binlog cache åˆ†é…äº†ä¸€ç‰‡å†…å­˜ï¼Œæ¯ä¸ªçº¿ç¨‹ä¸€ä¸ªï¼Œ\n\nå‚æ•° binlog_cache_size ç”¨äºæ§åˆ¶å•ä¸ªçº¿ç¨‹å†… binlog cache æ‰€å å†…å­˜çš„å¤§å°ã€‚å¦‚æœè¶…è¿‡äº†è¿™ä¸ªå‚æ•°è§„å®šçš„å¤§å°ï¼Œå°±è¦æš‚å­˜åˆ°ç£ç›˜ã€‚\n\n\näº‹åŠ¡æäº¤æ—¶ï¼Œæ‰§è¡Œå™¨æŠŠ binlog cache é‡Œçš„å®Œæ•´äº‹åŠ¡å†™å…¥åˆ° binlog ä¸­ï¼Œå¹¶æ¸…ç©º binlog cacheã€‚çŠ¶æ€å¦‚å›¾æ‰€ç¤ºã€‚\n\n\n\n\n\nå›¾ä¸­çš„ writeï¼ŒæŒ‡çš„å°±æ˜¯æŒ‡æŠŠæ—¥å¿—å†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿçš„ page cacheï¼Œå¹¶æ²¡æœ‰æŠŠæ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œæ‰€ä»¥é€Ÿåº¦æ¯”è¾ƒå¿«ã€‚\n\n\nå›¾ä¸­çš„ fsyncï¼Œæ‰æ˜¯å°†æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜çš„æ“ä½œã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è®¤ä¸º fsync æ‰å ç£ç›˜çš„ IOPSã€‚\n\n\nwrite å’Œ fsync çš„æ—¶æœºï¼Œæ˜¯ç”±å‚æ•° sync_binlog æ§åˆ¶çš„ï¼š\n\n\n\nsync_binlog=0 çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½åª writeï¼Œä¸ fsyncï¼›\n\n\n\n\nsync_binlog=1 çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½ä¼šæ‰§è¡Œ fsyncï¼›\n\n\n\n\n\nsync_binlog=N(N&gt;1) çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½ writeï¼Œä½†ç´¯ç§¯ N ä¸ªäº‹åŠ¡åæ‰ fsyncã€‚\n\n\n\nå¦‚æœä¸»æœºå‘ç”Ÿå¼‚å¸¸é‡å¯ï¼Œä¼šä¸¢å¤±æœ€è¿‘ N ä¸ªäº‹åŠ¡çš„ binlog æ—¥å¿—ã€‚\n\n\n\n\n\n\n\n\n\nredo log çš„å†™å…¥æœºåˆ¶ Â§\n\n\néƒ½å…ˆå†™åˆ° redo log buffer\n\nä¸ç”¨æ¯æ¬¡ç”Ÿæˆåéƒ½ç›´æ¥æŒä¹…åŒ–åˆ°ç£ç›˜\n\nå¦‚æœäº‹åŠ¡æ‰§è¡ŒæœŸé—´ MySQL å¼‚å¸¸é‡å¯ï¼Œè¿™éƒ¨åˆ†æ—¥å¿—ä¸¢äº†ï¼Œç”±äºäº‹åŠ¡å¹¶æ²¡æœ‰æäº¤ï¼Œæ‰€ä»¥æ²¡æŸå¤±\n\n\näº‹åŠ¡æ²¡æäº¤ï¼Œè¿™æ—¶æ—¥å¿—ä¹Ÿæœ‰å¯èƒ½è¢«æŒä¹…åŒ–åˆ°ç£ç›˜\n\n\n\nredo log çš„å­˜å‚¨çŠ¶æ€\n\n\n\n\n\nä¸ºäº†æ§åˆ¶ redo log çš„å†™å…¥ç­–ç•¥ï¼ŒInnoDB æä¾›äº† innodb_flush_log_at_trx_commit å‚æ•°\n\n\n\nè®¾ç½®ä¸º 0 çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½åªæ˜¯æŠŠ redo log ç•™åœ¨ redo log buffer ä¸­ ;\n\n\n\n\nè®¾ç½®ä¸º 1 çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½å°† redo log ç›´æ¥æŒä¹…åŒ–åˆ°ç£ç›˜ï¼›\n\n\n\n\nè®¾ç½®ä¸º 2 çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½åªæ˜¯æŠŠ redo log å†™åˆ° page cacheã€‚\n\n\n\n\n\nInnoDB æœ‰ä¸€ä¸ªåå°çº¿ç¨‹ï¼Œæ¯éš” 1 ç§’ï¼Œå°±ä¼šæŠŠ redo log buffer ä¸­çš„æ—¥å¿—ï¼Œè°ƒç”¨ write å†™åˆ°æ–‡ä»¶ç³»ç»Ÿçš„ page cacheï¼Œç„¶åè°ƒç”¨ fsync æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚\n\næ²¡æœ‰æäº¤çš„äº‹åŠ¡çš„ redo log ä¹Ÿä¼š\n\n\n\nå¦å¤–ä¸¤ä¸ªä¼šè®©æ²¡æœ‰æäº¤çš„äº‹åŠ¡çš„ redo log å†™å…¥åˆ°ç£ç›˜çš„åœºæ™¯\n\n\n\nredo log buffer å ç”¨çš„ç©ºé—´å³å°†è¾¾åˆ° innodb_log_buffer_size ä¸€åŠçš„æ—¶å€™ï¼Œåå°çº¿ç¨‹ä¼šä¸»åŠ¨å†™ç›˜ã€‚\n\n\næ³¨æ„ï¼Œç”±äºè¿™ä¸ªäº‹åŠ¡å¹¶æ²¡æœ‰æäº¤ï¼Œæ‰€ä»¥è¿™ä¸ªå†™ç›˜åŠ¨ä½œåªæ˜¯ writeï¼Œè€Œæ²¡æœ‰è°ƒç”¨ fsyncï¼Œä¹Ÿå°±æ˜¯åªç•™åœ¨äº†æ–‡ä»¶ç³»ç»Ÿçš„ page cacheã€‚\n\n\n\n\nå¹¶è¡Œçš„äº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œé¡ºå¸¦å°†è¿™ä¸ªäº‹åŠ¡çš„ redo log buffer æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚\n\n\nå‡è®¾ä¸€ä¸ªäº‹åŠ¡ A æ‰§è¡Œåˆ°ä¸€åŠï¼Œå·²ç»å†™äº†ä¸€äº› redo log åˆ° buffer ä¸­ï¼Œè¿™æ—¶å€™æœ‰å¦å¤–ä¸€ä¸ªçº¿ç¨‹çš„äº‹åŠ¡ B æäº¤ï¼Œå¦‚æœ innodb_flush_log_at_trx_commit è®¾ç½®çš„æ˜¯ 1ï¼Œé‚£ä¹ˆæŒ‰ç…§è¿™ä¸ªå‚æ•°çš„é€»è¾‘ï¼Œäº‹åŠ¡ B è¦æŠŠ redo log buffer é‡Œçš„æ—¥å¿—å…¨éƒ¨æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚è¿™æ—¶å€™ï¼Œå°±ä¼šå¸¦ä¸Šäº‹åŠ¡ A åœ¨ redo log buffer é‡Œçš„æ—¥å¿—ä¸€èµ·æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚\n\n\n\n\n\né€šå¸¸æˆ‘ä»¬è¯´ MySQL çš„â€œåŒ 1â€é…ç½®ï¼ŒæŒ‡çš„å°±æ˜¯ sync_binlog å’Œ innodb_flush_log_at_trx_commit éƒ½è®¾ç½®æˆ 1ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªäº‹åŠ¡å®Œæ•´æäº¤å‰ï¼Œéœ€è¦ç­‰å¾…ä¸¤æ¬¡åˆ·ç›˜ï¼Œä¸€æ¬¡æ˜¯ redo logï¼ˆprepare é˜¶æ®µï¼‰ï¼Œä¸€æ¬¡æ˜¯ binlogã€‚\n\n\nç»„æäº¤æœºåˆ¶ Â§\n\n\næ—¥å¿—é€»è¾‘åºåˆ—å·ï¼ˆlog sequence numberï¼ŒLSNï¼‰\n\nå•è°ƒé€’å¢ï¼Œç”¨æ¥å¯¹åº” redo log çš„ä¸€ä¸ªä¸ªå†™å…¥ç‚¹\næ¯æ¬¡å†™å…¥é•¿åº¦ä¸º length çš„ redo logï¼Œ LSN çš„å€¼å°±ä¼šåŠ ä¸Š lengthã€‚\nLSN ä¹Ÿä¼šå†™åˆ° InnoDB çš„æ•°æ®é¡µä¸­ï¼Œæ¥ç¡®ä¿æ•°æ®é¡µä¸ä¼šè¢«å¤šæ¬¡æ‰§è¡Œé‡å¤çš„ redo log\n\n\n\nä¸€æ¬¡ç»„æäº¤é‡Œé¢ï¼Œç»„å‘˜è¶Šå¤šï¼ŒèŠ‚çº¦ç£ç›˜ IOPS çš„æ•ˆæœè¶Šå¥½ã€‚ä½†å¦‚æœåªæœ‰å•çº¿ç¨‹å‹æµ‹ï¼Œé‚£å°±åªèƒ½è€è€å®å®åœ°ä¸€ä¸ªäº‹åŠ¡å¯¹åº”ä¸€æ¬¡æŒä¹…åŒ–æ“ä½œäº†ã€‚\n\n\n\n\n\ntrx1 å…ˆåˆ°è¾¾ï¼Œä¼šè¢«é€‰ä¸º leader\n\n\nå¼€å§‹å†™ç›˜ï¼Œå› ä¸ºç»„é‡Œæœ‰äº†ä¸‰ä¸ªäº‹åŠ¡ï¼Œæ‰€ä»¥ LSN å˜æˆäº†æœ€å¤§å€¼ 160\n\n\nç­‰åˆ° trx1 è¿”å›æ—¶ï¼Œæ‰€æœ‰ LSN å°äºç­‰äº 160 çš„ redo log éƒ½å·²ç»è¢«æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œæ‰€ä»¥ trx2 å’Œ trx3 å¯ä»¥ç›´æ¥è¿”å›\n\n\n\n\nåœ¨å¹¶å‘æ›´æ–°åœºæ™¯ä¸‹ï¼Œç¬¬ä¸€ä¸ªäº‹åŠ¡å†™å®Œ redo log buffer ä»¥åï¼Œæ¥ä¸‹æ¥è¿™ä¸ª fsync è¶Šæ™šè°ƒç”¨ï¼Œç»„å‘˜å¯èƒ½è¶Šå¤šï¼ŒèŠ‚çº¦ IOPS çš„æ•ˆæœå°±è¶Šå¥½ã€‚\n\n\nä¸ºäº†è®©ä¸€æ¬¡ fsync å¸¦çš„ç»„å‘˜æ›´å¤šï¼ŒMySQL æœ‰ä¸€ä¸ªå¾ˆæœ‰è¶£çš„ä¼˜åŒ–ï¼šæ‹–æ—¶é—´ã€‚\n\n\nä¸¤é˜¶æ®µæäº¤\n\n\n\n\n\nä¸¤é˜¶æ®µæäº¤ç»†åŒ–\n\n\n\n\n\nå†™ binlog æ˜¯åˆ†æˆä¸¤æ­¥çš„\n\n\n\nå…ˆæŠŠ binlog ä» binlog cache ä¸­å†™åˆ°ç£ç›˜ä¸Šçš„ binlog æ–‡ä»¶ï¼›\n\n\n\n\nè°ƒç”¨ fsync æŒä¹…åŒ–ã€‚\n\n\n\n\n\nMySQL ä¸ºäº†è®©ç»„æäº¤çš„æ•ˆæœæ›´å¥½ï¼ŒæŠŠ redo log åš fsync çš„æ—¶é—´æ‹–åˆ°äº†æ­¥éª¤ 1 ä¹‹å\n\n\n3 æ‰§è¡Œå¾ˆå¿«ï¼Œæ‰€ä»¥ binlog çš„ç»„æäº¤æ•ˆæœé€šå¸¸ä¸å¦‚ redo log çš„æ•ˆæœå¥½\n\n\n\n\næå‡ binlog ç»„æäº¤çš„æ•ˆæœ\n\n\n\nbinlog_group_commit_sync_delay å‚æ•°ï¼Œè¡¨ç¤ºå»¶è¿Ÿå¤šå°‘å¾®ç§’åæ‰è°ƒç”¨ fsync;\n\n\n\n\nbinlog_group_commit_sync_no_delay_count å‚æ•°ï¼Œè¡¨ç¤ºç´¯ç§¯å¤šå°‘æ¬¡ä»¥åæ‰è°ƒç”¨ fsyncã€‚\n\n\nä¸¤ä¸ªæ¡ä»¶æ˜¯ æˆ– çš„å…³ç³»\n\n\n\nWAL æœºåˆ¶æ˜¯å‡å°‘ç£ç›˜å†™ï¼Œä½†æ¯æ¬¡æäº¤äº‹åŠ¡éƒ½è¦å†™ redo log å’Œ binlogï¼Œç£ç›˜è¯»å†™æ²¡å‡å°‘ï¼Ÿ Â§\n\nredo log å’Œ binlog éƒ½æ˜¯é¡ºåºå†™ï¼Œç£ç›˜çš„é¡ºåºå†™æ¯”éšæœºå†™é€Ÿåº¦è¦å¿«ï¼›\nç»„æäº¤æœºåˆ¶å¯ä»¥å¤§å¹…åº¦é™ä½ç£ç›˜çš„ IOPS æ¶ˆè€—ã€‚\n\nMySQL å‡ºç° IO æ€§èƒ½ç“¶é¢ˆçš„æå‡æ€§èƒ½æ–¹æ³• Â§\n\n\n\nè®¾ç½® binlog_group_commit_sync_delay å’Œ binlog_group_commit_sync_no_delay_count å‚æ•°ï¼Œå‡å°‘ binlog çš„å†™ç›˜æ¬¡æ•°ã€‚\n\n\nè¿™ä¸ªæ–¹æ³•åŸºäºâ€œé¢å¤–çš„æ•…æ„ç­‰å¾…â€æ¥å®ç°ï¼Œå› æ­¤å¯èƒ½ä¼šå¢åŠ è¯­å¥çš„å“åº”æ—¶é—´ï¼Œä½†æ²¡æœ‰ä¸¢å¤±æ•°æ®çš„é£é™©ã€‚\n\n\n\n\nå°† sync_binlog è®¾ç½®ä¸ºå¤§äº 1 çš„å€¼ï¼ˆæ¯”è¾ƒå¸¸è§æ˜¯ 100~1000ï¼‰ã€‚\n\n\nâš ï¸ è¿™æ ·åšçš„é£é™©æ˜¯ï¼Œä¸»æœºæ‰ç”µæ—¶ä¼šä¸¢ binlog æ—¥å¿—ã€‚\n\n\n\n\nå°† innodb_flush_log_at_trx_commit è®¾ç½®ä¸º 2ã€‚è¿™æ ·åšçš„é£é™©æ˜¯ï¼Œä¸»æœºæ‰ç”µçš„æ—¶å€™ä¼šä¸¢æ•°æ®ã€‚\n\n\nä¸å»ºè®®è®¾ç½®ä¸º 0ï¼ˆåªä¿å­˜åœ¨å†…å­˜ä¸­ï¼‰\n0 è·Ÿ 2 çš„æ€§èƒ½å·®ä¸å¤šï¼Œä½† 2 çš„é£é™©æ›´å°\n\n\n\næ•°æ®åº“çš„ crash-safe çš„ä½œç”¨ Â§\n\n\n\nå¦‚æœå®¢æˆ·ç«¯æ”¶åˆ°äº‹åŠ¡æˆåŠŸçš„æ¶ˆæ¯ï¼Œäº‹åŠ¡å°±ä¸€å®šæŒä¹…åŒ–äº†ï¼›\n\n\nåŒ 1 é…ç½®æ—¶\n\n\n\n\nå¦‚æœå®¢æˆ·ç«¯æ”¶åˆ°äº‹åŠ¡å¤±è´¥ï¼ˆæ¯”å¦‚ä¸»é”®å†²çªã€å›æ»šç­‰ï¼‰çš„æ¶ˆæ¯ï¼Œäº‹åŠ¡å°±ä¸€å®šå¤±è´¥äº†ï¼›\n\n\n\n\nå¦‚æœå®¢æˆ·ç«¯æ”¶åˆ°â€œæ‰§è¡Œå¼‚å¸¸â€çš„æ¶ˆæ¯ï¼Œåº”ç”¨éœ€è¦é‡è¿åé€šè¿‡æŸ¥è¯¢å½“å‰çŠ¶æ€æ¥ç»§ç»­åç»­çš„é€»è¾‘ã€‚æ­¤æ—¶æ•°æ®åº“åªéœ€è¦ä¿è¯å†…éƒ¨ï¼ˆæ•°æ®å’Œæ—¥å¿—ä¹‹é—´ï¼Œä¸»åº“å’Œå¤‡åº“ä¹‹é—´ï¼‰ä¸€è‡´å°±å¯ä»¥äº†ã€‚\n\n\n\næ€è€ƒé¢˜ Â§\n\n\nä½ çš„ç”Ÿäº§åº“è®¾ç½®çš„æ˜¯ã€ŒåŒ 1ã€å—ï¼Ÿ å¦‚æœå¹³æ—¶æ˜¯çš„è¯ï¼Œä½ æœ‰åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹æ”¹æˆè¿‡â€œéåŒ 1â€å—ï¼Ÿä½ çš„è¿™ä¸ªæ“ä½œåˆæ˜¯åŸºäºä»€ä¹ˆå†³å®šçš„ï¼Ÿ\n\n\n\nä¸šåŠ¡é«˜å³°æœŸ\n\n\n\n\nå¤‡åº“å»¶è¿Ÿ\n\n\n\n\nç”¨å¤‡ä»½æ¢å¤ä¸»åº“çš„å‰¯æœ¬ï¼Œåº”ç”¨ binlog çš„è¿‡ç¨‹\n\n\n\n\næ‰¹é‡å¯¼å…¥æ•°æ®çš„æ—¶å€™\n\n\n\n\n\næˆ‘ä»¬éƒ½çŸ¥é“è¿™äº›è®¾ç½®å¯èƒ½æœ‰æŸï¼Œå¦‚æœå‘ç”Ÿäº†å¼‚å¸¸ï¼Œä½ çš„æ­¢æŸæ–¹æ¡ˆæ˜¯ä»€ä¹ˆï¼Ÿ\n\n\nä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒæŠŠç”Ÿäº§åº“æ”¹æˆâ€œéåŒ 1 â€é…ç½®ï¼Œæ˜¯è®¾ç½®\n\ninnodb_flush_logs_at_trx_commit=2\nsync_binlog=1000\n\n\n\nè¯„è®ºåŒº Â§\n\n\nçœ‹åˆ°çš„ã€Œbinlog çš„è®°å½•ã€æ˜¯ä» page cache è¯»ï¼Œpage cache åœ¨æ“ä½œç³»ç»Ÿæ–‡ä»¶ç³»ç»Ÿä¸Š\n\nls çš„ç»“æœä¹Ÿæ˜¯\n\n\n\nä¸ºä»€ä¹ˆ binlog cache æ˜¯æ¯ä¸ªçº¿ç¨‹è‡ªå·±ç»´æŠ¤çš„ï¼Œè€Œ redo log buffer æ˜¯å…¨å±€å…±ç”¨çš„ï¼Ÿ\n\nbinlog å­˜å‚¨æ˜¯ä»¥ statement æˆ–è€… row æ ¼å¼å­˜å‚¨çš„ï¼Œè€Œ redo log æ˜¯ä»¥ page é¡µæ ¼å¼å­˜å‚¨çš„ã€‚page æ ¼å¼ï¼Œå¤©ç”Ÿå°±æ˜¯å…±æœ‰çš„ï¼Œè€Œ row æ ¼å¼ï¼Œåªè·Ÿå½“å‰äº‹åŠ¡ç›¸å…³\nåœ¨è¿™é‡Œè”ç³»åˆ° binlog çš„æ ¼å¼ï¼Œstatement è®°å½•çš„æ˜¯æ›´æ–°çš„ SQLï¼Œä½†æ˜¯è¦å†™ä¸Šä¸‹æ–‡ï¼Œå› æ­¤ä¸èƒ½ä¸­æ–­ï¼Œä¸ç„¶åŒæ­¥åˆ°ä»åº“åä»åº“æ— æ³•æ¢å¤ä¸€æ ·çš„æ•°æ®å†…å®¹\n\n\n\nå¦‚æœ sync_binlog = Nï½œbinlog_group_commit_sync_no_delay_count = Mï½œbinlog_group_commit_sync_delay = å¾ˆå¤§å€¼ï¼Œè¿™ç§æƒ…å†µ fsync ä»€ä¹ˆæ—¶å€™å‘ç”Ÿ\n\nsync_delay å’Œ sync_no_delay_count çš„é€»è¾‘å…ˆèµ°ï¼Œå› æ­¤è¯¥ç­‰è¿˜æ˜¯ä¼šç­‰ã€‚ç­‰åˆ°æ»¡è¶³äº†è¿™ä¸¤ä¸ªæ¡ä»¶ä¹‹ä¸€ï¼Œå°±è¿›å…¥ sync_binlog é˜¶æ®µã€‚è¿™æ—¶å€™å¦‚æœåˆ¤æ–­ sync_binlog=0ï¼Œå°±ç›´æ¥è·³è¿‡ï¼Œè¿˜æ˜¯ä¸è°ƒ fsyncã€‚\n\n\n"},"å­¦ä¹ ç¬”è®°/MySQL-å®æˆ˜-45-è®²/24ï½œMySQL-æ˜¯æ€ä¹ˆä¿è¯ä¸»å¤‡ä¸€è‡´çš„ï¼Ÿ":{"title":"24ï½œMySQL æ˜¯æ€ä¹ˆä¿è¯ä¸»å¤‡ä¸€è‡´çš„ï¼Ÿ","links":[],"tags":["mysql"],"content":"æœ¬ç« çš„å†…å®¹æ˜¯æ‰€æœ‰ MySQL é«˜å¯ç”¨æ–¹æ¡ˆçš„åŸºç¡€\nå°†å¤‡åº“è®¾ç½®ä¸ºåªè¯»æ¨¡å¼ï¼ˆreadonlyï¼‰ Â§\n\né˜²æ­¢è¯¯æ“ä½œ\né˜²æ­¢åˆ‡æ¢é€»è¾‘æœ‰ bugï¼Œæ¯”å¦‚åˆ‡æ¢è¿‡ç¨‹ä¸­å‡ºç°åŒå†™é€ æˆä¸»å¤‡ä¸ä¸€è‡´\nå¯ä»¥ç”¨ readonly çŠ¶æ€åˆ¤æ–­èŠ‚ç‚¹çš„è§’è‰²\nreadonly è®¾ç½®å¯¹è¶…çº§æƒé™ç”¨æˆ·ï¼ˆsuperï¼‰æ— æ•ˆï¼Œç”¨äºåŒæ­¥æ›´æ–°çš„çº¿ç¨‹æ‹¥æœ‰è¶…çº§æƒé™\n\nä¸€ä¸ª update è¯­å¥åœ¨èŠ‚ç‚¹ A æ‰§è¡Œï¼Œç„¶ååŒæ­¥åˆ°èŠ‚ç‚¹ B çš„å®Œæ•´æµç¨‹å›¾ã€‚ï¼ˆä¸»å¤‡åŒæ­¥å†…éƒ¨æµç¨‹ï¼‰ Â§\n\n\n\n\n\nä¸»å¤‡å…³ç³»ç”±å¤‡åº“æŒ‡å®š\n\n\næ­å»ºå®Œæˆåç”±ä¸»åº“å†³å®šâ€œè¦å‘æ•°æ®ç»™å¤‡åº“â€\n\n\nä¸€ä¸ªäº‹åŠ¡æ—¥å¿—åŒæ­¥çš„å®Œæ•´è¿‡ç¨‹ï¼ˆåŸºäºé•¿è¿æ¥ï¼‰ Â§\n\n\n\nåœ¨å¤‡åº“ B é€šè¿‡ change master å‘½ä»¤è®¾ç½®ä¸»åº“ A çš„ IPã€ç«¯å£ã€ç”¨æˆ·åã€å¯†ç ï¼Œä»¥åŠä»å“ªä¸ªä½ç½®å¼€å§‹è¯·æ±‚ binlogï¼Œè¿™ä¸ªä½ç½®åŒ…å«æ–‡ä»¶åå’Œæ—¥å¿—åç§»é‡\n\n\n\n\nåœ¨å¤‡åº“ B ä¸Šæ‰§è¡Œ start slave å‘½ä»¤ï¼Œè¿™æ—¶å€™å¤‡åº“ä¼šå¯åŠ¨ä¸¤ä¸ªçº¿ç¨‹ï¼Œå°±æ˜¯å›¾ä¸­çš„ io_thread å’Œ sql_threadã€‚å…¶ä¸­ io_thread è´Ÿè´£ä¸ä¸»åº“å»ºç«‹è¿æ¥ã€‚\n\n\n\n\nä¸»åº“ A æ ¡éªŒå®Œç”¨æˆ·åã€å¯†ç åï¼Œå¼€å§‹æŒ‰ç…§å¤‡åº“ B ä¼ è¿‡æ¥çš„ä½ç½®ï¼Œä»æœ¬åœ°è¯»å– binlogï¼Œå‘ç»™ Bã€‚\n\n\n\n\nå¤‡åº“ B æ‹¿åˆ° binlog åï¼Œå†™åˆ°æœ¬åœ°æ–‡ä»¶ï¼Œç§°ä¸ºä¸­è½¬æ—¥å¿—ï¼ˆrelay logï¼‰ã€‚\n\n\n\n\nsql_thread è¯»å–ä¸­è½¬æ—¥å¿—ï¼Œè§£æå‡ºæ—¥å¿—é‡Œçš„å‘½ä»¤ï¼Œå¹¶æ‰§è¡Œã€‚\n\n\nåæ¥ç”±äºå¤šçº¿ç¨‹å¤åˆ¶æ–¹æ¡ˆçš„å¼•å…¥ï¼Œsql_thread æ¼”åŒ–æˆä¸ºäº†å¤šä¸ªçº¿ç¨‹è·Ÿæœ¬ç« è®²çš„åŸç†æ²¡æœ‰ç›´æ¥å…³ç³»\n\n\n\nbinlog çš„ä¸‰ç§æ ¼å¼å¯¹æ¯”ï¼ˆå»ºè®®è®¾ç½®ä¸º rowï¼‰ Â§\n\nstatement\n\nè®°å½• SQL åŸæ–‡\n\nunsafe çš„ï¼Œæ¯”å¦‚ä¸€ä¸ª delete è¯­å¥ï¼Œåœ¨ä¸»åº“è·Ÿåœ¨å¤‡åº“çš„æ‰§è¡Œç»“æœå¯èƒ½ä¸ä¸€æ ·\n\næœ‰äº›è¯­å¥æ‰§è¡Œä¾èµ–ä¸Šä¸‹æ–‡ï¼Œæ¯”å¦‚ä¼šæœ‰ SET TIMESTAMP=æ—¶é—´æˆ³ ç”¨æ¥è®¾ç½®æ¥ä¸‹æ¥çš„ now() å‡½æ•°çš„è¿”å›æ—¶é—´\n\n\n\n\næ¯”å¦‚å¸¦äº† limitï¼Œåœ¨ä¸»å¤‡ä¸Šç”¨åˆ°äº†ä¸åŒçš„ç´¢å¼•\nâš ï¸ å¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´\n\n\nraw\n\nè®°å½•å˜æ›´å‰å’Œå˜æ›´åçš„æ•°æ®æˆ–è¢«åˆ çš„æ•°æ®ï¼Œæ˜¯å®‰å…¨çš„\nå¾ˆå ç©ºé—´\n\n\nmixed = statement + row\n\nMySQL è‡ªå·±åˆ¤æ–­æ‰§è¡Œçš„è¯­å¥åº”è¯¥ä½¿ç”¨å“ªç§æ ¼å¼çš„æ—¥å¿—\nç”¨å¾—ä¸å¤š\n\n\n\næŸ¥çœ‹ binlog Â§\n\né¦–å…ˆé€šè¿‡ show variables like â€˜log_%â€™ æŸ¥çœ‹ log_bin å‚æ•°æ˜¯å¦ä¸º ON\n\nmysql&gt; show binary logs; è·å–binlogæ–‡ä»¶åˆ—è¡¨\nmysql&gt; show binlog events; åªæŸ¥çœ‹ç¬¬ä¸€ä¸ªbinlogæ–‡ä»¶çš„å†…å®¹\nmysql&gt; show binlog events in â€˜mysql-bin.000001â€™; # æŸ¥çœ‹æŒ‡å®š binlog æ–‡ä»¶çš„å†…å®¹\nmysql&gt; show master statusï¼›æŸ¥çœ‹å½“å‰æ­£åœ¨å†™å…¥çš„ binlog æ–‡ä»¶\n\n\néœ€è¦å€ŸåŠ© mysqlbinlog å·¥å…·ï¼Œç”¨ä¸‹é¢è¿™ä¸ªå‘½ä»¤è§£æå’ŒæŸ¥çœ‹ binlog ä¸­çš„å†…å®¹\n\næ¯”å¦‚äº‹åŠ¡çš„ binlog æ˜¯ä» 8900 è¿™ä¸ªä½ç½®å¼€å§‹ï¼Œå¯ä»¥ç”¨ start-position å‚æ•°æ¥æŒ‡å®šä»è¿™ä¸ªä½ç½®çš„æ—¥å¿—å¼€å§‹è§£æ\n\nmysqlbinlog -vv data/master.000001 --start-position=8900;\n\n\n\n\n\nè¶Šæ¥è¶Šå¤šçš„åœºæ™¯è¦æ±‚æŠŠæ ¼å¼è®¾ç½®ä¸º rowï¼Œæœ€ç›´æ¥çš„å¥½å¤„æ˜¯å¯ä»¥æ¢å¤æ•°æ® Â§\n\ndelete è¯­å¥\n\nè®°å½•è¢«åˆ çš„æ•°æ®\n\n\ninsert è¯­å¥\n\næŠŠè¯­å¥è½¬æˆ delete æ‰§è¡Œå³å¯\n\n\nupdate è¯­å¥\n\nbinlog è®°å½•ä¿®æ”¹å‰å’Œä¿®æ”¹åçš„æ•´è¡Œæ•°æ®\nå¯¹è°ƒä¸¤è¡Œä¿¡æ¯å†åˆ°æ•°æ®åº“é‡Œé¢æ‰§è¡Œå³å¯\n\n\nMariaDB çš„ Flashback å·¥å…·åŸºäºä¸Šé¢çš„åŸç†å›æ»šæ•°æ®\n\nå‰æï¼š\n\nbinlog_format=row\nbinlog_row_image=FULL\n\n\n\n\næ ‡å‡†åšæ³•\n\n\n\nç”¨ mysqlbinlog å·¥å…·è§£æå‡ºæ¥\n\n\n\n\næŠŠè§£æç»“æœæ•´ä¸ªå‘ç»™ MySQL æ‰§è¡Œ\n\n\nç±»ä¼¼äºï¼šå°† master.000001 æ–‡ä»¶ä»ç¬¬ 2738 å­—èŠ‚åˆ°ç¬¬ 2973 å­—èŠ‚ä¸­é—´è¿™æ®µå†…å®¹è§£æå‡ºæ¥ï¼Œæ”¾åˆ° MySQL å»æ‰§è¡Œã€‚\n\nmysqlbinlog master.000001 â€”start-position=2738 â€”stop-position=2973 | mysql -h127.0.0.1 -P13000 -uuser -ppwd;\n\n\n\n\n\nå¾ªç¯å¤åˆ¶é—®é¢˜ Â§\n\n\nå®é™…ç”Ÿäº§ä¸Šä½¿ç”¨æ¯”è¾ƒå¤šçš„æ˜¯åŒ M ç»“æ„ï¼ˆäº’ä¸ºä¸»å¤‡ï¼‰\n\nç›¸æ¯”äºä¸»ä»ï¼Œåœ¨åˆ‡æ¢æ—¶ä¸ç”¨ä¿®æ”¹ä¸»å¤‡å…³ç³»\n\n\n\nä¸šåŠ¡é€»è¾‘åœ¨èŠ‚ç‚¹ A ä¸Šæ›´æ–°äº†ä¸€æ¡è¯­å¥ï¼Œç„¶åå†æŠŠç”Ÿæˆçš„ binlog å‘ç»™èŠ‚ç‚¹ Bï¼ŒèŠ‚ç‚¹ B æ‰§è¡Œå®Œè¿™æ¡æ›´æ–°è¯­å¥åä¹Ÿä¼šç”Ÿæˆ binlogã€‚ï¼ˆæˆ‘å»ºè®®ä½ æŠŠå‚æ•° log_slave_updates è®¾ç½®ä¸º onï¼Œè¡¨ç¤ºå¤‡åº“æ‰§è¡Œ relay log åç”Ÿæˆ binlogï¼‰ã€‚\n\n\nè§£å†³ï¼ˆåœ¨æŸäº›åœºæ™¯ä¸‹è¿˜æ˜¯æœ‰å¯èƒ½å‡ºç°æ­»å¾ªç¯ï¼Œçœ‹ä¸‹ä¸€ç« ï¼‰\n\nè§„å®šä¸¤ä¸ªåº“çš„ server id å¿…é¡»ä¸åŒ\nä¸€ä¸ªå¤‡åº“æ¥åˆ° binlog å¹¶é‡æ”¾æ—¶ï¼Œç”Ÿæˆä¸åŸ binlog çš„ server id ç›¸åŒçš„æ–°çš„ binlog\næ¯ä¸ªåº“åœ¨æ”¶åˆ°ä»è‡ªå·±çš„ä¸»åº“å‘è¿‡æ¥çš„æ—¥å¿—åï¼Œå…ˆåˆ¤æ–­ server id\n\n\n\næ€è€ƒé¢˜ Â§\n\n\nä»€ä¹ˆåœºæ™¯ä¸‹ä¼šå‡ºç°å¾ªç¯å¤åˆ¶ï¼Ÿ\n\n\nä¸€ç§åœºæ™¯æ˜¯ï¼Œåœ¨ä¸€ä¸ªä¸»åº“æ›´æ–°äº‹åŠ¡åï¼Œç”¨å‘½ä»¤ set global server_id=x ä¿®æ”¹äº† server_idã€‚ç­‰æ—¥å¿—å†ä¼ å›æ¥çš„æ—¶å€™ï¼Œå‘ç° server_id è·Ÿè‡ªå·±çš„ server_id ä¸åŒï¼Œå°±åªèƒ½æ‰§è¡Œã€‚\n\n\nä¸‰ä¸ª M\n\nå¯ä»¥é€šè¿‡æš‚æ—¶ä¿®æ”¹ server id è§£å†³\nä½†å‡ºç°å¾ªç¯å¤åˆ¶æ—¶åº”è¯¥è€ƒè™‘æ˜¯ä¸æ˜¯æ•°æ®æœ¬èº«å·²ç»å¤±å»å¯é æ€§\n\n\n\nè¯„è®ºåŒº Â§\n\n\nbinlog å‡†å¤‡å†™åˆ° binlog file æ—¶éƒ½ä¼šå…ˆåˆ¤æ–­å†™å…¥åæ˜¯å¦è¶…è¿‡è®¾ç½®çš„ max_binlog_size å€¼å¦‚æœè¶…è¿‡ï¼Œrotate è‡ªåŠ¨ç”Ÿæˆä¸‹ä¸€ä¸ª binlog file è®°å½•è¿™æ¡ binlog ä¿¡æ¯\n\nä¸€ä¸ªäº‹åŠ¡çš„ binlog æ—¥å¿—ä¸ä¼šè¢«æ‹†åˆ°ä¸¤ä¸ª binlog æ–‡ä»¶ï¼Œæ‰€ä»¥ä¼šç­‰åˆ°æ—¥å¿—å†™å®Œæ‰ rotateï¼Œæ‰€ä»¥å¯ä»¥çœ‹åˆ°è¶…è¿‡é…ç½®å¤§å°ä¸Šé™çš„ binlog æ–‡ä»¶\n\n\n\nå¦‚æœä¸€å¼ è¡¨å¹¶æ²¡æœ‰ä¸»é”®ï¼Œæ’å…¥çš„ä¸€æ¡æ•°æ®å’Œè¿™å¼ è¡¨åŸæœ‰çš„ä¸€æ¡æ•°æ®æ‰€æœ‰å­—æ®µéƒ½æ˜¯ä¸€æ ·çš„ï¼Œç„¶åå¯¹æ’å…¥çš„è¿™æ¡æ•°æ®åšæ¢å¤ï¼Œä¼šä¸ä¼šæŠŠåŸæœ‰çš„é‚£æ¡æ•°æ®åˆ é™¤ï¼Ÿ\n\nä¼šåˆ é™¤ä¸€æ¡ï¼Œæœ‰å¯èƒ½åˆ é™¤åˆ°ä¹‹å‰çš„é‚£æ¡\nå› ä¸ºè¡¨æ²¡æœ‰ä¸»é”®çš„æ—¶å€™ï¼Œbinlog é‡Œé¢å°±ä¸ä¼šè®°å½•ä¸»é”®å­—æ®µï¼Œå³ï¼šbinlog ä¸ä¼šè®°å½• InnoDB éšè—çš„ä¸»é”® id å­—æ®µ\n\n\n\nå¦‚æœâ€œredo æ²¡æœ‰åŠæ—¶åˆ·ç›˜ï¼Œbinlog åˆ·ç›˜äº†â€ä¹‹åç¬é—´æ•°æ®åº“æ‰€åœ¨ä¸»æœºæ‰ç”µï¼Œä¸»æœºé‡å¯ï¼ŒMySQL é‡å¯ä»¥åï¼Œè¿™ä¸ªäº‹åŠ¡ä¼šä¸¢å¤±ï¼›ä¼šå¼•èµ·æ—¥å¿—å’Œæ•°æ®ä¸ä¸€è‡´ï¼Œè¿™ä¹Ÿæ˜¯è¦é»˜è®¤è®¾ç½®åŒ 1 çš„åŸå› ä¹‹ä¸€\n\n\nä¸»åº“ ssdï¼Œå¤‡åº“æœºæ¢°ç¡¬ç›˜ï¼Œæ­¤æ—¶å¯ä»¥è¯•è¯•å¤‡åº“éåŒ 1\n\n\nè”è¡¨ä¸€èˆ¬åœ¨ä¸šåŠ¡å±‚é¢è¿›è¡Œ\n\n"},"å­¦ä¹ ç¬”è®°/MySQL-å®æˆ˜-45-è®²/25ï½œMySQL-æ˜¯æ€ä¹ˆä¿è¯é«˜å¯ç”¨çš„ï¼Ÿ":{"title":"25ï½œMySQL æ˜¯æ€ä¹ˆä¿è¯é«˜å¯ç”¨çš„ï¼Ÿ","links":[],"tags":["mysql"],"content":"\næœ€ç»ˆä¸€è‡´æ€§ï¼šæ­£å¸¸æƒ…å†µä¸‹ï¼Œåªè¦ä¸»åº“æ‰§è¡Œæ›´æ–°ç”Ÿæˆçš„æ‰€æœ‰ binlog éƒ½å¯ä»¥ä¼ åˆ°å¤‡åº“å¹¶è¢«æ­£ç¡®åœ°æ‰§è¡Œï¼Œå¤‡åº“å°±èƒ½è¾¾åˆ°è·Ÿä¸»åº“ä¸€è‡´çš„çŠ¶æ€\nä»åº“å’Œå¤‡åº“æ¦‚å¿µä¸Šå·®ä¸å¤šï¼ŒæŠŠä¼šåœ¨ã€ŒHAã€è¿‡ç¨‹ä¸­è¢«é€‰æˆæ–°ä¸»åº“çš„ç§°ä¸ºå¤‡åº“\nHAï¼šé«˜å¯ç”¨ï¼ˆMySQL HA Solutionï¼‰\n\nä¸»åŠ¨åˆ‡æ¢çš„åœºæ™¯ Â§\n\nä¸»åº“ A æ‰§è¡Œå®Œæˆä¸€ä¸ªäº‹åŠ¡ï¼Œå†™å…¥ binlogï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªæ—¶åˆ»è®°ä¸º T1;\nä¹‹åä¼ ç»™å¤‡åº“ Bï¼Œæˆ‘ä»¬æŠŠå¤‡åº“ B æ¥æ”¶å®Œè¿™ä¸ª binlog çš„æ—¶åˆ»è®°ä¸º T2;\n\n\nå¾ˆå¿«\n\n\nå¤‡åº“ B æ‰§è¡Œå®Œæˆè¿™ä¸ªäº‹åŠ¡ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªæ—¶åˆ»è®°ä¸º T3\n\nä¸»å¤‡å»¶è¿Ÿ Â§\n\n\nT3 å‡ T1 çš„æ—¶é—´\n\n\nåœ¨å¤‡åº“æ‰§è¡Œ show slave status å‘½ä»¤ï¼Œè¿”å›ç»“æœçš„ seconds_behind_master è¡¨ç¤ºå½“å‰å¤‡åº“å»¶è¿Ÿäº†å¤šå°‘ç§’\n\n\n\næ¯ä¸ªäº‹åŠ¡çš„ binlog éƒ½æœ‰ä¸€ä¸ªè®°å½•ä¸»åº“ä¸Šå†™å…¥çš„æ—¶é—´çš„æ—¶é—´å­—æ®µ\n\n\n\n\nå¤‡åº“å–å‡ºå½“å‰æ­£åœ¨æ‰§è¡Œçš„äº‹åŠ¡çš„æ—¶é—´å­—æ®µçš„å€¼ï¼Œè®¡ç®—ä¸å½“å‰ã€Œç³»ç»Ÿæ—¶é—´ã€çš„å·®å€¼\n\n\nè®¡ç®—å®Œä¹‹åæ‰‹åŠ¨ä¿®æ”¹å¤‡åº“æ—¶é—´ï¼Œä¸ä¼šè‡ªåŠ¨ä¿®æ­£\n\n\n\n\n\nå¤‡åº“åœ¨è¿æ¥åˆ°ä¸»åº“çš„æ—¶å€™ä¼šé€šè¿‡ SELECT UNIX_TIMASTAMP() å‡½æ•°è·å¾—å½“å‰ä¸»åº“çš„ç³»ç»Ÿæ—¶é—´\n\nå¦‚æœä¸»åº“æ—¶é—´è·Ÿè‡ªå·±æ—¶é—´ä¸ä¸€æ ·ï¼Œä¼šåœ¨è®¡ç®—æ—¶è‡ªåŠ¨æ‰£æ‰è¿™ä¸ªå·®å€¼\n\n\n\nå»¶è¿ŸåŸå›  Â§\n\n\nå¤‡åº“æ¯”ä¸»åº“æ‰€åœ¨çš„æœºå™¨æ€§èƒ½å·®\n\nè¿™ç§æƒ…å†µå¯ä»¥è®¾ç½®å¤‡åº“éåŒ 1\n\n\n\nå¤‡åº“å‹åŠ›å¤§\n\næ¯”å¦‚ä¸€äº›ä¸é€‚åˆåœ¨ä¸»åº“è·‘çš„å¤§æŸ¥è¯¢æ”¾åœ¨äº†å¤‡åº“ä¸Šï¼Œæ­¤æ—¶å‹åŠ›æ¥åˆ°å¤‡åº“\nå¯ä»¥å¤šæ¥å‡ ä¸ªä»åº“åˆ†æ‹…å‹åŠ›\né€šè¿‡ binlog è¾“å‡ºåˆ°å¤–éƒ¨ç³»ç»Ÿï¼Œæ¯”å¦‚ Hadoop æˆ– esï¼Œè®©å¤–éƒ¨ç³»ç»Ÿæä¾›ç»Ÿè®¡ç±»æŸ¥è¯¢çš„èƒ½åŠ›\nå·¥å…·å¯ä»¥äº†è§£ä¸‹ canal\n\n\n\nå¤§äº‹åŠ¡\n\nå¦‚æœä¸€ä¸ªè¯­å¥åœ¨ä¸»åº“æ‰§è¡Œäº† 10 åˆ†é’Ÿï¼Œé‚£åœ¨å¤‡åº“ä¸Šä¹Ÿè¦æ‰§è¡Œå¾ˆä¹…\n\nâš ï¸ ä¸è¦ä¸€æ¬¡æ€§ä¿®æ”¹ã€åˆ é™¤å¤ªå¤šæ•°æ®\n\n\nå¤§è¡¨ DDL\n\nè®¡åˆ’å†…çš„ DDL å»ºè®®ç”¨ gh-ost æ–¹æ¡ˆ\n\n\n\n\n\nå¤‡åº“çš„å¹¶è¡Œå¤åˆ¶èƒ½åŠ›ï¼ˆåœ¨ä¸‹ä¸€ç¯‡ï¼‰\n\n\nä¸»å¤‡åˆ‡æ¢ç­–ç•¥ Â§\nå¯é æ€§ä¼˜å…ˆ Â§\n\nåˆ¤æ–­å¤‡åº“ B ç°åœ¨çš„ seconds_behind_masterï¼ŒæŒç»­é‡è¯•ï¼Œå¦‚æœå°äºæŸä¸ªå€¼æ‰è¿›å…¥ä¸‹ä¸€æ­¥\næŠŠä¸»åº“ A æ”¹æˆåªè¯»çŠ¶æ€\nåˆ¤æ–­å¤‡åº“ B çš„ seconds_behind_master çš„å€¼æ˜¯å¦ä¸º 0ï¼ŒæŒç»­é‡è¯•\næŠŠå¤‡åº“ B æ”¹æˆå¯è¯»å†™çŠ¶æ€\næŠŠä¸šåŠ¡è¯·æ±‚åˆ‡åˆ°å¤‡åº“ B\n\nä¸€èˆ¬ç”±ä¸“é—¨çš„ HA ç³»ç»Ÿå®Œæˆæ­¤æµç¨‹\nå¯ç”¨æ€§ä¼˜å…ˆ Â§\n\næŠŠ 4ã€5 è°ƒæ•´åˆ°æœ€å¼€å§‹æ‰§è¡Œ\nå¯èƒ½ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´\né€‚ç”¨åœºæ™¯ä¹‹ä¸€\n\nä¸€ä¸ªä¸“é—¨è´Ÿè´£æ“ä½œæ—¥å¿—çš„åº“ï¼Œæ•°æ®ä¸ä¸€è‡´å¯ä»¥é€šè¿‡ binlog ä¿®è¡¥ï¼ŒçŸ­æš‚çš„ä¸ä¸€è‡´ä¹Ÿä¸ä¼šå¼•å‘ä¸šåŠ¡é—®é¢˜åŒæ—¶ï¼Œä¸šåŠ¡ç³»ç»Ÿä¾èµ–äºè¿™ä¸ªæ—¥å¿—å†™å…¥é€»è¾‘ï¼Œå¦‚æœè¿™ä¸ªåº“ä¸å¯å†™ï¼Œä¼šå¯¼è‡´çº¿ä¸Šçš„ä¸šåŠ¡æ“ä½œæ— æ³•æ‰§è¡Œ\n\n\n\næ€è€ƒé¢˜ Â§\n\n\nä»€ä¹ˆåŸå› å¯¼è‡´çš„ï¼Ÿ\n\n\n\n\n\nä¸€ç§æ˜¯å¤§äº‹åŠ¡ï¼ˆåŒ…æ‹¬å¤§è¡¨ DDLã€ä¸€ä¸ªäº‹åŠ¡æ“ä½œå¾ˆå¤šè¡Œï¼‰ï¼›\n\n\nè¿˜æœ‰ä¸€ç§æƒ…å†µæ¯”è¾ƒéšè”½ï¼Œå¤‡åº“èµ·äº†ä¸€ä¸ªé•¿äº‹åŠ¡ï¼Œæ¯”å¦‚ begin;Â select * from t limit 1; ç„¶åå°±ä¸åŠ¨äº†\n\n\n\n\næ€ä¹ˆç¡®è®¤ï¼Ÿ\n\nçœ‹ä¸€ä¸‹å¤‡åº“å½“å‰æ‰§è¡Œçš„å‘½ä»¤\n\n\n"},"å­¦ä¹ ç¬”è®°/MySQL-å®æˆ˜-45-è®²/26ï½œå¤‡åº“ä¸ºä»€ä¹ˆä¼šå»¶è¿Ÿå¥½å‡ ä¸ªå°æ—¶ï¼Ÿ":{"title":"26ï½œå¤‡åº“ä¸ºä»€ä¹ˆä¼šå»¶è¿Ÿå¥½å‡ ä¸ªå°æ—¶ï¼Ÿ","links":[],"tags":["mysql"],"content":"\nä¸ºäº†è§£å†³å¤‡åº“ä¸€ç›´è¿½ä¸ä¸Šæ›´æ–°å‹åŠ›è¾ƒå¤§çš„ä¸»åº“çš„é—®é¢˜\n\nå¤šçº¿ç¨‹å¤åˆ¶æœºåˆ¶ï¼šå°†å•çº¿ç¨‹ sql_thread æ‹†æˆå¤šä¸ªçº¿ç¨‹ Â§\n\n\n\n\n\ncoordinator å°±æ˜¯åŸæ¥çš„ sql_threadï¼Œä½†ä¸å†æ›´æ–°æ•°æ®ï¼Œåªè´Ÿè´£è¯»å–ä¸­è½¬æ—¥å¿—å’Œåˆ†å‘äº‹åŠ¡çœŸæ­£æ›´æ–°æ—¥å¿—çš„å˜æˆ worker çº¿ç¨‹ï¼Œä¸ªæ•°ç”±å‚æ•° slave_parallel_workers å†³å®šä¸€èˆ¬è®¾ç½® 8ï½16 ä¹‹é—´æœ€å¥½ï¼ˆ32 æ ¸ç‰©ç†æœºçš„æƒ…å†µï¼‰éœ€è¦ç•™èµ„æºç»™è¯»æŸ¥è¯¢\n\n\n\n\n\nåˆ†å‘æ—¶çš„åŸºæœ¬è¦æ±‚\n\n\n\nä¸ä¼šé€ æˆæ›´æ–°è¦†ç›–ã€‚è¿™å°±è¦æ±‚æ›´æ–°åŒä¸€è¡Œçš„ä¸¤ä¸ªäº‹åŠ¡å¿…é¡»åˆ†å‘åˆ°åŒä¸€ä¸ª worker ä¸­\n\n\n\n\nåŒä¸€ä¸ªäº‹åŠ¡ä¸èƒ½è¢«æ‹†å¼€\n\n\n\n\n\nMySQL 5.5 ç‰ˆæœ¬çš„å¹¶è¡Œå¤åˆ¶ç­–ç•¥ Â§\n\n\nå®˜æ–¹ 5.5 ç‰ˆæœ¬ä¸æ”¯æŒå¹¶è¡Œå¤åˆ¶\n\nä¸‹é¢ä¸¤ä¸ªç­–ç•¥æ²¡æœ‰è¢«åˆå¹¶\n\n\n\næŒ‰è¡¨åˆ†å‘ç­–ç•¥\n\n\nå¦‚æœä¸¤ä¸ªäº‹åŠ¡æ›´æ–°ä¸åŒçš„è¡¨ï¼Œå°±å¯ä»¥å¹¶è¡Œï¼ŒÂ å¦‚æœæœ‰è·¨è¡¨çš„äº‹åŠ¡å°±éœ€è¦æŠŠä¸¤å¼ è¡¨æ”¾åœ¨ä¸€èµ·è€ƒè™‘\n\n\næŒ‰è¡¨å¹¶è¡Œå¤åˆ¶çº¿ç¨‹æ¨¡å‹\n\n\n\n\n\næ¯ä¸ª worker çº¿ç¨‹å¯¹åº”ä¸€ä¸ª hash è¡¨ï¼Œç”¨äºä¿å­˜å½“å‰æ­£åœ¨è¿™ä¸ª worker çš„â€œæ‰§è¡Œé˜Ÿåˆ—â€é‡Œçš„äº‹åŠ¡æ‰€æ¶‰åŠçš„è¡¨ã€‚hash è¡¨çš„ key æ˜¯â€œåº“å. è¡¨åâ€ï¼Œvalue æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œè¡¨ç¤ºé˜Ÿåˆ—ä¸­æœ‰å¤šå°‘ä¸ªäº‹åŠ¡ä¿®æ”¹è¿™ä¸ªè¡¨ã€‚\n\n\nå‡è®¾åœ¨å›¾ä¸­çš„æƒ…å†µä¸‹ï¼Œcoordinator ä»ä¸­è½¬æ—¥å¿—ä¸­è¯»å…¥ä¸€ä¸ªæ–°äº‹åŠ¡ Tï¼Œè¿™ä¸ªäº‹åŠ¡ä¿®æ”¹çš„è¡Œæ¶‰åŠåˆ°è¡¨ t1 å’Œ t3ã€‚æ­¤æ—¶äº‹åŠ¡ T çš„åˆ†é…è§„åˆ™ï¼š1. ç”±äºäº‹åŠ¡ T ä¸­æ¶‰åŠä¿®æ”¹è¡¨ t1ï¼Œè€Œ worker_1 é˜Ÿåˆ—ä¸­æœ‰äº‹åŠ¡åœ¨ä¿®æ”¹è¡¨ t1ï¼Œäº‹åŠ¡ T å’Œé˜Ÿåˆ—ä¸­çš„æŸä¸ªäº‹åŠ¡è¦ä¿®æ”¹åŒä¸€ä¸ªè¡¨çš„æ•°æ®ï¼Œè¿™ç§æƒ…å†µæˆ‘ä»¬è¯´äº‹åŠ¡ T å’Œ worker_1 æ˜¯å†²çªçš„ã€‚2.Â æŒ‰ç…§è¿™ä¸ªé€»è¾‘ï¼Œé¡ºåºåˆ¤æ–­äº‹åŠ¡ T å’Œæ¯ä¸ª worker é˜Ÿåˆ—çš„å†²çªå…³ç³»ï¼Œä¼šå‘ç°äº‹åŠ¡ T è·Ÿ worker_2 ä¹Ÿå†²çªã€‚3. äº‹åŠ¡ T è·Ÿå¤šäºä¸€ä¸ª worker å†²çªï¼Œcoordinator çº¿ç¨‹å°±è¿›å…¥ç­‰å¾…ã€‚4. æ¯ä¸ª worker ç»§ç»­æ‰§è¡Œï¼ŒåŒæ—¶ä¿®æ”¹ hash_tableã€‚å‡è®¾ hash_table_2 é‡Œé¢æ¶‰åŠåˆ°ä¿®æ”¹è¡¨ t3 çš„äº‹åŠ¡å…ˆæ‰§è¡Œå®Œæˆï¼Œå°±ä¼šä» hash_table_2 ä¸­æŠŠ db1.t3 è¿™ä¸€é¡¹å»æ‰ã€‚5. è¿™æ · coordinator ä¼šå‘ç°è·Ÿäº‹åŠ¡ T å†²çªçš„ worker åªæœ‰ worker_1 äº†ï¼Œå› æ­¤å°±æŠŠå®ƒåˆ†é…ç»™ worker_1ã€‚6. coordinator ç»§ç»­è¯»ä¸‹ä¸€ä¸ªä¸­è½¬æ—¥å¿—ï¼Œç»§ç»­åˆ†é…äº‹åŠ¡ã€‚\n\n\næ¯ä¸ªäº‹åŠ¡åœ¨åˆ†å‘çš„æ—¶å€™ï¼Œè·Ÿæ‰€æœ‰ worker çš„å†²çªå…³ç³»åŒ…æ‹¬ä¸‰ç§æƒ…å†µï¼š\n\n\n\nå¦‚æœè·Ÿæ‰€æœ‰ worker éƒ½ä¸å†²çªï¼Œcoordinator çº¿ç¨‹å°±ä¼šæŠŠè¿™ä¸ªäº‹åŠ¡åˆ†é…ç»™æœ€ç©ºé—²çš„ woker;\n\n\n\n\nå¦‚æœè·Ÿå¤šäºä¸€ä¸ª worker å†²çªï¼Œcoordinator çº¿ç¨‹å°±è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°å’Œè¿™ä¸ªäº‹åŠ¡å­˜åœ¨å†²çªå…³ç³»çš„ worker åªå‰©ä¸‹ 1 ä¸ªï¼›\n\n\n\n\nå¦‚æœåªè·Ÿä¸€ä¸ª worker å†²çªï¼Œcoordinator çº¿ç¨‹å°±ä¼šæŠŠè¿™ä¸ªäº‹åŠ¡åˆ†é…ç»™è¿™ä¸ªå­˜åœ¨å†²çªå…³ç³»çš„ workerã€‚\n\n\n\n\n\n\n\næŒ‰è¡Œåˆ†å‘ç­–ç•¥\n\nå¦‚æœä¸¤ä¸ªäº‹åŠ¡æ²¡æœ‰æ›´æ–°ç›¸åŒçš„è¡Œï¼Œå®ƒä»¬åœ¨å¤‡åº“ä¸Šå¯ä»¥å¹¶å‘æ‰§è¡Œ\néœ€è¦åŒæ—¶è€ƒè™‘ä¸»é”®å’Œå”¯ä¸€é”®\næ‰§è¡Œ update t1 set a=1 where id=2 è¯­å¥ï¼Œåœ¨ binlog é‡Œé¢è®°å½•äº†æ•´è¡Œçš„æ•°æ®ä¿®æ”¹å‰å„ä¸ªå­—æ®µçš„å€¼ï¼Œå’Œä¿®æ”¹åå„ä¸ªå­—æ®µçš„å€¼ã€‚å› æ­¤ï¼Œcoordinator åœ¨è§£æè¿™ä¸ªè¯­å¥çš„ binlog çš„æ—¶å€™ï¼Œè¿™ä¸ªäº‹åŠ¡çš„ hash è¡¨å°±æœ‰ä¸‰ä¸ªé¡¹\n\nkey=hash_func(db1+t1+â€œPRIMARYâ€+2), value=2ï¼Œè¿™é‡Œ value=2 æ˜¯å› ä¸ºä¿®æ”¹å‰åçš„è¡Œ id å€¼ä¸å˜ï¼Œå‡ºç°äº†ä¸¤æ¬¡ã€‚\nkey=hash_func(db1+t1+â€œaâ€+2), value=1ï¼Œè¡¨ç¤ºä¼šå½±å“åˆ°è¿™ä¸ªè¡¨ a=2 çš„è¡Œã€‚\nkey=hash_func(db1+t1+â€œaâ€+1), value=1ï¼Œè¡¨ç¤ºä¼šå½±å“åˆ°è¿™ä¸ªè¡¨ a=1 çš„è¡Œã€‚\n\n\næ¶ˆè€—æ›´å¤šçš„è®¡ç®—èµ„æº\n\n\n\nä¸¤ä¸ªæ–¹æ¡ˆæœ‰ä¸€äº›çº¦æŸæ¡ä»¶\n\n\n\nè¦èƒ½å¤Ÿä» binlog é‡Œé¢è§£æå‡ºè¡¨åã€ä¸»é”®å€¼å’Œå”¯ä¸€ç´¢å¼•çš„å€¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸»åº“çš„ binlog æ ¼å¼å¿…é¡»æ˜¯ rowï¼›\n\n\n\n\nè¡¨å¿…é¡»æœ‰ä¸»é”®ï¼›\n\n\n\n\nä¸èƒ½æœ‰å¤–é”®ã€‚è¡¨ä¸Šå¦‚æœæœ‰å¤–é”®ï¼Œçº§è”æ›´æ–°çš„è¡Œä¸ä¼šè®°å½•åœ¨ binlog ä¸­ï¼Œè¿™æ ·å†²çªæ£€æµ‹å°±ä¸å‡†ç¡®ã€‚\n\n\n\n\n\næŒ‰è¡Œç­–ç•¥é‡åˆ°ä¸€ä¸ªè¯­å¥è¦åˆ é™¤ 100 ä¸‡è¡Œæ•°æ®ç±»ä¼¼çš„æƒ…å†µæ—¶ï¼Œhash è¡¨è¦è®°å½• 100 ä¸‡ä¸ªé¡¹ï¼Œè€—å†…å­˜è§£æ binlog è®¡ç®— hash å€¼ï¼Œå¯¹äºå¤§äº‹åŠ¡ï¼Œæˆæœ¬å¾ˆé«˜\n\nè®¾ç½®é˜ˆå€¼ï¼Œå•ä¸ªäº‹åŠ¡å¦‚æœè¶…è¿‡è®¾ç½®çš„è¡Œæ•°é˜ˆå€¼ï¼Œå°±æš‚æ—¶é€€åŒ–ä¸ºå•çº¿ç¨‹æ¨¡å¼\n\ncoordinator æš‚æ—¶å…ˆ hold ä½è¿™ä¸ªäº‹åŠ¡ï¼›\nç­‰å¾…æ‰€æœ‰ worker éƒ½æ‰§è¡Œå®Œæˆï¼Œå˜æˆç©ºé˜Ÿåˆ—ï¼›\ncoordinator ç›´æ¥æ‰§è¡Œè¿™ä¸ªäº‹åŠ¡ï¼›\næ¢å¤å¹¶è¡Œæ¨¡å¼ã€‚\n\n\n\n\n\nMySQL 5.6 ç‰ˆæœ¬çš„å¹¶è¡Œå¤åˆ¶ç­–ç•¥ Â§\n\næŒ‰åº“å¹¶è¡Œ\nhash è¡¨çš„ key = æ•°æ®åº“å\nä¸è¦æ±‚ binlog çš„æ ¼å¼\n\nMariaDB çš„å¹¶è¡Œå¤åˆ¶ç­–ç•¥ Â§\n\n\nåˆ©ç”¨äº† redo log ç»„æäº¤ä¼˜åŒ–ï¼ˆgroup commitï¼‰çš„ç‰¹æ€§\n\n\n\nèƒ½å¤Ÿåœ¨åŒä¸€ç»„é‡Œæäº¤çš„äº‹åŠ¡ï¼Œä¸€å®šä¸ä¼šä¿®æ”¹åŒä¸€è¡Œï¼›\n\n\n\n\nä¸»åº“ä¸Šå¯ä»¥å¹¶è¡Œæ‰§è¡Œçš„äº‹åŠ¡ï¼Œå¤‡åº“ä¸Šä¹Ÿä¸€å®šæ˜¯å¯ä»¥å¹¶è¡Œæ‰§è¡Œçš„ã€‚\n\n\n\n\n\nå®ç°\n\n\n\nåœ¨ä¸€ç»„é‡Œé¢ä¸€èµ·æäº¤çš„äº‹åŠ¡ï¼Œæœ‰ä¸€ä¸ªç›¸åŒçš„ commit_idï¼Œä¸‹ä¸€ç»„å°±æ˜¯ commit_id + 1ï¼›\n\n\n\n\ncommit_id ç›´æ¥å†™åˆ° binlog é‡Œé¢ï¼›\n\n\n\n\nä¼ åˆ°å¤‡åº“åº”ç”¨çš„æ—¶å€™ï¼Œç›¸åŒ commit_id çš„äº‹åŠ¡åˆ†å‘åˆ°å¤šä¸ª worker æ‰§è¡Œï¼›\n\n\n\n\nè¿™ä¸€ç»„å…¨éƒ¨æ‰§è¡Œå®Œæˆåï¼Œcoordinator å†å»å–ä¸‹ä¸€æ‰¹ã€‚\n\n\n\n\n\nä¹‹å‰çš„æ€è·¯ï¼šåˆ†æ binlogï¼Œå¹¶æ‹†åˆ†åˆ° worker ä¸Šï¼ŒMariaDB çš„ç­–ç•¥ï¼šæ¨¡æ‹Ÿä¸»åº“çš„å¹¶è¡Œæ¨¡å¼\n\n\nä½†æ˜¯æ²¡æœ‰å®ç°â€œçœŸæ­£çš„æ¨¡æ‹Ÿä¸»åº“å¹¶å‘åº¦â€ç›®æ ‡ä¸»åº“ä¸Šï¼Œä¸€ç»„äº‹åŠ¡åœ¨ commit çš„æ—¶å€™ï¼Œä¸‹ä¸€ç»„äº‹åŠ¡æ˜¯åŒæ—¶å¤„äºâ€œæ‰§è¡Œä¸­â€çŠ¶æ€çš„\n\n\nMySQL 5.7 çš„å¹¶è¡Œå¤åˆ¶ç­–ç•¥ Â§\n\n\nç”±å‚æ•° slave-parallel-type æ§åˆ¶å¹¶è¡Œå¤åˆ¶ç­–ç•¥\n\n\n\né…ç½®ä¸º DATABASEï¼Œè¡¨ç¤ºä½¿ç”¨ MySQL 5.6 ç‰ˆæœ¬çš„æŒ‰åº“å¹¶è¡Œç­–ç•¥ï¼›\n\n\n\n\né…ç½®ä¸º LOGICAL_CLOCKï¼Œè¡¨ç¤ºçš„å°±æ˜¯ç±»ä¼¼ MariaDB çš„ç­–ç•¥ã€‚ä¸è¿‡ï¼ŒMySQL 5.7 è¿™ä¸ªç­–ç•¥ï¼Œé’ˆå¯¹å¹¶è¡Œåº¦åšäº†ä¼˜åŒ–ã€‚è¿™ä¸ªä¼˜åŒ–çš„æ€è·¯ä¹Ÿå¾ˆæœ‰è¶£å„¿ã€‚\n\n\nåŒæ—¶å¤„äºâ€œæ‰§è¡ŒçŠ¶æ€â€çš„æ‰€æœ‰äº‹åŠ¡ä¸å¯ä»¥å¹¶è¡Œå› ä¸ºå¯èƒ½ç”±ç”±äºé”å†²çªè€Œå¤„äºé”ç­‰å¾…çŠ¶æ€çš„äº‹åŠ¡\nè¿™é‡Œçš„æ€æƒ³æ˜¯ï¼š1. åŒæ—¶å¤„äº prepare çŠ¶æ€çš„äº‹åŠ¡ï¼Œåœ¨å¤‡åº“æ‰§è¡Œæ—¶æ˜¯å¯ä»¥å¹¶è¡Œçš„ï¼›2. å¤„äº prepare çŠ¶æ€çš„äº‹åŠ¡ï¼Œä¸å¤„äº commit çŠ¶æ€çš„äº‹åŠ¡ä¹‹é—´ï¼Œåœ¨å¤‡åº“æ‰§è¡Œæ—¶ä¹Ÿæ˜¯å¯ä»¥å¹¶è¡Œçš„ã€‚\nå¤‡åº“å¦‚ä½•çŸ¥é“äº‹åŠ¡çš„äºŒé˜¶æ®µæäº¤çŠ¶æ€ï¼ˆä¾èµ– redo logï¼Œå¤‡åº“æ¥æ”¶åˆ°çš„æ˜¯ binlogï¼‰\n\nä¸»åº“åœ¨å†™ binlog çš„æ—¶å€™ä¼šç»™è¿™äº› binlog é‡Œé¢è®° commit_id å’Œsequence_noï¼Œæ¥è¯´æ˜äº‹åŠ¡ä¹‹é—´åœ¨ä¸»åº“ä¸Šå¹¶è¡Œ prepare çš„çŠ¶æ€ï¼›å¤‡åº“æ˜¯é€šè¿‡è§£æ binlog æ‹¿åˆ° commit_id å’Œ sequence_noï¼Œæ¥å†³å®šè¦æ€ä¹ˆå¹¶å‘çš„ã€‚\n\n\n\n\n\n\n\nbinlog çš„ç»„æäº¤ç›¸å…³å‚æ•°\n\n\n\nbinlog_group_commit_sync_delay å‚æ•°ï¼Œè¡¨ç¤ºå»¶è¿Ÿå¤šå°‘å¾®ç§’åæ‰è°ƒç”¨ fsyncï¼›\n\n\n\n\nbinlog_group_commit_sync_no_delay_count å‚æ•°ï¼Œè¡¨ç¤ºç´¯ç§¯å¤šå°‘æ¬¡ä»¥åæ‰è°ƒç”¨ fsyncã€‚\n\n\nç”¨äºæ•…æ„æ‹‰é•¿ binlog ä» write åˆ° fsync çš„æ—¶é—´ï¼Œå‡å°‘ binlog çš„å†™ç›˜æ¬¡æ•°\nåŒæ—¶å¯ä»¥ç”¨æ¥åˆ¶é€ æ›´å¤šçš„â€œåŒæ—¶å¤„äº prepare é˜¶æ®µçš„äº‹åŠ¡â€ï¼Œå¢åŠ å¤‡åº“å¤åˆ¶çš„å¹¶è¡Œåº¦\n\n\n\nMySQL 5.7.22 çš„å¹¶è¡Œå¤åˆ¶ç­–ç•¥ Â§\n\n\nMySQL å¢åŠ äº†ä¸€ä¸ªæ–°çš„å¹¶è¡Œå¤åˆ¶ç­–ç•¥ï¼ŒåŸºäº WRITESET çš„å¹¶è¡Œå¤åˆ¶ã€‚\n\n\nç›¸åº”åœ°ï¼Œæ–°å¢äº†ä¸€ä¸ªå‚æ•° binlog-transaction-dependency-trackingï¼Œç”¨æ¥æ§åˆ¶æ˜¯å¦å¯ç”¨è¿™ä¸ªæ–°ç­–ç•¥ã€‚è¿™ä¸ªå‚æ•°çš„å¯é€‰å€¼æœ‰ä»¥ä¸‹ä¸‰ç§ã€‚\n\n\n\nCOMMIT_ORDERï¼Œè¡¨ç¤ºçš„å°±æ˜¯å‰é¢ä»‹ç»çš„ï¼Œæ ¹æ®åŒæ—¶è¿›å…¥ prepare å’Œ commit æ¥åˆ¤æ–­æ˜¯å¦å¯ä»¥å¹¶è¡Œçš„ç­–ç•¥ã€‚\n\n\n\n\nWRITESETï¼Œè¡¨ç¤ºçš„æ˜¯å¯¹äºäº‹åŠ¡æ¶‰åŠæ›´æ–°çš„æ¯ä¸€è¡Œï¼Œè®¡ç®—å‡ºè¿™ä¸€è¡Œçš„ hash å€¼ï¼Œç»„æˆé›†åˆ writesetã€‚å¦‚æœä¸¤ä¸ªäº‹åŠ¡æ²¡æœ‰æ“ä½œç›¸åŒçš„è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä»¬çš„ writeset æ²¡æœ‰äº¤é›†ï¼Œå°±å¯ä»¥å¹¶è¡Œã€‚\n\n\n\n\n\nWRITESET_SESSIONï¼Œæ˜¯åœ¨ WRITESET çš„åŸºç¡€ä¸Šå¤šäº†ä¸€ä¸ªçº¦æŸï¼Œå³åœ¨ä¸»åº“ä¸ŠåŒä¸€ä¸ªçº¿ç¨‹å…ˆåæ‰§è¡Œçš„ä¸¤ä¸ªäº‹åŠ¡ï¼Œåœ¨å¤‡åº“æ‰§è¡Œçš„æ—¶å€™ï¼Œè¦ä¿è¯ç›¸åŒçš„å…ˆåé¡ºåºã€‚\n\n\n\nåŸºæœ¬ç”¨ä¸åˆ°\n\n\n\n\n\n2ã€3 çš„ hash å€¼ = åº“å + è¡¨å + ç´¢å¼•å + å€¼ï¼Œå¦‚æœè¡¨ä¸Šé™¤äº†ä¸»é”®ç´¢å¼•å¤–ï¼Œè¿˜æœ‰å…¶ä»–å”¯ä¸€ç´¢å¼•ï¼Œå¯¹äºæ¯ä¸ªå”¯ä¸€ç´¢å¼•ï¼Œinsert è¯­å¥å¯¹åº”çš„ writeset å°±è¦å¤šå¢åŠ ä¸€ä¸ª hash å€¼\n\n\nè·Ÿ MySQL 5.5 ç‰ˆæœ¬çš„æŒ‰è¡Œåˆ†å‘ç­–ç•¥å·®ä¸å¤šï¼Œä½†æœ‰ä¼˜åŠ¿\n\n\n\nwriteset æ˜¯åœ¨ä¸»åº“ç”Ÿæˆåç›´æ¥å†™å…¥åˆ° binlog é‡Œé¢çš„ï¼Œè¿™æ ·åœ¨å¤‡åº“æ‰§è¡Œçš„æ—¶å€™ï¼Œä¸éœ€è¦è§£æ binlog å†…å®¹ï¼ˆevent é‡Œçš„è¡Œæ•°æ®ï¼‰ï¼ŒèŠ‚çœäº†å¾ˆå¤šè®¡ç®—é‡ï¼›\n\n\n\n\nä¸éœ€è¦æŠŠæ•´ä¸ªäº‹åŠ¡çš„ binlog éƒ½æ‰«ä¸€éæ‰èƒ½å†³å®šåˆ†å‘åˆ°å“ªä¸ª workerï¼Œæ›´çœå†…å­˜ï¼›\n\n\n\n\nç”±äºå¤‡åº“çš„åˆ†å‘ç­–ç•¥ä¸ä¾èµ–äº binlog å†…å®¹ï¼Œæ‰€ä»¥ binlog æ˜¯ statement æ ¼å¼ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚\n\n\n\n\n\nå¯¹äºâ€œè¡¨ä¸Šæ²¡ä¸»é”®â€å’Œâ€œå¤–é”®çº¦æŸâ€çš„åœºæ™¯ï¼ŒWRITESET ç­–ç•¥ä¹Ÿæ˜¯æ²¡æ³•å¹¶è¡Œçš„ï¼Œä¹Ÿä¼šæš‚æ—¶é€€åŒ–ä¸ºå•çº¿ç¨‹æ¨¡å‹ã€‚\n\n\nâš ï¸ 5.7 ç‰ˆæœ¬æ–°å¢çš„å¤‡åº“å¹¶è¡Œç­–ç•¥ä¿®æ”¹äº† binlog çš„å†…å®¹ï¼Œè¯´æ˜ binlog åè®®å¹¶ä¸æ˜¯å‘ä¸Šå…¼å®¹çš„ï¼Œåœ¨ä¸»å¤‡åˆ‡æ¢ã€ç‰ˆæœ¬å‡çº§çš„æ—¶å€™éœ€è¦è€ƒè™‘è¿™ä¸ªå› ç´  Â§\næ€è€ƒé¢˜ Â§\n\nå‡è®¾ä¸€ä¸ª MySQL 5.7.22 ç‰ˆæœ¬çš„ä¸»åº“ï¼Œå•çº¿ç¨‹æ’å…¥äº†å¾ˆå¤šæ•°æ®ï¼Œè¿‡äº† 3 ä¸ªå°æ—¶åï¼Œæˆ‘ä»¬è¦ç»™è¿™ä¸ªä¸»åº“æ­å»ºä¸€ä¸ªç›¸åŒç‰ˆæœ¬çš„å¤‡åº“ã€‚\nè¿™æ—¶å€™ï¼Œä½ ä¸ºäº†æ›´å¿«åœ°è®©å¤‡åº“è¿½ä¸Šä¸»åº“ï¼Œè¦å¼€å¹¶è¡Œå¤åˆ¶ã€‚åœ¨ binlog-transaction-dependency-tracking å‚æ•°çš„ COMMIT_ORDERã€WRITESET å’Œ WRITE_SESSION è¿™ä¸‰ä¸ªå–å€¼ä¸­ï¼Œä½ ä¼šé€‰æ‹©å“ªä¸€ä¸ªå‘¢ï¼Ÿä½ é€‰æ‹©çš„åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ\n\nWRITESET\n\n\nå¦‚æœè®¾ç½®å¦å¤–ä¸¤ä¸ªå‚æ•°ï¼Œä½ è®¤ä¸ºä¼šå‡ºç°ä»€ä¹ˆç°è±¡å‘¢ï¼Ÿ\n\nCOMMIT_ORDERï¼šç”±äºä¸»åº“æ˜¯å•çº¿ç¨‹å‹åŠ›æ¨¡å¼ï¼Œæ‰€ä»¥æ¯ä¸ªäº‹åŠ¡çš„ commit_id ä¸åŒ\nç”±äº WRITESET_SESSION æ¨¡å¼è¦æ±‚åœ¨å¤‡åº“åº”ç”¨æ—¥å¿—çš„æ—¶å€™ï¼ŒåŒä¸€ä¸ªçº¿ç¨‹çš„æ—¥å¿—å¿…é¡»ä¸ä¸»åº“ä¸Šæ‰§è¡Œçš„å…ˆåé¡ºåºç›¸åŒï¼Œä¹Ÿä¼šå¯¼è‡´ä¸»åº“å•çº¿ç¨‹å‹åŠ›æ¨¡å¼ä¸‹é€€åŒ–æˆå•çº¿ç¨‹å¤åˆ¶ã€‚\n\n\n\nè¯„è®ºåŒº Â§\n\n\nå­˜åœ¨ä¸»ä»çš„ binlog event å†™å…¥é¡ºåºä¸ä¸€è‡´çš„æƒ…å†µ\n\n\nå¯¹åŒä¸€è¡Œçš„ä¿®æ”¹ä¼šå› ä¸ºè¡Œé”è€Œä¸èƒ½åŒæ—¶è¿›å…¥ commit çŠ¶æ€ï¼Œæ‰€ä»¥ commit_id ä¸ä¼šç›¸åŒ\n\n\næ¯ä¸ªäº‹åŠ¡éƒ½æœ‰ä¸¤ä¸ªæ•°å­—è¡¨ç¤ºå®ƒåœ¨æ‰§è¡Œæäº¤é˜¶æ®µçš„æ—¶é—´èŒƒå›´ï¼Œæ„æˆåŒºé—´ (c1, c2)ã€‚å¦‚æœä¸¤ä¸ªäº‹åŠ¡çš„åŒºé—´æœ‰äº¤é›†ï¼Œå°±æ˜¯å¯ä»¥å¹¶è¡Œçš„ã€‚è¿™é‡Œ c1 æ˜¯äº‹åŠ¡å¯åŠ¨çš„æ—¶å€™ï¼Œå½“å‰ç³»ç»Ÿé‡Œæœ€å¤§çš„ commit_idï¼›ä¸€ä¸ªäº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œcommit_id + 1.\n\nè¿›å…¥ prepare çš„æ—¶å€™å°±ç»™è¿™ä¸ªäº‹åŠ¡åˆ†é… commit_idï¼Œè¿™ä¸ª commit_id å°±æ˜¯å½“å‰ç³»ç»Ÿæœ€å¤§çš„ä¸€ä¸ª commit_id\n\n\n\nä½œè€…å›å¤: æˆ‘ä¹Ÿå»ºè®®å°½é‡å°‘ä½¿ç”¨å¤–é”®\n\nè¿™ä¸ªå…³ç³»åº”è¯¥ç»´æŠ¤åœ¨å¼€å‘ç³»ç»Ÿçš„é€»è¾‘ä¸­ï¼Œæ”¾åœ¨æ•°æ®åº“é‡Œé¢ï¼Œæ¯”è¾ƒéšè”½ï¼Œå®¹æ˜“å¿˜è®°\nå¤–é”®çº¦æŸå¯èƒ½ä¼šå¯¼è‡´æœ‰äº›æ›´æ–°å¤±è´¥\nå¤–é”®çº¦æŸï¼ˆå°¤å…¶æ˜¯çº§è”æ›´æ–°ï¼‰å®¹æ˜“å‡ºç°éé¢„æœŸçš„ç»“æœ\n\n\n"},"å­¦ä¹ ç¬”è®°/MySQL-å®æˆ˜-45-è®²/27ï½œä¸»åº“å‡ºé—®é¢˜äº†ï¼Œä»åº“æ€ä¹ˆåŠï¼Ÿ":{"title":"27ï½œä¸»åº“å‡ºé—®é¢˜äº†ï¼Œä»åº“æ€ä¹ˆåŠï¼Ÿ","links":[],"tags":["mysql"],"content":"åŸºäºä½ç‚¹çš„ä¸»å¤‡åˆ‡æ¢ Â§\n\n\nchange master å‘½ä»¤ï¼š\n \n\n\nCHANGE MASTER TOÂ \nMASTER_HOST=hostnâ€‹ameÂ MASTERPâ€‹ORT=portÂ \nMASTER_USER=usernâ€‹ameÂ MASTERPâ€‹ASSWORD=passwordÂ \nMASTER_LOG_FILE=masterlâ€‹ognâ€‹ameÂ MASTERLâ€‹OGPâ€‹OS=master_log_pos\n\n- æœ€åä¸¤ä¸ªå‚æ•°å°±æ˜¯ä½ç‚¹å‚æ•°ï¼šä»ä¸»åº“çš„ master_log_name æ–‡ä»¶çš„ master_log_pos è¿™ä¸ªä½ç½®çš„æ—¥å¿—ç»§ç»­åŒæ­¥\n- å…¶ä¸­ä¸€ç§å–åŒæ­¥ä½ç‚¹çš„æ–¹æ³•\n\n  - 1. ç­‰å¾…æ–°ä¸»åº“æŠŠä¸­è½¬æ—¥å¿—å…¨éƒ¨åŒæ­¥å®Œæˆï¼›\n  - 2. åœ¨æ–°ä¸»åº“ä¸Šæ‰§è¡Œ show master status å‘½ä»¤ï¼Œå¾—åˆ°å½“å‰æœ€æ–°çš„ File å’Œ Positionï¼›\n  - 3. å–åŸä¸»åº“æ•…éšœçš„æ—¶åˆ» Tï¼›\n  - 4. ç”¨ mysqlbinlog å·¥å…·è§£ææ–°ä¸»åº“çš„ Fileï¼Œå¾—åˆ° T æ—¶åˆ»çš„ä½ç‚¹ã€‚mysqlbinlog File --stop-datetime=T --start-datetime=T\n\n- âš ï¸ å¾—åˆ°çš„ä½ç½®ä¸å‡†ç¡®ï¼šæ¯”å¦‚æ—§ä¸»åº“æ‰§è¡Œå®Œæˆä¸€ä¸ª insert è¯­å¥æ’å…¥æ•°æ®ï¼Œå¹¶ä¸”å°† binlog ä¼ ç»™äº†è¦æˆä¸ºæ–°ä¸»åº“çš„å®ä¾‹å’Œä»åº“ï¼Œä¼ å®Œåæ‰ç”µã€‚æ­¤æ—¶ï¼Œä»åº“æ‰§è¡Œ binlog åæœ‰äº†æ–°æ•°æ®ï¼Œæ–°ä¸»åº“å¯èƒ½åˆå†æ¬¡æŠŠ binlog ä¼ è¿‡æ¥ï¼Œä¼šæŠ¥ä¸»é”®é‡å¤é”™è¯¯ã€‚\n\n  - ä¸¤ç§è§£å†³æ–¹æ³•\n  - 1. ä¸»åŠ¨è·³è¿‡ä¸€ä¸ªäº‹åŠ¡ï¼š`set global sql_slave_skip_counter=1;start slave;`\n\n    - æ­¤æ–¹æ³•éœ€è¦åœ¨ä»åº“åˆšå¼€å§‹è¿æ¥åˆ°æ–°ä¸»åº“çš„æ—¶å€™æŒç»­è§‚å¯Ÿï¼Œæ¯æ¬¡ç¢°åˆ°è¿™äº›é”™è¯¯å°±åœä¸‹æ¥ï¼Œæ‰§è¡Œä¸€æ¬¡è·³è¿‡å‘½ä»¤ï¼Œç›´åˆ°ä¸å†å‡ºç°åœä¸‹æ¥çš„æƒ…å†µï¼Œä»¥æ­¤æ¥è·³è¿‡å¯èƒ½æ¶‰åŠçš„æ‰€æœ‰äº‹åŠ¡ã€‚\n\n  - 2. é€šè¿‡è®¾ç½® slave_skip_error å‚æ•°ï¼Œç›´æ¥è®¾ç½®è·³è¿‡æŒ‡å®šçš„é”™è¯¯ã€‚åœ¨æ‰§è¡Œä¸»å¤‡åˆ‡æ¢æ—¶ï¼Œç»å¸¸ä¼šé‡åˆ°ï¼š\n    - a. 1062 é”™è¯¯ï¼Œæ’å…¥æ•°æ®æ—¶å”¯ä¸€é”®å†²çªï¼›\n    - b. 1032 é”™è¯¯ï¼Œåˆ é™¤æ•°æ®æ—¶æ‰¾ä¸åˆ°è¡Œã€‚\n\n## GTIDï¼ˆGlobal Transaction Identifierï¼Œå…¨å±€äº‹åŠ¡ IDï¼‰\n\n- MySQL 5.6 ç‰ˆæœ¬å¼•å…¥\n\n- ä¸€ä¸ªäº‹åŠ¡åœ¨æäº¤çš„æ—¶å€™ç”Ÿæˆçš„ï¼Œæ ¼å¼ï¼š`GTID=server_uuid:gno`\n\n  - server_uuidï¼šå®ä¾‹ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨ç”Ÿæˆï¼Œå…¨å±€å”¯ä¸€\n  - gnoï¼šæ•´æ•°ï¼Œåˆå§‹å€¼ 1ï¼Œæ¯æ¬¡æäº¤äº‹åŠ¡çš„æ—¶å€™åˆ†é…ç»™è¿™ä¸ªäº‹åŠ¡ï¼Œå¹¶åŠ  1\n\n- å®˜æ–¹æ–‡æ¡£çš„ GTID æ ¼å¼å®šä¹‰å®¹æ˜“é€ æˆè¯¯è§£ï¼š`GTID=source_id:transaction_id`\n\n  - source_idï¼šserver_uuid\n  - transaction_idï¼šgno\n  - åœ¨ MySQL é‡Œ transaction_id å°±æ˜¯æŒ‡äº‹åŠ¡ idï¼Œäº‹åŠ¡ id æ˜¯åœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­åˆ†é…çš„ï¼Œå¦‚æœè¿™ä¸ªäº‹åŠ¡å›æ»šäº†ï¼Œäº‹åŠ¡ id ä¹Ÿä¼šé€’å¢ï¼Œä¸è¿ç»­é€’å¢ã€‚\n  - è€Œ gno æ˜¯åœ¨äº‹åŠ¡æäº¤çš„æ—¶å€™æ‰ä¼šåˆ†é…ï¼Œè¿ç»­é€’å¢ã€‚\n\n- å¯åŠ¨ GTID æ¨¡å¼ï¼šå¯åŠ¨ MySQL å®ä¾‹æ—¶åŠ ä¸Šå‚æ•° gtid_mode=on å’Œ enforce_gtid_consistency=on\n- æ¯ä¸ªäº‹åŠ¡è·Ÿä¸€ä¸ª GTID ä¸€ä¸€å¯¹åº”\n- GTID ä¸¤ç§ç”Ÿæˆæ–¹å¼\n\n  - 1. å¦‚æœ gtid_next=automaticï¼Œä»£è¡¨ä½¿ç”¨é»˜è®¤å€¼ã€‚è¿™æ—¶ï¼ŒMySQL å°±ä¼šæŠŠ server_uuid:gno åˆ†é…ç»™è¿™ä¸ªäº‹åŠ¡ã€‚\n    - a. è®°å½• binlog çš„æ—¶å€™ï¼Œå…ˆè®°å½•ä¸€è¡Œ `SETÂ @@SESSION.GTID_NEXT=â€˜server_uuid:gnoâ€™;`\n    - b. æŠŠè¿™ä¸ª GTID åŠ å…¥æœ¬å®ä¾‹çš„ GTID é›†åˆã€‚\n  - 2. å¦‚æœ gtid_next æ˜¯ä¸€ä¸ªæŒ‡å®šçš„ GTID çš„å€¼ï¼Œæ¯”å¦‚é€šè¿‡ set gtid_next=&#039;current_gtid&#039; æŒ‡å®šä¸º current_gtidï¼Œé‚£ä¹ˆå°±æœ‰ä¸¤ç§å¯èƒ½ï¼š\n    - a. å¦‚æœ current_gtid å·²ç»å­˜åœ¨äºå®ä¾‹çš„ GTID é›†åˆä¸­ï¼Œæ¥ä¸‹æ¥æ‰§è¡Œçš„è¿™ä¸ªäº‹åŠ¡ä¼šç›´æ¥è¢«ç³»ç»Ÿå¿½ç•¥ï¼›\n    - b. å¦‚æœ current_gtid æ²¡æœ‰å­˜åœ¨äºå®ä¾‹çš„ GTID é›†åˆä¸­ï¼Œå°±å°†è¿™ä¸ª current_gtid åˆ†é…ç»™æ¥ä¸‹æ¥è¦æ‰§è¡Œçš„äº‹åŠ¡ï¼Œä¹Ÿå°±æ˜¯è¯´ç³»ç»Ÿä¸éœ€è¦ç»™è¿™ä¸ªäº‹åŠ¡ç”Ÿæˆæ–°çš„ GTIDï¼Œå› æ­¤ gno ä¹Ÿä¸ç”¨åŠ  1ã€‚\n\n- æ¯ä¸ª MySQL å®ä¾‹éƒ½ç»´æŠ¤äº†ä¸€ä¸ª GTID é›†åˆï¼Œç”¨æ¥å¯¹åº”â€œè¿™ä¸ªå®ä¾‹æ‰§è¡Œè¿‡çš„æ‰€æœ‰äº‹åŠ¡â€ã€‚\n\n## åŸºäº GTID çš„ä¸»å¤‡åˆ‡æ¢\n\n- change master å‘½ä»¤ï¼š\n  ```sql\nCHANGE MASTER TO \nMASTER_HOST=$host_name \nMASTER_PORT=$port \nMASTER_USER=$user_name \nMASTER_PASSWORD=$password \nmaster_auto_position=1 \n\n\n\nmaster_auto_position=1 è¡¨ç¤ºè¿™ä¸ªä¸»å¤‡å…³ç³»ä½¿ç”¨çš„æ˜¯ GTID åè®®\n\n\nå®ä¾‹ B æ‰§è¡Œ start slave å‘½ä»¤ï¼Œå– binlog é€»è¾‘ï¼š\n\nå»ºç«‹è¿æ¥\nå®ä¾‹ B æŠŠ set_b å‘ç»™ä¸»åº“\nä¸»åº“ç®—å‡ºä¸¤ä¸ª GTID é›†åˆçš„å·®é›†ï¼ˆæ‰€æœ‰å­˜åœ¨äº set_a ä½†ä¸å­˜åœ¨ set_b çš„ GTID é›†åˆï¼‰ï¼Œåˆ¤æ–­æœ¬åœ°æ˜¯å¦åŒ…å«å·®é›†éœ€è¦çš„æ‰€æœ‰ binlog äº‹åŠ¡\na ä¸åŒ…å«ï¼Œç›´æ¥è¿”å›é”™è¯¯\nb ç¡®è®¤å…¨éƒ¨åŒ…å«ï¼Œä» binlog æ‰¾å‡ºç¬¬ä¸€ä¸ªä¸åœ¨ set_b çš„äº‹åŠ¡ï¼Œå‘ç»™ B4. ä»è¿™ä¸ªäº‹åŠ¡å¼€å§‹å¾€åè¯»æ–‡ä»¶ï¼ŒæŒ‰é¡ºåºå– binlog å‘ç»™ B æ‰§è¡Œ\nä¹‹åå°±ä»è¿™ä¸ªäº‹åŠ¡å¼€å§‹ï¼Œå¾€åè¯»æ–‡ä»¶ï¼ŒæŒ‰é¡ºåºå– binlog å‘ç»™ B å»æ‰§è¡Œ\n\n\n\nå–ä½ç‚¹çš„å·¥ä½œç”±ä¸»åº“å†…éƒ¨è‡ªåŠ¨å®Œæˆ\n\n\næ€è€ƒé¢˜ Â§\n\n\nä½ åœ¨ GTID æ¨¡å¼ä¸‹è®¾ç½®ä¸»ä»å…³ç³»çš„æ—¶å€™ï¼Œä»åº“æ‰§è¡Œ start slave å‘½ä»¤åï¼Œä¸»åº“å‘ç°éœ€è¦çš„ binlog å·²ç»è¢«åˆ é™¤æ‰äº†ï¼Œå¯¼è‡´ä¸»å¤‡åˆ›å»ºä¸æˆåŠŸã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä½ è§‰å¾—å¯ä»¥æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ\n\n\n\nå¦‚æœä¸šåŠ¡å…è®¸ä¸»ä»ä¸ä¸€è‡´çš„æƒ…å†µï¼Œé‚£ä¹ˆå¯ä»¥åœ¨ä¸»åº“ä¸Šå…ˆæ‰§è¡Œ show global variables like &#039;gtid_purged&#039;ï¼Œå¾—åˆ°ä¸»åº“å·²ç»åˆ é™¤çš„ GTID é›†åˆï¼Œå‡è®¾æ˜¯ gtid_purged1ï¼›ç„¶åå…ˆåœ¨ä»åº“ä¸Šæ‰§è¡Œ reset masterï¼Œå†æ‰§è¡Œ set global gtid_purged =&#039;gtid_purged1&#039;ï¼›æœ€åæ‰§è¡Œ start slaveï¼Œå°±ä¼šä»ä¸»åº“ç°å­˜çš„ binlog å¼€å§‹åŒæ­¥ã€‚binlog ç¼ºå¤±çš„é‚£ä¸€éƒ¨åˆ†ï¼Œæ•°æ®åœ¨ä»åº“ä¸Šå°±å¯èƒ½ä¼šæœ‰ä¸¢å¤±ï¼Œé€ æˆä¸»ä»ä¸ä¸€è‡´ã€‚\n\n\n\n\nå¦‚æœéœ€è¦ä¸»ä»æ•°æ®ä¸€è‡´çš„è¯ï¼Œæœ€å¥½è¿˜æ˜¯é€šè¿‡é‡æ–°æ­å»ºä»åº“æ¥åšã€‚\n\n\n\n\nå¦‚æœæœ‰å…¶ä»–çš„ä»åº“ä¿ç•™æœ‰å…¨é‡çš„ binlog çš„è¯ï¼Œå¯ä»¥æŠŠæ–°çš„ä»åº“å…ˆæ¥åˆ°è¿™ä¸ªä¿ç•™äº†å…¨é‡ binlog çš„ä»åº“ï¼Œè¿½ä¸Šæ—¥å¿—ä»¥åï¼Œå¦‚æœæœ‰éœ€è¦ï¼Œå†æ¥å›ä¸»åº“ã€‚\n\n\n\n\nå¦‚æœ binlog æœ‰å¤‡ä»½çš„æƒ…å†µï¼Œå¯ä»¥å…ˆåœ¨ä»åº“ä¸Šåº”ç”¨ç¼ºå¤±çš„ binlogï¼Œç„¶åå†æ‰§è¡Œ start slaveã€‚\n\n\n\n\n\nè¯„è®ºåŒº Â§\n\n\nä¸€ä¸»å¤šä»ï¼Œå³ä½¿é‡‡ç”¨åŠåŒæ­¥ï¼Œä¹Ÿåªèƒ½ä¿è¯ binlog è‡³å°‘åœ¨ä¸¤å°æœºå™¨ä¸Šï¼Œæ²¡æœ‰ä¸€ä¸ªæœºåˆ¶èƒ½å¤Ÿé€‰å‡ºæ‹¥æœ‰æœ€å®Œæ•´ binlog çš„ä»åº“ä½œä¸ºæ–°çš„ä¸»åº“ã€‚\n\nç›´æ¥ä½¿ç”¨MHAå·¥å…·ï¼Œåœ¨é…ç½®æ–‡ä»¶é‡Œé¢é€‰æ‹© candidate_masterï¼Œé€‰æ‹©ä½¿ç”¨äº†åŠåŒæ­¥å¤åˆ¶çš„å¤‡åº“å°±è¡Œäº†ã€‚MHA å·¥å…·ä»‹ç»\n\n\n\nå¦‚æœåœ¨ä»åº“ä¸Šæ‰§è¡Œäº†å•ç‹¬çš„æ“ä½œï¼Œå¯¼è‡´ä¸»åº“ä¸Šç¼ºå°‘ GTIDï¼Œé‚£ä¹ˆå¯ä»¥åœ¨ä¸»åº“ä¸Šæ¨¡æ‹Ÿä¸€ä¸ªä¸ä»åº“ B ä¸Š GTID ä¸€æ ·çš„ç©ºäº‹åŠ¡ï¼Œè¿™æ ·ä¸»ä»åŒæ­¥å°±ä¸ä¼šæŠ¥é”™äº†ã€‚\n\n\nåœ¨ Docker ä¸­è·‘ MySQL æ²¡æœ‰é—®é¢˜\n\n\næ…ç”¨ reset masterï¼›ç­‰åŒäºåˆ æ•°æ®\n\n\nMySQL æ˜¯æ€ä¹ˆå¿«é€Ÿå®šä½ binlog é‡Œé¢çš„æŸä¸€ä¸ª GTID ä½ç½®çš„ï¼Ÿbinlog æ–‡ä»¶å¤´éƒ¨çš„ Previous_gtids\n\n\nsql_slave_skip_counter è·³è¿‡çš„æ˜¯ä¸€ä¸ª eventï¼Œç”±äº MySQL æ€»ä¸èƒ½æ‰§è¡Œä¸€åŠçš„äº‹åŠ¡ï¼Œæ‰€ä»¥æ—¢ç„¶è·³è¿‡äº†ä¸€ä¸ª eventï¼Œå°±ä¼šè·³åˆ°è¿™ä¸ªäº‹åŠ¡çš„æœ«å°¾\n\nset global sql_slave_skip_counter=1;start slave å¯ä»¥è·³è¿‡æ•´ä¸ªäº‹åŠ¡ã€‚\n\n\n"},"å­¦ä¹ ç¬”è®°/MySQL-å®æˆ˜-45-è®²/28ï½œè¯»å†™åˆ†ç¦»æœ‰å“ªäº›å‘ï¼Ÿ":{"title":"28ï½œè¯»å†™åˆ†ç¦»æœ‰å“ªäº›å‘ï¼Ÿ","links":[],"tags":["mysql"],"content":"\n\n\n\nå®¢æˆ·ç«¯ç›´è¿\n\n\n\næŸ¥è¯¢æ€§èƒ½ç¨å¾®å¥½ç‚¹ï¼Œæ•´ä½“æ¶æ„ç®€å•ï¼Œæ’æŸ¥é—®é¢˜æ›´æ–¹ä¾¿\nä¸»å¤‡åˆ‡æ¢ã€åº“è¿ç§»ç­‰æ“ä½œæ—¶ï¼Œå®¢æˆ·ç«¯ä¼šæ„ŸçŸ¥åˆ°ï¼Œå¹¶ä¸”éœ€è¦è°ƒæ•´æ•°æ®åº“è¿æ¥ä¿¡æ¯\nä¸€èˆ¬é‡‡ç”¨è¿™æ ·çš„æ¶æ„ï¼Œä¸€å®šä¼šä¼´éšä¸€ä¸ªè´Ÿè´£ç®¡ç†åç«¯çš„ç»„ä»¶ï¼Œæ¯”å¦‚ Zookeeperï¼Œå°½é‡è®©ä¸šåŠ¡ç«¯åªä¸“æ³¨äºä¸šåŠ¡é€»è¾‘å¼€å‘\n\n\n\n\n\nå¸¦ proxy çš„æ¶æ„\n\n\n\nå¯¹å®¢æˆ·ç«¯å‹å¥½ï¼Œè¿æ¥ç»´æŠ¤ã€åç«¯ä¿¡æ¯ç­‰å·¥ä½œéƒ½ç”± proxy å®Œæˆ\nå¯¹åç«¯ç»´æŠ¤å›¢é˜Ÿçš„è¦æ±‚æ›´é«˜ï¼Œéœ€è¦é«˜å¯ç”¨ï¼Œæ•´ä½“æ¶æ„æ¯”è¾ƒå¤æ‚\n\n\n\nè¿‡æœŸè¯»ï¼šåœ¨ä»åº“ä¸Šä¼šè¯»åˆ°ç³»ç»Ÿçš„ä¸€ä¸ªè¿‡æœŸçŠ¶æ€\n\n\nå¼ºåˆ¶èµ°ä¸»åº“æ–¹æ¡ˆ\n\n\n\nå¯¹äºå¿…é¡»è¦æ‹¿åˆ°æœ€æ–°ç»“æœçš„è¯·æ±‚ï¼Œå¼ºåˆ¶å°†å…¶å‘åˆ°ä¸»åº“ä¸Š\n\n\n\n\nå¯¹äºå¯ä»¥è¯»åˆ°æ—§æ•°æ®çš„è¯·æ±‚ï¼Œæ‰å°†å…¶å‘åˆ°ä»åº“ä¸Š\n\n\n\n\n\nsleep æ–¹æ¡ˆ\n\nä¸ç²¾ç¡®\n\n\n\nåˆ¤æ–­ä¸»å¤‡æ— å»¶è¿Ÿæ–¹æ¡ˆ\n\n\nä¸‰ç§æ–¹æ³•\n\n\n\n\næ¯æ¬¡ä»åº“æ‰§è¡ŒæŸ¥è¯¢è¯·æ±‚å‰ï¼Œå…ˆåˆ¤æ–­ seconds_behind_master æ˜¯å¦å·²ç»ç­‰äº 0ã€‚å¦‚æœè¿˜ä¸ç­‰äº 0 ï¼Œé‚£å°±å¿…é¡»ç­‰åˆ°è¿™ä¸ªå‚æ•°å˜ä¸º 0 æ‰èƒ½æ‰§è¡ŒæŸ¥è¯¢è¯·æ±‚ã€‚\n\n\n\nseconds_behind_master çš„å•ä½æ˜¯ç§’ï¼Œå¯èƒ½ç²¾åº¦ä¸å¤Ÿ\n\n\n\n\n\nå¯¹æ¯”ä½ç‚¹\n\n\n\nMaster_Log_File å’Œ Read_Master_Log_Posï¼Œè¡¨ç¤ºçš„æ˜¯è¯»åˆ°çš„ä¸»åº“çš„æœ€æ–°ä½ç‚¹ï¼›Relay_Master_Log_File å’Œ Exec_Master_Log_Posï¼Œè¡¨ç¤ºçš„æ˜¯å¤‡åº“æ‰§è¡Œçš„æœ€æ–°ä½ç‚¹ã€‚å¦‚æœMaster_Log_File å’Œ Relay_Master_Log_Fileã€Read_Master_Log_Pos å’Œ Exec_Master_Log_Posè¿™ä¸¤ç»„å€¼å®Œå…¨ç›¸åŒï¼Œå°±è¡¨ç¤ºæ¥æ”¶åˆ°çš„æ—¥å¿—å·²ç»åŒæ­¥å®Œæˆã€‚\n\n\n\n\n\nå¯¹æ¯”GTID é›†åˆ\n\n\n\nAuto_Position=1 ï¼Œè¡¨ç¤ºè¿™å¯¹ä¸»å¤‡å…³ç³»ä½¿ç”¨äº† GTID åè®®ã€‚Retrieved_Gtid_Setï¼Œæ˜¯å¤‡åº“æ”¶åˆ°çš„æ‰€æœ‰æ—¥å¿—çš„ GTID é›†åˆï¼›Executed_Gtid_Setï¼Œæ˜¯å¤‡åº“æ‰€æœ‰å·²ç»æ‰§è¡Œå®Œæˆçš„ GTID é›†åˆã€‚å¦‚æœè¿™ä¸¤ä¸ªé›†åˆç›¸åŒï¼Œä¹Ÿè¡¨ç¤ºå¤‡åº“æ¥æ”¶åˆ°çš„æ—¥å¿—éƒ½å·²ç»åŒæ­¥å®Œæˆã€‚\n\n\n\nåä¸¤ç§å‡†ç¡®åº¦æ›´é«˜ï¼Œä½†è¿˜ä¸å¤Ÿ\n\nå¯èƒ½è¿˜æœ‰ä¸€éƒ¨åˆ†æ—¥å¿—ï¼Œå¤„äºå®¢æˆ·ç«¯å·²ç»æ”¶åˆ°æäº¤ç¡®è®¤ï¼Œè€Œå¤‡åº“è¿˜æ²¡æ”¶åˆ°æ—¥å¿—çš„çŠ¶æ€ã€‚\n\n\n\n\n\n\n\n\n\né…åˆ semi-syncï¼ˆåŠåŒæ­¥å¤åˆ¶ï¼‰\b æ–¹æ¡ˆ\n\n\nsemi-sync çš„è®¾è®¡\n\n\n\näº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œä¸»åº“æŠŠ binlog å‘ç»™ä»åº“ï¼›\n\n\n\n\nä»åº“æ”¶åˆ° binlog ä»¥åï¼Œå‘å›ç»™ä¸»åº“ä¸€ä¸ª ackï¼Œè¡¨ç¤ºæ”¶åˆ°äº†ï¼›\n\n\n3ã€‚ ä¸»åº“æ”¶åˆ°è¿™ä¸ª ack ä»¥åï¼Œæ‰èƒ½ç»™å®¢æˆ·ç«¯è¿”å›â€œäº‹åŠ¡å®Œæˆâ€çš„ç¡®è®¤ã€‚\n\n\n\nå¦‚æœå¯ç”¨äº† semi-syncï¼Œå°±è¡¨ç¤ºæ‰€æœ‰ç»™å®¢æˆ·ç«¯å‘é€è¿‡ç¡®è®¤çš„äº‹åŠ¡ï¼Œéƒ½ç¡®ä¿äº†å¤‡åº“å·²ç»æ”¶åˆ°äº†è¿™ä¸ªæ—¥å¿—ã€‚\n\n\nå­˜åœ¨é—®é¢˜\n\n\n\n\nä¸€ä¸»å¤šä»çš„æ—¶å€™ï¼Œåœ¨æŸäº›ä»åº“æ‰§è¡ŒæŸ¥è¯¢è¯·æ±‚ä¼šå­˜åœ¨è¿‡æœŸè¯»çš„ç°è±¡ï¼›\n\n\n\nä¸»åº“åªè¦ç­‰åˆ°ä¸€ä¸ªä»åº“çš„ ackï¼Œå°±å¼€å§‹ç»™å®¢æˆ·ç«¯è¿”å›ç¡®è®¤\n\n\n\n\n\nåœ¨æŒç»­å»¶è¿Ÿçš„æƒ…å†µä¸‹ï¼Œå¯èƒ½å‡ºç°è¿‡åº¦ç­‰å¾…çš„é—®é¢˜ã€‚\n\n\n\nå¦‚æœåœ¨ä¸šåŠ¡æ›´æ–°çš„é«˜å³°æœŸï¼Œä¸»åº“çš„ä½ç‚¹æˆ–è€… GTID é›†åˆæ›´æ–°å¾ˆå¿«ï¼Œé‚£ä¹ˆä¸Šé¢çš„ä¸¤ä¸ªä½ç‚¹ç­‰å€¼åˆ¤æ–­å°±ä¼šä¸€ç›´ä¸æˆç«‹ï¼Œå¾ˆå¯èƒ½å‡ºç°ä»åº“ä¸Šè¿Ÿè¿Ÿæ— æ³•å“åº”æŸ¥è¯¢è¯·æ±‚çš„æƒ…å†µã€‚\n\n\n\n\n\n\n\nç­‰ä¸»åº“ä½ç‚¹æ–¹æ¡ˆ\n\n\nä¸»å¤‡æŒç»­å»¶è¿Ÿä¸€ä¸ªäº‹åŠ¡\n\n\n\n\n\n\ntrx1 äº‹åŠ¡æ›´æ–°å®Œæˆåï¼Œå®¢æˆ·ç«¯é©¬ä¸Šæ‰§è¡Œ show master status å¾—åˆ°å½“å‰ä¸»åº“æ‰§è¡Œåˆ°çš„ File å’Œ Positionï¼›\n\n\n\n\né€‰å®šä¸€ä¸ªä»åº“æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼›\n\n\n\n\n\nåœ¨ä»åº“ä¸Šæ‰§è¡Œ select master_pos_wait(File, Position, 1)ï¼›\n\n\n\na. å‚æ•° file å’Œ pos æŒ‡çš„æ˜¯ä¸»åº“ä¸Šçš„æ–‡ä»¶åå’Œä½ç½®ï¼›\nb. timeout å¯é€‰ï¼Œè®¾ç½®ä¸ºæ­£æ•´æ•° N è¡¨ç¤ºè¿™ä¸ªå‡½æ•°æœ€å¤šç­‰å¾… N ç§’ã€‚\nè¿™ä¸ªå‘½ä»¤æ­£å¸¸è¿”å›çš„ç»“æœæ˜¯ä¸€ä¸ªæ­£æ•´æ•° Mï¼Œè¡¨ç¤ºä»å‘½ä»¤å¼€å§‹æ‰§è¡Œï¼Œåˆ°åº”ç”¨å®Œ file å’Œ pos è¡¨ç¤ºçš„ binlog ä½ç½®ï¼Œæ‰§è¡Œäº†å¤šå°‘äº‹åŠ¡ã€‚ç­‰äº 0ï¼šä»£è¡¨è¿™ä¸ª file å’Œ postion å·²ç»æ‰§è¡Œè¿‡ï¼›å¤§äº 0ï¼šä»£è¡¨åœ¨æ—¶é—´å†…å·²ç»æ‰§è¡Œåˆ°è¿™ä¸ª file å’Œ positionï¼Œå¹¶ä¸”å·²ç»æ‰§è¡Œäº† n æ¡äº‹åŠ¡ã€‚\n\n\n\n\nå¦‚æœè¿”å›å€¼æ˜¯ &gt;=0 çš„æ­£æ•´æ•°ï¼Œåˆ™åœ¨è¿™ä¸ªä»åº“æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼›\n\n\n\n\nå¦åˆ™ï¼Œåˆ°ä¸»åº“æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ã€‚\n\n\n\n\n\nç­‰ GTID æ–¹æ¡ˆ\n\n\n\n= MySQL 5.7.6\n\n\n\nselect wait_for_executed_gtid_set(gtid_set, 1);\n\n\n\nç­‰å¾…ï¼Œç›´åˆ°è¿™ä¸ªåº“æ‰§è¡Œçš„äº‹åŠ¡ä¸­åŒ…å«ä¼ å…¥çš„ gtid_setï¼Œè¿”å› 0ï¼›\n\n\n\n\nè¶…æ—¶è¿”å› 1ã€‚\n\n\n\n\n\n\n\ntrx1 äº‹åŠ¡æ›´æ–°å®Œæˆåï¼Œä»è¿”å›åŒ…ç›´æ¥è·å–è¿™ä¸ªäº‹åŠ¡çš„ GTIDï¼Œè®°ä¸º gtid1ï¼›\n\n\n\nå°†å‚æ•° session_track_gtids è®¾ç½®ä¸º OWN_GTIDï¼Œç„¶åé€šè¿‡ API æ¥å£ mysql_session_track_get_first ä»è¿”å›åŒ…è§£æå‡º GTID çš„å€¼ã€‚\n\n\n\n\né€‰å®šä¸€ä¸ªä»åº“æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼›\n\n\n\n\nåœ¨ä»åº“ä¸Šæ‰§è¡Œ select wait_for_executed_gtid_set(gtid1, 1)ï¼›\n\n\n\n\nå¦‚æœè¿”å›å€¼æ˜¯ 0ï¼Œåˆ™åœ¨è¿™ä¸ªä»åº“æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼›\n\n\n\n\nå¦åˆ™ï¼Œåˆ°ä¸»åº“æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ã€‚\n\n\n\n\n\næ–¹æ¡ˆå¯ä»¥æ··åˆä½¿ç”¨\n\n\næ€è€ƒé¢˜\n\n\nå‡è®¾ä½ çš„ç³»ç»Ÿé‡‡ç”¨äº†æˆ‘ä»¬æ–‡ä¸­ä»‹ç»çš„æœ€åä¸€ä¸ªæ–¹æ¡ˆï¼Œä¹Ÿå°±æ˜¯ç­‰ GTID çš„æ–¹æ¡ˆï¼Œç°åœ¨ä½ è¦å¯¹ä¸»åº“çš„ä¸€å¼ å¤§è¡¨åš DDLï¼ˆåŠ å‡ç´¢å¼•ã€å¢åŠ å­—æ®µåœ¨æœ€åä¸€åˆ—ï¼‰ï¼Œå¯èƒ½ä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿ\n\nå‡è®¾ï¼Œè¿™æ¡è¯­å¥åœ¨ä¸»åº“ä¸Šè¦æ‰§è¡Œ 10 åˆ†é’Ÿï¼Œæäº¤åä¼ åˆ°å¤‡åº“å°±è¦ 10 åˆ†é’Ÿï¼ˆå…¸å‹çš„å¤§äº‹åŠ¡ï¼‰ã€‚é‚£ä¹ˆï¼Œåœ¨ä¸»åº“ DDL ä¹‹åå†æäº¤çš„äº‹åŠ¡çš„ GTIDï¼Œå»å¤‡åº“æŸ¥çš„æ—¶å€™ï¼Œå°±ä¼šç­‰ 10 åˆ†é’Ÿæ‰å‡ºç°ã€‚\nè¿™æ ·ï¼Œè¿™ä¸ªè¯»å†™åˆ†ç¦»æœºåˆ¶åœ¨è¿™ 10 åˆ†é’Ÿä¹‹å†…éƒ½ä¼šè¶…æ—¶ï¼Œç„¶åèµ°ä¸»åº“ã€‚\n\n\n\nä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œä½ ä¼šæ€ä¹ˆåšå‘¢ï¼Ÿ\n\nè¿™ç§é¢„æœŸå†…çš„æ“ä½œï¼Œåº”è¯¥åœ¨ä¸šåŠ¡ä½å³°æœŸçš„æ—¶å€™ï¼Œç¡®ä¿ä¸»åº“èƒ½å¤Ÿæ”¯æŒæ‰€æœ‰ä¸šåŠ¡æŸ¥è¯¢ã€‚ç„¶åæŠŠè¯»è¯·æ±‚éƒ½åˆ‡åˆ°ä¸»åº“ï¼Œå†åœ¨ä¸»åº“ä¸Šåš DDLã€‚ç­‰å¤‡åº“å»¶è¿Ÿè¿½ä¸Šä»¥åï¼Œå†æŠŠè¯»è¯·æ±‚åˆ‡å›å¤‡åº“ã€‚\n\n\n\n\n"},"å­¦ä¹ ç¬”è®°/MySQL-å®æˆ˜-45-è®²/29ï½œå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªæ•°æ®åº“æ˜¯ä¸æ˜¯å‡ºé—®é¢˜äº†ï¼Ÿ":{"title":"29ï½œå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªæ•°æ®åº“æ˜¯ä¸æ˜¯å‡ºé—®é¢˜äº†ï¼Ÿ","links":[],"tags":["mysql"],"content":"\n\nselect 1 åˆ¤æ–­\n\nselect 1 è¿™æ ·çš„æ–¹æ³•æ˜¯ä¸æ˜¯å·²ç»è¢«æ·˜æ±°äº†å‘¢ï¼Œä½†å®é™…ä¸Šä½¿ç”¨éå¸¸å¹¿æ³›çš„ MHAï¼ˆMaster High Availabilityï¼‰ï¼Œé»˜è®¤ä½¿ç”¨çš„å°±æ˜¯è¿™ä¸ªæ–¹æ³•ã€‚\nåªèƒ½è¯´æ˜è¿™ä¸ªåº“çš„è¿›ç¨‹è¿˜åœ¨ï¼Œä¸èƒ½è¯´æ˜ä¸»åº“æ²¡é—®é¢˜\nmysqladmin ping æœºåˆ¶ä¹Ÿå±äºåŒä¸€ç±»\n\n\n\nå»ºè®®æŠŠ innodb_thread_concurrency è®¾ç½®ä¸º 64~128 ä¹‹é—´çš„å€¼\n\nè¾¾åˆ°ä¸Šé™æ—¶ï¼Œselect 1 èƒ½æ­£å¸¸è¿”å›\næ§åˆ¶ InnoDB çš„å¹¶å‘çº¿ç¨‹ä¸Šé™ã€‚\nä¸€æ—¦å¹¶å‘çº¿ç¨‹æ•°è¾¾åˆ°è¿™ä¸ªå€¼ï¼ŒInnoDB åœ¨æ¥æ”¶åˆ°æ–°è¯·æ±‚çš„æ—¶å€™ï¼Œå°±ä¼šè¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°æœ‰çº¿ç¨‹é€€å‡ºã€‚\nå¹¶å‘è¿æ¥ï¼šè¾¾åˆ°å‡ åƒä¸ªå½±å“ä¸å¤§ï¼Œå å†…å­˜è€Œå·²\nå¹¶å‘æŸ¥è¯¢ï¼šCPU æ€æ‰‹\nåœ¨çº¿ç¨‹è¿›å…¥é”ç­‰å¾…ä»¥åï¼Œå¹¶å‘çº¿ç¨‹çš„è®¡æ•°ä¼šå‡ä¸€\n\n\n\næŸ¥è¡¨åˆ¤æ–­\n\nä¸€èˆ¬çš„åšæ³•æ˜¯ï¼Œåœ¨ç³»ç»Ÿåº“ï¼ˆmysql åº“ï¼‰é‡Œåˆ›å»ºä¸€ä¸ªè¡¨ï¼Œæ¯”å¦‚å‘½åä¸º health_checkï¼Œé‡Œé¢åªæ”¾ä¸€è¡Œæ•°æ®ï¼Œç„¶åå®šæœŸæ‰§è¡Œï¼šmysql&gt; select * from mysql.health_check;Â \nç©ºé—´æ»¡äº†ä¹‹åï¼Œæ­¤æ–¹æ³•å¤±æ•ˆï¼Œå› ä¸ºç³»ç»Ÿè¿˜æ˜¯å¯ä»¥æ­£å¸¸è¯»æ•°æ®çš„\n\n\n\næ›´æ–°åˆ¤æ–­\n\n\nå¸¸è§åšæ³•æ˜¯æ”¾ä¸€ä¸ª timestamp å­—æ®µï¼Œç”¨æ¥è¡¨ç¤ºæœ€åä¸€æ¬¡æ‰§è¡Œæ£€æµ‹çš„æ—¶é—´ã€‚è¿™æ¡æ›´æ–°è¯­å¥ç±»ä¼¼äºï¼šmysql&gt; update mysql.health_check set t_modified=now();\n\nä½†æ˜¯ä¸»å¤‡ä¸‹ä¼šå‡ºç°è¡Œå†²çªï¼ˆå¯¼è‡´ä¸»å¤‡åŒæ­¥åœæ­¢ï¼‰\n\n\n\nä¸ºäº†è®©ä¸»å¤‡ä¹‹é—´çš„æ›´æ–°ä¸äº§ç”Ÿå†²çªï¼Œå¯ä»¥åœ¨ mysql.health_check è¡¨ä¸Šå­˜å…¥å¤šè¡Œæ•°æ®ï¼Œå¹¶ç”¨ Aã€B çš„ server_id åšä¸»é”®ã€‚è¡¨ health_checkï¼ˆidï¼Œt_modifiedï¼‰/* æ£€æµ‹å‘½ä»¤ */insert into mysql.health_check(id, t_modified) values (@@server_id, now()) on duplicate key update t_modified=now();\n\n\næ­¤æ–¹æ¡ˆè¿˜ä¼šåˆåˆ¤æ–­æ…¢çš„é—®é¢˜\n\næ£€æµ‹å‘½ä»¤éœ€è¦çš„èµ„æºå°‘ï¼Œå¯èƒ½ç³»ç»Ÿå·²ç»è´Ÿè½½ä¸¥é‡ï¼Œä½†æ˜¯æ£€æµ‹è¿˜æ˜¯èƒ½åœ¨è¶…æ—¶å‰æ­£å¸¸è¿”å›\n\n\n\n\n\nä¸Šé¢çš„éƒ½æ˜¯å¤–éƒ¨æ£€æµ‹\n\n\nå†…éƒ¨ç»Ÿè®¡\n\n\nMySQL 5.6 ç‰ˆæœ¬ä»¥åæä¾›çš„ performance_schema åº“ï¼Œå°±åœ¨ file_summary_by_event_name è¡¨é‡Œç»Ÿè®¡äº†æ¯æ¬¡ IO è¯·æ±‚çš„æ—¶é—´ã€‚\n\n\næ‰“å¼€æ‰€æœ‰çš„ performance_schema é¡¹ï¼Œæ€§èƒ½ä¼šä¸‹é™ 10% å·¦å³ã€‚\n\n\næ‰“å¼€ redo log çš„æ—¶é—´ç›‘æ§\n\nmysql&gt; update setup_instruments set ENABLED=â€˜YESâ€™, Timed=â€˜YESâ€™ where name like â€˜%wait/io/file/innodb/innodb_log_file%â€˜;\n\n\n\næ£€æµ‹æ–¹æ³•\n\n\n\nå‡è®¾å•æ¬¡ IO è¯·æ±‚æ—¶é—´è¶…è¿‡ 200 æ¯«ç§’å±äºå¼‚å¸¸\n\n\n\n\n/* æ£€æµ‹ /mysql&gt; select event_name,MAX_TIMER_WAIT FROM performance_schema.file_summary_by_event_name where event_name in (â€˜wait/io/file/innodb/innodb_log_fileâ€™,â€˜wait/io/file/sql/binlogâ€™) and MAX_TIMER_WAIT&gt;2001000000000;\n\n\n\n\n/* æ¸…ç©ºä¹‹å‰çš„ç»Ÿè®¡ä¿¡æ¯ */mysql&gt; truncate table performance_schema.file_summary_by_event_name;\n\n\n\n\n\n\n\nä¼˜å…ˆè€ƒè™‘ update ç³»ç»Ÿè¡¨ï¼Œç„¶åå†é…åˆå¢åŠ æ£€æµ‹ performance_schema çš„ä¿¡æ¯ã€‚\n\n\nè¯„è®ºåŒº\n\n\næ€ä¹ˆä¹‹å‰é‡åˆ°ç©ºé—´æ»¡äº†ï¼Œæ•°æ®åº“éƒ½ç™»ä¸ä¸Šäº†ï¼Œæ‰€æœ‰çš„è¿æ¥éƒ½è¿ä¸ä¸Šï¼Œæ›´ä¸ç”¨æ‰§è¡Œ select è¯­å¥äº†\n\nç©ºé—´æ»¡æœ¬èº«æ˜¯ä¸ä¼šå¯¼è‡´è¿ä¸ä¸Šçš„ã€‚\nä½†æ˜¯å› ä¸ºç©ºé—´æ»¡ï¼Œäº‹åŠ¡æ— æ³•æäº¤ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ¥ä¸‹æ¥å¤–éƒ¨äº‹åŠ¡é‡è¯•ï¼Œæ–°é‡è¯•çš„ä¸šåŠ¡è¿˜æ˜¯å µåœ¨æäº¤é˜¶æ®µï¼ŒæŒç»­ç´¯ç§¯å¯èƒ½ä¼šæŠŠè¿æ¥æ•°ç”¨æ»¡\n\n\n\nå¤–éƒ¨æ£€æµ‹ï¼šæ£€æµ‹æ—¶é—´ç‚¹çš„ä¿¡æ¯å†…éƒ¨ç»Ÿè®¡ï¼šå–åˆ°çš„æ˜¯ä¸€æ®µæ—¶é—´å†…çš„ä¿¡æ¯\n\n\nDDLï¼šä¸€èˆ¬æ˜¯æŒ‡åŠ å‡ç´¢å¼•ã€å¢åŠ å­—æ®µåœ¨æœ€åä¸€åˆ—\n\n\ndrop åˆ—æ˜¯å¾ˆéº»çƒ¦çš„ï¼Œå°½é‡ä¸åšã€‚ä¸šåŠ¡ä»£ç ç›´æ¥æ— è§†è¿™ä¸ªåˆ—å°±å¥½äº†\n\n\n\n"},"å­¦ä¹ ç¬”è®°/MySQL-å®æˆ˜-45-è®²/30ï½œç­”ç–‘æ–‡ç« ï¼ˆäºŒï¼‰ï¼šç”¨åŠ¨æ€çš„è§‚ç‚¹çœ‹åŠ é”":{"title":"30ï½œç­”ç–‘æ–‡ç« ï¼ˆäºŒï¼‰ï¼šç”¨åŠ¨æ€çš„è§‚ç‚¹çœ‹åŠ é”","links":[],"tags":["mysql"],"content":"\n\nCREATE TABLE t (Â  id int(11) NOT NULL,Â  c int(11) DEFAULT NULL,Â  d int(11) DEFAULT NULL,Â  PRIMARY KEY (id),Â  KEY c (c)) ENGINE=InnoDB;insert into t values(0,0,0),(5,5,5),(10,10,10),(15,15,15),(20,20,20),(25,25,25);\n\n\nä¸ç­‰å·æ¡ä»¶é‡Œçš„ç­‰å€¼æŸ¥è¯¢\n\n\né€šè¿‡æ ‘æœç´¢çš„æ–¹å¼å®šä½è®°å½•çš„æ—¶å€™ï¼Œç”¨çš„æ˜¯â€œç­‰å€¼æŸ¥è¯¢â€çš„æ–¹æ³•\n\n\nshow engine innodb status å‘½ä»¤è¾“å‡ºçš„ä¿¡æ¯ä¸­å›½å‘¢ï¼ŒLATESTADETECTED DEADLOCK è®°å½•äº†æœ€åä¸€æ¬¡æ­»é”ä¿¡æ¯\n\n\n\n\n\n\nç”±äºé”æ˜¯ä¸€ä¸ªä¸ªåŠ çš„ï¼Œè¦é¿å…æ­»é”ï¼Œå¯¹åŒä¸€ç»„èµ„æºï¼Œè¦æŒ‰ç…§å°½é‡ç›¸åŒçš„é¡ºåºè®¿é—®ï¼›\n\n\n\n\nåœ¨å‘ç”Ÿæ­»é”çš„æ—¶åˆ»ï¼Œfor update è¿™æ¡è¯­å¥å æœ‰çš„èµ„æºæ›´å¤šï¼Œå›æ»šæˆæœ¬æ›´å¤§ï¼Œæ‰€ä»¥ InnoDB é€‰æ‹©äº†å›æ»šæˆæœ¬æ›´å°çš„ lock in share mode è¯­å¥ï¼Œæ¥å›æ»šã€‚\n\n\n\næ‰€è°“â€œé—´éš™â€ï¼Œå…¶å®æ ¹æœ¬å°±æ˜¯ç”±â€œè¿™ä¸ªé—´éš™å³è¾¹çš„é‚£ä¸ªè®°å½•â€å®šä¹‰çš„ã€‚\n\n\næ€è€ƒé¢˜\n\n\nç©ºè¡¨çš„é—´éš™çš„å®šä¹‰\n\nä¸€ä¸ªç©ºè¡¨åªæœ‰ä¸€ä¸ªé—´éš™æ¯”å¦‚æ‰§è¡Œï¼šbegin; select * from t where id&gt;1 for update;åŠ é”èŒƒå›´ï¼šnext_key lock (-âˆ, supremum]\n\n\n\n\n\nè¯„è®ºåŒº\n\nåˆ é™¤æ•°æ®ï¼Œå¯¼è‡´é”æ‰©å¤§çš„æè¿°ï¼šâ€œå› æ­¤ï¼Œæˆ‘ä»¬å°±çŸ¥é“äº†ï¼Œç”±äº delete æ“ä½œæŠŠ id=10 è¿™ä¸€è¡Œåˆ æ‰äº†ï¼ŒåŸæ¥çš„ä¸¤ä¸ªé—´éš™ (5,10)ã€(10,15ï¼‰å˜æˆäº†ä¸€ä¸ª (5,15)ã€‚â€æˆ‘è§‰å¾—è¿™ä¸ªæåˆ°çš„(5, 10) å’Œ (10, 15)ä¸¤ä¸ªé—´éš™ä¼šè®©äººæœ‰ç‚¹è¯¯è§£ï¼Œå®é™…ä¸Šåœ¨åˆ é™¤ä¹‹å‰é—´éš™é”åªæœ‰ä¸€ä¸ª(10, 15)ï¼Œåˆ é™¤äº†æ•°æ®ä¹‹åï¼Œå¯¼è‡´é—´éš™é”å·¦ä¾§æ‰©å¼ æˆäº†5ï¼Œé—´éš™é”æˆä¸ºäº†(5, 15)ã€‚\n\n\n"},"å­¦ä¹ ç¬”è®°/MySQL-å®æˆ˜-45-è®²/31ï½œè¯¯åˆ æ•°æ®åé™¤äº†è·‘è·¯ï¼Œè¿˜èƒ½æ€ä¹ˆåŠï¼Ÿ":{"title":"31ï½œè¯¯åˆ æ•°æ®åé™¤äº†è·‘è·¯ï¼Œè¿˜èƒ½æ€ä¹ˆåŠï¼Ÿ","links":[],"tags":["mysql"],"content":"\n\n\nä½¿ç”¨ delete è¯­å¥è¯¯åˆ æ•°æ®è¡Œï¼›\n\n\n\n\nä½¿ç”¨ drop table æˆ–è€… truncate table è¯­å¥è¯¯åˆ æ•°æ®è¡¨ï¼›\n\n\n\n\nä½¿ç”¨ drop database è¯­å¥è¯¯åˆ æ•°æ®åº“ï¼›\n\n\n\n\nä½¿ç”¨ rm å‘½ä»¤è¯¯åˆ æ•´ä¸ª MySQL å®ä¾‹ã€‚\n\n\n\nè¯¯åˆ è¡Œ\n\n\næ¢å¤æ•°æ®æ¯”è¾ƒå®‰å…¨çš„åšæ³•ï¼Œæ˜¯æ¢å¤å‡ºä¸€ä¸ªå¤‡ä»½ï¼Œæˆ–è€…æ‰¾ä¸€ä¸ªä»åº“ä½œä¸ºä¸´æ—¶åº“ï¼Œåœ¨è¿™ä¸ªä¸´æ—¶åº“ä¸Šæ‰§è¡Œè¿™äº›æ“ä½œï¼Œç„¶åå†å°†ç¡®è®¤è¿‡çš„ä¸´æ—¶åº“çš„æ•°æ®ï¼Œæ¢å¤å›ä¸»åº“ã€‚\n\n\né¢„é˜²\n\n\n\næŠŠ sql_safe_updates å‚æ•°è®¾ç½®ä¸º onã€‚è¿™æ ·ä¸€æ¥ï¼Œå¦‚æœæˆ‘ä»¬å¿˜è®°åœ¨ delete æˆ–è€… update è¯­å¥ä¸­å†™ where æ¡ä»¶ï¼Œæˆ–è€… where æ¡ä»¶é‡Œé¢æ²¡æœ‰åŒ…å«ç´¢å¼•å­—æ®µçš„è¯ï¼Œè¿™æ¡è¯­å¥çš„æ‰§è¡Œå°±ä¼šæŠ¥é”™ã€‚\n\n\n\n\nä»£ç ä¸Šçº¿å‰ï¼Œå¿…é¡»ç»è¿‡ SQL å®¡è®¡ã€‚\n\n\n\n\n\ndelete å…¨è¡¨å¾ˆæ…¢ï¼Œåº”è¯¥ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨ truncate table æˆ–è€… drop table å‘½ä»¤\n\n\n\n\nè¯¯åˆ åº“ / è¡¨\n\n\nå³ä½¿é…ç½®äº† binlog_format=rowï¼Œè®°å½•çš„è¿˜æ˜¯ statement æ ¼å¼ï¼Œbinlog åªæœ‰ä¸€ä¸ª truncate/drop è¯­å¥ï¼Œä¸è¶³ä»¥æ¢å¤æ•°æ®\n\n\næ¢å¤æ–¹æ³•ï¼šä½¿ç”¨å…¨é‡å¤‡ä»½ + å¢é‡æ—¥å¿—çš„æ–¹å¼\n\n\n\nåŠ é€Ÿæ•°æ®æ¢å¤ï¼šä½¿ç”¨ mysqlbinlog å‘½ä»¤æ—¶åŠ ä¸Š -database å‚æ•°æŒ‡å®šè¯¯åˆ è¡¨æ‰€åœ¨çš„åº“\n\n\n\n\n\nåº”ç”¨æ—¥å¿—æ—¶è·³è¿‡è¯¯æ“ä½œçš„è¯­å¥çš„ binlog\n\n\n\n\n\nå¦‚æœåŸå®ä¾‹æ²¡æœ‰ä½¿ç”¨ GTID æ¨¡å¼ï¼Œåªèƒ½åœ¨åº”ç”¨åˆ°åŒ…å«é”™è¯¯è¯­å¥çš„ binlog æ–‡ä»¶æ—¶ï¼Œå…ˆç”¨ -stop-position å‚æ•°æ‰§è¡Œåˆ°è¯¯æ“ä½œä¹‹å‰çš„æ—¥å¿—ï¼Œå†ç”¨ -start-position ä»è¯¯æ“ä½œä¹‹åçš„æ—¥å¿—ç»§ç»­æ‰§è¡Œ\n\n\n\n\nå¦‚æœå®ä¾‹ä½¿ç”¨äº† GTID æ¨¡å¼ï¼Œå‡è®¾è¯¯æ“ä½œå‘½ä»¤çš„ GTID æ—¶ gtid1ï¼Œæ‰§è¡Œ set gtid_next=gtid1; begin; commit; æŠŠè¿™ä¸ª GTID åŠ åˆ°ä¸´æ—¶å®ä¾‹çš„ GTID é›†åˆï¼Œä¹‹åé¡ºåºæ‰§è¡Œ binlog çš„æ—¶å€™ä¼šè‡ªåŠ¨è·³è¿‡è¯¯æ“ä½œçš„è¯­å¥\n\n\n\n\n\nä¸Šè¿°ä½¿ç”¨ mysqlbinlog æ–¹æ³•æ¢å¤æ•°æ®ä¸å¤Ÿå¿«\n\n\n\nmysqlbinlog ä¸èƒ½æŒ‡å®šåªè§£æä¸€ä¸ªè¡¨çš„æ—¥å¿—\n\n\n\n\nå•çº¿ç¨‹\n\n\n\n\n\nåŠ é€Ÿæ–¹æ³•ä¹‹ä¸€ï¼šåœ¨ç”¨å¤‡ä»½æ¢å¤å‡ºä¸´æ—¶å®ä¾‹ä¹‹åï¼ŒæŠŠå®ä¾‹è®¾ç½®æˆçº¿ä¸Šå¤‡åº“çš„ä»åº“\n\n\n\nåœ¨ start slave ä¹‹å‰ï¼Œå…ˆé€šè¿‡æ‰§è¡Œchange replication filter replicate_do_table = (tbl_name) å‘½ä»¤ï¼Œå°±å¯ä»¥è®©ä¸´æ—¶åº“åªåŒæ­¥è¯¯æ“ä½œçš„è¡¨ï¼›\n\n\n\n\nè¿™æ ·åšä¹Ÿå¯ä»¥ç”¨ä¸Šå¹¶è¡Œå¤åˆ¶æŠ€æœ¯ï¼Œæ¥åŠ é€Ÿæ•´ä¸ªæ•°æ®æ¢å¤è¿‡ç¨‹ã€‚\n\n\nå¦‚æœå¤‡åº“ä¸Šæ²¡æœ‰æ—¥å¿—çš„è¯ï¼Œä»å¤‡ä»½ä¸­ä¸‹è½½æ¢å¤\n\n\n\n\n\n\n\nå»ºè®®æŠŠä¸Šè¿°æ¢å¤åŠŸèƒ½åšæˆè‡ªåŠ¨åŒ–å·¥å…·ï¼Œå¹¶ä¸”ç»å¸¸æ‹¿å‡ºæ¥æ¼”ç»ƒ\n\n\n\n\nå»¶è¿Ÿå¤åˆ¶å¤‡åº“\n\nMySQL 5.6 å¼•å…¥\nå»¶è¿Ÿå¤åˆ¶çš„å¤‡åº“æ˜¯ä¸€ç§ç‰¹æ®Šçš„å¤‡åº“ï¼Œé€šè¿‡ CHANGE MASTER TO MASTER_DELAY = N å‘½ä»¤ï¼Œå¯ä»¥æŒ‡å®šè¿™ä¸ªå¤‡åº“æŒç»­ä¿æŒè·Ÿä¸»åº“æœ‰ N ç§’çš„å»¶è¿Ÿã€‚\nå¤‡åº“ä¸Šæ‰§è¡Œ stop slaveï¼Œå†é€šè¿‡ä¹‹å‰ä»‹ç»çš„æ–¹æ³•ï¼Œè·³è¿‡è¯¯æ“ä½œå‘½ä»¤ï¼Œå°±å¯ä»¥æ¢å¤å‡ºéœ€è¦çš„æ•°æ®ã€‚\néšæ—¶å¯ä»¥å¾—åˆ°ä¸€ä¸ªï¼Œåªéœ€è¦æœ€å¤šå†è¿½ n ç§’ï¼Œå°±å¯ä»¥æ¢å¤å‡ºæ•°æ®çš„ä¸´æ—¶å®ä¾‹ï¼Œä¹Ÿå°±ç¼©çŸ­äº†æ•´ä¸ªæ•°æ®æ¢å¤éœ€è¦çš„æ—¶é—´ã€‚\n\n\n\né¢„é˜²è¯¯åˆ åº“ / è¡¨çš„æ–¹æ³•\n\n\nç¬¬ä¸€æ¡å»ºè®®æ˜¯ï¼Œè´¦å·åˆ†ç¦»ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯ï¼Œé¿å…å†™é”™å‘½ä»¤ã€‚\n\n\nç¬¬äºŒæ¡å»ºè®®æ˜¯ï¼Œåˆ¶å®šæ“ä½œè§„èŒƒã€‚è¿™æ ·åšçš„ç›®çš„ï¼Œæ˜¯é¿å…å†™é”™è¦åˆ é™¤çš„è¡¨åã€‚\n\n\n\nåœ¨åˆ é™¤è¡¨ä¹‹å‰ï¼Œå¿…é¡»å…ˆå¯¹è¡¨åšæ”¹åæ“ä½œï¼Œç„¶åè§‚å¯Ÿä¸€æ®µæ—¶é—´ã€‚\n\n\n\n\næ”¹è¡¨åæ—¶ï¼Œè¦æ±‚ç»™è¡¨ååŠ å›ºå®šçš„åç¼€ï¼ˆæ¯”å¦‚ _to_be_deletedï¼‰ï¼Œåˆ é™¤è¡¨çš„åŠ¨ä½œå¿…é¡»é€šè¿‡ç®¡ç†ç³»ç»Ÿæ‰§è¡Œï¼Œå¹¶ä¸”åªèƒ½åˆ é™¤å›ºå®šåç¼€çš„è¡¨\n\n\n\n\n\n\n\nrm åˆ é™¤æ•°æ®\n\né‡åšå³å¯\n\n\n\næ€è€ƒé¢˜\n\n\nè¯¯åˆ æ•°æ®äº‹ä»¶\n\nç™»é”™ç¯å¢ƒ\n\n\n\n\n\nè¯„è®ºåŒº\n\n\nä¸åŒçš„æµè§ˆå™¨æµè§ˆæ–‡ä»¶å¯èƒ½ä¼šæˆªæ–­æˆ–ä¹±ç \n\nå¯ä»¥æŠŠè„šæœ¬æ”¾åˆ° git ä¸Šï¼Œç„¶åæŠŠ git åœ°å€å’Œæ–‡ä»¶çš„ md5 å‘ç»™è¦æ‰§è¡Œçš„äºº\n\n\n\nä¿®æ”¹ç”Ÿäº§çš„æ•°æ®ï¼Œæˆ–è€…æ·»åŠ ç´¢å¼•ä¼˜åŒ–ï¼Œéƒ½è¦å…ˆå†™å¥½å››ä¸ªè„šæœ¬ï¼šå¤‡ä»½è„šæœ¬ã€æ‰§è¡Œè„šæœ¬ã€éªŒè¯è„šæœ¬ã€å›æ»šè„šæœ¬\n\n\né€šè¿‡ chatrr +i å‘½ä»¤ç»™æ‰€æœ‰é‡è¦çš„æ–‡ä»¶å¢åŠ äº† i æƒé™å±æ€§ï¼Œè¿™æ ·å“ªæ€• root ç”¨æˆ·éƒ½æ— æ³•ç›´æ¥åˆ é™¤æ–‡ä»¶ã€‚\n\n\n\n\nrename å¾ˆå¿«\n\n"},"å­¦ä¹ ç¬”è®°/MySQL-å®æˆ˜-45-è®²/32ï½œä¸ºä»€ä¹ˆè¿˜æœ‰-kill-ä¸æ‰çš„è¯­å¥ï¼Ÿ":{"title":"32ï½œä¸ºä»€ä¹ˆè¿˜æœ‰ kill ä¸æ‰çš„è¯­å¥ï¼Ÿ","links":[],"tags":["mysql"],"content":"\n\nä¸¤ä¸ª kill å‘½ä»¤\n\n\n\n\nkill query + çº¿ç¨‹ id\n\n\n\nç»ˆæ­¢è¿™ä¸ªçº¿ç¨‹ä¸­æ­£åœ¨æ‰§è¡Œçš„è¯­å¥\n\n\n\n\n\nkill connection + çº¿ç¨‹ id\n\n\n\nconnection å¯ä»¥ä¸å†™\næ–­å¼€è¿™ä¸ªçº¿ç¨‹çš„è¿æ¥\nä¼šå…ˆåœæ­¢æ­£åœ¨æ‰§è¡Œçš„è¯­å¥\n\n\n\n\n\nä½¿ç”¨äº† kill å‘½ä»¤ï¼Œå´æ²¡èƒ½æ–­å¼€è¿™ä¸ªè¿æ¥ã€‚å†æ‰§è¡Œ show processlist å‘½ä»¤ï¼Œçœ‹åˆ°è¿™æ¡è¯­å¥çš„ Command åˆ—æ˜¾ç¤ºçš„æ˜¯ Killedã€‚\n\n\næ”¶åˆ° kill ä»¥åï¼Œçº¿ç¨‹åšä»€ä¹ˆï¼Ÿ\n\n\nå‘Šè¯‰æ‰§è¡Œçº¿ç¨‹ï¼šè¿™æ¡è¯­å¥å·²ç»ä¸éœ€è¦ç»§ç»­æ‰§è¡Œäº†ï¼Œå¯ä»¥å¼€å§‹â€œæ‰§è¡Œåœæ­¢çš„é€»è¾‘äº†â€\n\nè·Ÿ Linux çš„ kill å‘½ä»¤ç±»ä¼¼ï¼Œkill -N pid å¹¶ä¸æ˜¯è®©è¿›ç¨‹ç›´æ¥åœæ­¢ï¼Œè€Œæ˜¯ç»™è¿›ç¨‹å‘ä¸€ä¸ªä¿¡å·ï¼Œç„¶åè¿›ç¨‹å¤„ç†è¿™ä¸ªä¿¡å·ï¼Œè¿›å…¥ç»ˆæ­¢é€»è¾‘ã€‚åªæ˜¯å¯¹äº MySQL çš„ kill å‘½ä»¤æ¥è¯´ï¼Œä¸éœ€è¦ä¼ ä¿¡å·é‡å‚æ•°ï¼Œå°±åªæœ‰â€œåœæ­¢â€è¿™ä¸ªå‘½ä»¤ã€‚\n\n\n\nå®ç°ä¸Šï¼Œå½“ç”¨æˆ·æ‰§è¡Œ kill query thread_id_B æ—¶ï¼ŒMySQL é‡Œå¤„ç† kill å‘½ä»¤çš„çº¿ç¨‹åšäº†ä¸¤ä»¶äº‹ï¼š\n\n\n\n\næŠŠ session B çš„è¿è¡ŒçŠ¶æ€æ”¹æˆ THD::KILL_QUERY(å°†å˜é‡ killed èµ‹å€¼ä¸º THD::KILL_QUERY)ï¼›\n\n\n\nå¦‚æœ session B å¤„äºé”ç­‰å¾…ï¼Œå¹¶ä¸èƒ½çŸ¥é“çŠ¶æ€å˜åŒ–ï¼Œè¿˜æ˜¯ä¼šç»§ç»­ç­‰å¾…ã€‚\n\n\n\n\n\nç»™ session B çš„æ‰§è¡Œçº¿ç¨‹å‘ä¸€ä¸ªä¿¡å·ã€‚\n\n\n\nå‘ä¿¡å·çš„ç›®çš„ï¼šè®© session B é€€å‡ºç­‰å¾…ï¼Œå¤„ç† 1 è®¾ç½®çš„çŠ¶æ€\n\n\n\n\n\n\n\nkill æ— æ•ˆçš„ä¸¤ç±»æƒ…å†µ\n\n\n\n\nçº¿ç¨‹æ²¡æœ‰æ‰§è¡Œåˆ°åˆ¤æ–­çº¿ç¨‹çŠ¶æ€çš„é€»è¾‘\n\n\n\nç›¸åŒçš„è¿˜æœ‰ç”±äº IO å‹åŠ›è¿‡å¤§ï¼Œè¯»å†™ IO çš„å‡½æ•°ä¸€ç›´æ— æ³•è¿”å›ï¼Œå¯¼è‡´ä¸èƒ½åŠæ—¶åˆ¤æ–­çº¿ç¨‹çš„çŠ¶æ€\nè¯­å¥æ‰§è¡Œåˆ°èƒ½åˆ¤æ–­åˆ°çº¿ç¨‹çŠ¶æ€å·²ç»å˜æˆäº† KILL_QUERY æˆ–è€… KILL_CONNECTION çš„æ—¶å€™ï¼Œå†è¿›å…¥ç»ˆæ­¢é€»è¾‘é˜¶æ®µã€‚\nå¦‚æœä¸€ä¸ªçº¿ç¨‹çš„çŠ¶æ€æ˜¯KILL_CONNECTIONï¼Œå°±æŠŠCommandåˆ—æ˜¾ç¤ºæˆKilledã€‚\n\n\n\n\n\nç»ˆæ­¢é€»è¾‘è€—æ—¶è¾ƒé•¿\n\n\n\n\n\nè¶…å¤§äº‹åŠ¡æ‰§è¡ŒæœŸé—´è¢« killï¼Œè§¦å‘å›æ»šæ“ä½œ\n\n\n\n\nå¤§æŸ¥è¯¢å›æ»šï¼ŒæŸ¥è¯¢è¿‡ç¨‹ç”Ÿæˆäº†æ¯”è¾ƒå¤§çš„ä¸´æ—¶æ–‡ä»¶ + æ­¤æ—¶æ–‡ä»¶ç³»ç»Ÿå‹åŠ›å¤§ =&gt; åˆ é™¤ä¸´æ—¶æ–‡ä»¶å¯èƒ½éœ€è¦ç­‰å¾… IO èµ„æº\n\n\n\n\nDDL å‘½ä»¤æ‰§è¡Œåˆ°æœ€åé˜¶æ®µï¼Œè¢« kill éœ€è¦åˆ é™¤ä¸­é—´è¿‡ç¨‹çš„ä¸´æ—¶æ–‡ä»¶ï¼ŒåŒ 2\n\n\n\n\n\n\n\næ‰§è¡Œ Ctrl+C çš„æ—¶å€™ï¼Œæ˜¯ MySQL å®¢æˆ·ç«¯å¦å¤–å¯åŠ¨ä¸€ä¸ªè¿æ¥å‘é€ä¸€ä¸ª kill query å‘½ä»¤\n\n\nå¦å¤–ä¸¤ä¸ªå…³äºå®¢æˆ·ç«¯çš„è¯¯è§£\n\n\nå¦‚æœåº“é‡Œé¢çš„è¡¨ç‰¹åˆ«å¤šï¼Œè¿æ¥å°±ä¼šå¾ˆæ…¢ã€‚\n\n\næ¯ä¸ªå®¢æˆ·ç«¯åœ¨å’ŒæœåŠ¡ç«¯å»ºç«‹è¿æ¥çš„æ—¶å€™ï¼Œéœ€è¦åšçš„äº‹æƒ…å°±æ˜¯ TCP æ¡æ‰‹ã€ç”¨æˆ·æ ¡éªŒã€è·å–æƒé™ã€‚ä½†è¿™å‡ ä¸ªæ“ä½œï¼Œæ˜¾ç„¶è·Ÿåº“é‡Œé¢è¡¨çš„ä¸ªæ•°æ— å…³ã€‚ï¼ˆç¬¬ä¸€ç« ï¼‰\n\n\næˆ‘ä»¬æ„ŸçŸ¥åˆ°çš„è¿æ¥è¿‡ç¨‹æ…¢ï¼Œå…¶å®å¹¶ä¸æ˜¯è¿æ¥æ…¢ï¼Œä¹Ÿä¸æ˜¯æœåŠ¡ç«¯æ…¢ï¼Œè€Œæ˜¯å®¢æˆ·ç«¯æ…¢ã€‚\n\nå®¢æˆ·ç«¯åœ¨è¿æ¥æˆåŠŸåï¼š1. æ‰§è¡Œ show databases2. åˆ‡åˆ° db1 åº“ï¼Œæ‰§è¡Œ show tables3. æŠŠè¿™ä¸¤ä¸ªå‘½ä»¤çš„ç»“æœç”¨äºæ„å»ºä¸€ä¸ªæœ¬åœ°çš„å“ˆå¸Œè¡¨ï¼ˆæœ€è€—æ—¶ï¼‰\nå¦‚æœåœ¨è¿æ¥å‘½ä»¤ä¸­åŠ ä¸Š -Aï¼Œå°±å¯ä»¥å…³æ‰è¿™ä¸ªè‡ªåŠ¨è¡¥å…¨çš„åŠŸèƒ½ï¼Œç„¶åå®¢æˆ·ç«¯å°±å¯ä»¥å¿«é€Ÿè¿”å›äº†ã€‚\nâ€“quick ä¹Ÿå¯ä»¥è·³è¿‡\n\n\n\n\n\nâ€“quick\n\n\næ˜¯è®©å®¢æˆ·ç«¯å˜å¿«\n\n\nMySQL å®¢æˆ·ç«¯å‘é€è¯·æ±‚åï¼Œæ¥æ”¶æœåŠ¡ç«¯è¿”å›ç»“æœçš„æ–¹å¼æœ‰ä¸¤ç§ï¼š1. ä¸€ç§æ˜¯æœ¬åœ°ç¼“å­˜ï¼Œä¹Ÿå°±æ˜¯åœ¨æœ¬åœ°å¼€ä¸€ç‰‡å†…å­˜ï¼Œå…ˆæŠŠç»“æœå­˜èµ·æ¥ã€‚å¦‚æœä½ ç”¨ API å¼€å‘ï¼Œå¯¹åº”çš„å°±æ˜¯ mysql_store_result æ–¹æ³•ã€‚2. å¦ä¸€ç§æ˜¯ä¸ç¼“å­˜ï¼Œè¯»ä¸€ä¸ªå¤„ç†ä¸€ä¸ªã€‚å¦‚æœä½ ç”¨ API å¼€å‘ï¼Œå¯¹åº”çš„å°±æ˜¯ mysql_use_result æ–¹æ³•ã€‚\n\n\né»˜è®¤ç¬¬ä¸€ç§\n\næŸ¥è¯¢çš„è¿”å›ç»“æœä¸ä¼šå¾ˆå¤šçš„è¯ï¼Œéƒ½æ¨èç”¨è¿™ä¸ª\n\n\n\nåŠ ä¸Š -quick å‚æ•°åä½¿ç”¨ç¬¬äºŒç§\n\n\n\n\né‡‡ç”¨ä¸ç¼“å­˜çš„æ–¹å¼ï¼Œå¦‚æœæœ¬åœ°å¤„ç†å¾—æ…¢ï¼Œå°±ä¼šå¯¼è‡´æœåŠ¡ç«¯å‘é€ç»“æœè¢«é˜»å¡ï¼Œå› æ­¤ä¼šè®©æœåŠ¡ç«¯å˜æ…¢\n\n\nå‚æ•°æ•ˆæœ\n\n\n\nè·³è¿‡è¡¨åè‡ªåŠ¨è¡¥å…¨åŠŸèƒ½\n\n\n\n\nmysql_store_result éœ€è¦ç”³è¯·æœ¬åœ°å†…å­˜æ¥ç¼“å­˜æŸ¥è¯¢ç»“æœï¼Œå¦‚æœæŸ¥è¯¢ç»“æœå¤ªå¤§ï¼Œä¼šè€—è´¹è¾ƒå¤šçš„æœ¬åœ°å†…å­˜\n\n\n\n\nä¸ä¼šæŠŠæ‰§è¡Œå‘½ä»¤è®°å½•åˆ°æœ¬åœ°çš„å‘½ä»¤å†å²æ–‡ä»¶\n\n\n\n\n\n\n\n\n\nå‘ç°ä¸€ä¸ªçº¿ç¨‹å¤„äº Killed çŠ¶æ€ï¼Œå¯ä»¥åšçš„äº‹æƒ…ï¼šé€šè¿‡å½±å“ç³»ç»Ÿç¯å¢ƒï¼Œè®© Killed çŠ¶æ€å°½å¿«ç»“æŸ\n\n\n\nå¹¶å‘åº¦é—®é¢˜ï¼Œä¸´æ—¶è°ƒå¤§ innodb_thread_concurrency çš„å€¼æˆ–åœæ‰åˆ«çš„çº¿ç¨‹ï¼Œè®©å‡ºä½å­ç»™è¿™ä¸ªçº¿ç¨‹æ‰§è¡Œ\n\n\n\n\nå›æ»šé€»è¾‘ç”±äº IO èµ„æºé™åˆ¶ï¼Œé€šè¿‡å‡å°‘ç³»ç»Ÿå‹åŠ›è®©å®ƒåŠ é€Ÿ\n\n\n\n\n\næ€è€ƒé¢˜\n\n\nå¦‚æœä½ ç¢°åˆ°ä¸€ä¸ªè¢« killed çš„äº‹åŠ¡ä¸€ç›´å¤„äºå›æ»šçŠ¶æ€ï¼Œä½ è®¤ä¸ºæ˜¯åº”è¯¥ç›´æ¥æŠŠ MySQL è¿›ç¨‹å¼ºè¡Œé‡å¯ï¼Œè¿˜æ˜¯åº”è¯¥è®©å®ƒè‡ªå·±æ‰§è¡Œå®Œæˆå‘¢ï¼Ÿ\n\nè®©å®ƒè‡ªå·±ç»“æŸ\n\n\n\nä¸ºä»€ä¹ˆå‘¢ï¼Ÿ\n\nå› ä¸ºé‡å¯ä¹‹åè¯¥åšçš„å›æ»šåŠ¨ä½œä¸èƒ½å°‘\nå¯ä»¥å…ˆåšä¸»å¤‡åˆ‡æ¢ï¼Œåˆ‡åˆ°æ–°ä¸»åº“æä¾›æœåŠ¡\n\n\n\nå‡å°‘ç³»ç»Ÿå‹åŠ›ï¼ŒåŠ é€Ÿç»ˆæ­¢é€»è¾‘\n\n\n\n\nè¯„è®ºåŒº\n\n\nå¹¶éæ‰€æœ‰çš„ DDL æ“ä½œéƒ½å¯ä»¥é€šè¿‡ä¸»ä»åˆ‡æ¢æ¥å®ç°\n\nåªæœ‰ æ”¹ç´¢å¼•ã€ åŠ æœ€åä¸€åˆ—ã€åˆ æœ€åä¸€åˆ—å…¶ä»–çš„å¤§å¤šæ•°ä¸è¡Œï¼Œæ¯”å¦‚åˆ é™¤ä¸­é—´ä¸€åˆ—\n\n\n\nkill çš„å½±å“åªæœ‰å›æ»šï¼Œæ¢å¤åˆ°æ‰§è¡Œå‰çš„çŠ¶æ€ï¼Œæ²¡æœ‰å…¶ä»–çš„\n\n\né‡åˆ°é”™è¯¯æ—¶ï¼špstack  &gt; /tmp/pstack.1\n\n\n\n"},"å­¦ä¹ ç¬”è®°/MySQL-å®æˆ˜-45-è®²/33ï½œæˆ‘æŸ¥è¿™ä¹ˆå¤šæ•°æ®ï¼Œä¼šä¸ä¼šæŠŠæ•°æ®åº“å†…å­˜æ‰“çˆ†ï¼Ÿ":{"title":"33ï½œæˆ‘æŸ¥è¿™ä¹ˆå¤šæ•°æ®ï¼Œä¼šä¸ä¼šæŠŠæ•°æ®åº“å†…å­˜æ‰“çˆ†ï¼Ÿ","links":[],"tags":["mysql"],"content":"\n\nå…¨è¡¨æ‰«æå¯¹ server å±‚çš„å½±å“\n\n\næœåŠ¡ç«¯å¹¶ä¸éœ€è¦ä¿å­˜ä¸€ä¸ªå®Œæ•´çš„ç»“æœé›†ï¼Œå–æ•°æ®å’Œå‘æ•°æ®çš„æµç¨‹ï¼ˆè¾¹è¯»è¾¹å‘ï¼‰ï¼š\n\n\n\nè·å–ä¸€è¡Œï¼Œå†™åˆ° net_buffer ä¸­ã€‚è¿™å—å†…å­˜çš„å¤§å°æ˜¯ç”±å‚æ•° net_buffer_length å®šä¹‰çš„ï¼Œé»˜è®¤æ˜¯ 16kã€‚2. é‡å¤è·å–è¡Œï¼Œç›´åˆ° net_buffer å†™æ»¡ï¼Œè°ƒç”¨ç½‘ç»œæ¥å£å‘å‡ºå»ã€‚ï¼ˆå‘ç»™ socket send bufferï¼‰3. å¦‚æœå‘é€æˆåŠŸï¼Œå°±æ¸…ç©º net_bufferï¼Œç„¶åç»§ç»­å–ä¸‹ä¸€è¡Œï¼Œå¹¶å†™å…¥ net_bufferã€‚4. å¦‚æœå‘é€å‡½æ•°è¿”å› EAGAIN æˆ– WSAEWOULDBLOCKï¼Œå°±è¡¨ç¤ºæœ¬åœ°ç½‘ç»œæ ˆï¼ˆsocket send bufferï¼‰å†™æ»¡äº†ï¼Œè¿›å…¥ç­‰å¾…ã€‚ç›´åˆ°ç½‘ç»œæ ˆé‡æ–°å¯å†™ï¼Œå†ç»§ç»­å‘é€ã€‚\n\n\n\n\n\n\n\n\nshow processlist ç»“æœçœ‹åˆ° State ä¸€ç›´å¤„äºâ€œSending to clientâ€ï¼Œè¡¨ç¤ºæœåŠ¡å™¨ç«¯çš„ç½‘ç»œæ ˆå†™æ»¡äº†ï¼ˆä¸Šä¸€èŠ‚è®²åˆ°çš„ -quick å‚æ•°å°±å¯èƒ½å¯¼è‡´è¿™ç§æƒ…å†µï¼‰\n\nå¯ä»¥è€ƒè™‘å°† net_buffer_length å‚æ•°è®¾ç½®ä¸ºæ›´å¤§çš„å€¼\nç­‰å¾…å®¢æˆ·ç«¯æ¥æ”¶ç»“æœ\n\n\n\nâ€œSending dataâ€çŠ¶æ€\n\n\nä¸€ä¸ªæŸ¥è¯¢è¯­å¥çš„çŠ¶æ€å˜åŒ–ï¼ˆè¿™é‡Œç•¥å»äº†å…¶ä»–æ— å…³çš„çŠ¶æ€ï¼‰ï¼š\n\nMySQL æŸ¥è¯¢è¯­å¥è¿›å…¥æ‰§è¡Œé˜¶æ®µåï¼Œé¦–å…ˆæŠŠçŠ¶æ€è®¾ç½®æˆâ€œSending dataâ€ï¼›ç„¶åï¼Œå‘é€æ‰§è¡Œç»“æœçš„åˆ—ç›¸å…³çš„ä¿¡æ¯ï¼ˆmeta data) ç»™å®¢æˆ·ç«¯ï¼›å†ç»§ç»­æ‰§è¡Œè¯­å¥çš„æµç¨‹ï¼›æ‰§è¡Œå®Œæˆåï¼ŒæŠŠçŠ¶æ€è®¾ç½®æˆç©ºå­—ç¬¦ä¸²ã€‚\n\n\n\nä¸ä¸€å®šæ˜¯æŒ‡æ­£åœ¨å‘é€æ•°æ®ï¼Œè€Œå¯èƒ½æ˜¯å¤„äºæ‰§è¡Œå™¨è¿‡ç¨‹ä¸­çš„ä»»æ„é˜¶æ®µ\n\n\n\n\n\n\nå…¨è¡¨æ‰«æå¯¹ InnoDB çš„å½±å“\n\n\nå†…å­˜çš„æ•°æ®é¡µæ˜¯åœ¨ Buffer Pool (BP) ä¸­ç®¡ç†çš„ï¼Œåœ¨ WAL é‡Œ Buffer Pool èµ·åˆ°äº†åŠ é€Ÿæ›´æ–°çš„ä½œç”¨ã€‚è€Œå®é™…ä¸Šï¼ŒBuffer Pool è¿˜æœ‰ä¸€ä¸ªæ›´é‡è¦çš„ä½œç”¨ï¼Œå°±æ˜¯åŠ é€ŸæŸ¥è¯¢ã€‚\n\nç”±äºæœ‰ WAL æœºåˆ¶ï¼Œå½“äº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œç£ç›˜ä¸Šçš„æ•°æ®é¡µæ˜¯æ—§çš„ï¼Œæ­¤æ—¶å¦‚æœæœ‰ä¸€ä¸ªæŸ¥è¯¢è¦è¯»è¿™ä¸ªæ•°æ®é¡µï¼Œå¹¶ä¸éœ€è¦æŠŠ redo log åº”ç”¨åˆ°æ•°æ®é¡µã€‚å› ä¸ºè¿™æ—¶å€™å†…å­˜æ•°æ®é¡µçš„ç»“æœæ˜¯æœ€æ–°çš„ï¼Œ ç›´æ¥è¯»å†…å­˜é¡µå°±å¯ä»¥äº†\n\n\n\nBuffer Pool å¯¹æŸ¥è¯¢çš„åŠ é€Ÿæ•ˆæœä¾èµ–äºä¸€ä¸ªé‡è¦çš„æŒ‡æ ‡ï¼šå†…å­˜å‘½ä¸­ç‡\n\nshow engine innodb status ç»“æœæŸ¥çœ‹ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸€ä¸ªç¨³å®šæœåŠ¡çš„çº¿ä¸Šç³»ç»Ÿï¼Œè¦ä¿è¯å“åº”æ—¶é—´ç¬¦åˆè¦æ±‚çš„è¯ï¼Œå†…å­˜å‘½ä¸­ç‡è¦åœ¨ 99% ä»¥ä¸Šã€‚\nBuffer pool hit rate è¡¨ç¤ºå‘½ä¸­ç‡\nInnoDB Buffer Pool çš„å¤§å°æ˜¯ç”±å‚æ•° innodb_buffer_pool_size ç¡®å®šçš„ï¼Œä¸€èˆ¬å»ºè®®è®¾ç½®æˆå¯ç”¨ç‰©ç†å†…å­˜çš„ 60%~80%ã€‚\n\n\n\nInnoDB å†…å­˜ç®¡ç†ç”¨çš„æ˜¯æœ€è¿‘æœ€å°‘ä½¿ç”¨ (Least Recently Used, LRU) ç®—æ³•ï¼Œè¿™ä¸ªç®—æ³•çš„æ ¸å¿ƒå°±æ˜¯æ·˜æ±°æœ€ä¹…æœªä½¿ç”¨çš„æ•°æ®ã€‚\n\nç”¨é“¾è¡¨å®ç°\næ²¡æœ‰æ”¹è¿›å‰ï¼šé‡åˆ°å…¨è¡¨æ‰«ææ—¶å†…å­˜å‘½ä¸­ç‡æ€¥å‰§ä¸‹é™ï¼Œç£ç›˜å‹åŠ›å¢åŠ ï¼ŒSQL è¯­å¥å“åº”å˜æ…¢\næ”¹è¿›çš„ LRU ç®—æ³•\n\n\n\n\n\né è¿‘é“¾è¡¨å¤´éƒ¨çš„ 5/8 æ˜¯ young åŒºåŸŸï¼Œé è¿‘é“¾è¡¨å°¾éƒ¨çš„ 3/8 æ˜¯ old åŒºåŸŸã€‚\n\n\n\nçŠ¶æ€ 1ï¼Œè¦è®¿é—®æ•°æ®é¡µ P3ï¼Œç”±äº P3 åœ¨ young åŒºåŸŸï¼Œå› æ­¤å’Œä¼˜åŒ–å‰çš„ LRU ç®—æ³•ä¸€æ ·ï¼Œå°†å…¶ç§»åˆ°é“¾è¡¨å¤´éƒ¨ï¼Œå˜æˆçŠ¶æ€ 2ã€‚\n\n\n\n\nä¹‹åè¦è®¿é—®ä¸€ä¸ªæ–°çš„ä¸å­˜åœ¨äºå½“å‰é“¾è¡¨çš„æ•°æ®é¡µï¼Œè¿™æ—¶å€™ä¾ç„¶æ˜¯æ·˜æ±°æ‰æ•°æ®é¡µ Pmï¼Œä½†æ˜¯æ–°æ’å…¥çš„æ•°æ®é¡µ Pxï¼Œæ˜¯æ”¾åœ¨ LRU_old å¤„ã€‚\n\n\n\n\nå¤„äº old åŒºåŸŸçš„æ•°æ®é¡µï¼Œæ¯æ¬¡è¢«è®¿é—®çš„æ—¶å€™éƒ½è¦åšä¸‹é¢è¿™ä¸ªåˆ¤æ–­ï¼šÂ  a. è‹¥è¿™ä¸ªæ•°æ®é¡µåœ¨ LRU é“¾è¡¨ä¸­å­˜åœ¨çš„æ—¶é—´è¶…è¿‡äº† 1 ç§’ï¼Œå°±æŠŠå®ƒç§»åŠ¨åˆ°é“¾è¡¨å¤´éƒ¨ï¼›Â  b. å¦‚æœè¿™ä¸ªæ•°æ®é¡µåœ¨ LRU é“¾è¡¨ä¸­å­˜åœ¨çš„æ—¶é—´çŸ­äº 1 ç§’ï¼Œä½ç½®ä¿æŒä¸å˜ã€‚1 ç§’è¿™ä¸ªæ—¶é—´ï¼Œæ˜¯ç”±å‚æ•° innodb_old_blocks_time æ§åˆ¶çš„ã€‚å…¶é»˜è®¤å€¼æ˜¯ 1000ï¼Œå•ä½æ¯«ç§’ã€‚\n\n\n\n\n\n\n\n\n\næ€è€ƒé¢˜\n\n\nå¦‚æœç”±äºå®¢æˆ·ç«¯å‹åŠ›å¤ªå¤§ï¼Œè¿Ÿè¿Ÿä¸èƒ½æ¥æ”¶ç»“æœï¼Œä¼šå¯¼è‡´ MySQL æ— æ³•å‘é€ç»“æœè€Œå½±å“è¯­å¥æ‰§è¡Œã€‚ä½†ï¼Œè¿™è¿˜ä¸æ˜¯æœ€ç³Ÿç³•çš„æƒ…å†µã€‚\n\n\nä½ å¯ä»¥è®¾æƒ³å‡ºç”±äºå®¢æˆ·ç«¯çš„æ€§èƒ½é—®é¢˜ï¼Œå¯¹æ•°æ®åº“å½±å“æ›´ä¸¥é‡çš„ä¾‹å­å—ï¼Ÿæˆ–è€…ä½ æ˜¯å¦ç»å†è¿‡è¿™æ ·çš„åœºæ™¯ï¼Ÿä½ åˆæ˜¯æ€ä¹ˆä¼˜åŒ–çš„ï¼Ÿ\n\né€ æˆé•¿äº‹åŠ¡\nå¦‚æœå‰é¢çš„è¯­å¥æœ‰æ›´æ–°ï¼Œæ„å‘³ç€å®ƒä»¬åœ¨å ç”¨ç€è¡Œé”ï¼Œä¼šå¯¼è‡´åˆ«çš„è¯­å¥æ›´æ–°è¢«é”ä½ï¼›\nè¯»çš„äº‹åŠ¡ä¼šå¯¼è‡´ undo log ä¸èƒ½è¢«å›æ”¶ï¼Œå¯¼è‡´å›æ»šæ®µç©ºé—´è†¨èƒ€\n\n\n\n\n\nè¯„è®ºåŒº\n\nå¤§æŸ¥è¯¢å¸¸è§çš„åšæ³•ï¼šåˆ†æ‰¹å–ï¼Œç„¶åæ¯ä¸€æ‰¹æ‹¿åˆ°æœ€å¤§çš„ä¸€ä¸ª idï¼ˆä¸»é”®å€¼ï¼‰ï¼Œä¸‹ä¸€æ‰¹æŸ¥è¯¢çš„æ—¶å€™ç”¨ where id &gt; N è¿™ç§å†™æ³•\nä¸€ä¸ªå¤§æŸ¥è¯¢ä¸ä¼šæ‰“çˆ†ï¼Œä½†æ˜¯å¾ˆå¤šå¹¶å‘æŸ¥è¯¢è¿˜æ˜¯å¯èƒ½æ‰“çˆ†çš„\nMyISAM å¼•æ“ä¹Ÿä¸ä¼šçˆ†å†…å­˜ï¼Œè·Ÿ InnoDB ä¸€æ ·\næ›´æ–°ä¹‹é—´ä¼šäº’ç›¸ç­‰é”çš„é—®é¢˜ã€‚åŒä¸€ä¸ªäº‹åŠ¡ï¼Œæ›´æ–°ä¹‹åè¦å°½å¿«æäº¤ï¼Œä¸è¦åšæ²¡å¿…è¦çš„æŸ¥è¯¢ï¼Œå°¤å…¶æ˜¯ä¸è¦æ‰§è¡Œéœ€è¦è¿”å›å¤§é‡æ•°æ®çš„æŸ¥è¯¢ã€‚\n\n\n"},"å­¦ä¹ ç¬”è®°/MySQL-å®æˆ˜-45-è®²/34ï½œåˆ°åº•å¯ä¸å¯ä»¥ä½¿ç”¨-join-ï¼Ÿ":{"title":"34ï½œåˆ°åº•å¯ä¸å¯ä»¥ä½¿ç”¨ join ï¼Ÿ","links":[],"tags":["mysql"],"content":"\n\nIndex Nested-Loop Joinï¼ˆNLJï¼‰\n\n\n\nä½¿ç”¨ join è¯­å¥ï¼Œæ€§èƒ½æ¯”å¼ºè¡Œæ‹†æˆå¤šä¸ªä½†è¡¨æ‰§è¡Œ SQL è¯­å¥çš„æ€§èƒ½è¦å¥½ï¼›\n\n\n\n\nå¦‚æœä½¿ç”¨ join è¯­å¥çš„è¯ï¼Œéœ€è¦è®©å°è¡¨åšé©±åŠ¨è¡¨\n\n\nå‰ææ˜¯â€œå¯ä»¥ä½¿ç”¨è¢«é©±åŠ¨è¡¨çš„ç´¢å¼•â€\n\n\n\nSimple Nested-Loop Join\n\nMySQL æ²¡ç”¨\n\n\n\nBlock Nested-Loop Joinï¼ˆBNLï¼‰\n\n\n\n\n\n\nè¢«é©±åŠ¨è¡¨æ²¡æœ‰ç´¢å¼•\n\n\n\n\n\né©±åŠ¨è¡¨ä¸­å–å‡ºæ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„æ•°æ®ï¼Œè¯»å…¥çº¿ç¨‹å†…å­˜ join_buffer ä¸­\n\n\n\nå¦‚æœ join_buffer æ»¡äº†ï¼Œè¿›å…¥ä¸‹ä¸€æ­¥ï¼Œæ¯”è¾ƒå®Œæ”¾å…¥ç»“æœé›†åï¼Œæ¸…ç©º join_bufferï¼Œå›åˆ°è¿™ä¸€æ­¥\njoin_buffer_size è®¾ç½® join_buffer çš„å¤§å°\n\n\n\n\n\næ‰«æè¢«é©±åŠ¨è¡¨ï¼ŒæŠŠæ¯ä¸€è¡Œæ‹¿å‡ºæ¥è·Ÿ join_buffer ä¸­çš„æ•°æ®åšå¯¹æ¯”ï¼Œæ»¡è¶³ join æ¡ä»¶çš„ï¼Œä½œä¸ºç»“æœé›†çš„ä¸€éƒ¨åˆ†è¿”å›\n\n\n\nè·Ÿ Simple xx join ä¸€æ ·çš„æ‰«æè¡Œæ•°\nä¸åŒçš„æ˜¯ä¸€ä¸ªæ˜¯æ¯ä¸€è¡Œéƒ½åœ¨é©±åŠ¨è¡¨å…¨è¡¨æ‰«æä½œæ¯”è¾ƒï¼Œä¸€ä¸ªåœ¨å†…å­˜æ¯”è¾ƒ\n\n\n\nä¸ç”¨åˆ†æ®µæ—¶ï¼Œé€‰å“ªä¸ªè¡¨åšé©±åŠ¨è¡¨éƒ½ä¸€æ ·\n\n\n\nä¸¤ä¸ªè¡¨éƒ½åšä¸€æ¬¡å…¨è¡¨æ‰«æ M+N\n\n\n\n\nå†…å­˜ä¸­çš„åˆ¤æ–­æ¬¡æ•° M*N\n\n\n\n\n\nåˆ†æ®µæ—¶ï¼Œé€‰æ‹©å°è¡¨åšé©±åŠ¨è¡¨\n\né©±åŠ¨è¡¨ N è¡Œï¼Œè¢«é©±åŠ¨è¡¨ M è¡Œ\nN è¶Šå¤§ï¼Œåˆ†æ®µæ¬¡æ•°è¶Šå¤šï¼ŒM è¢«æ‰«çš„æ¬¡æ•°è¶Šå¤š\nè°ƒå¤§ join_buffer_size å¯ä»¥åŠ å¿«æ²¡ç”¨åˆ°è¢«é©±åŠ¨è¡¨ç´¢å¼•çš„ join è¯­å¥\n\n\n\n\n\nèƒ½ä¸èƒ½ç”¨ join è¯­å¥ï¼Ÿ\n\nå¦‚æœå¯ä»¥ä½¿ç”¨ Index Nested-Loop Join ç®—æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥ç”¨ä¸Šè¢«é©±åŠ¨è¡¨ä¸Šçš„ç´¢å¼•ï¼Œå…¶å®æ˜¯æ²¡é—®é¢˜çš„ï¼›\nåˆ¤æ–­è¦ä¸è¦ä½¿ç”¨ join è¯­å¥æ—¶ï¼Œå°±æ˜¯çœ‹ explain ç»“æœé‡Œé¢ï¼ŒExtra å­—æ®µé‡Œé¢æœ‰æ²¡æœ‰å‡ºç°â€œBlock Nested Loopâ€å­—æ ·ï¼Œæœ‰å°±ä¸ç”¨\n\n\n\né€‰æ‹©å¤§è¡¨è¿˜æ˜¯å°è¡¨åšé©±åŠ¨è¡¨\n\næ€»æ˜¯åº”è¯¥ç”¨å°è¡¨\nå°è¡¨ï¼šåœ¨å†³å®šå“ªä¸ªè¡¨åšé©±åŠ¨è¡¨çš„æ—¶å€™ï¼Œåº”è¯¥æ˜¯ä¸¤ä¸ªè¡¨æŒ‰ç…§å„è‡ªçš„æ¡ä»¶è¿‡æ»¤ï¼Œè¿‡æ»¤å®Œæˆä¹‹åï¼Œè®¡ç®—å‚ä¸ join çš„å„ä¸ªå­—æ®µçš„æ€»æ•°æ®é‡ï¼Œæ•°æ®é‡å°çš„é‚£ä¸ªè¡¨ï¼Œå°±æ˜¯â€œå°è¡¨â€ï¼Œåº”è¯¥ä½œä¸ºé©±åŠ¨è¡¨ã€‚\n\n\n\næ€è€ƒé¢˜\n\nå¦‚æœè¢«é©±åŠ¨è¡¨æ˜¯ä¸€ä¸ªå¤§è¡¨ï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªå†·æ•°æ®è¡¨ï¼Œé™¤äº†æŸ¥è¯¢è¿‡ç¨‹ä¸­å¯èƒ½ä¼šå¯¼è‡´ IO å‹åŠ›å¤§ä»¥å¤–ï¼Œä½ è§‰å¾—å¯¹è¿™ä¸ª MySQL æœåŠ¡è¿˜æœ‰ä»€ä¹ˆæ›´ä¸¥é‡çš„å½±å“å—ï¼Ÿï¼ˆè¿™ä¸ªé—®é¢˜éœ€è¦ç»“åˆä¸Šä¸€ç¯‡æ–‡ç« çš„çŸ¥è¯†ç‚¹ï¼‰\n\n\n"},"å­¦ä¹ ç¬”è®°/MySQL-å®æˆ˜-45-è®²/35ï½œjoin-è¯­å¥æ€ä¹ˆä¼˜åŒ–ï¼Ÿ":{"title":"35ï½œjoin è¯­å¥æ€ä¹ˆä¼˜åŒ–ï¼Ÿ","links":[],"tags":["mysql"],"content":"\n\nMulti-Range Read ä¼˜åŒ–ï¼ˆMRRï¼‰\n\n\nç›®çš„ï¼šå°½é‡ä½¿ç”¨é¡ºåºè¯»ç›˜\n\n\nå› ä¸ºå¤§å¤šæ•°çš„æ•°æ®éƒ½æ˜¯æŒ‰ç…§ä¸»é”®é€’å¢é¡ºåºæ’å…¥å¾—åˆ°çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è®¤ä¸ºï¼Œå¦‚æœæŒ‰ç…§ä¸»é”®çš„é€’å¢é¡ºåºæŸ¥è¯¢çš„è¯ï¼Œå¯¹ç£ç›˜çš„è¯»æ¯”è¾ƒæ¥è¿‘é¡ºåºè¯»ï¼Œèƒ½å¤Ÿæå‡è¯»æ€§èƒ½ã€‚\n\nMRR çš„è®¾è®¡æ€è·¯\n\n\n\nä¼˜åŒ–åçš„æ‰§è¡Œæµç¨‹\n\n\n\n\n\n\n\næ ¹æ®ç´¢å¼• aï¼Œå®šä½åˆ°æ»¡è¶³æ¡ä»¶çš„è®°å½•ï¼Œå°† id å€¼æ”¾å…¥ read_rnd_buffer ä¸­ ;\n\n\n\nread_rnd_bufferï¼šMySQL çš„éšæœºè¯»ç¼“å†²åŒºã€‚å½“æŒ‰ä»»æ„é¡ºåºè¯»å–è¡Œæ—¶ï¼ˆä¾‹å¦‚æŒ‰ç…§æ’åºé¡ºåºï¼‰å°†åˆ†é…ä¸€ä¸ªéšæœºè¯»å–ç¼“å†²åŒºï¼Œè¿›è¡Œæ’åºæŸ¥è¯¢æ—¶ï¼ŒMySQL ä¼šé¦–å…ˆæ‰«æä¸€éè¯¥ç¼“å†²ï¼Œä»¥é¿å…ç£ç›˜æœç´¢ï¼Œæé«˜æŸ¥è¯¢é€Ÿåº¦ã€‚\n\n\n\n\nå°† read_rnd_buffer ä¸­çš„ id è¿›è¡Œé€’å¢æ’åºï¼›\n\n\n\n\næ’åºåçš„ id æ•°ç»„ï¼Œä¾æ¬¡åˆ°ä¸»é”® id ç´¢å¼•ä¸­æŸ¥è®°å½•ï¼Œå¹¶ä½œä¸ºç»“æœè¿”å›ã€‚\n\n\n\nread_rnd_buffer çš„å¤§å°æ˜¯ç”± read_rnd_buffer_size å‚æ•°æ§åˆ¶çš„ã€‚å¦‚æœæ­¥éª¤ 1 ä¸­ï¼Œread_rnd_buffer æ”¾æ»¡äº†ï¼Œå°±ä¼šå…ˆæ‰§è¡Œå®Œæ­¥éª¤ 2 å’Œ 3ï¼Œç„¶åæ¸…ç©º read_rnd_bufferã€‚ä¹‹åç»§ç»­æ‰¾ç´¢å¼• a çš„ä¸‹ä¸ªè®°å½•ï¼Œå¹¶ç»§ç»­å¾ªç¯ã€‚\n\n\n\n\næƒ³è¦ç¨³å®šåœ°ä½¿ç”¨ MRR ä¼˜åŒ–çš„è¯ï¼Œéœ€è¦è®¾ç½®set optimizer_switch=â€œmrr_cost_based=offâ€ã€‚\n\nå®˜æ–¹æ–‡æ¡£çš„è¯´æ³•ï¼Œæ˜¯ç°åœ¨çš„ä¼˜åŒ–å™¨ç­–ç•¥ï¼Œåˆ¤æ–­æ¶ˆè€—çš„æ—¶å€™ï¼Œä¼šæ›´å€¾å‘äºä¸ä½¿ç”¨ MRRï¼ŒæŠŠ mrr_cost_based è®¾ç½®ä¸º offï¼Œå°±æ˜¯å›ºå®šä½¿ç”¨ MRR äº†ã€‚\n\n\n\næå‡æ€§èƒ½çš„æ ¸å¿ƒï¼šåœ¨ç´¢å¼• a ä¸Šåšä¸€ä¸ªèŒƒå›´æŸ¥è¯¢ï¼Œæ‹¿åˆ°è¶³å¤Ÿå¤šçš„ä¸»é”® idï¼Œé€šè¿‡æ’åºåï¼Œå†å»ä¸»é”®ç´¢å¼•æŸ¥æ•°æ®ï¼Œæ‰èƒ½ä½“ç°å‡ºâ€œé¡ºåºæ€§â€çš„ä¼˜åŠ¿ã€‚\n\n\nç”¨äº† order by å°±ä¸è¦ç”¨ MRR äº†\n\n\n\n\nBatched Key Accessï¼ˆBKAï¼‰\n\n\nMySQL 5.6\n\n\nå¯¹ NLJ ç®—æ³•çš„ä¼˜åŒ–\n\nNLJ ç”¨ä¸åˆ° join_bufferï¼ŒBKA å¯ä»¥\næ¯å¤šä¸€ä¸ª joinï¼Œå°±å¤šä¸€ä¸ª join_buffer\n\n\n\nå¯ç”¨æ–¹æ³•ï¼Œåœ¨æ‰§è¡Œ SQL è¯­å¥ä¹‹å‰ï¼Œå…ˆè®¾ç½®ï¼šset optimizer_switch=â€˜mrr=on,mrr_cost_based=off,batched_key_access=onâ€™;\n\n\n\n\n\nå‰ä¸¤ä¸ªå‚æ•°çš„ä½œç”¨æ˜¯è¦å¯ç”¨ MRRã€‚BKA ç®—æ³•çš„ä¼˜åŒ–è¦ä¾èµ–äº MRRã€‚\n\n\n\n\nMySQL Â· ç‰¹æ€§åˆ†æ Â· ä¼˜åŒ–å™¨ MRR &amp; BKAï¼šPolarDB æ•°æ®åº“å†…æ ¸æœˆæŠ¥\n\n\nå¹¶ä¸æ˜¯â€œå…ˆè®¡ç®—ä¸¤ä¸ªè¡¨ join çš„ç»“æœï¼Œå†è·Ÿç¬¬ä¸‰ä¸ªè¡¨ joinâ€ï¼Œè€Œæ˜¯ç›´æ¥åµŒå¥—æŸ¥è¯¢çš„ã€‚\n\n\n\n\nBNL ç®—æ³•çš„æ€§èƒ½é—®é¢˜\n\n\nBNL ç®—æ³•å¯¹ç³»ç»Ÿçš„å½±å“\n\n\n\nå¯èƒ½ä¼šå¤šæ¬¡æ‰«æè¢«é©±åŠ¨è¡¨ï¼Œå ç”¨ç£ç›˜ IO èµ„æºï¼›\n\n\n\n\nåˆ¤æ–­ join æ¡ä»¶éœ€è¦æ‰§è¡Œ M*N æ¬¡å¯¹æ¯”ï¼ˆMã€N åˆ†åˆ«æ˜¯ä¸¤å¼ è¡¨çš„è¡Œæ•°ï¼‰ï¼Œå¦‚æœæ˜¯å¤§è¡¨å°±ä¼šå ç”¨éå¸¸å¤šçš„ CPU èµ„æºï¼›\n\n\n\n\nå¯èƒ½ä¼šå¯¼è‡´ Buffer Pool çš„çƒ­æ•°æ®è¢«æ·˜æ±°ï¼Œå½±å“å†…å­˜å‘½ä¸­ç‡ã€‚\n\n\n\nå¦‚æœä¸€ä¸ªä½¿ç”¨ BNL ç®—æ³•çš„ join è¯­å¥ï¼Œå¤šæ¬¡æ‰«æä¸€ä¸ªå†·è¡¨ï¼Œè€Œä¸”è¿™ä¸ªè¯­å¥æ‰§è¡Œæ—¶é—´è¶…è¿‡ 1 ç§’ï¼Œå°±ä¼šåœ¨å†æ¬¡æ‰«æå†·è¡¨çš„æ—¶å€™ï¼ŒæŠŠå†·è¡¨çš„æ•°æ®é¡µç§»åˆ° LRU é“¾è¡¨å¤´éƒ¨ã€‚\n\n\nä¸šåŠ¡æ­£å¸¸è®¿é—®çš„æ•°æ®é¡µï¼Œæ²¡æœ‰æœºä¼šè¿›å…¥ young åŒºåŸŸã€‚\n\n\nå½±å“ Buffer Pool çš„æ­£å¸¸è¿ä½œ\n\n\nå‡å°å½±å“çš„æ–¹æ³•ï¼šå¢å¤§ join_buffer_size çš„å€¼ï¼Œå‡å°‘å¯¹è¢«é©±åŠ¨è¡¨çš„æ‰«ææ¬¡æ•°\n\n\næ‰§è¡Œè¯­å¥ä¹‹å‰ï¼Œé€šè¿‡ç†è®ºåˆ†æå’ŒæŸ¥çœ‹ explain ç»“æœçš„æ–¹å¼ï¼Œç¡®è®¤æ˜¯å¦è¦ä½¿ç”¨ BNL ç®—æ³•ï¼Œå¦‚æœç¡®è®¤ä¼˜åŒ–å™¨ä¼šä½¿ç”¨ï¼Œå°±éœ€è¦åšä¼˜åŒ–\n\n\nBNL è½¬ BKA\n\n\n\nä¸€äº›æƒ…å†µä¸‹ï¼Œç›´æ¥åœ¨è¢«é©±åŠ¨è¡¨ä¸Šå»ºç´¢å¼•\n\n\n\n\nä¸èƒ½å»ºç´¢å¼•æ—¶ï¼Œä½¿ç”¨ä¸´æ—¶è¡¨\n\n\n\n\næŠŠè¢«é©±åŠ¨è¡¨ä¸­æ»¡è¶³æ¡ä»¶çš„æ•°æ®æ”¾åˆ°ä¸´æ—¶è¡¨ä¸­\n\n\n\n\nä¸ºäº†è®© join ä½¿ç”¨ BKA ç®—æ³•ï¼Œç»™ä¸´æ—¶è¡¨çš„å­—æ®µåŠ ä¸Šç´¢å¼•\n\n\n\n\nè®©é©±åŠ¨è¡¨å’Œä¸´æ—¶è¡¨åš join æ“ä½œ\n\n\n\nSQLï¼šcreate temporary table temp_t(id int primary key, a int, b int, index(b))engine=innodb;insert into temp_t select * from t2 where b&gt;=1 and b&lt;=2000;select * from t1 join temp_t on (t1.b=temp_t.b);\n\n\nè¿™é‡Œç”¨å†…å­˜ä¸´æ—¶è¡¨çš„æ•ˆæœæ›´å¥½create temporary table temp_t(id int primary key, a int, b int, index (b))engine=memory;insert into temp_t select * from t2 where b&gt;=1 and b&lt;=2000;select * from t1 join temp_t on (t1.b=temp_t.b);\n\n\næ€è·¯ï¼šç”¨ä¸Šè¢«é©±åŠ¨è¡¨çš„ç´¢å¼•ï¼Œè§¦å‘ BKA ç®—æ³•\n\n\næ‰©å±• -hash join\n\n\nMysql 8.0.18 å·²ç»æ”¯æŒ Hash-join8.0.20 ç‰ˆæœ¬ä»¥ä¸Šå®˜æ–¹å·²ç»ç§»é™¤BNLçš„æ”¯æŒï¼Œå…¨éƒ¨æ›¿æ¢æˆ hash -join\n\n\njoin_buffer ç»´æŠ¤çš„æ— åºæ•°ç»„æ›¿æ¢æˆå“ˆå¸Œè¡¨\n\n\nN * M =&gt; 1 * M\n\n\nè‡ªå·±åœ¨ä¸šåŠ¡ç«¯å®ç°\n\n\n\nselect * from t1;å–å¾—è¡¨ t1 çš„å…¨éƒ¨ 1000 è¡Œæ•°æ®ï¼Œåœ¨ä¸šåŠ¡ç«¯å­˜å…¥ä¸€ä¸ª hash ç»“æ„ï¼Œæ¯”å¦‚ C++ é‡Œçš„ setã€PHP çš„æ•°ç»„è¿™æ ·çš„æ•°æ®ç»“æ„ã€‚\n\n\n\n\nselect * from t2 where b&gt;=1 and b&lt;=2000; è·å–è¡¨ t2 ä¸­æ»¡è¶³æ¡ä»¶çš„ 2000 è¡Œæ•°æ®ã€‚\n\n\n\n\næŠŠè¿™ 2000 è¡Œæ•°æ®ï¼Œä¸€è¡Œä¸€è¡Œåœ°å–åˆ°ä¸šåŠ¡ç«¯ï¼Œåˆ° hash ç»“æ„çš„æ•°æ®è¡¨ä¸­å¯»æ‰¾åŒ¹é…çš„æ•°æ®ã€‚æ»¡è¶³åŒ¹é…çš„æ¡ä»¶çš„è¿™è¡Œæ•°æ®ï¼Œå°±ä½œä¸ºç»“æœé›†çš„ä¸€è¡Œã€‚\n\n\n\næ‰§è¡Œæ•ˆç‡ï¼šhash join &gt; ä¸´æ—¶è¡¨\n\n\nBKA ä¼˜åŒ–æ˜¯ MySQL å·²ç»å†…ç½®æ”¯æŒçš„ï¼Œå»ºè®®é»˜è®¤ä½¿ç”¨ï¼›\n\n\nè¯„è®ºåŒº\n\n\nwhere in (?)ï¼Œï¼Ÿçš„å¤šä¸ªå€¼ä¸éœ€è¦æ’åº\n\n\nå›ºæ€ç¡¬ç›˜çš„é¡ºåºå†™è¿˜æ˜¯æ¯”éšæœºå†™å¿«\n\n"},"å­¦ä¹ ç¬”è®°/MySQL-å®æˆ˜-45-è®²/36ï½œä¸ºä»€ä¹ˆä¸´æ—¶è¡¨å¯ä»¥é‡åï¼Ÿ":{"title":"36ï½œä¸ºä»€ä¹ˆä¸´æ—¶è¡¨å¯ä»¥é‡åï¼Ÿ","links":["tags/sql"],"tags":["mysql","sql"],"content":"\n\nä¸´æ—¶è¡¨å’Œå†…å­˜è¡¨ä¸åŒ\n\nå†…å­˜è¡¨ï¼ŒæŒ‡çš„æ˜¯ä½¿ç”¨ Memory å¼•æ“çš„è¡¨ï¼Œå»ºè¡¨è¯­æ³•æ˜¯ create table â€¦ engine=memoryã€‚è¿™ç§è¡¨çš„æ•°æ®éƒ½ä¿å­˜åœ¨å†…å­˜é‡Œï¼Œç³»ç»Ÿé‡å¯çš„æ—¶å€™ä¼šè¢«æ¸…ç©ºï¼Œä½†æ˜¯è¡¨ç»“æ„è¿˜åœ¨ã€‚é™¤äº†è¿™ä¸¤ä¸ªç‰¹æ€§çœ‹ä¸Šå»æ¯”è¾ƒâ€œå¥‡æ€ªâ€å¤–ï¼Œä»å…¶ä»–çš„ç‰¹å¾ä¸Šçœ‹ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªæ­£å¸¸çš„è¡¨ã€‚\nè€Œä¸´æ—¶è¡¨ï¼Œå¯ä»¥ä½¿ç”¨å„ç§å¼•æ“ç±»å‹ ã€‚å¦‚æœæ˜¯ä½¿ç”¨ InnoDB å¼•æ“æˆ–è€… MyISAM å¼•æ“çš„ä¸´æ—¶è¡¨ï¼Œå†™æ•°æ®çš„æ—¶å€™æ˜¯å†™åˆ°ç£ç›˜ä¸Šçš„ã€‚ä¸´æ—¶è¡¨ä¹Ÿå¯ä»¥ä½¿ç”¨ Memory å¼•æ“ã€‚\n\n\n\nä¸´æ—¶è¡¨çš„ç‰¹æ€§\n\n\n\nå»ºè¡¨è¯­æ³•æ˜¯ create temporary table â€¦ã€‚\n\n\n\n\n\nä¸€ä¸ªä¸´æ—¶è¡¨åªèƒ½è¢«åˆ›å»ºå®ƒçš„ session è®¿é—®ï¼Œå¯¹å…¶ä»–çº¿ç¨‹ä¸å¯è§ã€‚\n\n\n\n\nåœ¨ session ç»“æŸçš„æ—¶å€™ä¼šè‡ªåŠ¨åˆ é™¤ä¸´æ—¶è¡¨\n\nä¸ç”¨æ‹…å¿ƒæ•°æ®åˆ é™¤é—®é¢˜\n\n\n\nä¸åŒ session çš„ä¸´æ—¶è¡¨å¯ä»¥é‡å\n\n\n\n\n\nä¸´æ—¶è¡¨å¯ä»¥ä¸æ™®é€šè¡¨åŒåã€‚\n\n\n\n\nsession A å†…æœ‰åŒåçš„ä¸´æ—¶è¡¨å’Œæ™®é€šè¡¨çš„æ—¶å€™ï¼Œshow create è¯­å¥ï¼Œä»¥åŠå¢åˆ æ”¹æŸ¥è¯­å¥è®¿é—®çš„æ˜¯ä¸´æ—¶è¡¨ã€‚\n\n\n\n\nshow tables å‘½ä»¤ä¸æ˜¾ç¤ºä¸´æ—¶è¡¨ã€‚\n\n\n\n\n\nä¸´æ—¶è¡¨çš„åº”ç”¨\n\n\nç»å¸¸è¢«ç”¨åœ¨å¤æ‚æŸ¥è¯¢çš„ä¼˜åŒ–è¿‡ç¨‹ä¸­\n\n\nå…¸å‹ï¼šåˆ†åº“åˆ†è¡¨ç³»ç»Ÿçš„è·¨åº“æŸ¥è¯¢\n\n\nç¬¬ä¸€ç§æ€è·¯ï¼šåœ¨ proxy å±‚çš„è¿›ç¨‹ä»£ç ä¸­å®ç°æ’åº\n\n\n\nå¼€å‘å·¥ä½œé‡æ¯”è¾ƒå¤§\n\n\n\n\nå¯¹ proxy ç«¯å‹åŠ›å¤§ï¼šå†…å­˜ã€CPU\n\n\n\n\n\nç¬¬äºŒç§æ€è·¯ï¼šæŠŠå„ä¸ªåˆ†åº“æ‹¿åˆ°çš„æ•°æ®ï¼Œæ±‡æ€»åˆ°ä¸€ä¸ª MySQL å®ä¾‹çš„ä¸€ä¸ªè¡¨ä¸­ï¼Œç„¶ååœ¨è¿™ä¸ªæ±‡æ€»å®ä¾‹ä¸Šåšé€»è¾‘æ“ä½œã€‚\n\n\n\nåœ¨æ±‡æ€»åº“åˆ›å»ºä¸´æ—¶è¡¨\n\n\n\n\nåœ¨åˆ†åº“æ‹¿åˆ°éœ€è¦çš„æ•°æ®ï¼Œæ’å…¥åˆ°ä¸´æ—¶è¡¨ä¸­\n\n\n\n\n\n\n\n\n\nä¸´æ—¶è¡¨å¯ä»¥é‡å\n\n\nç‰©ç†ä¸Šçš„æ–‡ä»¶\n\n\n#sql{è¿›ç¨‹ id}{çº¿ç¨‹ id} åºåˆ—å·.frm æ–‡ä»¶ä¿å­˜è¡¨ç»“æ„å®šä¹‰\n\né€šè¿‡ select @@tmpdir å‘½ä»¤å¯ä»¥æŸ¥çœ‹ä¸´æ—¶æ–‡ä»¶ç›®å½•\n\n\n\n5.6 ä»¥åŠä¹‹å‰çš„ç‰ˆæœ¬ï¼š#sql{è¿›ç¨‹ id}{çº¿ç¨‹ id} åºåˆ—å·.ibd å­˜æ”¾æ•°æ®æ–‡ä»¶\n\n\n5.7 å¼€å§‹ï¼šMySQL å¼•å…¥äº†ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶è¡¨ç©ºé—´ï¼Œä¸“é—¨ç”¨æ¥å­˜æ”¾ä¸´æ—¶æ–‡ä»¶çš„æ•°æ®ã€‚ä¸éœ€è¦å†åˆ›å»º ibd æ–‡ä»¶äº†ã€‚\n\n\nå†…å­˜é‡Œé¢\n\n\næ¯ä¸ªè¡¨å¯¹åº”ä¸€ä¸ª table_def_key\n\næ™®é€šè¡¨ï¼šåº“å + è¡¨å\nä¸´æ—¶è¡¨ï¼šåº“å + è¡¨å + server_id + thread_id\n\n\n\nåœ¨å®ç°ä¸Šï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½ç»´æŠ¤äº†è‡ªå·±çš„ä¸´æ—¶è¡¨é“¾è¡¨ã€‚è¿™æ ·æ¯æ¬¡ session å†…æ“ä½œè¡¨çš„æ—¶å€™ï¼Œå…ˆéå†é“¾è¡¨ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰è¿™ä¸ªåå­—çš„ä¸´æ—¶è¡¨ï¼Œå¦‚æœæœ‰å°±ä¼˜å…ˆæ“ä½œä¸´æ—¶è¡¨ï¼Œå¦‚æœæ²¡æœ‰å†æ“ä½œæ™®é€šè¡¨ï¼›åœ¨ session ç»“æŸçš„æ—¶å€™ï¼Œå¯¹é“¾è¡¨é‡Œçš„æ¯ä¸ªä¸´æ—¶è¡¨ï¼Œæ‰§è¡Œ â€œDROP TEMPORARY TABLE + è¡¨åâ€æ“ä½œã€‚\n\n\n\n\n\n\nä¸´æ—¶è¡¨å’Œä¸»å¤‡å¤åˆ¶\n\n\nåªåœ¨ binlog_format=statment/mixed çš„æ—¶å€™ï¼Œbinlog ä¸­æ‰ä¼šè®°å½•ä¸´æ—¶è¡¨çš„æ“ä½œã€‚\n\n\nrow æ ¼å¼ä¼šè®°å½•æ“ä½œçš„æ•°æ®\n\nåˆ é™¤ä¸´æ—¶è¡¨çš„è¯­å¥ä¼šè¢«æ”¹å†™ï¼Œå› ä¸ºå¤‡åº“æ‰¾ä¸åˆ°ä¸´æ—¶è¡¨ä¼šæŠ¥é”™\n/* generated by server */ è¯´æ˜æ˜¯è¢«æœåŠ¡ç«¯æ”¹å†™è¿‡çš„è¯­å¥\n\n\n\n\n\nMySQL åœ¨è®°å½• binlog çš„æ—¶å€™ï¼Œä¼šæŠŠä¸»åº“æ‰§è¡Œè¿™ä¸ªè¯­å¥çš„çº¿ç¨‹ id å†™åˆ° binlog ä¸­ã€‚è¿™æ ·ï¼Œåœ¨å¤‡åº“çš„åº”ç”¨çº¿ç¨‹å°±èƒ½å¤ŸçŸ¥é“æ‰§è¡Œæ¯ä¸ªè¯­å¥çš„ä¸»åº“çº¿ç¨‹ idï¼Œå¹¶åˆ©ç”¨è¿™ä¸ªçº¿ç¨‹ id æ¥æ„é€ ä¸´æ—¶è¡¨çš„ table_def_keyï¼š\n\n\n\n\næœ¬ç« çš„å†…å­˜è¡¨éƒ½æ˜¯ç”¨æˆ·æ‰‹åŠ¨åˆ›å»ºçš„\n\nå†…å­˜ä¸´æ—¶è¡¨åœ¨ 17 ç« å’Œä¸‹ä¸€ç« æœ‰ä»‹ç»\n\n\n\næ€è€ƒé¢˜\n\n\nå¯ä»¥ç”¨ alter table ä¿®æ”¹ä¸´æ—¶è¡¨çš„è¡¨åï¼Œä¸èƒ½ä½¿ç”¨ rename è¯­æ³•çš„åŸå› ï¼Ÿ\n\nåœ¨å®ç°ä¸Šï¼Œæ‰§è¡Œ rename table è¯­å¥çš„æ—¶å€™ï¼Œè¦æ±‚æŒ‰ç…§â€œåº“å / è¡¨å.frmâ€çš„è§„åˆ™å»ç£ç›˜æ‰¾æ–‡ä»¶ï¼Œä½†æ˜¯ä¸´æ—¶è¡¨åœ¨ç£ç›˜ä¸Šçš„ frm æ–‡ä»¶æ˜¯æ”¾åœ¨ tmpdir ç›®å½•ä¸‹çš„ï¼Œå¹¶ä¸”æ–‡ä»¶åçš„è§„åˆ™æ˜¯â€œ#sql{è¿›ç¨‹ id}{çº¿ç¨‹ id} åºåˆ—å·.frmâ€ï¼Œå› æ­¤ä¼šæŠ¥â€œæ‰¾ä¸åˆ°æ–‡ä»¶åâ€çš„é”™è¯¯ã€‚\n\n\n\n\n\nè¯„è®ºåŒº\n\n\nâ€œä¸´æ—¶è¡¨ä¼šè‡ªåŠ¨å›æ”¶â€è¿™ä¸ªåŠŸèƒ½ï¼Œä¸»è¦ç”¨äºâ€œåº”ç”¨ç¨‹åºå¼‚å¸¸æ–­å¼€ã€MySQLå¼‚å¸¸é‡å¯â€åï¼Œä¸éœ€è¦ä¸»åŠ¨å»åˆ é™¤è¡¨ã€‚å¹³æ—¶æ­£å¸¸ä½¿ç”¨çš„æ—¶å€™ï¼Œå»ºè®®ç”¨å®Œæ‰‹åŠ¨åˆ é™¤ã€‚\n\nå¦‚æœ A å®¢æˆ·ç«¯åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­åˆ›å»ºäº†ä¸´æ—¶è¡¨ï¼Œç”¨å®Œäº†è¿æ¥å°±æ”¾å›æ± å­é‡Œé¢ï¼Œæ²¡æœ‰åšåˆ«çš„æ¸…ç†å·¥ä½œï¼Œç„¶åæ–°çš„å®¢æˆ·ç«¯ B å¤ç”¨è¿™ä¸ªè¿æ¥ï¼Œå°±å¯èƒ½ä¼šçœ‹åˆ° A çš„ä¸´æ—¶è¡¨ã€‚å…·ä½“è¦çœ‹è¿æ¥æ± æ€ä¹ˆå®ç°çš„ã€‚\n\n\n\nä¸€èˆ¬ä¸€ä¸ªäº‹åŠ¡åˆ›å»ºä¸´æ—¶è¡¨ä»¥åï¼Œè¯»å†™åˆ†ç¦»å°±ä¼šé»˜è®¤æ¥ä¸‹æ¥çš„è¯·æ±‚éƒ½è·¯ç”±åˆ°ä¸»åº“å»äº†\n\n\nç”¨æˆ·æ²¡æœ‰æ˜¾ç¤ºæŒ‡å®šä¸»é”®çš„è¯ï¼ŒInnoDB å¼•æ“ä¼šè‡ªå·±åˆ›å»ºä¸€ä¸ªéšè—çš„ä¸»é”®ï¼Œä½†æ˜¯è¿™ä¸ªä¸»é”®å¯¹ server å±‚æ˜¯é€æ˜çš„ï¼Œä¼˜åŒ–å™¨ç”¨ä¸ä¸Šã€‚\n\n\nå¯ä»¥å MySQL ä¼šæ‰«æä¸´æ—¶ç›®å½•ï¼ŒæŠŠè¡¨éƒ½åˆ æ‰ï¼›\n\n\n\n"},"å­¦ä¹ ç¬”è®°/MySQL-å®æˆ˜-45-è®²/37ï½œä»€ä¹ˆæ—¶å€™ä¼šä½¿ç”¨å†…éƒ¨ä¸´æ—¶è¡¨ï¼Ÿ":{"title":"37ï½œä»€ä¹ˆæ—¶å€™ä¼šä½¿ç”¨å†…éƒ¨ä¸´æ—¶è¡¨ï¼Ÿ","links":[],"tags":["mysql"],"content":"\n\nunion æ‰§è¡Œæµç¨‹\n\n(select 1000 as f) union (select id from t1 order by id desc limit 2);è¿™æ¡è¯­å¥ç”¨åˆ°äº† unionï¼Œå®ƒçš„è¯­ä¹‰æ˜¯ï¼Œå–è¿™ä¸¤ä¸ªå­æŸ¥è¯¢ç»“æœçš„å¹¶é›†ã€‚å¹¶é›†çš„æ„æ€å°±æ˜¯è¿™ä¸¤ä¸ªé›†åˆåŠ èµ·æ¥ï¼Œé‡å¤çš„è¡Œåªä¿ç•™ä¸€è¡Œã€‚\nåˆ›å»ºä¸´æ—¶è¡¨ï¼Œæ‰§è¡Œç¬¬ä¸€ä¸ªæŸ¥è¯¢ï¼Œæ‹¿åˆ° 1000ï¼Œæ”¾å…¥ä¸´æ—¶è¡¨ï¼Œæ‰§è¡Œç¬¬äºŒä¸ªæŸ¥è¯¢ï¼Œæ‹¿åˆ° 1000 å’Œ 999ï¼Œ1000 ç”±äºè¿åå”¯ä¸€æ€§çº¦æŸæ’å…¥å¤±è´¥ï¼Œæ¥ç€æ”¾å…¥ 999 åè¿”å›ï¼Œæœ€åä»ä¸´æ—¶è¡¨ä¸­æŒ‰è¡Œå–å‡ºæ•°æ®ï¼Œè¿”å›ç»“æœï¼Œå¹¶åˆ é™¤ä¸´æ—¶è¡¨\næ”¹æˆ union all åˆ™æ²¡æœ‰å»é‡çš„è¯­ä¹‰ï¼Œæ‰§è¡Œæ—¶ä¸éœ€è¦ä¸´æ—¶è¡¨\n\n\n\n\n\n\n\ngroup by æ‰§è¡Œæµç¨‹\n\n\nselect id%10 as m, count(*) as c from t1 group by m;åˆ›å»ºä¸´æ—¶è¡¨ï¼ˆm(pk)ï¼Œcï¼‰ï¼Œæ‰«è¡¨ t1 çš„ç´¢å¼• aï¼Œå–å‡º id å¹¶è®¡ç®—å‡º xï¼Œæ”¾å…¥ä¸´æ—¶è¡¨/è®¡æ•°ï¼Œå®Œæˆåæ ¹æ® m åšæ’åºï¼Œå¾—åˆ°ç»“æœé›†è¿”å›ç»™å®¢æˆ·ç«¯\n\n\n\n\n\norder by null å¯ä»¥è·³è¿‡å¯¹ç»“æœé›†çš„æ’åº\n\n\nå†…å­˜ä¸´æ—¶è¡¨çš„å¤§å°æ˜¯æœ‰é™åˆ¶çš„ï¼Œå‚æ•° tmp_table_size å°±æ˜¯æ§åˆ¶è¿™ä¸ªå†…å­˜å¤§å°çš„ï¼Œé»˜è®¤æ˜¯ 16Mã€‚\n\nå¦‚æœè¶…å‡ºï¼Œå°±ä¼šè½¬æˆç£ç›˜ä¸´æ—¶è¡¨\n\n\n\nç£ç›˜ä¸´æ—¶è¡¨é»˜è®¤ä½¿ç”¨ InnoDB å¼•æ“\n\n\n\n\ngroup by ä¼˜åŒ–æ–¹æ³• â€” ç´¢å¼•\n\n\næ•°æ®æœ‰åºï¼Œå°±ä¸éœ€è¦ä¸´æ—¶è¡¨æ’åºäº†\n\nå¦‚æœå¯ä»¥ç¡®ä¿è¾“å…¥çš„æ•°æ®æ˜¯æœ‰åºçš„ï¼Œé‚£ä¹ˆè®¡ç®— group by çš„æ—¶å€™ï¼Œå°±åªéœ€è¦ä»å·¦åˆ°å³ï¼Œé¡ºåºæ‰«æï¼Œä¾æ¬¡ç´¯åŠ ã€‚\n\n\n\nåœ¨ MySQL 5.7 ç‰ˆæœ¬æ”¯æŒäº† generated column æœºåˆ¶ï¼Œç”¨æ¥å®ç°åˆ—æ•°æ®çš„å…³è”æ›´æ–°\n\nalter table t1 add column z int generated always as(id % 100), add index(z);\n\n\n\nMySQL 5.6 åŠä¹‹å‰çš„ç‰ˆæœ¬ï¼Œä½ ä¹Ÿå¯ä»¥åˆ›å»ºæ™®é€šåˆ—å’Œç´¢å¼•\n\n\nä¾‹å­ï¼šselect id%10 as m, count() as c from t1 group by m;å¯ä»¥æ”¹å†™æˆï¼šselect z, count() as c from t1 group by z;\n\nz å­—æ®µçš„å€¼ = id%10\n\n\n\n\n\ngroup by ä¼˜åŒ–æ–¹æ³• â€” ç›´æ¥æ’åº\n\n\nåœ¨ group by è¯­å¥ä¸­åŠ å…¥ SQL_BIG_RESULT è¿™ä¸ªæç¤ºï¼ˆhintï¼‰ï¼Œå°±å¯ä»¥å‘Šè¯‰ä¼˜åŒ–å™¨ï¼šè¿™ä¸ªè¯­å¥æ¶‰åŠçš„æ•°æ®é‡å¾ˆå¤§ï¼Œè¯·ç›´æ¥ç”¨ç£ç›˜ä¸´æ—¶è¡¨ã€‚\n\n\nMySQL çš„ä¼˜åŒ–å™¨ä¸€çœ‹ï¼Œç£ç›˜ä¸´æ—¶è¡¨æ˜¯ B+ æ ‘å­˜å‚¨ï¼Œå­˜å‚¨æ•ˆç‡ä¸å¦‚æ•°ç»„æ¥å¾—é«˜ã€‚æ‰€ä»¥ï¼Œæ—¢ç„¶ä½ å‘Šè¯‰æˆ‘æ•°æ®é‡å¾ˆå¤§ï¼Œé‚£ä»ç£ç›˜ç©ºé—´è€ƒè™‘ï¼Œè¿˜æ˜¯ç›´æ¥ç”¨æ•°ç»„æ¥å­˜å§ã€‚\n\næ•°ç»„å­˜æ”¾äº†æ¯ä¸€ä¸ª id%10ï¼Œæœ€åæ’åºï¼Œè®¡æ•°\n\n\n\n\n\næ€»ç»“æŒ‡å¯¼åŸåˆ™\n\n\n\nå¦‚æœå¯¹ group by è¯­å¥çš„ç»“æœæ²¡æœ‰æ’åºè¦æ±‚ï¼Œè¦åœ¨è¯­å¥åé¢åŠ  order by nullï¼›\n\n\n\n\nå°½é‡è®© group by è¿‡ç¨‹ç”¨ä¸Šè¡¨çš„ç´¢å¼•ï¼Œç¡®è®¤æ–¹æ³•æ˜¯ explain ç»“æœé‡Œæ²¡æœ‰ Using temporary å’Œ Using filesortï¼›\n\n\n\n\nå¦‚æœ group by éœ€è¦ç»Ÿè®¡çš„æ•°æ®é‡ä¸å¤§ï¼Œå°½é‡åªä½¿ç”¨å†…å­˜ä¸´æ—¶è¡¨ï¼›ä¹Ÿå¯ä»¥é€šè¿‡é€‚å½“è°ƒå¤§ tmp_table_size å‚æ•°ï¼Œæ¥é¿å…ç”¨åˆ°ç£ç›˜ä¸´æ—¶è¡¨ï¼›\n\n\n\n\nå¦‚æœæ•°æ®é‡å®åœ¨å¤ªå¤§ï¼Œä½¿ç”¨ SQL_BIG_RESULT è¿™ä¸ªæç¤ºï¼Œæ¥å‘Šè¯‰ä¼˜åŒ–å™¨ç›´æ¥ä½¿ç”¨æ’åºç®—æ³•å¾—åˆ° group by çš„ç»“æœã€‚\n\n\n\n\n\nè¯„è®ºåŒº\n\n\nå¦‚æœåªéœ€è¦å»é‡ï¼Œä¸éœ€è¦æ‰§è¡Œèšåˆå‡½æ•°ï¼Œdistinct å’Œ group by é‚£ç§æ•ˆç‡é«˜ä¸€äº›å‘¢ï¼Ÿ\n\nåªéœ€è¦å»é‡çš„è¯ï¼Œå¦‚æœæ²¡æœ‰ limitï¼Œæ˜¯ä¸€æ ·çš„ï¼›æœ‰ limit çš„è¯ï¼Œdistinct å¿«äº›ã€‚\n\n\n\nsort_bufferã€join_bufferã€å†…å­˜ä¸´æ—¶è¡¨å’Œç£ç›˜ä¸´æ—¶è¡¨ éƒ½æ˜¯ server å±‚çš„ï¼Œå¼•æ“é—´å…±ç”¨\n\n\néœ€è¦åˆ›å»ºä¸´æ—¶è¡¨çš„æ—¶å€™ï¼Œä¸å½“å‰è®¿é—®æ•°æ®çš„å¼•æ“æ— å…³ï¼Œéƒ½æ˜¯é»˜è®¤åˆ›å»ºå†…å­˜ä¸´æ—¶è¡¨ï¼Œå†…å­˜ä¸å¤Ÿäº†è½¬ç£ç›˜ä¸´æ—¶è¡¨ï¼ˆé»˜è®¤æ˜¯ innodb è¡¨ï¼‰\n\n\nå†…å­˜è¡¨çš„ä¸»é”®ä¸æ˜¯ä¿è¯æœ‰åºçš„\n\n\n\n"},"å­¦ä¹ ç¬”è®°/MySQL-å®æˆ˜-45-è®²/38ï½œéƒ½è¯´-InnoDB-å¥½ï¼Œé‚£è¿˜è¦ä¸è¦ä½¿ç”¨-Memory-å¼•æ“ï¼Ÿ":{"title":"38ï½œéƒ½è¯´ InnoDB å¥½ï¼Œé‚£è¿˜è¦ä¸è¦ä½¿ç”¨ Memory å¼•æ“ï¼Ÿ","links":[],"tags":["mysql"],"content":"\n\nå†…å­˜è¡¨çš„æ•°æ®ç»„ç»‡ç»“æ„\n\n\nInnoDB å¼•æ“æŠŠæ•°æ®æ”¾åœ¨ä¸»é”®ç´¢å¼•ä¸Šï¼Œå…¶ä»–ç´¢å¼•ä¸Šä¿å­˜çš„æ˜¯ä¸»é”® idã€‚è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºç´¢å¼•ç»„ç»‡è¡¨ï¼ˆIndex Organizied Tableï¼‰ã€‚\n\n\nè€Œ Memory å¼•æ“é‡‡ç”¨çš„æ˜¯æŠŠæ•°æ®å•ç‹¬å­˜æ”¾ï¼Œç´¢å¼•ä¸Šä¿å­˜æ•°æ®ä½ç½®çš„æ•°æ®ç»„ç»‡å½¢å¼ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºå †ç»„ç»‡è¡¨ï¼ˆHeap Organizied Tableï¼‰ã€‚\n\n\n\n\n\n\nInnoDB è¡¨çš„æ•°æ®æ€»æ˜¯æœ‰åºå­˜æ”¾çš„ï¼Œè€Œå†…å­˜è¡¨çš„æ•°æ®å°±æ˜¯æŒ‰ç…§å†™å…¥é¡ºåºå­˜æ”¾çš„ï¼›\n\n\n\n\nå½“æ•°æ®æ–‡ä»¶æœ‰ç©ºæ´çš„æ—¶å€™ï¼ŒInnoDB è¡¨åœ¨æ’å…¥æ–°æ•°æ®çš„æ—¶å€™ï¼Œä¸ºäº†ä¿è¯æ•°æ®æœ‰åºæ€§ï¼Œåªèƒ½åœ¨å›ºå®šçš„ä½ç½®å†™å…¥æ–°å€¼ï¼Œè€Œå†…å­˜è¡¨æ‰¾åˆ°ç©ºä½å°±å¯ä»¥æ’å…¥æ–°å€¼ï¼›\n\n\n\n\næ•°æ®ä½ç½®å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼ŒInnoDB è¡¨åªéœ€è¦ä¿®æ”¹ä¸»é”®ç´¢å¼•ï¼Œè€Œå†…å­˜è¡¨éœ€è¦ä¿®æ”¹æ‰€æœ‰ç´¢å¼•ï¼›\n\n\n\n\nInnoDB è¡¨ç”¨ä¸»é”®ç´¢å¼•æŸ¥è¯¢æ—¶éœ€è¦èµ°ä¸€æ¬¡ç´¢å¼•æŸ¥æ‰¾ï¼Œç”¨æ™®é€šç´¢å¼•æŸ¥è¯¢çš„æ—¶å€™ï¼Œéœ€è¦èµ°ä¸¤æ¬¡ç´¢å¼•æŸ¥æ‰¾ã€‚è€Œå†…å­˜è¡¨æ²¡æœ‰è¿™ä¸ªåŒºåˆ«ï¼Œæ‰€æœ‰ç´¢å¼•çš„â€œåœ°ä½â€éƒ½æ˜¯ç›¸åŒçš„ã€‚\n\n\n\n\nInnoDB æ”¯æŒå˜é•¿æ•°æ®ç±»å‹ï¼Œä¸åŒè®°å½•çš„é•¿åº¦å¯èƒ½ä¸åŒï¼›å†…å­˜è¡¨ä¸æ”¯æŒ Blob å’Œ Text å­—æ®µï¼Œå¹¶ä¸”å³ä½¿å®šä¹‰äº† varchar(N)ï¼Œå®é™…ä¹Ÿå½“ä½œ char(N)ï¼Œä¹Ÿå°±æ˜¯å›ºå®šé•¿åº¦å­—ç¬¦ä¸²æ¥å­˜å‚¨ï¼Œå› æ­¤å†…å­˜è¡¨çš„æ¯è¡Œæ•°æ®é•¿åº¦ç›¸åŒã€‚\n\n\n\n\n\nå†…å­˜è¡¨ä¹Ÿæ”¯æŒ B-Tree ç´¢å¼•çš„\n\nalter table t1 add index a_btree_index using btree (id);\n\n\n\nä¸å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨æ™®é€šå†…å­˜è¡¨\n\n\n\n\né”ç²’åº¦é—®é¢˜\n\n\n\nä¸æ”¯æŒè¡Œé”ï¼Œåªæ”¯æŒè¡¨é”\n\n\n\n\n\næ•°æ®æŒä¹…åŒ–é—®é¢˜\n\n\n\nM - S æ¶æ„ä¸‹ï¼Œæ¯”å¦‚å¤‡åº“é‡å¯ï¼Œå†…å­˜è¡¨è¢«æ¸…ç©ºï¼Œæ­¤æ—¶å†…å­˜è¡¨è¢«æ¸…ç©ºï¼Œå¯¼è‡´ä¸»å¤‡åŒæ­¥åœæ­¢\nåŒ M æ¶æ„ä¸‹ï¼Œåœ¨å¤‡åº“é‡å¯çš„æ—¶å€™ï¼Œå¤‡åº“ binlog é‡Œçš„ delete è¯­å¥å°±ä¼šä¼ åˆ°ä¸»åº“ï¼Œç„¶åæŠŠä¸»åº“å†…å­˜è¡¨çš„å†…å®¹åˆ é™¤ã€‚\n\n\n\n\n\nå»ºè®®æŠŠæ™®é€šå†…å­˜è¡¨éƒ½ç”¨ InnoDB ä»£æ›¿\n\n\nä¾‹å¤–ï¼šå†…å­˜ä¸´æ—¶è¡¨\n\n\n\nä¸´æ—¶è¡¨ä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹è®¿é—®ï¼Œæ²¡æœ‰å¹¶å‘æ€§çš„é—®é¢˜ï¼›\n\n\n\n\nä¸´æ—¶è¡¨é‡å¯åä¹Ÿæ˜¯éœ€è¦åˆ é™¤çš„ï¼Œæ¸…ç©ºæ•°æ®è¿™ä¸ªé—®é¢˜ä¸å­˜åœ¨ï¼›\n\n\n\n\nå¤‡åº“çš„ä¸´æ—¶è¡¨ä¹Ÿä¸ä¼šå½±å“ä¸»åº“çš„ç”¨æˆ·çº¿ç¨‹ã€‚\n\n\n\n\n\n\n\næ€è€ƒé¢˜\n\n\nå‡è®¾ä½ åˆšåˆšæ¥æ‰‹çš„ä¸€ä¸ªæ•°æ®åº“ä¸Šï¼ŒçœŸçš„å‘ç°äº†ä¸€ä¸ªå†…å­˜è¡¨ã€‚å¤‡åº“é‡å¯ä¹‹åè‚¯å®šæ˜¯ä¼šå¯¼è‡´å¤‡åº“çš„å†…å­˜è¡¨æ•°æ®è¢«æ¸…ç©ºï¼Œè¿›è€Œå¯¼è‡´ä¸»å¤‡åŒæ­¥åœæ­¢ã€‚è¿™æ—¶ï¼Œæœ€å¥½çš„åšæ³•æ˜¯å°†å®ƒä¿®æ”¹æˆ InnoDB å¼•æ“è¡¨ã€‚\n\n\nå‡è®¾å½“æ—¶çš„ä¸šåŠ¡åœºæ™¯æš‚æ—¶ä¸å…è®¸ä½ ä¿®æ”¹å¼•æ“ï¼Œä½ å¯ä»¥åŠ ä¸Šä»€ä¹ˆè‡ªåŠ¨åŒ–é€»è¾‘ï¼Œæ¥é¿å…ä¸»å¤‡åŒæ­¥åœæ­¢å‘¢ï¼Ÿ\n\nå…ˆé¿å…å¤‡åº“é‡å¯çš„æ—¶å€™æ•°æ®ä¸¢å¤±ï¼šset sql_log_bin=off;alter table tbl_name engine=innodb;ç”±äºä¸»åº“é‡å¯åï¼Œä¼šå¾€ binlog å†™ delete from tbl_nameï¼Œä¼ åˆ°å¤‡åº“ï¼Œå¤‡åº“çš„åŒåçš„è¡¨æ•°æ®ä¹Ÿä¼šè¢«æ¸…ç©ºï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°ä¸»å¤‡åŒæ­¥åœæ­¢çš„é—®é¢˜\nå¦‚æœä¸»åº“å˜æˆæ–°å¤‡åº“ï¼Œé‡å¤ä¸Šé¢çš„æ“ä½œ\næ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬ä¸èƒ½ç›´æ¥ä¿®æ”¹ä¸»åº“ä¸Šçš„è¡¨å¼•æ“ï¼Œå¯ä»¥é…ç½®ä¸€ä¸ªè‡ªåŠ¨å·¡æ£€çš„å·¥å…·ï¼Œåœ¨å¤‡åº“ä¸Šå‘ç°å†…å­˜è¡¨å°±æŠŠå¼•æ“æ”¹äº†ã€‚\n\n\n\n\n"},"å­¦ä¹ ç¬”è®°/MySQL-å®æˆ˜-45-è®²/39ï½œè‡ªå¢ä¸»é”®ä¸ºä»€ä¹ˆä¸æ˜¯è¿ç»­çš„ï¼Ÿ":{"title":"39ï½œè‡ªå¢ä¸»é”®ä¸ºä»€ä¹ˆä¸æ˜¯è¿ç»­çš„ï¼Ÿ","links":[],"tags":["mysql"],"content":"\n\nè‡ªå¢å€¼ä¿å­˜åœ¨å“ªå„¿ï¼Ÿ\n\n\nè¡¨çš„ç»“æ„å®šä¹‰å­˜æ”¾åœ¨åç¼€åä¸º.frm çš„æ–‡ä»¶ä¸­ï¼Œä½†æ˜¯å¹¶ä¸ä¼šä¿å­˜è‡ªå¢å€¼ã€‚\n\n\nMyISAM å¼•æ“çš„è‡ªå¢å€¼ä¿å­˜åœ¨æ•°æ®æ–‡ä»¶ä¸­ã€‚\n\n\nInnoDB\n\nåœ¨ MySQL 5.7 åŠä¹‹å‰çš„ç‰ˆæœ¬ï¼Œè‡ªå¢å€¼ä¿å­˜åœ¨å†…å­˜é‡Œï¼Œå¹¶æ²¡æœ‰æŒä¹…åŒ–ã€‚æ¯æ¬¡é‡å¯åï¼Œç¬¬ä¸€æ¬¡æ‰“å¼€è¡¨çš„æ—¶å€™ï¼Œéƒ½ä¼šå»æ‰¾è‡ªå¢å€¼çš„æœ€å¤§å€¼ max(id)ï¼Œç„¶åå°† max(id)+1 ä½œä¸ºè¿™ä¸ªè¡¨å½“å‰çš„è‡ªå¢å€¼ã€‚\nåœ¨ MySQL 8.0 ç‰ˆæœ¬ï¼Œå°†è‡ªå¢å€¼çš„å˜æ›´è®°å½•åœ¨äº† redo log ä¸­ï¼Œé‡å¯çš„æ—¶å€™ä¾é  redo log æ¢å¤é‡å¯ä¹‹å‰çš„å€¼ã€‚\n\n\n\n\n\nè‡ªå¢å€¼ä¿®æ”¹æœºåˆ¶\n\n\n\nå¦‚æœæ’å…¥æ•°æ®æ—¶ id å­—æ®µæŒ‡å®šä¸º 0ã€null æˆ–æœªæŒ‡å®šå€¼ï¼Œé‚£ä¹ˆå°±æŠŠè¿™ä¸ªè¡¨å½“å‰çš„ AUTO_INCREMENT å€¼å¡«åˆ°è‡ªå¢å­—æ®µï¼›\n\n\n\n\n\nå¦‚æœæ’å…¥æ•°æ®æ—¶ id å­—æ®µæŒ‡å®šäº†å…·ä½“çš„å€¼ï¼Œå°±ç›´æ¥ä½¿ç”¨è¯­å¥é‡ŒæŒ‡å®šçš„å€¼ã€‚\n\n\n\nå¦‚æœå¤§äºå½“å‰è‡ªå¢å€¼ï¼Œåˆ™ä¼šå°†æ’å…¥çš„å€¼çš„ä¸‹ä¸€ä¸ªå¤§äºçš„å€¼ä½œä¸ºè‡ªå¢å€¼ï¼ˆåŸºäºæ­¥é•¿ï¼‰\n\n\n\n\n\nè‡ªå¢å€¼çš„ä¿®æ”¹æ—¶æœº\n\n\ninsert into t values(null, 1, 1);Â å‘ç°æ²¡æŒ‡å®šè‡ªå¢å€¼ï¼Œè·å–è¡¨å½“å‰çš„è‡ªå¢å€¼ï¼ˆå‡è®¾æ˜¯ 2ï¼‰å°†ä¼ å…¥çš„è¡Œæ”¹æˆ (2, 1, 1)å°†è¡¨çš„è‡ªå¢å€¼æ”¹æˆ 3ç»§ç»­æ‰§è¡Œæ’å…¥æ“ä½œå‘ç”Ÿå”¯ä¸€é”®å†²çªï¼Œæ’å…¥å¤±è´¥\n\nç¬¬ä¸€ç§åŸå› ï¼šå”¯ä¸€é”®å†²çª\n\n\n\nç¬¬äºŒç§åŸå› ï¼šäº‹åŠ¡å›æ»šï¼Œè‡ªå¢å€¼ä¸å›é€€\n\nä¸¤ä¸ªäº‹åŠ¡ï¼Œå‰ä¸€ä¸ªæ‹¿åˆ°è‡ªå¢å€¼ï¼Œåä¸€ä¸ªå†æ‹¿åˆ°è‡ªå¢å€¼ï¼Œå‰ä¸€ä¸ªæ‰§è¡Œå¤±è´¥ï¼Œå¦‚æœå›é€€ï¼Œå°†å¯¼è‡´ä¸»é”®å†²çª\nä¸ºäº†è§£å†³ä¸»é”®å†²çªæœ‰ä¸¤ç§æ–¹æ³•ï¼Œä½†æ˜¯å½±å“æ€§èƒ½\n\n\n\n\n\nè‡ªå¢é”çš„ä¼˜åŒ–\n\n\nMySQL 5.0 ç‰ˆæœ¬ï¼Œè‡ªå¢é”çš„èŒƒå›´æ˜¯è¯­å¥çº§åˆ«ï¼Œç­‰è¯­å¥æ‰§è¡Œå®Œæ‰é‡Šæ”¾ï¼Œå½±å“å¹¶å‘åº¦\n\n\nMySQL 5.1.22 å¼•å…¥ä¸€ä¸ªæ–°ç­–ç•¥ï¼Œæ–°å¢å‚æ•° innodb_autoinc_lock_modeï¼Œé»˜è®¤å€¼ 1\n\n\n\nè¿™ä¸ªå‚æ•°çš„å€¼è¢«è®¾ç½®ä¸º 0 æ—¶ï¼Œè¡¨ç¤ºé‡‡ç”¨ä¹‹å‰ MySQL 5.0 ç‰ˆæœ¬çš„ç­–ç•¥\n\n\n\n\n\nè¿™ä¸ªå‚æ•°çš„å€¼è¢«è®¾ç½®ä¸º 1 æ—¶ï¼šÂ  a. æ™®é€š insert è¯­å¥ï¼Œè‡ªå¢é”åœ¨ç”³è¯·ä¹‹åå°±é©¬ä¸Šé‡Šæ”¾ï¼›Â  b. ç±»ä¼¼ insert â€¦ select è¿™æ ·çš„æ‰¹é‡æ’å…¥æ•°æ®çš„è¯­å¥ï¼Œè‡ªå¢é”è¿˜æ˜¯è¦ç­‰è¯­å¥ç»“æŸåæ‰è¢«é‡Šæ”¾ï¼›\n\n\n\nå…³äº bï¼Œå¦‚æœåƒå‚æ•°è®¾ç½® 2 ä¸€æ ·ï¼Œå°†ä¼šå¯¼è‡´ä¸»å¤‡ä¸ä¸€è‡´ï¼ˆbinlog_format=statementï¼‰ï¼Œå› ä¸ºäº‹åŠ¡çš„ binlog æ˜¯è®°å½•åˆ°ä¸€èµ·çš„ï¼Œåœ¨å¤‡åº“æ˜¯è¿ç»­ï¼Œä½†åœ¨ä¸»åº“æ—¶å´ä¸ä¸€å®šæ˜¯è¿ç»­æ‹¿åˆ°è‡ªå¢å€¼\nè¿™é‡Œè¯´çš„æ‰¹é‡æ’å…¥æ•°æ®ï¼ŒåŒ…å«çš„è¯­å¥ç±»å‹æ˜¯ insert â€¦ selectã€replace â€¦ select å’Œ load data è¯­å¥ã€‚\nb çš„è®¾å®šæ˜¯å› ä¸ºâ€œä¸çŸ¥é“è¦é¢„å…ˆç”³è¯·å¤šå°‘ä¸ª idâ€\n\n\n\n\n\nè¿™ä¸ªå‚æ•°çš„å€¼è¢«è®¾ç½®ä¸º 2 æ—¶ï¼Œæ‰€æœ‰çš„ç”³è¯·è‡ªå¢ä¸»é”®çš„åŠ¨ä½œéƒ½æ˜¯ç”³è¯·åå°±é‡Šæ”¾é”ã€‚\n\n\n\næ¨èï¼Œéœ€é…åˆ binlog_format=row\n\n\n\n\n\nåœ¨ 8.0.3 ç‰ˆæœ¬åï¼Œinnodb_autoinc_lock_mode é»˜è®¤å€¼å·²æ˜¯ 2\n\n\n\n\nå¯¹äºæ‰¹é‡æ’å…¥æ•°æ®çš„è¯­å¥ï¼ŒMySQL æœ‰ä¸€ä¸ªæ‰¹é‡ç”³è¯·è‡ªå¢ id çš„ç­–ç•¥ï¼š\n\n\n\nè¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œç¬¬ä¸€æ¬¡ç”³è¯·è‡ªå¢ idï¼Œä¼šåˆ†é… 1 ä¸ªï¼›\n\n\n\n\n1 ä¸ªç”¨å®Œä»¥åï¼Œè¿™ä¸ªè¯­å¥ç¬¬äºŒæ¬¡ç”³è¯·è‡ªå¢ idï¼Œä¼šåˆ†é… 2 ä¸ªï¼›\n\n\n\n\nä¾æ­¤ç±»æ¨ï¼ŒåŒä¸€ä¸ªè¯­å¥å»ç”³è¯·è‡ªå¢ idï¼Œæ¯æ¬¡ç”³è¯·åˆ°çš„è‡ªå¢ id ä¸ªæ•°éƒ½æ˜¯ä¸Šä¸€æ¬¡çš„ä¸¤å€ã€‚\n\n\n\næœ€åä¸€æ¬¡ç”³è¯·çš„å¦‚æœæ²¡ç”¨å®Œå°±æµªè´¹æ‰äº†\n\nç¬¬ä¸‰ç§åŸå› \n\n\n\n\n\næ€è€ƒé¢˜\n\nåœ¨æœ€åä¸€ä¸ªä¾‹å­ä¸­ï¼Œæ‰§è¡Œ insert into t2(c,d) select c,d from t; è¿™ä¸ªè¯­å¥çš„æ—¶å€™ï¼Œå¦‚æœéš”ç¦»çº§åˆ«æ˜¯å¯é‡å¤è¯»ï¼ˆrepeatable readï¼‰ï¼Œbinlog_format=statementã€‚è¿™ä¸ªè¯­å¥ä¼šå¯¹è¡¨ t çš„æ‰€æœ‰è®°å½•å’Œé—´éš™åŠ é”ã€‚\nä½ è§‰å¾—ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¹ˆåšå‘¢ï¼Ÿ\n\n\n\nè¯„è®ºåŒº\n\n\nåœ¨ binlog ä¸º statement çš„æƒ…å†µä¸‹ã€‚è¯­å¥ A å…ˆè·å– id=1ï¼Œç„¶å B è·å– id=2ï¼Œæ¥ç€ B æäº¤ï¼Œå†™ binlogï¼Œå† A å†™ binlogã€‚è¿™ä¸ªæ—¶å€™å¦‚æœ binlog é‡æ”¾ï¼Œæ˜¯ä¸æ˜¯ä¼šå‘ç”Ÿ B çš„ id ä¸º 1ï¼Œè€Œ Açš„ id ä¸º 2 çš„ä¸ä¸€è‡´çš„æƒ…å†µï¼Ÿ\n\n\nä¸ä¼šå› ä¸º binlog åœ¨è®°å½•è¿™ç§å¸¦è‡ªå¢å€¼çš„è¯­å¥ä¹‹å‰ï¼Œä¼šåœ¨å‰é¢å¤šä¸€å¥ï¼Œç”¨äºæŒ‡å®šâ€œæ¥ä¸‹æ¥è¿™ä¸ªè¯­å¥è¦éœ€è¦çš„ è‡ªå¢ ID å€¼æ˜¯å¤šå°‘â€ï¼Œè€Œè¿™ä¸ªå€¼ï¼Œæ˜¯åœ¨ä¸»åº“ä¸Šè¿™ä¸€è¡Œæ’å…¥æˆåŠŸåå¯¹åº”çš„è‡ªå¢å€¼ï¼Œæ‰€ä»¥æ˜¯ä¸€è‡´çš„\n\nè·Ÿè¿™é‡Œä¸å†²çªï¼Œå› ä¸ºè¿™é‡Œæ˜¯åœ¨è¯´ä¸»åº“äº‹åŠ¡ä¸­ä¸èƒ½è¿ç»­æ‹¿åˆ°çš„é—®é¢˜\n\n\n\n\n\n\n"},"å­¦ä¹ ç¬”è®°/MySQL-å®æˆ˜-45-è®²/40ï½œinsert-è¯­å¥çš„é”ä¸ºä»€ä¹ˆè¿™ä¹ˆå¤šï¼Ÿ":{"title":"40ï½œinsert è¯­å¥çš„é”ä¸ºä»€ä¹ˆè¿™ä¹ˆå¤šï¼Ÿ","links":[],"tags":["mysql"],"content":"\n\ninsert â€¦ select è¯­å¥\n\n\nå¹¶å‘ insert åœºæ™¯\n\n\n\n\n\nå®é™…çš„æ‰§è¡Œæ•ˆæœæ˜¯ï¼Œå¦‚æœ session B å…ˆæ‰§è¡Œï¼Œç”±äºè¿™ä¸ªè¯­å¥å¯¹è¡¨ t ä¸»é”®ç´¢å¼•åŠ äº† (-âˆ,1]è¿™ä¸ª next-key lockï¼Œä¼šåœ¨è¯­å¥æ‰§è¡Œå®Œæˆåï¼Œæ‰å…è®¸ session A çš„ insert è¯­å¥æ‰§è¡Œã€‚\n\n\nä½†å¦‚æœæ²¡æœ‰é”çš„è¯ï¼Œå°±å¯èƒ½å‡ºç° session B çš„ insert è¯­å¥å…ˆæ‰§è¡Œï¼Œä½†æ˜¯åå†™å…¥ binlog çš„æƒ…å†µã€‚äºæ˜¯ï¼Œåœ¨ binlog_format=statement çš„æƒ…å†µä¸‹ï¼Œbinlog é‡Œé¢å°±è®°å½•äº†è¿™æ ·çš„è¯­å¥åºåˆ—ï¼šinsert into t values(-1,-1,-1);insert into t2(c,d) select c,d from t;è¿™ä¸ªè¯­å¥åˆ°äº†å¤‡åº“æ‰§è¡Œï¼Œå°±ä¼šæŠŠ id=-1 è¿™ä¸€è¡Œä¹Ÿå†™åˆ°è¡¨ t2 ä¸­ï¼Œå‡ºç°ä¸»å¤‡ä¸ä¸€è‡´ã€‚\n\n\n\n\næ˜¯å¾ˆå¸¸è§çš„åœ¨ä¸¤ä¸ªè¡¨ä¹‹é—´æ‹·è´æ•°æ®çš„æ–¹æ³•\n\n\nåœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œè¿™ä¸ªè¯­å¥ä¼šç»™ select çš„è¡¨é‡Œæ‰«æåˆ°çš„è®°å½•å’Œé—´éš™åŠ è¯»é”ã€‚\n\n\n\n\ninsert å¾ªç¯å†™å…¥\n\n\nå¦‚æœ insert å’Œ select çš„å¯¹è±¡æ˜¯åŒä¸€ä¸ªè¡¨ï¼Œåˆ™æœ‰å¯èƒ½ä¼šé€ æˆå¾ªç¯å†™å…¥ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥ç”¨æˆ·ä¸´æ—¶è¡¨æ¥åšä¼˜åŒ–ã€‚\n\n\næ€•è¾¹éå†åŸè¡¨è¾¹æ’å…¥æ•°æ®ä¼šæŸ¥åˆ°åˆšæ’å…¥çš„æ–°æ•°æ®ï¼Œæ‰€ä»¥ä¼šå…ˆæŠŠæŸ¥è¯¢ç»“æœæ”¾åˆ°ä¸´æ—¶è¡¨ï¼Œå†å–å‡ºæ¥è¿›è¡Œæ’å…¥æ“ä½œ\n\n\nè¿™é‡Œéœ€è¦ç»™å­æŸ¥è¯¢åŠ å…¥ limitï¼Œä¸ç„¶å°±ä¼šå…¨è¡¨æ‰«æï¼Œå¯¼è‡´ç»™æ‰€æœ‰è®°å½•å’Œç©ºéš™åŠ é”\n\n8.x ä¼˜åŒ–äº†\n\n\n\n\n\ninsert å”¯ä¸€é”®å†²çª\n\n\n\n\n\ninsert è¯­å¥å¦‚æœå‡ºç°å”¯ä¸€é”®å†²çªï¼Œä¼šåœ¨å†²çªçš„å”¯ä¸€å€¼ä¸ŠåŠ å…±äº«çš„ next-key lock(S é”)ã€‚å› æ­¤ï¼Œç¢°åˆ°ç”±äºå”¯ä¸€é”®çº¦æŸå¯¼è‡´æŠ¥é”™åï¼Œè¦å°½å¿«æäº¤æˆ–å›æ»šäº‹åŠ¡ï¼Œé¿å…åŠ é”æ—¶é—´è¿‡é•¿ã€‚\n\n\nå”¯ä¸€é”®å†²çªåŠ é”\n\n\nä¸€ä¸ªç»å…¸çš„æ­»é”åœºæ™¯\n\n\n\n\n\nA å…ˆåŠ é”ï¼ŒBã€C å‘ç°å”¯ä¸€é”®å†²çªï¼ˆc æ˜¯å”¯ä¸€ç´¢å¼•ï¼Œæ‰€ä»¥è¯»æ˜¯å½“å‰è¯»ï¼‰ï¼Œéƒ½åŠ ä¸Šè¯»é”ï¼ˆé—´éš™é”ä¸äº’æ–¥æ‰€ä»¥åŠ æˆåŠŸï¼Œè¯»ã€å†™é”ä¼šäº’æ–¥ï¼Œæ‰€ä»¥éƒ½åœ¨ç­‰å¾…è¡Œé”é‡Šæ”¾ï¼‰ï¼ŒA å›æ»šï¼ŒBã€C ç»§ç»­æ‰§è¡Œï¼Œéƒ½è¦åŠ ä¸Šå†™é”ï¼Œäº’ç›¸ç­‰å¾…å¯¹æ–¹çš„è¡Œé”ï¼Œäºæ˜¯å‡ºç°äº†æ­»é”\n\n\n\n\n\n\ninsert into â€¦ on duplicate key update\n\n\nè¿™ä¸ªè¯­ä¹‰çš„é€»è¾‘æ˜¯ï¼Œæ’å…¥ä¸€è¡Œæ•°æ®ï¼Œå¦‚æœç¢°åˆ°å”¯ä¸€é”®çº¦æŸï¼Œå°±æ‰§è¡Œåé¢çš„æ›´æ–°è¯­å¥ã€‚\n\nä¼šç»™ç´¢å¼• c ä¸Š (5,10] åŠ ä¸€ä¸ªæ’ä»–çš„ next-key lockï¼ˆå†™é”ï¼‰ã€‚\n\n\n\nå¦‚æœæœ‰å¤šä¸ªåˆ—è¿åäº†å”¯ä¸€æ€§çº¦æŸï¼Œå°±ä¼šæŒ‰ç…§ç´¢å¼•çš„é¡ºåºï¼Œä¿®æ”¹è·Ÿç¬¬ä¸€ä¸ªç´¢å¼•å†²çªçš„è¡Œã€‚\n\n\næ‰§è¡Œè¿™æ¡è¯­å¥çš„ affected rows è¿”å›çš„æ˜¯ 2ï¼Œå¾ˆå®¹æ˜“é€ æˆè¯¯è§£ã€‚\n\nçœŸæ­£æ›´æ–°çš„åªæœ‰ä¸€è¡Œï¼Œåªæ˜¯åœ¨ä»£ç å®ç°ä¸Šï¼Œinsert å’Œ update éƒ½è®¤ä¸ºè‡ªå·±æˆåŠŸäº†ï¼Œupdate è®¡æ•°åŠ äº† 1ï¼Œ insert è®¡æ•°ä¹ŸåŠ äº† 1ã€‚\n\n\n\n\n\nè¯„è®ºåŒº\n\nå…³äº insert é€ æˆæ­»é”çš„æƒ…å†µï¼Œå¹¶éåªæœ‰ insertï¼Œdelete å’Œ update éƒ½å¯èƒ½é€ æˆæ­»é”é—®é¢˜ï¼Œæ ¸å¿ƒè¿˜æ˜¯æ’å…¥å”¯ä¸€å€¼å†²çªå¯¼è‡´çš„çº¿ä¸Šçš„å¤„ç†åŠæ³•å¯ä»¥æ˜¯ 1 å»æ‰å”¯ä¸€å€¼æ£€æµ‹ 2 å‡å°‘é‡å¤å€¼çš„æ’å…¥ 3 é™ä½å¹¶å‘çº¿ç¨‹æ•°é‡\nå…³äºæ•°æ®æ‹·è´å¤§è¡¨ï¼Œå»ºè®®é‡‡ç”¨ pt-archiverï¼Œè¿™ä¸ªå·¥å…·èƒ½è‡ªåŠ¨æ§åˆ¶é¢‘ç‡å’Œé€Ÿåº¦ï¼Œå»ºè®®åœ¨ä½å³°æœŸè¿›è¡Œæ•°æ®æ“ä½œ\nä¸€èˆ¬ select â€¦lock in share mode å°±æ˜¯å…±äº«é”ï¼›select â€¦ for update å’Œ IUD è¯­å¥ï¼Œå°±æ˜¯æ’ä»–é”ã€‚\n\n\n"},"å­¦ä¹ ç¬”è®°/MySQL-å®æˆ˜-45-è®²/41ï½œæ€ä¹ˆæœ€å¿«åœ°å¤åˆ¶ä¸€å¼ è¡¨ï¼Ÿ":{"title":"41ï½œæ€ä¹ˆæœ€å¿«åœ°å¤åˆ¶ä¸€å¼ è¡¨ï¼Ÿ","links":[],"tags":["mysql"],"content":"\n\né€»è¾‘å¯¼æ•°æ®\n\n\nåœ¨ä¸¤å¼ è¡¨ä¸­æ‹·è´æ•°æ®ï¼Œæœ€ç®€å•åœ°ä½¿ç”¨ insert â€¦ select è¯­å¥å³å¯å®ç°\n\n\nå°†æ•°æ®å†™åˆ°å¤–éƒ¨æ–‡æœ¬æ–‡ä»¶ï¼Œç„¶åå†å†™å›ç›®æ ‡è¡¨\n\n\n\n\nmysqldump æ–¹æ³•\n\n\n\n\na. å°†æ•°æ®å¯¼å‡ºæˆä¸€ç»„ INSERT è¯­å¥ï¼šmysqldump -hhostâˆ’Pport -u$user â€”add-locks=0 â€”no-create-info â€”single-transaction â€”set-gtid-purged=OFF db1 t â€”where=â€œa&gt;900â€ â€”result-file=/client_tmp/t.sql\n\n\nb. å°†ç»“æœæ‹¿åˆ°ç›®æ ‡åº“é‡Œæ‰§è¡Œï¼šmysql -h127.0.0.1 -P13000 -uroot db2 -e â€œsource /client_tmp/t.sqlâ€\n\nsource å¹¶ä¸æ˜¯ä¸€æ¡ SQL è¯­å¥ï¼Œè€Œæ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯å‘½ä»¤ã€‚1. æ‰“å¼€æ–‡ä»¶ï¼Œé»˜è®¤ä»¥åˆ†å·ä¸ºç»“å°¾è¯»å–ä¸€æ¡æ¡çš„ SQL è¯­å¥ï¼›2. å°† SQL è¯­å¥å‘é€åˆ°æœåŠ¡ç«¯æ‰§è¡Œ\nbinlog è®°å½•äº†çœŸæ­£è¢«æ‰§è¡Œçš„ INSERT è¯­å¥\n\n\n\n\n\n\n\nå¯¼å‡º CSV æ–‡ä»¶\n\n\n\n\na. å°†æŸ¥è¯¢ç»“æœå¯¼å‡ºåˆ°æœåŠ¡ç«¯æœ¬åœ°ç›®å½•select * from db1.t where a&gt;900 into outfile â€˜/server_tmp/t.csvâ€™;\n\n\nä¼šå°†ç»“æœä¿å­˜åœ¨æœåŠ¡ç«¯\n\n\nsecure_file_priv é™åˆ¶æ–‡ä»¶ç”Ÿæˆä½ç½®\n\nemptyï¼šä¸é™åˆ¶\nè·¯å¾„å­—ç¬¦ä¸²ï¼šåªèƒ½åœ¨è¿™ä¸ªæŒ‡å®šç›®å½•æˆ–å®ƒçš„å­ç›®å½•ä¸‹\nNULLï¼šç¦æ­¢æ‰§è¡Œ select â€¦ into outfile\n\n\n\né‡åˆ°åŒåæ–‡ä»¶æŠ¥é”™\n\n\nè¯¥å‘½ä»¤ä¸ä¼šç”Ÿæˆè¡¨ç»“æ„æ–‡ä»¶\n\nmysqldump æä¾›äº†ä¸€ä¸ªâ€“tab å‚æ•°ï¼Œå¯ä»¥åŒæ—¶å¯¼å‡ºè¡¨ç»“æ„å®šä¹‰æ–‡ä»¶å’Œ csv æ•°æ®æ–‡ä»¶mysqldump -hhostâˆ’Pport -uuserâˆ’âˆ’âˆ’singleâˆ’transactionâˆ’âˆ’setâˆ’gtidâˆ’purged=OFFdb1tâˆ’âˆ’where=&quot;a&gt;900&quot;âˆ’âˆ’tab=secure_file_priv\n\n\n\n\n\nb. load dataÂ  å‘½ä»¤å°†æ•°æ®å¯¼å…¥ç›®æ ‡è¡¨ï¼šload data infile â€˜/server_tmp/t.csvâ€™ into table db2.t;\n\n\nå¦‚æœ binlog_format=statementï¼Œ1. ä¸»åº“æ‰§è¡Œå®Œæˆåï¼Œå°† /server_tmp/t.csv æ–‡ä»¶çš„å†…å®¹ç›´æ¥å†™åˆ° binlog æ–‡ä»¶ä¸­ã€‚2. å¾€ binlog æ–‡ä»¶ä¸­å†™å…¥è¯­å¥ load data local infile â€˜/tmp/SQL_LOAD_MB-1-0â€™ INTO TABLE db2.tã€‚3. æŠŠè¿™ä¸ª binlog æ—¥å¿—ä¼ åˆ°å¤‡åº“ã€‚4. å¤‡åº“çš„ apply çº¿ç¨‹åœ¨æ‰§è¡Œè¿™ä¸ªäº‹åŠ¡æ—¥å¿—æ—¶ï¼šÂ  a. å…ˆå°† binlog ä¸­ t.csv æ–‡ä»¶çš„å†…å®¹è¯»å‡ºæ¥ï¼Œå†™å…¥åˆ°æœ¬åœ°ä¸´æ—¶ç›®å½• /tmp/SQL_LOAD_MB-1-0 ä¸­ï¼›Â  b. å†æ‰§è¡Œ load data è¯­å¥ï¼Œå¾€å¤‡åº“çš„ db2.t è¡¨ä¸­æ’å…¥è·Ÿä¸»åº“ç›¸åŒçš„æ•°æ®ã€‚\n\n\n\n\n\nload data å‘½ä»¤æœ‰ä¸¤ç§ç”¨æ³•ï¼š\n\n\n\nä¸åŠ â€œlocalâ€ï¼Œæ˜¯è¯»å–æœåŠ¡ç«¯çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å¿…é¡»åœ¨ secure_file_priv æŒ‡å®šçš„ç›®å½•æˆ–å­ç›®å½•ä¸‹ï¼›\n\n\n\n\nåŠ ä¸Šâ€œlocalâ€ï¼Œè¯»å–çš„æ˜¯å®¢æˆ·ç«¯çš„æ–‡ä»¶ï¼Œåªè¦ mysql å®¢æˆ·ç«¯æœ‰è®¿é—®è¿™ä¸ªæ–‡ä»¶çš„æƒé™å³å¯ã€‚è¿™æ—¶å€™ï¼ŒMySQL å®¢æˆ·ç«¯ä¼šå…ˆæŠŠæœ¬åœ°æ–‡ä»¶ä¼ ç»™æœåŠ¡ç«¯ï¼Œç„¶åæ‰§è¡Œä¸Šè¿°çš„ load data æµç¨‹ã€‚\n\n\n\n\n\n\n\n\n\n\n\néƒ½å¯ä»¥è·¨å¼•æ“ä½¿ç”¨\n\n\n\n\nç‰©ç†æ‹·è´æ–¹æ¡ˆï¼ˆæœ€å¿«ï¼‰\n\n\nMySQL 5.6\n\n\n\næ‰§è¡Œ create table r like tï¼Œåˆ›å»ºä¸€ä¸ªç›¸åŒè¡¨ç»“æ„çš„ç©ºè¡¨ï¼›\n\n\n\n\næ‰§è¡Œ alter table r discard tablespaceï¼Œè¿™æ—¶å€™ r.ibd æ–‡ä»¶ä¼šè¢«åˆ é™¤ï¼›\n\n\n\n\næ‰§è¡Œ flush table t for exportï¼Œè¿™æ—¶å€™ db1 ç›®å½•ä¸‹ä¼šç”Ÿæˆä¸€ä¸ª t.cfg æ–‡ä»¶ï¼›\n\n\n\n\nåœ¨ db1 ç›®å½•ä¸‹æ‰§è¡Œ cp t.cfg r.cfg; cp t.ibd r.ibdï¼›è¿™ä¸¤ä¸ªå‘½ä»¤ï¼ˆè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ‹·è´å¾—åˆ°çš„ä¸¤ä¸ªæ–‡ä»¶ï¼ŒMySQL è¿›ç¨‹è¦æœ‰è¯»å†™æƒé™ï¼‰ï¼›\n\n\n\n\næ‰§è¡Œ unlock tablesï¼Œè¿™æ—¶å€™ t.cfg æ–‡ä»¶ä¼šè¢«åˆ é™¤ï¼›\n\n\n\n\næ‰§è¡Œ alter table r import tablespaceï¼Œå°†è¿™ä¸ª r.ibd æ–‡ä»¶ä½œä¸ºè¡¨ r çš„æ–°çš„è¡¨ç©ºé—´ï¼Œç”±äºè¿™ä¸ªæ–‡ä»¶çš„æ•°æ®å†…å®¹å’Œ t.ibd æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥è¡¨ r ä¸­å°±æœ‰äº†å’Œè¡¨ t ç›¸åŒçš„æ•°æ®ã€‚\n\n\n\n\n\nåªèƒ½å…¨è¡¨æ‹·è´\n\n\néœ€è¦åˆ°æœåŠ¡å™¨ä¸Šæ‹·è´æ•°æ®ï¼Œæ— æ³•ç™»å½•æ•°æ®åº“ä¸»æœºæ—¶æ— æ³•ä½¿ç”¨\n\n\nInnoDB ä¸“å±\n\n\n\n\næ€è€ƒé¢˜\n\n\næˆ‘ä»¬å‰é¢ä»‹ç» binlog_format=statement çš„æ—¶å€™ï¼Œbinlog è®°å½•çš„ load data å‘½ä»¤æ˜¯å¸¦ local çš„ã€‚æ—¢ç„¶è¿™æ¡å‘½ä»¤æ˜¯å‘é€åˆ°å¤‡åº“å»æ‰§è¡Œçš„ï¼Œé‚£ä¹ˆå¤‡åº“æ‰§è¡Œçš„æ—¶å€™ä¹Ÿæ˜¯æœ¬åœ°æ‰§è¡Œï¼Œä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ª local å‘¢ï¼Ÿ\n\n\n\nä¸ºäº†ç¡®ä¿å¤‡åº“åº”ç”¨ binlog æ­£å¸¸ã€‚å› ä¸ºå¤‡åº“å¯èƒ½é…ç½®äº† secure_file_priv=nullï¼Œæ‰€ä»¥å¦‚æœä¸ç”¨ local çš„è¯ï¼Œå¯èƒ½ä¼šå¯¼å…¥å¤±è´¥ï¼Œé€ æˆä¸»å¤‡åŒæ­¥å»¶è¿Ÿã€‚\n\n\n\n\nä½¿ç”¨ mysqlbinlog å·¥å…·è§£æ binlog æ–‡ä»¶ï¼Œå¹¶åº”ç”¨åˆ°ç›®æ ‡åº“çš„æƒ…å†µã€‚ä½¿ç”¨ä¸‹é¢å‘½ä»¤ ï¼šmysqlbinlog binlogfâ€‹ileâˆ£mysqlâˆ’hhost -Pportâˆ’uuser -ppwdæŠŠæ—¥å¿—ç›´æ¥è§£æå‡ºæ¥å‘ç»™ç›®æ ‡åº“æ‰§è¡Œã€‚å¢åŠ localï¼Œå°±èƒ½è®©è¿™ä¸ªæ–¹æ³•æ”¯æŒéæœ¬åœ°çš„hostã€‚\n\n\n\n\n\nå¦‚æœå†™åˆ° binlog ä¸­çš„å‘½ä»¤ä¸å¸¦ localï¼Œåˆä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ\n\n\n\n"},"å­¦ä¹ ç¬”è®°/MySQL-å®æˆ˜-45-è®²/42ï½œgrant-ä¹‹åè¦è·Ÿç€-flush-privileges-å—ï¼Ÿ":{"title":"42ï½œgrant ä¹‹åè¦è·Ÿç€ flush privileges å—ï¼Ÿ","links":[],"tags":["mysql"],"content":"\n\nä¸ç”¨\n\n\nåœ¨ MySQL é‡Œé¢ï¼Œç”¨æˆ·å (user)+ åœ°å€ (host) æ‰è¡¨ç¤ºä¸€ä¸ªç”¨æˆ·ï¼Œå› æ­¤ ua@ip1 å’Œ ua@ip2 ä»£è¡¨çš„æ˜¯ä¸¤ä¸ªä¸åŒçš„ç”¨æˆ·ã€‚\n\n\nå…¨å±€æƒé™\n\n\nä¿å­˜åœ¨ mysql.user è¡¨\n\n\nç»™ç”¨æˆ· ua èµ‹ä¸€ä¸ªæœ€é«˜æƒé™ï¼Œè¯­å¥ï¼šgrant all privileges on . to â€˜uaâ€™@â€™%â€™ with grant option;\n\nåŒæ—¶æ›´æ–°äº†ç£ç›˜å’Œå†…å­˜\n\n\nç£ç›˜ä¸Šï¼Œå°† mysql.user è¡¨é‡Œï¼Œç”¨æˆ·â€™uaâ€™@â€™%â€˜è¿™ä¸€è¡Œçš„æ‰€æœ‰è¡¨ç¤ºæƒé™çš„å­—æ®µçš„å€¼éƒ½ä¿®æ”¹ä¸ºâ€˜Yâ€™ï¼›\n\n\n\n\nå†…å­˜é‡Œï¼Œä»æ•°ç»„ acl_users ä¸­æ‰¾åˆ°è¿™ä¸ªç”¨æˆ·å¯¹åº”çš„å¯¹è±¡ï¼Œå°† access å€¼ï¼ˆæƒé™ä½ï¼‰ä¿®æ”¹ä¸ºäºŒè¿›åˆ¶çš„â€œå…¨ 1â€ã€‚\n\n\nåœ¨è¿™ä¸ª grant å‘½ä»¤æ‰§è¡Œå®Œæˆåï¼Œå¦‚æœæœ‰æ–°çš„å®¢æˆ·ç«¯ä½¿ç”¨ç”¨æˆ·å ua ç™»å½•æˆåŠŸï¼ŒMySQL ä¼šä¸ºæ–°è¿æ¥ç»´æŠ¤ä¸€ä¸ªçº¿ç¨‹å¯¹è±¡ï¼Œç„¶åä» acl_users æ•°ç»„é‡ŒæŸ¥åˆ°è¿™ä¸ªç”¨æˆ·çš„æƒé™ï¼Œå¹¶å°†æƒé™å€¼æ‹·è´åˆ°è¿™ä¸ªçº¿ç¨‹å¯¹è±¡ä¸­ã€‚ä¹‹ååœ¨è¿™ä¸ªè¿æ¥ä¸­æ‰§è¡Œçš„è¯­å¥ï¼Œæ‰€æœ‰å…³äºå…¨å±€æƒé™çš„åˆ¤æ–­ï¼Œéƒ½ç›´æ¥ä½¿ç”¨çº¿ç¨‹å¯¹è±¡å†…éƒ¨ä¿å­˜çš„æƒé™ä½ã€‚\nrevoke å‘½ä»¤ä¹Ÿä¸€æ ·\n\n\n\n\n\ndb æƒé™\n\n\nä¿å­˜åœ¨ mysql.db è¡¨\n\n\nè®©ç”¨æˆ· ua æ‹¥æœ‰åº“ db1 çš„æ‰€æœ‰æƒé™ï¼šgrant all privileges on db1.* to â€˜uaâ€™@â€™%â€™ with grant option;\n\n\n\nç£ç›˜ä¸Šï¼Œå¾€ mysql.db è¡¨ä¸­æ’å…¥äº†ä¸€è¡Œè®°å½•ï¼Œæ‰€æœ‰æƒé™ä½å­—æ®µè®¾ç½®ä¸ºâ€œYâ€ï¼›\n\n\n\n\nå†…å­˜é‡Œï¼Œå¢åŠ ä¸€ä¸ªå¯¹è±¡åˆ°æ•°ç»„ acl_dbs ä¸­ï¼Œè¿™ä¸ªå¯¹è±¡çš„æƒé™ä½ä¸ºâ€œå…¨ 1â€ã€‚\n\n\næ¯æ¬¡éœ€è¦åˆ¤æ–­ä¸€ä¸ªç”¨æˆ·å¯¹ä¸€ä¸ªæ•°æ®åº“è¯»å†™æƒé™çš„æ—¶å€™ï¼Œéƒ½éœ€è¦éå†ä¸€æ¬¡ acl_dbs æ•°ç»„\nacl_dbls æ˜¯ä¸€ä¸ªå…¨å±€æ•°ç»„\nå¦‚æœå·²ç» use database_nameï¼Œåˆ™åœ¨åˆ‡æ¢å‡ºè¯¥åº“ä¹‹å‰ï¼Œsession å°±ä¸€ç›´æœ‰è¯¥åº“æƒé™\n\n\n\n\n\nè¡¨æƒé™å’Œåˆ—æƒé™\n\nè¡¨æƒé™å®šä¹‰å­˜æ”¾åœ¨è¡¨ mysql.tables_priv ä¸­ï¼Œåˆ—æƒé™å®šä¹‰å­˜æ”¾åœ¨è¡¨ mysql.columns_priv ä¸­ã€‚è¿™ä¸¤ç±»æƒé™ï¼Œç»„åˆèµ·æ¥å­˜æ”¾åœ¨å†…å­˜çš„ hash ç»“æ„ column_priv_hash ä¸­ã€‚\ncolumn_priv_hash ä¹Ÿæ˜¯ä¸€ä¸ªå…¨å±€å¯¹è±¡\n\n\n\nå¦‚æœå†…å­˜çš„æƒé™æ•°æ®å’Œç£ç›˜æ•°æ®è¡¨ç›¸åŒçš„è¯ï¼Œä¸éœ€è¦æ‰§è¡Œ flush privilegesã€‚\n\n\nå¦‚æœæˆ‘ä»¬éƒ½æ˜¯ç”¨ grant/revoke è¯­å¥æ¥æ‰§è¡Œçš„è¯ï¼Œå†…å­˜å’Œæ•°æ®è¡¨æœ¬æ¥å°±æ˜¯ä¿æŒåŒæ­¥æ›´æ–°çš„ã€‚\n\nflush privileges è¯­å¥å¯ä»¥ç”¨æ¥é‡å»ºå†…å­˜æ•°æ®ï¼Œè¾¾åˆ°ä¸€è‡´çŠ¶æ€ã€‚\n\n\n\nflush privileges ä½¿ç”¨åœºæ™¯\n\nç›´æ¥æ‰‹åŠ¨ä¿®æ”¹ç³»ç»Ÿæƒé™è¡¨æ—¶\n\n\n\ngrant å‘½ä»¤åŠ äº† identified by â€˜å¯†ç â€™\n\n\n\nå¦‚æœç”¨æˆ·â€™uaâ€™@â€™%â€˜ä¸å­˜åœ¨ï¼Œå°±åˆ›å»ºè¿™ä¸ªç”¨æˆ·ï¼Œå¯†ç æ˜¯ paï¼›\n\n\n\n\nå¦‚æœç”¨æˆ· ua å·²ç»å­˜åœ¨ï¼Œå°±å°†å¯†ç ä¿®æ”¹æˆ paã€‚\n\n\nä¸å»ºè®®çš„å†™æ³•ï¼Œå®¹æ˜“ä¸æ…æŠŠå¯†ç ç»™æ”¹äº†\n\n\n\nè¯„è®ºåŒº\n\næ–‡ç« å†…å®¹æ€»ç»“\n\n\n\n\n\n\n"},"å­¦ä¹ ç¬”è®°/MySQL-å®æˆ˜-45-è®²/43ï½œè¦ä¸è¦ä½¿ç”¨åˆ†åŒºè¡¨ï¼Ÿ":{"title":"43ï½œè¦ä¸è¦ä½¿ç”¨åˆ†åŒºè¡¨ï¼Ÿ","links":[],"tags":["mysql"],"content":"\n\nåˆ†åŒºè¡¨ï¼šå¯¹äºå¼•æ“å±‚ï¼Œn ä¸ªè¡¨å¯¹äº server å±‚ï¼Œ1 ä¸ªè¡¨\n\n\nåˆ†åŒºç­–ç•¥\n\n\nMyISAM åˆ†åŒºè¡¨\n\n\nInnoDB åˆ†åŒºè¡¨\n\n\né€šç”¨åˆ†åŒºç­–ç•¥ï¼šæ¯æ¬¡è®¿é—®éƒ½ç”± server å±‚æ§åˆ¶\n\nMyISAM åˆ†åŒºè¡¨ä½¿ç”¨çš„åˆ†åŒºç­–ç•¥\næ€§èƒ½è¾ƒå·®\n5.7.17 å¼€å§‹æ ‡è®°ä¸ºå³å°†å¼ƒç”¨8.0 å¼€å§‹ä¸å…è®¸ä½¿ç”¨\næ‰“å¼€åˆ†åŒºè¡¨æ—¶ï¼Œå¦‚æœåˆ†åŒºè¿‡å¤šï¼Œè¶…è¿‡ open_files_limit å‚æ•°è®¾ç½®çš„å€¼æ—¶ä¼šæŠ¥é”™ï¼Œé»˜è®¤ 1024\n\n\n\næœ¬åœ°åˆ†åŒºç­–ç•¥ï¼šå¼•æ“å†…éƒ¨è‡ªå·±ç®¡ç†æ‰“å¼€åˆ†åŒºçš„è¡Œä¸º\n\nInnoDB å’Œ NDB å¼•æ“æ”¯æŒäº†\næ²¡æœ‰é€šç”¨åˆ†åŒºç­–ç•¥ä¼šæŠ¥é”™çš„é—®é¢˜ï¼šinnodb_open_files å‚æ•°æ§åˆ¶æ‰“å¼€å¤šå°‘ä¸ªæ–‡ä»¶åè‡ªåŠ¨å…³é—­ä¸€äº›ä¹‹å‰æ‰“å¼€çš„æ–‡ä»¶\n\n\n\n\n\nåˆ†åŒºè¡¨çš„ server å±‚è¡Œä¸º\n\n\n\nMySQL åœ¨ç¬¬ä¸€æ¬¡æ‰“å¼€åˆ†åŒºè¡¨çš„æ—¶å€™ï¼Œéœ€è¦è®¿é—®æ‰€æœ‰çš„åˆ†åŒºï¼›\n\n\n\n\nåœ¨ server å±‚ï¼Œè®¤ä¸ºè¿™æ˜¯åŒä¸€å¼ è¡¨ï¼Œå› æ­¤æ‰€æœ‰åˆ†åŒºå…±ç”¨åŒä¸€ä¸ª MDL é”ï¼›\n\n\n\n\nåœ¨å¼•æ“å±‚ï¼Œè®¤ä¸ºè¿™æ˜¯ä¸åŒçš„è¡¨ï¼Œå› æ­¤ MDL é”ä¹‹åçš„æ‰§è¡Œè¿‡ç¨‹ï¼Œä¼šæ ¹æ®åˆ†åŒºè¡¨è§„åˆ™ï¼Œåªè®¿é—®å¿…è¦çš„åˆ†åŒºã€‚\n\n\n\n\n\nåˆ†åŒºè¡¨çš„åº”ç”¨åœºæ™¯\n\n\nå¯¹ä¸šåŠ¡é€æ˜ï¼Œä»£ç æ›´ç®€æ´\n\n\næ¸…ç†å†å²æ•°æ®æ–¹ä¾¿\n\nåˆ æ‰åˆ†åŒºï¼šalter table t drop partition â€¦ä¼šç›´æ¥åˆ é™¤åˆ†åŒºæ–‡ä»¶ï¼Œæ•ˆæœè·Ÿ drop æ™®é€šè¡¨ç±»ä¼¼\nä¸ä½¿ç”¨ delete è¯­å¥åˆ é™¤æ•°æ®ç›¸æ¯”ï¼Œé€Ÿåº¦å¿«ï¼Œå¯¹ç³»ç»Ÿå½±å“å°\n\n\n\n\n\næ³¨æ„äº‹é¡¹\n\n\n\nåˆ†åŒºå¹¶ä¸æ˜¯è¶Šç»†è¶Šå¥½ã€‚\n\n\n\n\nåˆ†åŒºä¹Ÿä¸è¦æå‰é¢„ç•™å¤ªå¤šï¼Œåœ¨ä½¿ç”¨ä¹‹å‰é¢„å…ˆåˆ›å»ºå³å¯ã€‚æ¯”å¦‚ï¼Œå¦‚æœæ˜¯æŒ‰æœˆåˆ†åŒºï¼Œæ¯å¹´å¹´åº•æ—¶å†æŠŠä¸‹ä¸€å¹´åº¦çš„ 12 ä¸ªæ–°åˆ†åŒºåˆ›å»ºä¸Šå³å¯ã€‚å¯¹äºæ²¡æœ‰æ•°æ®çš„å†å²åˆ†åŒºï¼Œè¦åŠæ—¶çš„ drop æ‰ã€‚\n\n\n\n\n\nå…¶ä»–åˆ†åŒºæ–¹æ³•ï¼šå®˜æ–¹æ‰‹å†Œ\n\n\næ€è€ƒé¢˜\n\n\næ–‡ç« ä¸­ä¸¾ä¾‹åªç”¨åˆ°äº†æ—¥æœŸå­—æ®µï¼Œæ²¡æœ‰è‡ªå¢ä¸»é”®ï¼Œå¦‚æœè¦å®šä¹‰è¿™ä¸ªè¡¨çš„ä¸»é”®ï¼Œæ€ä¹ˆå®šä¹‰ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ\n\n\nMySQL è¦æ±‚ä¸»é”®åŒ…å«æ‰€æœ‰çš„åˆ†åŒºå­—æ®µ\n\nè¿™é‡Œå¿…é¡»åˆ›å»ºè”åˆä¸»é”®\n\n\n\nä»åˆ©ç”¨ç‡ä¸Šçœ‹ï¼Œåº”è¯¥åˆ›å»º (ftime, id)\n\nInnoDB è¦æ±‚è‡³å°‘æœ‰ä¸€ä¸ªç´¢å¼•ï¼Œä»¥è‡ªå¢å­—æ®µä½œä¸ºç¬¬ä¸€ä¸ªå­—æ®µï¼Œæ‰€ä»¥è¿˜è¦åˆ›å»ºä¸€ä¸ª id çš„å•ç‹¬ç´¢å¼•\n\n\n\nä¸Šé¢çš„æ–¹æ¡ˆåè¿‡æ¥ä¹Ÿå¯ä»¥ (id, ftime) (ftime)\n\n\n\n\n\n\nè¯„è®ºåŒº\n\nåˆ†åŒºè¡¨çš„ç”¨æ³•è·Ÿæ™®é€šè¡¨ï¼Œåœ¨ sql è¯­å¥ä¸Šæ˜¯ç›¸åŒçš„ã€‚\n\n\n"},"å­¦ä¹ ç¬”è®°/MySQL-å®æˆ˜-45-è®²/44ï½œç­”ç–‘æ–‡ç« ï¼ˆä¸‰ï¼‰ï¼šè¯´ä¸€è¯´è¿™äº›å¥½é—®é¢˜":{"title":"44ï½œç­”ç–‘æ–‡ç« ï¼ˆä¸‰ï¼‰ï¼šè¯´ä¸€è¯´è¿™äº›å¥½é—®é¢˜","links":[],"tags":["mysql"],"content":"\n\njoin çš„å†™æ³•\n\n\nåœ¨ MySQL é‡Œï¼ŒNULL è·Ÿä»»ä½•å€¼æ‰§è¡Œç­‰å€¼åˆ¤æ–­å’Œä¸ç­‰å€¼åˆ¤æ–­çš„ç»“æœï¼Œéƒ½æ˜¯ NULLã€‚è¿™é‡ŒåŒ…æ‹¬ï¼Œ select NULL = NULL çš„ç»“æœï¼Œä¹Ÿæ˜¯è¿”å› NULLã€‚\n\nwhere a.f2=b.f2 å°±è¡¨ç¤ºï¼ŒæŸ¥è¯¢ç»“æœé‡Œé¢ä¸ä¼šåŒ…å« b.f2 æ˜¯ NULL çš„è¡Œ\n\n\n\nä½¿ç”¨ left join æ—¶ï¼Œå·¦è¾¹çš„è¡¨ä¸ä¸€å®šæ˜¯é©±åŠ¨è¡¨ã€‚\n\n\nå¦‚æœéœ€è¦ left join çš„è¯­ä¹‰ï¼Œå°±ä¸èƒ½æŠŠè¢«é©±åŠ¨è¡¨çš„å­—æ®µæ”¾åœ¨ where æ¡ä»¶é‡Œé¢åšç­‰å€¼åˆ¤æ–­æˆ–ä¸ç­‰å€¼åˆ¤æ–­ï¼Œå¿…é¡»éƒ½å†™åœ¨ on é‡Œé¢\n\n\n\n\ndistinct å’Œ group by çš„æ€§èƒ½\n\n\nå¦‚æœåªéœ€è¦å»é‡ï¼Œä¸éœ€è¦æ‰§è¡Œèšåˆå‡½æ•°ï¼Œdistinct å’Œ group by å“ªç§æ•ˆç‡é«˜ä¸€äº›å‘¢ï¼Ÿ\n\næ²¡æœ‰ç´¢å¼•æ—¶ä¸€æ ·\nselect a,count(*) from t group by a order by null;è¿™æ¡è¯­å¥çš„é€»è¾‘æ˜¯ï¼šæŒ‰ç…§å­—æ®µ a åˆ†ç»„ï¼Œè®¡ç®—æ¯ç»„çš„ a å‡ºç°çš„æ¬¡æ•°ã€‚åœ¨è¿™ä¸ªç»“æœé‡Œï¼Œç”±äºåšçš„æ˜¯èšåˆè®¡ç®—ï¼Œç›¸åŒçš„ a åªå‡ºç°ä¸€æ¬¡ã€‚37 ç« æœ‰å…³äº group by çš„ç›¸å…³å†…å®¹\n\n\n\n\n\næ€è€ƒé¢˜\n\næŸ¥çœ‹äº†ä¸€ä¸‹ innodb_trxï¼Œå‘ç°è¿™ä¸ªäº‹åŠ¡çš„ trx_id æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ•°ï¼ˆ281479535353408ï¼‰ï¼Œè€Œä¸”ä¼¼ä¹åœ¨åŒä¸€ä¸ª session ä¸­å¯åŠ¨çš„ä¼šè¯å¾—åˆ°çš„ trx_id æ˜¯ä¿æŒä¸å˜çš„ã€‚å½“æ‰§è¡Œä»»ä½•åŠ å†™é”çš„è¯­å¥åï¼Œtrx_id éƒ½ä¼šå˜æˆä¸€ä¸ªå¾ˆå°çš„æ•°å­—ï¼ˆ118378ï¼‰ã€‚\nä½ å¯ä»¥é€šè¿‡å®éªŒéªŒè¯ä¸€ä¸‹ï¼Œç„¶ååˆ†æçœ‹çœ‹ï¼Œäº‹åŠ¡ id çš„åˆ†é…è§„åˆ™æ˜¯ä»€ä¹ˆï¼Œä»¥åŠ MySQL ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆè®¾è®¡å‘¢ï¼Ÿ\n\n\n"},"å­¦ä¹ ç¬”è®°/MySQL-å®æˆ˜-45-è®²/45ï½œè‡ªå¢-id-ç”¨å®Œæ€ä¹ˆåŠï¼Ÿ":{"title":"45ï½œè‡ªå¢ id ç”¨å®Œæ€ä¹ˆåŠï¼Ÿ","links":[],"tags":["mysql"],"content":"\n\nè¡¨å®šä¹‰çš„è‡ªå¢å€¼è¾¾åˆ°ä¸Šé™åçš„é€»è¾‘æ˜¯ï¼šå†ç”³è¯·ä¸‹ä¸€ä¸ª id æ—¶ï¼Œå¾—åˆ°çš„å€¼ä¿æŒä¸å˜ã€‚\n\n\nrow_id\n\n\nInnoDB è¡¨æ²¡æœ‰æŒ‡å®šä¸»é”®æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªä¸å¯è§çš„ï¼Œé•¿åº¦ä¸º 6 ä¸ªå­—èŠ‚çš„ row_idã€‚\n\n\nrow_id æ˜¯ä¸€ä¸ªé•¿åº¦ 8 å­—èŠ‚çš„æ— ç¬¦å·é•¿æ•´å½¢\n\n\nä½†æ˜¯ InnoDB åªç•™äº† 6 ä¸ªå­—èŠ‚çš„é•¿åº¦ç»™ row_id ç”¨\n\n\n\nrow_id å†™å…¥è¡¨ä¸­çš„å€¼èŒƒå›´ï¼Œæ˜¯ä» 0 åˆ° 248-1ï¼›\n\n\n\n\nè¾¾åˆ°ä¸Šé™åä» 0 å¼€å§‹ï¼Œå†™å…¥æ—¶ä¼šè¦†ç›–åŸæœ‰çš„è¡Œ\n\n\n\n\n\n\n\nXid\n\n\nredo log å’Œ binlog ç›¸é…åˆæ—¶éƒ½æœ‰çš„ä¸€ä¸ªå…±åŒå­—æ®µ\n\n\nMySQL å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªå…¨å±€å˜é‡ global_query_idï¼Œæ¯æ¬¡æ‰§è¡Œè¯­å¥çš„æ—¶å€™å°†å®ƒèµ‹å€¼ç»™ Query_idï¼Œç„¶åç»™è¿™ä¸ªå˜é‡åŠ  1ã€‚å¦‚æœå½“å‰è¯­å¥æ˜¯è¿™ä¸ªäº‹åŠ¡æ‰§è¡Œçš„ç¬¬ä¸€æ¡è¯­å¥ï¼Œé‚£ä¹ˆ MySQL è¿˜ä¼šåŒæ—¶æŠŠ Query_id èµ‹å€¼ç»™è¿™ä¸ªäº‹åŠ¡çš„ Xidã€‚\n\n\nglobal_query_id æ˜¯ä¸€ä¸ªçº¯å†…å­˜å˜é‡ï¼Œé‡å¯ä¹‹åå°±æ¸…é›¶äº†\n\n\n\n\né‡å¯åä¼šæ¸…é›¶\n\n\n\nä¸åŒäº‹åŠ¡çš„ Xid å¯èƒ½ç›¸åŒ\n\n\n\n\n\n\n\né‡å¯åä¼šé‡æ–°ç”Ÿæˆæ–°çš„ binlog æ–‡ä»¶\n\n\n\nåŒä¸€ä¸ª binlog æ–‡ä»¶é‡Œï¼ŒXid å”¯ä¸€\nè¾¾åˆ°ä¸Šé™ï¼ˆè¶…å¤§ï¼‰åä» 0 å¼€å§‹ï¼Œè¿˜æ˜¯å¯èƒ½ä¸å”¯ä¸€ï¼Œä½†æ˜¯åªå­˜åœ¨äºç†è®ºä¸Š\n\n\n\né•¿åº¦æ˜¯ 8 ä¸ªå­—èŠ‚ï¼Œä¸Šé™è¶…å¤§\n\n\n\n\nInnodb trx_id\n\n\nç¬¬ 8 ç¯‡è®²äº‹åŠ¡å¯è§æ€§ç”¨åˆ°çš„äº‹åŠ¡ idï¼ˆtransaction idï¼‰\n\n\nXid ç”± server å±‚ç»´æŠ¤ï¼ŒInnoDB å†…éƒ¨ä½¿ç”¨ Xid æ˜¯ä¸ºäº†åœ¨ InnoDB äº‹åŠ¡å’Œ server ä¹‹é—´åšå…³è”\n\n\nInnoDB å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ª max_trx_id å…¨å±€å˜é‡ï¼Œæ¯æ¬¡éœ€è¦ç”³è¯·ä¸€ä¸ªæ–°çš„ trx_id æ—¶ï¼Œå°±è·å¾— max_trx_id çš„å½“å‰å€¼ï¼Œç„¶åå¹¶å°† max_trx_id åŠ  1ã€‚\n\n\nå¯¹äºæ­£åœ¨æ‰§è¡Œçš„äº‹åŠ¡ï¼Œå¯ä»¥ä» information_schema.innodb_trx è¡¨ä¸­çœ‹åˆ°äº‹åŠ¡çš„ trx_idã€‚\n\n\nå¯¹äºåªè¯»äº‹åŠ¡ï¼ŒInnoDB ä¸åˆ†é… trx_idï¼Œåœ¨è¡¨ä¸­æŸ¥çœ‹åˆ°çš„å¾ˆå¤§çš„ trx_id åªæ˜¯æ˜¾ç¤ºç”¨çš„\n\n\næŠŠå½“å‰äº‹åŠ¡çš„ trx å˜é‡çš„æŒ‡é’ˆåœ°å€è½¬æˆæ•´æ•°ï¼Œå†åŠ ä¸Š 2^48\n\n\n\nå› ä¸ºåŒä¸€ä¸ªåªè¯»äº‹åŠ¡åœ¨æ‰§è¡ŒæœŸé—´ï¼Œå®ƒçš„æŒ‡é’ˆåœ°å€æ˜¯ä¸ä¼šå˜çš„ï¼Œæ‰€ä»¥ä¸è®ºæ˜¯åœ¨ innodb_trx è¿˜æ˜¯åœ¨ innodb_locks è¡¨é‡Œï¼ŒåŒä¸€ä¸ªåªè¯»äº‹åŠ¡æŸ¥å‡ºæ¥çš„ trx_id å°±ä¼šæ˜¯ä¸€æ ·çš„ã€‚\n\n\n\n\nå¦‚æœæœ‰å¹¶è¡Œçš„å¤šä¸ªåªè¯»äº‹åŠ¡ï¼Œæ¯ä¸ªäº‹åŠ¡çš„ trx å˜é‡çš„æŒ‡é’ˆåœ°å€è‚¯å®šä¸åŒã€‚è¿™æ ·ï¼Œä¸åŒçš„å¹¶å‘åªè¯»äº‹åŠ¡ï¼ŒæŸ¥å‡ºæ¥çš„ trx_id å°±æ˜¯ä¸åŒçš„ã€‚\n\n\nåŠ ä¸Šæ˜¯ä¸ºäº†é¿å…è·ŸçœŸæ­£çš„ trx_id ä¸€æ ·\n\n\n\nä¸åˆ†é…çš„å¥½å¤„\n\nå¯ä»¥å‡å°äº‹åŠ¡è§†å›¾é‡Œé¢æ´»è·ƒäº‹åŠ¡æ•°ç»„çš„å¤§å°\nå¯ä»¥å‡å°‘ trx_id çš„ç”³è¯·æ¬¡æ•°ï¼ˆå‡å°‘å¹¶å‘äº‹åŠ¡ç”³è¯· trx_id çš„é”å†²çªï¼‰\n\n\n\n\n\nselect è¯­å¥åé¢åŠ ä¸Š for update åˆ™ä¸æ˜¯åªè¯»äº‹åŠ¡\n\n\n\nupdate å’Œ delete è¯­å¥é™¤äº†äº‹åŠ¡æœ¬èº«ï¼Œè¿˜æ¶‰åŠåˆ°æ ‡è®°åˆ é™¤æ—§æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¦æŠŠæ•°æ®æ”¾åˆ° purge é˜Ÿåˆ—é‡Œç­‰å¾…åç»­ç‰©ç†åˆ é™¤ï¼Œè¿™ä¸ªæ“ä½œä¹Ÿä¼šæŠŠ max_trx_id+1ï¼Œ å› æ­¤åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­è‡³å°‘åŠ  2ï¼›\n\n\n\n\nInnoDB çš„åå°æ“ä½œï¼Œæ¯”å¦‚è¡¨çš„ç´¢å¼•ä¿¡æ¯ç»Ÿè®¡è¿™ç±»æ“ä½œï¼Œä¹Ÿæ˜¯ä¼šå¯åŠ¨å†…éƒ¨äº‹åŠ¡çš„ï¼Œå› æ­¤ä½ å¯èƒ½çœ‹åˆ°ï¼Œtrx_id å€¼å¹¶ä¸æ˜¯æŒ‰ç…§åŠ  1 é€’å¢çš„ã€‚\n\n\n\n\n\nInnoDB æ•°æ®å¯è§æ€§çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šæ¯ä¸€è¡Œæ•°æ®éƒ½è®°å½•äº†æ›´æ–°å®ƒçš„ trx_idï¼Œå½“ä¸€ä¸ªäº‹åŠ¡è¯»åˆ°ä¸€è¡Œæ•°æ®çš„æ—¶å€™ï¼Œåˆ¤æ–­è¿™ä¸ªæ•°æ®æ˜¯å¦å¯è§çš„æ–¹æ³•ï¼Œå°±æ˜¯é€šè¿‡äº‹åŠ¡çš„ä¸€è‡´æ€§è§†å›¾ä¸è¿™è¡Œæ•°æ®çš„ trx_id åšå¯¹æ¯”ã€‚\n\n\né‡å¯ MySQLæ—¶ max_trx_id ä¸ä¼šæ¸…é›¶\n\nç†è®ºä¸Šï¼ŒMySQL å®ä¾‹è¿è¡Œå¾—è¶³å¤Ÿä¹…ï¼Œtrx_id è¾¾åˆ°ä¸Šé™åä» 0 å¼€å§‹ï¼Œå°±ä¼šæŒç»­å‡ºç°è„è¯»\n\n\n\n\n\nthread_id\n\n\n4 ä¸ªå­—èŠ‚ï¼Œè¾¾åˆ° 2^32 - 1 åé‡ç½®ä¸º 0ï¼Œç„¶åç»§ç»­å¢åŠ \n\n\nä¸ä¼šåœ¨ show processlist çœ‹åˆ°ä¸¤ä¸ªç›¸åŒçš„ thread_id\n\nMySQL è®¾è®¡äº†ä¸€ä¸ªå”¯ä¸€æ•°ç»„ï¼šå¾ªç¯å°è¯•æ’å…¥è‡ªå¢ 1 çš„çº¿ç¨‹ id ç›´åˆ°æˆåŠŸ\n\n\n\n\n\nå°ç»“\n\n\n\nè¡¨çš„è‡ªå¢ id è¾¾åˆ°ä¸Šé™åï¼Œå†ç”³è¯·æ—¶å®ƒçš„å€¼å°±ä¸ä¼šæ”¹å˜ï¼Œè¿›è€Œå¯¼è‡´ç»§ç»­æ’å…¥æ•°æ®æ—¶æŠ¥ä¸»é”®å†²çªçš„é”™è¯¯ã€‚\n\n\n\n\nrow_id è¾¾åˆ°ä¸Šé™åï¼Œåˆ™ä¼šå½’ 0 å†é‡æ–°é€’å¢ï¼Œå¦‚æœå‡ºç°ç›¸åŒçš„ row_idï¼Œåå†™çš„æ•°æ®ä¼šè¦†ç›–ä¹‹å‰çš„æ•°æ®ã€‚\n\n\n\n\nXid åªéœ€è¦ä¸åœ¨åŒä¸€ä¸ª binlog æ–‡ä»¶ä¸­å‡ºç°é‡å¤å€¼å³å¯ã€‚è™½ç„¶ç†è®ºä¸Šä¼šå‡ºç°é‡å¤å€¼ï¼Œä½†æ˜¯æ¦‚ç‡æå°ï¼Œå¯ä»¥å¿½ç•¥ä¸è®¡ã€‚\n\n\n\n\nInnoDB çš„ max_trx_id é€’å¢å€¼æ¯æ¬¡ MySQL é‡å¯éƒ½ä¼šè¢«ä¿å­˜èµ·æ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬æ–‡ç« ä¸­æåˆ°çš„è„è¯»çš„ä¾‹å­å°±æ˜¯ä¸€ä¸ªå¿…ç°çš„ bugï¼Œå¥½åœ¨ç•™ç»™æˆ‘ä»¬çš„æ—¶é—´è¿˜å¾ˆå……è£•ã€‚\n\n\n\n\nthread_id æ˜¯æˆ‘ä»¬ä½¿ç”¨ä¸­æœ€å¸¸è§çš„ï¼Œè€Œä¸”ä¹Ÿæ˜¯å¤„ç†å¾—æœ€å¥½çš„ä¸€ä¸ªè‡ªå¢ id é€»è¾‘äº†ã€‚\n\n\n\n\n"},"å­¦ä¹ ç¬”è®°/MySQL-å®æˆ˜-45-è®²/MySQL-å®æˆ˜-45-è®²":{"title":"MySQL å®æˆ˜ 45 è®²","links":["%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/01%EF%BD%9C%E5%9F%BA%E7%A1%80%E6%9E%B6%E6%9E%84%EF%BC%9A%E4%B8%80%E6%9D%A1-SQL-%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5%E6%98%AF%E5%A6%82%E4%BD%95%E6%89%A7%E8%A1%8C%E7%9A%84%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/02%EF%BD%9C%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%EF%BC%9A%E4%B8%80%E6%9D%A1-SQL-%E6%9B%B4%E6%96%B0%E8%AF%AD%E5%8F%A5%E6%98%AF%E5%A6%82%E4%BD%95%E6%89%A7%E8%A1%8C%E7%9A%84%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/03%EF%BD%9C%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%EF%BC%9A%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%A0%E6%94%B9%E4%BA%86%E4%B8%BA%E8%BF%98%E7%9C%8B%E4%B8%8D%E8%A7%81%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/04%EF%BD%9C%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E7%B4%A2%E5%BC%95%EF%BC%88%E4%B8%8A%EF%BC%89","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/05%EF%BD%9C%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E7%B4%A2%E5%BC%95%EF%BC%88%E4%B8%8B%EF%BC%89","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/06%EF%BD%9C%E5%85%A8%E5%B1%80%E9%94%81%E5%92%8C%E8%A1%A8%E9%94%81%EF%BC%9A%E7%BB%99%E8%A1%A8%E5%8A%A0%E4%B8%AA%E5%AD%97%E6%AE%B5%E6%80%8E%E4%B9%88%E6%9C%89%E8%BF%99%E4%B9%88%E5%A4%9A%E9%98%BB%E7%A2%8D%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/07%EF%BD%9C%E8%A1%8C%E9%94%81%E5%8A%9F%E8%BF%87%EF%BC%9A%E6%80%8E%E4%B9%88%E5%87%8F%E5%B0%91%E9%94%81%E5%AF%B9%E6%80%A7%E8%83%BD%E7%9A%84%E5%BD%B1%E5%93%8D%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/08%EF%BD%9C%E4%BA%8B%E5%8A%A1%E5%88%B0%E5%BA%95%E6%98%AF%E9%9A%94%E7%A6%BB%E7%9A%84%E8%BF%98%E6%98%AF%E4%B8%8D%E9%9A%94%E7%A6%BB%E7%9A%84%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/09%EF%BD%9C%E6%99%AE%E9%80%9A%E7%B4%A2%E5%BC%95%E5%92%8C%E5%94%AF%E4%B8%80%E7%B4%A2%E5%BC%95%EF%BC%8C%E5%BA%94%E8%AF%A5%E6%80%8E%E4%B9%88%E9%80%89%E6%8B%A9%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/10%EF%BD%9CMySQL-%E4%B8%BA%E4%BB%80%E4%B9%88%E6%9C%89%E6%97%B6%E5%80%99%E4%BC%9A%E9%80%89%E9%94%99%E7%B4%A2%E5%BC%95%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/11%EF%BD%9C%E6%80%8E%E4%B9%88%E7%BB%99%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%AD%97%E6%AE%B5%E5%8A%A0%E7%B4%A2%E5%BC%95%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/12%EF%BD%9C%E4%B8%BA%E4%BB%80%E4%B9%88%E6%88%91%E7%9A%84-MySQL-%E4%BC%9A%E2%80%9C%E6%8A%96%E2%80%9D%E4%B8%80%E4%B8%8B%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/13%EF%BD%9C%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A1%A8%E6%95%B0%E6%8D%AE%E5%88%A0%E6%8E%89%E4%B8%80%E5%8D%8A%EF%BC%8C%E8%A1%A8%E6%96%87%E4%BB%B6%E5%A4%A7%E5%B0%8F%E4%B8%8D%E5%8F%98%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/14%EF%BD%9Ccount(*)-%E8%BF%99%E4%B9%88%E6%85%A2%EF%BC%8C%E6%88%91%E8%AF%A5%E6%80%8E%E4%B9%88%E5%8A%9E%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/15%EF%BD%9C%E7%AD%94%E7%96%91%E6%96%87%E7%AB%A0%EF%BC%88%E4%B8%80%EF%BC%89%EF%BC%9A%E6%97%A5%E5%BF%97%E5%92%8C%E7%B4%A2%E5%BC%95%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/16%EF%BD%9C%E2%80%9Corder-by%E2%80%9D%E6%98%AF%E6%80%8E%E4%B9%88%E5%B7%A5%E4%BD%9C%E7%9A%84%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/17%EF%BD%9C%E5%A6%82%E4%BD%95%E6%AD%A3%E7%A1%AE%E5%9C%B0%E6%98%BE%E7%A4%BA%E9%9A%8F%E6%9C%BA%E6%B6%88%E6%81%AF%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/18%EF%BD%9C%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%99%E4%BA%9B-SQL-%E8%AF%AD%E5%8F%A5%E9%80%BB%E8%BE%91%E7%9B%B8%E5%90%8C%EF%BC%8C%E6%80%A7%E8%83%BD%E5%8D%B4%E5%B7%AE%E5%BC%82%E5%B7%A8%E5%A4%A7%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/19%EF%BD%9C%E4%B8%BA%E4%BB%80%E4%B9%88%E6%88%91%E5%8F%AA%E6%9F%A5%E4%B8%80%E8%A1%8C%E7%9A%84%E8%AF%AD%E5%8F%A5%EF%BC%8C%E4%B9%9F%E6%89%A7%E8%A1%8C%E8%BF%99%E4%B9%88%E6%85%A2%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/20%EF%BD%9C%E5%B9%BB%E8%AF%BB%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%8C%E5%B9%BB%E8%AF%BB%E6%9C%89%E4%BB%80%E4%B9%88%E9%97%AE%E9%A2%98%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/21%EF%BD%9C%E4%B8%BA%E4%BB%80%E4%B9%88%E6%88%91%E5%8F%AA%E6%94%B9%E4%B8%80%E8%A1%8C%E7%9A%84%E8%AF%AD%E5%8F%A5%EF%BC%8C%E9%94%81%E8%BF%99%E4%B9%88%E5%A4%9A%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/22%EF%BD%9CMySQL%E6%9C%89%E5%93%AA%E4%BA%9B%E2%80%9C%E9%A5%AE%E9%B8%A9%E6%AD%A2%E6%B8%B4%E2%80%9D%E6%8F%90%E9%AB%98%E6%80%A7%E8%83%BD%E7%9A%84%E6%96%B9%E6%B3%95%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/23%EF%BD%9CMySQL-%E6%98%AF%E6%80%8E%E4%B9%88%E4%BF%9D%E8%AF%81%E6%95%B0%E6%8D%AE%E4%B8%8D%E4%B8%A2%E7%9A%84%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/24%EF%BD%9CMySQL-%E6%98%AF%E6%80%8E%E4%B9%88%E4%BF%9D%E8%AF%81%E4%B8%BB%E5%A4%87%E4%B8%80%E8%87%B4%E7%9A%84%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/25%EF%BD%9CMySQL-%E6%98%AF%E6%80%8E%E4%B9%88%E4%BF%9D%E8%AF%81%E9%AB%98%E5%8F%AF%E7%94%A8%E7%9A%84%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/26%EF%BD%9C%E5%A4%87%E5%BA%93%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E5%BB%B6%E8%BF%9F%E5%A5%BD%E5%87%A0%E4%B8%AA%E5%B0%8F%E6%97%B6%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/27%EF%BD%9C%E4%B8%BB%E5%BA%93%E5%87%BA%E9%97%AE%E9%A2%98%E4%BA%86%EF%BC%8C%E4%BB%8E%E5%BA%93%E6%80%8E%E4%B9%88%E5%8A%9E%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/28%EF%BD%9C%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%E6%9C%89%E5%93%AA%E4%BA%9B%E5%9D%91%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/29%EF%BD%9C%E5%A6%82%E4%BD%95%E5%88%A4%E6%96%AD%E4%B8%80%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%BA%93%E6%98%AF%E4%B8%8D%E6%98%AF%E5%87%BA%E9%97%AE%E9%A2%98%E4%BA%86%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/30%EF%BD%9C%E7%AD%94%E7%96%91%E6%96%87%E7%AB%A0%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BC%9A%E7%94%A8%E5%8A%A8%E6%80%81%E7%9A%84%E8%A7%82%E7%82%B9%E7%9C%8B%E5%8A%A0%E9%94%81","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/31%EF%BD%9C%E8%AF%AF%E5%88%A0%E6%95%B0%E6%8D%AE%E5%90%8E%E9%99%A4%E4%BA%86%E8%B7%91%E8%B7%AF%EF%BC%8C%E8%BF%98%E8%83%BD%E6%80%8E%E4%B9%88%E5%8A%9E%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/32%EF%BD%9C%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%98%E6%9C%89-kill-%E4%B8%8D%E6%8E%89%E7%9A%84%E8%AF%AD%E5%8F%A5%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/33%EF%BD%9C%E6%88%91%E6%9F%A5%E8%BF%99%E4%B9%88%E5%A4%9A%E6%95%B0%E6%8D%AE%EF%BC%8C%E4%BC%9A%E4%B8%8D%E4%BC%9A%E6%8A%8A%E6%95%B0%E6%8D%AE%E5%BA%93%E5%86%85%E5%AD%98%E6%89%93%E7%88%86%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/34%EF%BD%9C%E5%88%B0%E5%BA%95%E5%8F%AF%E4%B8%8D%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8-join-%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/35%EF%BD%9Cjoin-%E8%AF%AD%E5%8F%A5%E6%80%8E%E4%B9%88%E4%BC%98%E5%8C%96%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/36%EF%BD%9C%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%B4%E6%97%B6%E8%A1%A8%E5%8F%AF%E4%BB%A5%E9%87%8D%E5%90%8D%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/37%EF%BD%9C%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E4%BC%9A%E4%BD%BF%E7%94%A8%E5%86%85%E9%83%A8%E4%B8%B4%E6%97%B6%E8%A1%A8%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/38%EF%BD%9C%E9%83%BD%E8%AF%B4-InnoDB-%E5%A5%BD%EF%BC%8C%E9%82%A3%E8%BF%98%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BD%BF%E7%94%A8-Memory-%E5%BC%95%E6%93%8E%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/39%EF%BD%9C%E8%87%AA%E5%A2%9E%E4%B8%BB%E9%94%AE%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E6%98%AF%E8%BF%9E%E7%BB%AD%E7%9A%84%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/40%EF%BD%9Cinsert-%E8%AF%AD%E5%8F%A5%E7%9A%84%E9%94%81%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%99%E4%B9%88%E5%A4%9A%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/41%EF%BD%9C%E6%80%8E%E4%B9%88%E6%9C%80%E5%BF%AB%E5%9C%B0%E5%A4%8D%E5%88%B6%E4%B8%80%E5%BC%A0%E8%A1%A8%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/42%EF%BD%9Cgrant-%E4%B9%8B%E5%90%8E%E8%A6%81%E8%B7%9F%E7%9D%80-flush-privileges-%E5%90%97%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/43%EF%BD%9C%E8%A6%81%E4%B8%8D%E8%A6%81%E4%BD%BF%E7%94%A8%E5%88%86%E5%8C%BA%E8%A1%A8%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/44%EF%BD%9C%E7%AD%94%E7%96%91%E6%96%87%E7%AB%A0%EF%BC%88%E4%B8%89%EF%BC%89%EF%BC%9A%E8%AF%B4%E4%B8%80%E8%AF%B4%E8%BF%99%E4%BA%9B%E5%A5%BD%E9%97%AE%E9%A2%98","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MySQL-%E5%AE%9E%E6%88%98-45-%E8%AE%B2/45%EF%BD%9C%E8%87%AA%E5%A2%9E-id-%E7%94%A8%E5%AE%8C%E6%80%8E%E4%B9%88%E5%8A%9E%EF%BC%9F"],"tags":["mysql","æå®¢æ—¶é—´"],"content":"\nå†…å®¹æ•´ç†è‡ªæå®¢æ—¶é—´ã€ŠMySQL å®æˆ˜ 45 è®²ã€‹\n\nç« èŠ‚åˆ†ç±» Â§\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nåˆ†ç±»åç« èŠ‚åŸºç¡€çŸ¥è¯†01ç´¢å¼•04ã€05ã€09ã€10ã€11ã€15ã€16ã€18äº‹åŠ¡03ã€08ã€20é”06ã€07ã€13ã€19ã€20ã€21ã€30ã€40æ—¥å¿—ä¸ä¸»å¤‡02ã€12ã€23ã€24ã€25ã€26ã€27ã€28ã€29ã€31ä¸´æ—¶è¡¨17ã€34ã€35ã€36ã€37ã€43å®ç”¨æ€§14ã€32ã€33ã€38ã€41ã€44ã€45\nåŸºç¡€ç¯‡ Â§\n\n01ï½œåŸºç¡€æ¶æ„ï¼šä¸€æ¡ SQL æŸ¥è¯¢è¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Ÿ\n02ï½œæ—¥å¿—ç³»ç»Ÿï¼šä¸€æ¡ SQL æ›´æ–°è¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Ÿ\n03ï½œäº‹åŠ¡éš”ç¦»ï¼šä¸ºä»€ä¹ˆä½ æ”¹äº†ä¸ºè¿˜çœ‹ä¸è§ï¼Ÿ\n04ï½œæ·±å…¥æµ…å‡ºç´¢å¼•ï¼ˆä¸Šï¼‰\n05ï½œæ·±å…¥æµ…å‡ºç´¢å¼•ï¼ˆä¸‹ï¼‰\n06ï½œå…¨å±€é”å’Œè¡¨é”ï¼šç»™è¡¨åŠ ä¸ªå­—æ®µæ€ä¹ˆæœ‰è¿™ä¹ˆå¤šé˜»ç¢ï¼Ÿ\n07ï½œè¡Œé”åŠŸè¿‡ï¼šæ€ä¹ˆå‡å°‘é”å¯¹æ€§èƒ½çš„å½±å“ï¼Ÿ\n08ï½œäº‹åŠ¡åˆ°åº•æ˜¯éš”ç¦»çš„è¿˜æ˜¯ä¸éš”ç¦»çš„ï¼Ÿ\n\nå®è·µç¯‡ Â§\n\n09ï½œæ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•ï¼Œåº”è¯¥æ€ä¹ˆé€‰æ‹©ï¼Ÿ\n10ï½œMySQL ä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä¼šé€‰é”™ç´¢å¼•ï¼Ÿ\n11ï½œæ€ä¹ˆç»™å­—ç¬¦ä¸²å­—æ®µåŠ ç´¢å¼•ï¼Ÿ\n12ï½œä¸ºä»€ä¹ˆæˆ‘çš„ MySQL ä¼šâ€œæŠ–â€ä¸€ä¸‹ï¼Ÿ\n13ï½œä¸ºä»€ä¹ˆè¡¨æ•°æ®åˆ æ‰ä¸€åŠï¼Œè¡¨æ–‡ä»¶å¤§å°ä¸å˜ï¼Ÿ\n14ï½œcount(*) è¿™ä¹ˆæ…¢ï¼Œæˆ‘è¯¥æ€ä¹ˆåŠï¼Ÿ\n15ï½œç­”ç–‘æ–‡ç« ï¼ˆä¸€ï¼‰ï¼šæ—¥å¿—å’Œç´¢å¼•ç›¸å…³é—®é¢˜\n16ï½œâ€œorder byâ€æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ\n17ï½œå¦‚ä½•æ­£ç¡®åœ°æ˜¾ç¤ºéšæœºæ¶ˆæ¯ï¼Ÿ\n18ï½œä¸ºä»€ä¹ˆè¿™äº› SQL è¯­å¥é€»è¾‘ç›¸åŒï¼Œæ€§èƒ½å´å·®å¼‚å·¨å¤§ï¼Ÿ\n19ï½œä¸ºä»€ä¹ˆæˆ‘åªæŸ¥ä¸€è¡Œçš„è¯­å¥ï¼Œä¹Ÿæ‰§è¡Œè¿™ä¹ˆæ…¢ï¼Ÿ\n20ï½œå¹»è¯»æ˜¯ä»€ä¹ˆï¼Œå¹»è¯»æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ\n21ï½œä¸ºä»€ä¹ˆæˆ‘åªæ”¹ä¸€è¡Œçš„è¯­å¥ï¼Œé”è¿™ä¹ˆå¤šï¼Ÿ\n22ï½œMySQLæœ‰å“ªäº›â€œé¥®é¸©æ­¢æ¸´â€æé«˜æ€§èƒ½çš„æ–¹æ³•ï¼Ÿ\n23ï½œMySQL æ˜¯æ€ä¹ˆä¿è¯æ•°æ®ä¸ä¸¢çš„ï¼Ÿ\n24ï½œMySQL æ˜¯æ€ä¹ˆä¿è¯ä¸»å¤‡ä¸€è‡´çš„ï¼Ÿ\n25ï½œMySQL æ˜¯æ€ä¹ˆä¿è¯é«˜å¯ç”¨çš„ï¼Ÿ\n26ï½œå¤‡åº“ä¸ºä»€ä¹ˆä¼šå»¶è¿Ÿå¥½å‡ ä¸ªå°æ—¶ï¼Ÿ\n27ï½œä¸»åº“å‡ºé—®é¢˜äº†ï¼Œä»åº“æ€ä¹ˆåŠï¼Ÿ\n28ï½œè¯»å†™åˆ†ç¦»æœ‰å“ªäº›å‘ï¼Ÿ\n29ï½œå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªæ•°æ®åº“æ˜¯ä¸æ˜¯å‡ºé—®é¢˜äº†ï¼Ÿ\n30ï½œç­”ç–‘æ–‡ç« ï¼ˆäºŒï¼‰ï¼šç”¨åŠ¨æ€çš„è§‚ç‚¹çœ‹åŠ é”\n31ï½œè¯¯åˆ æ•°æ®åé™¤äº†è·‘è·¯ï¼Œè¿˜èƒ½æ€ä¹ˆåŠï¼Ÿ\n32ï½œä¸ºä»€ä¹ˆè¿˜æœ‰ kill ä¸æ‰çš„è¯­å¥ï¼Ÿ\n33ï½œæˆ‘æŸ¥è¿™ä¹ˆå¤šæ•°æ®ï¼Œä¼šä¸ä¼šæŠŠæ•°æ®åº“å†…å­˜æ‰“çˆ†ï¼Ÿ\n34ï½œåˆ°åº•å¯ä¸å¯ä»¥ä½¿ç”¨ join ï¼Ÿ\n35ï½œjoin è¯­å¥æ€ä¹ˆä¼˜åŒ–ï¼Ÿ\n36ï½œä¸ºä»€ä¹ˆä¸´æ—¶è¡¨å¯ä»¥é‡åï¼Ÿ\n37ï½œä»€ä¹ˆæ—¶å€™ä¼šä½¿ç”¨å†…éƒ¨ä¸´æ—¶è¡¨ï¼Ÿ\n38ï½œéƒ½è¯´ InnoDB å¥½ï¼Œé‚£è¿˜è¦ä¸è¦ä½¿ç”¨ Memory å¼•æ“ï¼Ÿ\n39ï½œè‡ªå¢ä¸»é”®ä¸ºä»€ä¹ˆä¸æ˜¯è¿ç»­çš„ï¼Ÿ\n40ï½œinsert è¯­å¥çš„é”ä¸ºä»€ä¹ˆè¿™ä¹ˆå¤šï¼Ÿ\n41ï½œæ€ä¹ˆæœ€å¿«åœ°å¤åˆ¶ä¸€å¼ è¡¨ï¼Ÿ\n42ï½œgrant ä¹‹åè¦è·Ÿç€ flush privileges å—ï¼Ÿ\n43ï½œè¦ä¸è¦ä½¿ç”¨åˆ†åŒºè¡¨ï¼Ÿ\n44ï½œç­”ç–‘æ–‡ç« ï¼ˆä¸‰ï¼‰ï¼šè¯´ä¸€è¯´è¿™äº›å¥½é—®é¢˜\n45ï½œè‡ªå¢ id ç”¨å®Œæ€ä¹ˆåŠï¼Ÿ\n"},"å­¦ä¹ ç¬”è®°/Nodejs/Egg.js-æ‰‹åŠ¨çƒ­æ›´æ–°":{"title":"Egg.js æ‰‹åŠ¨çƒ­æ›´æ–°","links":[],"tags":["éƒ¨ç½²","çƒ­æ›´æ–°","eggjs","nodejs"],"content":"package.json\n{\n  &quot;scripts&quot;: {\n    &quot;start&quot;: &quot;egg-scripts start --daemon --title=egg-server&quot;,\n    &quot;stop&quot;: &quot;egg-scripts stop --daemon --title=egg-server&quot;,\n    &quot;start-tmp&quot;: &quot;egg-scripts start --daemon --title=egg-tmp-server --port=7002&quot;,\n    &quot;stop-tmp&quot;: &quot;egg-scripts stop --daemon --title=egg-tmp-server --port=7002&quot;\n  }\n}\n\næ­£å¸¸å¯åŠ¨æ—¶ npm run build &amp;&amp; npm run startï¼Œåœ¨ Nginx é‡Œåä»£åˆ° 7001 ç«¯å£\néœ€è¦çƒ­æ›´æ–°æ—¶ï¼Œnpm run start-tmpï¼Œåœ¨ Nginx é‡Œåä»£åˆ° 7002 ç«¯å£ï¼ˆservice nginx reloadï¼‰\né‡å¯ 7001 ç«¯å£ä¸Šçš„æœåŠ¡ï¼Œåœ¨ Nginx é‡Œåä»£å› 7001 ç«¯å£\nnpm run start-tmp å…³é—­ 7002 ç«¯å£çš„æœåŠ¡\n"},"å­¦ä¹ ç¬”è®°/PHP/Laravel-Pint-ä½¿ç”¨":{"title":"Laravel Pint ä½¿ç”¨","links":[],"tags":["php","æœªå®Œæˆ"],"content":"å‚è€ƒï¼š\n\nlaravel-pint-pre-commit-hooks-github-actions\nPhpStorm å·²å†…ç½®æ”¯æŒï¼Œå¯åœ¨è®¾ç½®é‡Œæœç´¢åˆ°å¹¶ä¸»åŠ¨æ‰“å¼€\n"},"å­¦ä¹ ç¬”è®°/PHP/PHP-å¼€å‘è®¾ç½®":{"title":"PHP å¼€å‘è®¾ç½®","links":[],"tags":["php","æœªå®Œæˆ"],"content":"Laravel Pint Â§\nå¦‚ä½•åœ¨PHPSTORM é…ç½®Laravel Pint ä»£ç æ ¼å¼åŒ–åŒ…\nLaravel Pint\nVSCode Â§"},"å­¦ä¹ ç¬”è®°/PHP/PHP-é”™è¯¯ç è®¾è®¡":{"title":"PHP é”™è¯¯ç è®¾è®¡","links":[],"tags":["php","æœªå®Œæˆ"],"content":"ç›®æ ‡ Â§\né”™è¯¯ç åŒ…å«ï¼šæ•°å­—ã€è‹±æ–‡ã€å«ä¹‰ï¼Œè¿˜å¯ä»¥æœ‰ HTTP Status\nè¿™äº›æœ€å¥½æ”¾åˆ°ä¸€èµ·ï¼Œä¸ç„¶æ·»åŠ æ—¶å®¹æ˜“æ¼\næ–¹æ¡ˆ Â§\né™æ€å˜é‡ï¼šæ•°ç»„\nå¤šä¸ªåå­—ç±»ä¼¼çš„é™æ€å˜é‡\né™æ€å·¥å‚æ–¹æ³•\næšä¸¾å’Œæ³¨è§£\nè®¨è®º Â§\nç»“è®º Â§\nå‚è€ƒ Â§\n\nUsing attributes to add value\nPHP å¼‚å¸¸ä¸é”™è¯¯å¤„ç†\n"},"å­¦ä¹ ç¬”è®°/PHP/PHP-FPM-é…ç½®":{"title":"PHP-FPM é…ç½®","links":[],"tags":["php","php-fpm"],"content":"ä»¥ä¸‹å†…å®¹é€‚ç”¨äº IO å¯†é›†å‹åº”ç”¨\nä¸€ä¸ª PHP-FPM è¿›ç¨‹å¤§çº¦å  30M å†…å­˜\n\nè¿›ç¨‹æ•°é‡\n\nè®¡ç®—å…¬å¼ï¼šè¿›ç¨‹æ•° = å†…å­˜å¤§å°ï¼ˆMï¼‰ * 0.6 / 30\nä¸¾ä¾‹ï¼š8G * 1024 * 0.6 / 30 = 163.84\n\n\nmax_requests\n\næ¯ä¸ªè¿›ç¨‹é‡å¯å‰å¯ä»¥å¤„ç†çš„è¯·æ±‚æ•°\nç”±Â pm.max_childrenÂ çš„å€¼å’Œæ¯ç§’çš„å®é™…è¯·æ±‚æ•°é‡å†³å®š\n\n\n\nå‚è€ƒæ–‡ç« \n\nFastCGI è¿›ç¨‹ç®¡ç†å™¨ï¼ˆFPMï¼‰\nPHP-FPM tuning: Using â€˜pm staticâ€™ for Max Performanceï¼ˆè¯‘æ–‡ï¼‰\nPHP-FPM é…ç½®\nPHP-FPM è¿›ç¨‹æ•°è®¾ç½®å¤šå°‘åˆé€‚\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/00ï½œå¼€ç¯‡è¯":{"title":"00ï½œå¼€ç¯‡è¯","links":[],"tags":["redis"],"content":"\n\n1 Redis çš„â€œä¸¤å¤§ç»´åº¦ï¼Œä¸‰å¤§ä¸»çº¿\n\n\n\n\n\nåº”ç”¨çº¬åº¦\n\nç¼“å­˜åº”ç”¨\né›†ç¾¤åº”ç”¨\næ•°æ®ç»“æ„åº”ç”¨\n\n\n\nç³»ç»Ÿçº¬åº¦\n\n\né«˜æ€§èƒ½ä¸»çº¿\n\nçº¿ç¨‹æ¨¡å‹\næ•°æ®ç»“æ„\nAOF\nepoll ç½‘ç»œæ¡†æ¶\n\n\n\né«˜å¯é ä¸»çº¿\n\nä¸»ä»å¤åˆ¶\nå“¨å…µæœºåˆ¶\nRDB\n\n\n\né«˜å¯æ‰©å±•æ€§ä¸»çº¿\n\næ•°æ®åˆ†ç‰‡\nè´Ÿè½½å‡è¡¡\n\n\n\n\n\n\n\n2 Redis é—®é¢˜ç”»åƒå›¾\n\n\n\n\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/01ï½œåŸºç¡€æ¶æ„ï¼šä¸€ä¸ªé”®å€¼æ•°æ®åº“åŒ…å«ä»€ä¹ˆï¼Ÿ":{"title":"01ï½œåŸºç¡€æ¶æ„ï¼šä¸€ä¸ªé”®å€¼æ•°æ®åº“åŒ…å«ä»€ä¹ˆï¼Ÿ","links":[],"tags":["redis"],"content":"\n\næ“ä½œæ¨¡å—\n\nPUTï¼šæ–°å†™å…¥æˆ–æ›´æ–°ä¸€ä¸ª key-value å¯¹ï¼Œå¦‚ PUT hello world\nGETï¼šæ ¹æ® K è¯»å– V\nDELETEï¼šæ ¹æ® K åˆ é™¤æ•´ä¸ª KV å¯¹\nSCANï¼šæ ¹æ®ä¸€æ®µ key çš„èŒƒå›´è¿”å›ç›¸åº”çš„ value å€¼\n\n\n\nè®¿é—®æ¨¡å¼\n\né€šè¿‡å‡½æ•°åº“è°ƒç”¨çš„æ–¹å¼ä¾›å¤–éƒ¨åº”ç”¨ä½¿ç”¨\né€šè¿‡ç½‘ç»œæ¡†æ¶ä»¥ Socket é€šä¿¡çš„å½¢å¼å¯¹å¤–æä¾›é”®å€¼å¯¹æ“ä½œ\n\n\n\nI/O æ¨¡å‹è®¾è®¡\n\nå•çº¿ç¨‹ã€å¤šçº¿ç¨‹ã€å¤šè¿›ç¨‹\n\n\n\nç´¢å¼•æ¨¡å—\n\nè®©é”®å€¼æ•°æ®åº“æ ¹æ® key æ‰¾åˆ° value çš„å­˜å‚¨ä½ç½®ï¼Œè¿›è€Œæ‰§è¡Œæ“ä½œ\nMemcached å’Œ Redis é‡‡ç”¨å“ˆå¸Œè¡¨ä½œä¸º key-value ç´¢å¼•\nå†…å­˜çš„é«˜æ€§èƒ½éšæœºè®¿é—®ç‰¹æ€§å’Œå“ˆå¸Œè¡¨ O(1) çš„æ“ä½œå¤æ‚åº¦ç›¸åŒ¹é…\n\n\n\nå­˜å‚¨æ¨¡å—\n\n\nåˆ†é…å™¨\n\nå†…å­˜ï¼šè¯»å†™å¿«ï¼Œæ‰ç”µæ•°æ®ä¸¢å¤±\nå¤–å­˜ï¼šè¯»å†™æ…¢ï¼Œæ•°æ®æŒä¹…åŒ–\n\n\n\næŒä¹…åŒ–\n\n\nå¯¹äºæ¯ä¸ªé”®å€¼å¯¹éƒ½è¿›è¡Œè½ç›˜ä¿å­˜\n\næ•°æ®å¯é \næ€§èƒ½å·®\n\n\n\nå‘¨æœŸæ€§æŠŠå†…å­˜ä¸­çš„é”®å€¼æ•°æ®ä¿å­˜åˆ°æ–‡ä»¶\n\næ•°æ®å¯èƒ½ä¸¢å¤±\næ€§èƒ½è¾ƒå¥½\n\n\n\n\n\n\n\nä» SimpleKV åˆ° Redis çš„æ¶æ„å›¾è½¬å˜\n\n\n\n\n\n\n\n\n\n\nä»é”®å€¼æ•°æ®åº“å¼€å‘å’Œè¿ç»´çš„è¾…åŠ©å·¥å…·ä¸Šåšå¯¹æ¯”\n\n\n\n\n\n\n\n\n\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/02ï½œæ•°æ®ç»“æ„ï¼šå¿«é€Ÿçš„-Redis-æœ‰å“ªäº›æ…¢æ“ä½œï¼Ÿ":{"title":"02ï½œæ•°æ®ç»“æ„ï¼šå¿«é€Ÿçš„ Redis æœ‰å“ªäº›æ…¢æ“ä½œï¼Ÿ","links":[],"tags":["redis"],"content":"\n\nRedis æ•°æ®ç±»å‹å’Œåº•å±‚æ•°æ®ç»“æ„çš„å¯¹åº”å…³ç³»\n\n\n\n\n\nRedis ä½¿ç”¨ä¸€ä¸ªå“ˆå¸Œè¡¨ O(1) ä¿å­˜æ‰€æœ‰é”®å€¼å¯¹\n\n\nå…¨å±€å“ˆå¸Œè¡¨ï¼ˆæ•°ç»„ï¼‰\n\n\n\n\n\nå“ˆå¸Œæ¡¶\n\n\nå“ˆå¸Œæ¡¶\n\n\nentry\n\n\nentry\n\n\n*key\n\nString\n\n\n\n*value\n\nStringï½œListï½œHashï½œSetï½œSorted Set\n\n\n\n\n\n\n\næ¯ä¸ªæ•°ç»„å…ƒç´ ç§°ä¸ºä¸€ä¸ªå“ˆå¸Œæ¡¶ï¼ˆæŒ‡é’ˆï¼‰\n\n\næ¯ä¸ªå“ˆå¸Œæ¡¶ä¿å­˜å¤šä¸ªé”®å€¼å¯¹æ•°æ®\n\n\nè®¡ç®—é”®çš„å“ˆå¸Œå€¼å°±å¯ä»¥çŸ¥é“å¯¹åº”çš„å“ˆå¸Œæ¡¶ä½ç½®\n\n\n\n\nå“ˆå¸Œå†²çª\n\n\nä¸¤ä¸ª key çš„å“ˆå¸Œå€¼å’Œå“ˆå¸Œæ¡¶è®¡ç®—å¯¹åº”å…³ç³»æ—¶ï¼Œæ­£å¥½è½åœ¨äº†åŒä¸€ä¸ªå“ˆå¸Œæ¡¶ä¸­ã€‚\n\n\nè§£å†³æ–¹æ¡ˆï¼šé“¾å¼å“ˆå¸Œã€‚åŒä¸€ä¸ªå“ˆå¸Œæ¡¶ä¸­çš„å¤šä¸ªå…ƒç´ ç”¨ä¸€ä¸ªé“¾è¡¨æ¥ä¿å­˜ï¼Œå®ƒä»¬ä¹‹é—´ä¾æ¬¡ç”¨æŒ‡é’ˆè¿æ¥ã€‚\n\n\nå½“ä¸€ä¸ªæ¡¶ä¸­çš„å…ƒç´ è¿‡å¤šï¼Œè®¿é—®æ—¶é—´å˜é•¿æ—¶\n\n\né‡‡ç”¨ä¸¤ä¸ªå…¨å±€å“ˆå¸Œè¡¨ï¼Œå½“å“ˆå¸Œè¡¨ 1 ä¸å¤Ÿå¤§æ—¶ copy åˆ°æ›´å¤§çš„å“ˆå¸Œè¡¨ 2\n\né—®é¢˜ï¼šä¸€æ¬¡æ€§å¤åˆ¶ä¼šå¯¼è‡´ Redis çº¿ç¨‹é˜»å¡\n\n\n\nrehashï¼šå¢åŠ ç°æœ‰å“ˆå¸Œæ¡¶çš„æ•°é‡\n\n\nè£…è½½å› å­çš„å¤§å° = æ‰€æœ‰ entry ä¸ªæ•°é™¤ä»¥å“ˆå¸Œè¡¨çš„å“ˆå¸Œæ¡¶ä¸ªæ•°\n\n\n&lt; 1 æˆ–è€…åœ¨è¿›è¡Œ RDB å’Œ AOF é‡å†™æ—¶ç¦æ­¢ rehash\n\n\n\n= 1ï¼Œä¸”å…è®¸è¿›è¡Œ rehash æ—¶ä¼šè¿›è¡Œ rehash\n\n\n\n\n= 5ï¼Œç«‹é©¬å¼€å§‹ rehash\n\n\n\n\n\næ¸è¿›å¼ rehash\n\næ¯æ¬¡å¤„ç†è¯·æ±‚æ—¶ï¼Œé¡ºå¸¦æ‹·è´ä¸€éƒ¨åˆ†æ•°æ®åˆ°å¦ä¸€ä¸ªå“ˆå¸Œè¡¨ã€‚\nå®šæ—¶ä»»åŠ¡å‘¨æœŸæ€§åœ°æ¬ç§»ä¸€äº›æ•°æ®åˆ°æ–°çš„å“ˆå¸Œè¡¨ä¸­\n\n\n\n\n\n\n\nå‹ç¼©åˆ—è¡¨ ziplist çš„ç»“æ„\n\n\nè¡¨å¤´\n\nzlbytesï¼šåˆ—è¡¨é•¿åº¦\nzltailï¼šåˆ—è¡¨å°¾çš„åç§»é‡\nzllenï¼šentry ä¸ªæ•°\n\n\n\nè¡¨å°¾ zlendï¼šåˆ—è¡¨ç»“æŸï¼Œå–å€¼é»˜è®¤æ˜¯ 255\n\n\nå…ƒç´  entry\n\n\nprev_len å‰ä¸€ä¸ª entry çš„é•¿åº¦\n\n1 å­—èŠ‚ï¼šä¸Šä¸€ä¸ª entry çš„é•¿åº¦ &lt; 254 å­—èŠ‚\n5 å­—èŠ‚ï¼š1 å­—èŠ‚ä»¥å¤–çš„æƒ…å†µ\nprev_lençš„ç¬¬ä¸€ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªentryçš„å¼€å§‹ï¼Œå¦‚æœç­‰äº255è¡¨ç¤ºåˆ—è¡¨ç»“æŸï¼Œå¦‚æœç­‰äº254é‚£åå››ä¸ªå­—èŠ‚æ‰æ˜¯prev_lençš„å®é™…å€¼ï¼Œå¦‚æœå°äº254ï¼Œé‚£å°±ä¸éœ€è¦åå››ä¸ªå­—èŠ‚ï¼Œç›´æ¥ä½¿ç”¨è¿™ä¸€ä¸ªå­—èŠ‚è¡¨ç¤ºprev_lençš„å®é™…å€¼\nå½“å‰ä¸€èŠ‚ç‚¹é•¿åº¦å¤§äºç­‰äº254æ—¶ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚ä¸º254(1111 1110)ä½œä¸ºæ ‡å¿—ï¼Œåé¢4ä¸ªå­—èŠ‚ç»„æˆä¸€ä¸ªæ•´å‹ç”¨æ¥å­˜å‚¨é•¿åº¦\n\n\n\nencoding ç¼–ç æ–¹å¼ï¼Œ1 å­—èŠ‚\n\n\ncontent å®é™…æ•°æ®\n\n\n\n\nå…¶ä»–æ“ä½œåŒæ•´æ•°æ•°ç»„ã€åŒå‘åˆ—è¡¨\n\n\n\n\n\né¡ºåºæŸ¥æ‰¾ O(N)\n\n\n\n\nè·³è¡¨ O(logN)ï¼šå¤šçº§ç´¢å¼•ï¼Œé€šè¿‡ç´¢å¼•ä½ç½®çš„å‡ ä¸ªè·³è½¬ï¼Œå®ç°æ•°æ®çš„å¿«é€Ÿå®šä½\n\n\nä¸åŒæ“ä½œçš„å¤æ‚åº¦\n\n\nå•å…ƒç´ æ“ä½œæ˜¯åŸºç¡€\n\næ¯ä¸€ç§é›†åˆç±»å‹å¯¹å•ä¸ªæ•°æ®å®ç°çš„å¢åˆ æ”¹æŸ¥æ“ä½œ\n\n\n\nèŒƒå›´æ“ä½œéå¸¸è€—æ—¶\n\n\né›†åˆç±»å‹ä¸­çš„éå†æ“ä½œï¼Œå¯ä»¥è¿”å›é›†åˆä¸­çš„æ‰€æœ‰æ•°æ®\n\nç”¨ SCAN ä»£æ›¿éå†æ“ä½œ\n\n\n\n\n\nç»Ÿè®¡æ“ä½œé€šå¸¸é«˜æ•ˆ\n\né›†åˆç±»å‹ä¸­å¯¹é›†åˆä¸­æ‰€æœ‰å…ƒç´ ä¸ªæ•°çš„è®°å½•\n\n\n\nä¾‹å¤–æƒ…å†µåªæœ‰å‡ ä¸ª\n\næŸäº›æ•°æ®ç»“æ„çš„ç‰¹æ®Šè®°å½•\n\n\n\n\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/03ï½œé«˜æ€§èƒ½-IO-æ¨¡å‹ï¼šä¸ºä»€ä¹ˆå•çº¿ç¨‹-Redis-é‚£ä¹ˆå¿«ï¼Ÿ":{"title":"03ï½œé«˜æ€§èƒ½ IO æ¨¡å‹ï¼šä¸ºä»€ä¹ˆå•çº¿ç¨‹ Redis é‚£ä¹ˆå¿«ï¼Ÿ","links":[],"tags":["redis"],"content":"\n\nRedis çš„ç½‘ç»œ IO å’Œé”®å€¼å¯¹è¯»å†™ç”±ä¸€ä¸ªçº¿ç¨‹å®Œæˆ\n\nå½“å®¢æˆ·ç«¯å’Œ Reids çš„ç½‘ç»œè¿æ¥æ–­å¼€æ—¶ï¼ŒRedis ä¸ä¼šç­‰å¾…å®¢æˆ·ç«¯æ¢å¤è¿æ¥\n\n\n\nRedis çš„å…¶ä»–åŠŸèƒ½ï¼Œæ¯”å¦‚æŒä¹…åŒ–ã€å¼‚æ­¥åˆ é™¤ã€é›†ç¾¤æ•°æ®åŒæ­¥ç­‰ï¼Œç”±é¢å¤–çš„çº¿ç¨‹æ‰§è¡Œ\n\n\nå•çº¿ç¨‹è®¾è®¡æœºåˆ¶\n\nå¤šçº¿ç¨‹ç¼–ç¨‹æ¨¡å¼ï¼šå…±äº«èµ„æºçš„å¹¶å‘è®¿é—®æ§åˆ¶é—®é¢˜\nåœ¨å†…å­˜ä¸­å®Œæˆå¤§éƒ¨åˆ†æ“ä½œ + é«˜æ•ˆçš„æ•°æ®ç»“æ„\n\n\n\nå¤šè·¯å¤ç”¨æœºåˆ¶ï¼ˆselect/epoll æœºåˆ¶ï¼‰\n\n\nè¯¥æœºåˆ¶å…è®¸å†…æ ¸ä¸­åŒæ—¶å­˜åœ¨å¤šä¸ªç›‘å¬å¥—æ¥å­—å’Œå·²è¿æ¥å¥—æ¥å­—\n\n\nå†…æ ¸ç›‘å¬è¿™äº›å¥—æ¥å­—ä¸Šçš„è¿æ¥è¯·æ±‚æˆ–æ•°æ®è¯·æ±‚ï¼Œä¸€æ—¦æœ‰è¯·æ±‚åˆ°è¾¾ï¼Œå°±äº¤ç»™ Redis å¤„ç†\n\n\nåŸºäºäº‹ä»¶çš„å›è°ƒæœºåˆ¶\n\näº‹ä»¶é˜Ÿåˆ—\n\n\n\n\n\nåŸºäºå¤šè·¯æœç”¨çš„ Redis é«˜æ€§èƒ½ IO æ¨¡å‹\n\n\n\n\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/04ï½œAOF-æ—¥å¿—ï¼šå®•æœºäº†ï¼ŒRedis-å¦‚ä½•é¿å…æ•°æ®ä¸¢å¤±ï¼Ÿ":{"title":"04ï½œAOF æ—¥å¿—ï¼šå®•æœºäº†ï¼ŒRedis å¦‚ä½•é¿å…æ•°æ®ä¸¢å¤±ï¼Ÿ","links":[],"tags":["redis"],"content":"\n\nRedis ä½œä¸ºç¼“å­˜ä½¿ç”¨\n\nä»æ•°æ®åº“è¯»å–æ•°æ®æ¢å¤\nå½“éœ€è¦æ¢å¤æ—¶æ•°æ®åº“å‹åŠ›å¤§ã€Redis å“åº”æ…¢\n\n\n\nå†™åæ—¥å¿—ï¼šå…ˆæ‰§è¡Œå‘½ä»¤æŠŠæ•°æ®å†™å…¥å†…å­˜ï¼Œå†è®°å½•æ—¥å¿—\n\nä¸ä¼šé˜»å¡å½“å‰çš„å†™æ“ä½œ\nè®°å½•çš„å‘½ä»¤æ²¡æœ‰é”™è¯¯\næ²¡æ¥å¾—åŠè®°å½•æ—¶ï¼Œå®•æœºä¼šä¸¢å¤±æ•°æ®\nåœ¨ä¸»çº¿ç¨‹å†™ï¼Œå†™ç›˜å‹åŠ›å¤§å¯èƒ½å¯¼è‡´åç»­æ“ä½œæ— æ³•æ‰§è¡Œ\n\n\n\næ—¥å¿—æ ¼å¼ç¤ºä¾‹\n\n\nRedis å‘½ä»¤ set testkey testvalue\n\n\nAOF æ–‡ä»¶ï¼ˆAppend Only Fileï¼‰\n\n\n\n\n\n*3ï¼šå‘½ä»¤æœ‰ä¸‰ä¸ªéƒ¨åˆ†\n\n\n$3ï¼šå‘½ä»¤ã€é”®æˆ–å€¼ä¸€å…±æœ‰å¤šå°‘å­—èŠ‚\n\n\næ¯ä¸ª $n ä¸‹ä¸€è¡Œè·Ÿç€å‘½ä»¤ã€é”®æˆ–å€¼\n\n\n\n\nä¸‰ç§å†™å›ç­–ç•¥\n\n\nAlwaysï¼šåŒæ­¥å†™å›\n\n\nEverysecï¼šæ¯ç§’å†™å›\n\nä¼˜å…ˆä½¿ç”¨ï¼Œåœ¨å¯é æ€§å’Œæ€§èƒ½å–äº†ä¸€ä¸ªå¹³è¡¡\n\n\n\nNoï¼šæ“ä½œç³»ç»Ÿæ§åˆ¶çš„å†™å›\n\n\n\n\né‡å†™æœºåˆ¶\n\n\nå¦‚å¤šä¸ªæ“ä½œåŒä¸€ä¸ªé”®å€¼çš„å‘½ä»¤åˆå¹¶ä¸ºä¸€ä¸ªå‘½ä»¤\n\n\né¿å…é‡å†™æ—¥å¿—è¿‡å¤§\n\n\nç›´æ¥æ ¹æ®æ•°æ®åº“é‡Œæ•°æ®çš„æœ€æ–°çŠ¶æ€ï¼Œç”Ÿæˆè¿™äº›æ•°æ®çš„æ’å…¥å‘½ä»¤ï¼Œä½œä¸ºæ–°æ—¥å¿—\n\n\nä¸€ä¸ªæ‹·è´\n\n\nç”±åå°å­è¿›ç¨‹ bgrewiteaof å®Œæˆï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹\n\nfork åˆ›å»º bgrewriteaof å­è¿›ç¨‹æ—¶ï¼Œé˜»å¡ä¸»çº¿ç¨‹ï¼Œå¦‚æœå®ä¾‹å†…å­˜å¤§ï¼Œæ‰§è¡Œæ—¶é—´è¿˜ä¼šæ›´é•¿\nå…±äº«ä¸»çº¿ç¨‹å†…å­˜ï¼Œä¸»çº¿ç¨‹æ‰§è¡Œæ–°å†™æˆ–ä¿®æ”¹æ“ä½œæ—¶ä¼šç”³è¯·æ–°çš„å†…å­˜ç©ºé—´ä¿å­˜æ–°çš„æ•°æ®ï¼Œå¦‚æœæ“ä½œçš„æ˜¯ bigkeyï¼Œå¯èƒ½å› ä¸ºç”³è¯·å¤§ç©ºé—´è€Œé¢ä¸´é˜»å¡é£é™©\n\n\n\n\n\nä¸¤å¤„æ—¥å¿—\n\næ­£åœ¨ä½¿ç”¨çš„ AOF æ—¥å¿— + æ–°çš„é‡å†™æ—¥å¿—\né¿å…ç«äº‰æ–‡ä»¶ç³»ç»Ÿçš„é”\n\n\n\nå‡å°æ—¥å¿—å¤§å°\n\n\n\n\n\nAOF éé˜»å¡é‡å†™è¿‡ç¨‹\n\n\n\n\n\n\n\né€‚ç”¨äºè¯»æ“ä½œæ¯”è¾ƒå¤šçš„åœºæ™¯\n\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/05ï½œå†…å­˜å¿«ç…§ï¼šå®•æœºåï¼ŒRedis-å¦‚ä½•å®ç°å¿«é€Ÿæ¢å¤ï¼Ÿ":{"title":"05ï½œå†…å­˜å¿«ç…§ï¼šå®•æœºåï¼ŒRedis å¦‚ä½•å®ç°å¿«é€Ÿæ¢å¤ï¼Ÿ","links":[],"tags":["redis"],"content":"\n\nå’Œ AOF ç›¸æ¯”ï¼ŒRDB è®°å½•æŸä¸€æ—¶åˆ»çš„æ•°æ®ï¼Œæ¢å¤æ—¶ç›´æ¥æŠŠ RDB æ–‡ä»¶è¯»å…¥å†…å­˜\n\nç±»æ¯”æ‹ç…§\nå…¨é‡å¿«ç…§\n\n\n\nç”Ÿæˆ RDB æ–‡ä»¶çš„æ–¹æ¡ˆ\n\n\nsaveï¼šåœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œä¼šå¯¼è‡´é˜»å¡\n\n\nbgsaveï¼šåˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œå¤åˆ¶ä¸»çº¿ç¨‹çš„é¡µè¡¨ï¼Œä¸“é—¨å†™å…¥ RDB æ–‡ä»¶ï¼Œé¿å…é˜»å¡ã€‚é»˜è®¤é…ç½®\n\nå…±äº«ä¸»çº¿ç¨‹çš„æ‰€æœ‰å†…å­˜æ•°æ®\n\n\n\n\n\nå¿«ç…§æ—¶æ•°æ®èƒ½ä¿®æ”¹å—ï¼Ÿ\n\nè¯»æ“ä½œï¼šbgsave å­è¿›ç¨‹å’Œä¸»çº¿ç¨‹äº’ä¸å½±å“\nèƒ½\nå†™æ“ä½œï¼šç”Ÿæˆè¢«ä¿®æ”¹çš„ä¸€å—æ•°æ®çš„å‰¯æœ¬ï¼Œbgsave å­è¿›ç¨‹ç»§ç»­å†™ RDB æ–‡ä»¶ï¼Œä¸»çº¿ç¨‹åœ¨å‰¯æœ¬ä¸Šè¿›è¡Œä¿®æ”¹\nå†™æ—¶å¤åˆ¶ï¼šä¸»çº¿ç¨‹åœ¨æœ‰å†™æ“ä½œæ—¶ï¼Œæ‰ä¼šæŠŠè¿™ä¸ªæ–°å†™æˆ–ä¿®æ”¹åçš„æ•°æ®å†™å…¥åˆ°ä¸€ä¸ªæ–°çš„ç‰©ç†åœ°å€ä¸­ï¼Œå¹¶ä¿®æ”¹è‡ªå·±çš„é¡µè¡¨æ˜ å°„\n\n\n\n\n\n\n\nå¯ä»¥æ¯ç§’åšä¸€æ¬¡å¿«ç…§å—ï¼Ÿ\n\nç£ç›˜å‹åŠ›\nfork bgsave å­è¿›ç¨‹çš„è¿‡ç¨‹ä¼šé˜»å¡ä¸»çº¿ç¨‹\n\n\n\næ··åˆä½¿ç”¨ AOF å’Œå†…å­˜å¿«ç…§\n\nAOF åªä¿ç•™ä»æœ€åä¸€æ¬¡å¿«ç…§å¼€å§‹çš„æ”¹åŠ¨\n\n\n\næ•°æ®ä¸èƒ½ä¸¢å¤±æ—¶ï¼Œå†…å­˜å¿«ç…§å’Œ AOF çš„æ··åˆä½¿ç”¨æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©\n\n\nå¦‚æœå…è®¸åˆ†é’Ÿçº§åˆ«çš„æ•°æ®ä¸¢å¤±ï¼Œå¯ä»¥åªä½¿ç”¨ RDB\n\n\nå¦‚æœåªç”¨ AOFï¼Œä¼˜å…ˆä½¿ç”¨ everysec çš„é…ç½®é€‰é¡¹ï¼Œå› ä¸ºå®ƒåœ¨å¯é æ€§å’Œæ€§èƒ½ä¹‹é—´å–äº†ä¸€ä¸ªå¹³è¡¡\n\n\næŒä¹…åŒ–æœ‰å…³çš„é£é™©\n\n\næœåŠ¡å™¨å†…å­˜ä¸è¶³\n\nå†™æ—¶å¤åˆ¶ä¸ºå†™ã€ä¿®æ”¹æ“ä½œæ¶‰åŠçš„æ•°æ®åˆ†é…ç›¸åŒå¤§å°çš„å†…å­˜å‰¯æœ¬\n\n\n\nå­è¿›ç¨‹ä¹Ÿä¼šå ç”¨ CPU èµ„æº\n\n\néœ€è¦å¼€å¯å®šæ—¶ RDB å’Œ AOF é‡å†™æ—¶è¿›ç¨‹ä¸€å®šä¸è¦ç»‘å®š CPUï¼šå­è¿›ç¨‹ä¼šä¸çˆ¶è¿›ç¨‹äº‰å¤ºåŒä¸€ä¸ª CPU èµ„æºï¼ˆå…·ä½“æœç´¢å…³é”®å­—æ‰¾åˆ°åé¢æœ‰å…³ç»‘å®š CPU çš„ç« èŠ‚ï¼‰\n\n\n\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/06ï½œæ•°æ®åŒæ­¥ï¼šä¸»ä»åº“å¦‚ä½•å®ç°æ•°æ®ä¸€è‡´ï¼Ÿ":{"title":"06ï½œæ•°æ®åŒæ­¥ï¼šä¸»ä»åº“å¦‚ä½•å®ç°æ•°æ®ä¸€è‡´ï¼Ÿ","links":[],"tags":["redis"],"content":"\n\nå†™æ“ä½œï¼šé¦–å…ˆåˆ°ä¸»åº“æ‰§è¡Œï¼Œä¸»åº“å°†å†™æ“ä½œåŒæ­¥ç»™ä»åº“\n\n\nåŒæ­¥æµç¨‹\n\n\nä¸»ä»åº“ç¬¬ä¸€æ¬¡åŒæ­¥çš„æµç¨‹\n\n\n\n\n\nå¢é‡å¤åˆ¶æµç¨‹\n\n\n\n\n\n\n\nå…¨é‡å¤åˆ¶\n\n\n\n\nç¬¬ä¸€æ¬¡åŒæ­¥æ— æ³•é¿å…\n\n\nä¸€ä¸ªå®ä¾‹çš„æ•°æ®åº“ä¸è¦å¤ªå¤§ï¼ˆå‡  GB çº§åˆ«åˆé€‚ï¼‰\n\n\né€šè¿‡ RDB æ–‡ä»¶\n\näºŒè¿›åˆ¶æ–‡ä»¶\n\n\n\nä¸ç”¨ AOF çš„åŸå› \n\n\néœ€è¦æ‰“å¼€ AOF åŠŸèƒ½\n\næœ‰å¾ˆå¤šåœºæ™¯æ•°æ®ä¸æ•æ„Ÿä¸éœ€è¦å¼€å¯ AOF åŠŸèƒ½\nåˆ·ç›˜ç­–ç•¥é€‰æ‹©ä¸å½“ä¼šä¸¥é‡å½±å“ Redis æ€§èƒ½\n\n\n\næ¯” RDB æ–‡ä»¶å¤§\n\n\nåœ¨ä»åº“ç«¯è¿›è¡Œæ¢å¤æ—¶ï¼Œç”¨ RDB çš„æ¢å¤æ•ˆç‡é«˜äºç”¨ AOF\n\n\n\n\n\n\n\n\nå¢é‡å¤åˆ¶\n\n\n\n\né€šè¿‡å‘½ä»¤ä¼ æ’­çš„é•¿è¿æ¥å¤åˆ¶\n\nå®Œæˆå…¨é‡å¤åˆ¶åï¼Œä¸»åº“é€šè¿‡é•¿è¿æ¥å°†åç»­é™†ç»­æ”¶åˆ°çš„å‘½ä»¤æ“ä½œåŒæ­¥ç»™ä»åº“ï¼Œå¯ä»¥é¿å…é¢‘ç¹å»ºç«‹è¿æ¥çš„å¼€é”€\n\n\n\nç½‘ç»œæ–­è¿æ—¶\n\nrepl_backlog_buffer\n\n\n\n\n\n\n\nä¸» -&gt; ä» -&gt; ä»\n\n\n\n\n\nä»åº“æ‰§è¡Œ replicaof IP PORT\n\n\n\nIP ä¸Šçš„å®ä¾‹æ‰§è¡Œ bgsave å‘½ä»¤ç”Ÿæˆ RDB æ–‡ä»¶åå‘ç»™ä»åº“\n\n\n\n\nä»åº“æ¸…ç©ºå½“å‰æ•°æ®åº“\n\n\n\n\nä¸»åº“ä¼šåœ¨å†…å­˜ç”¨ä¸“é—¨çš„ replication buffer è®°å½• RDB æ–‡ä»¶ç”Ÿæˆåæ”¶åˆ°çš„æ‰€æœ‰å†™æ“ä½œ\n\n\n\n\nå°† replication buffer çš„ä¿®æ”¹æ“ä½œå‘ç»™ä»åº“\n\n\n\n\n\nåˆ†æ‹…å…¨é‡å¤åˆ¶æ—¶çš„ä¸»åº“å‹åŠ›\n\n\n\n\nreplication buffer å’Œ repl_backlog_buffer çš„åŒºåˆ«\n\n\nreplication bufferï¼šå¤åˆ¶ç¼“å†²åŒº\n\n\nä»åº“ä¹Ÿç›¸å½“äºä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œä¼šå•ç‹¬åˆ†é…ä¸€ä¸ª client bufferï¼Œè¿™é‡Œç”¨æ¥ä¼ æ’­ç”¨æˆ·çš„å†™å‘½ä»¤åˆ°ä»åº“ï¼Œé€šå¸¸æŠŠå®ƒå«åš replication buffer\n\n\nä¸»èŠ‚ç‚¹å¼€å§‹å’Œä¸€ä¸ªä»èŠ‚ç‚¹è¿›è¡Œå…¨é‡åŒæ­¥æ—¶ï¼Œä¼šä¸ºä»èŠ‚ç‚¹åˆ›å»ºä¸€ä¸ªè¾“å‡ºç¼“å†²åŒºï¼Œè¿™ä¸ªç¼“å†²åŒºå°±æ˜¯å¤åˆ¶ç¼“å†²åŒº\n\n\nä½œç”¨ï¼šä¸»èŠ‚ç‚¹å‘ä»èŠ‚ç‚¹å‘é€ RDB æ–‡ä»¶æ—¶ï¼Œå¦‚æœåˆæ¥æ”¶å†™æ“ä½œï¼Œä¼šæš‚å­˜åœ¨ç¼“å†²åŒºï¼Œç­‰ RDB æ–‡ä»¶ä¼ è¾“å®Œæˆï¼Œä¸”ä»èŠ‚ç‚¹åŠ è½½å®Œæˆåï¼Œä¸»èŠ‚ç‚¹æŠŠç¼“å†²åŒºä¸­çš„å†™å‘½ä»¤å‘ç»™ä»èŠ‚ç‚¹è¿›è¡ŒåŒæ­¥\n\n\n\n\n\nå¯¹ä¸»ä»åŒæ­¥çš„å½±å“ï¼šå¦‚æœä¼ è¾“å’ŒåŠ è½½ RDB æ–‡ä»¶è€—æ—¶é•¿ï¼ŒåŒæ—¶ä¸»åº“æ¥æ”¶çš„å†™å‘½ä»¤æ“ä½œè¾ƒå¤šï¼Œå¯¼è‡´ç¼“å†²åŒºå†™æ»¡æº¢å‡ºï¼Œä¸»åº“ä¼šå¼ºåˆ¶å…³é—­å’Œä»åº“çš„ç½‘ç»œè¿æ¥ï¼Œé‡æ–°å¼€å§‹å…¨é‡åŒæ­¥\n\n\né€šè¿‡ client-output-buffer-limit-slave é…ç½®é¡¹å¢åŠ ç¼“å†²åŒºå¤§å°\n\n\n\n\nclient buffer è¶…è¿‡é™åˆ¶æ—¶ï¼Œä¸»åº“ä¼šå¼ºåˆ¶æ–­å¼€è¿™ä¸ª client è¿æ¥\n\næ­¤æ—¶ä»åº“å†æ¬¡å‘èµ·å¤åˆ¶è¯·æ±‚ï¼Œå¯èƒ½å¯¼è‡´æ¶æ€§å¾ªç¯\n\n\n\nrepl_backlog_bufferï¼šå¤åˆ¶ç§¯å‹ç¼“å†²åŒº\n\n\næ˜¯ä¸€ä¸ªç¯å½¢ç¼“å†²åŒºï¼šä¸ºäº†åœ¨ä»åº“æ–­å¼€ä¹‹åèƒ½æ‰¾åˆ°ä¸»ä»å·®å¼‚æ•°æ®è€Œè®¾è®¡\n\n\nè®°å½•å†™æ“ä½œ\n\n\næ‰€æœ‰ä»åº“å…±äº«\n\n\nä¸åŒçš„ä»åº“åœ¨è¿›è¡Œæ¢å¤æ—¶ï¼Œä¼šæŠŠè‡ªå·±çš„å¤åˆ¶è¿›åº¦ï¼ˆslave_repl_offsetï¼‰å‘ç»™ä¸»åº“ï¼Œä¸»åº“å°±å¯ä»¥å’Œå®ƒç‹¬ç«‹åŒæ­¥\n\n\nä¸»ä»æ–­å¼€å¤ªä¹…ï¼Œä¸»åº“å†™æ“ä½œèŠ‚ç‚¹è¶Šè¿‡ä»åº“åœ¨ repl_backlog_buffer çš„è¯»èŠ‚ç‚¹æ—¶ï¼Œä»åº“åªèƒ½å…¨é‡å¤åˆ¶\n\n\nrepl_backlog_size\n\n= ç¼“å†²ç©ºé—´å¤§å° * 2\nç¼“å†²ç©ºé—´å¤§å° = ä¸»åº“å†™å…¥å‘½ä»¤é€Ÿåº¦ * æ“ä½œå¤§å° - ä¸»ä»åº“é—´ç½‘ç»œä¼ è¾“å‘½ä»¤é€Ÿåº¦ * æ“ä½œå¤§å°\nè¿‡å°å¯èƒ½å¯¼è‡´ä»åº“å¤åˆ¶è¿›åº¦èµ¶ä¸ä¸Šä¸»åº“ï¼Œè§¦å‘å…¨é‡å¤åˆ¶\n\n\n\nrepl_backlog_buffer çš„ä½¿ç”¨\n\n\n\n\n\nä¸»èŠ‚ç‚¹åœ¨æŠŠæ¥æ”¶åˆ°çš„å†™å‘½ä»¤åŒæ­¥ç»™ä»èŠ‚ç‚¹æ—¶ï¼ŒåŒæ—¶ä¼šæŠŠè¿™äº›å†™å‘½ä»¤å†™å…¥å¤åˆ¶ç§¯å‹ç¼“å†²åŒºã€‚ä¸€æ—¦ä»èŠ‚ç‚¹å‘ç”Ÿç½‘ç»œé—ªæ–­ï¼Œå†æ¬¡å’Œä¸»èŠ‚ç‚¹æ¢å¤è¿æ¥åï¼Œä»èŠ‚ç‚¹å°±ä¼šä»å¤åˆ¶ç§¯å‹ç¼“å†²åŒºä¸­ï¼Œè¯»å–æ–­è¿æœŸé—´ä¸»èŠ‚ç‚¹æ¥æ”¶åˆ°çš„å†™å‘½ä»¤ï¼Œè¿›è€Œè¿›è¡Œå¢é‡åŒæ­¥\n\n\n\n\n\nçˆ¶èŠ‚ç‚¹å›¾2\n\n\n\n\n\n\n\n\n\n\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/07ï½œå“¨å…µæœºåˆ¶ï¼šä¸»åº“æŒ‚äº†ï¼Œå¦‚ä½•ä¸é—´æ–­æœåŠ¡ï¼Ÿ":{"title":"07ï½œå“¨å…µæœºåˆ¶ï¼šä¸»åº“æŒ‚äº†ï¼Œå¦‚ä½•ä¸é—´æ–­æœåŠ¡ï¼Ÿ","links":[],"tags":["redis"],"content":"\n\nå“¨å…µæœºåˆ¶çš„åŸºæœ¬æµç¨‹\n\n\n\nç›‘æ§ï¼šåˆ¤æ–­ä¸»ä»åº“ä¸‹çº¿\n\n\n\nä¸»è§‚ä¸‹çº¿\n\nå“¨å…µè¿›ç¨‹ä¼šä½¿ç”¨ PING å‘½ä»¤æ£€æµ‹å®ƒè‡ªå·±å’Œä¸»ã€ä»åº“çš„ç½‘ç»œè¿æ¥æƒ…å†µï¼Œç”¨æ¥åˆ¤æ–­å®ä¾‹çš„çŠ¶æ€ã€‚\nå¦‚æœå“¨å…µå‘ç°ä¸»åº“æˆ–ä»åº“å¯¹ PING å‘½ä»¤çš„å“åº”è¶…æ—¶äº†ï¼Œå“¨å…µå°±ä¼šå…ˆæŠŠå®ƒæ ‡è®°ä¸ºâ€œä¸»è§‚ä¸‹çº¿â€ã€‚\nä»åº“ä¼šè¢«ç›´æ¥æ ‡è®°ä¸ºâ€œä¸»è§‚ä¸‹çº¿â€ã€‚\n\n\n\nå®¢è§‚ä¸‹çº¿\n\n\nå¤§å¤šæ•°çš„å“¨å…µåˆ¤æ–­ä¸»åº“ä¸»è§‚ä¸‹çº¿ï¼Œä¸»åº“æ‰ä¼šæ ‡è®°ä¸ºå®¢è§‚ä¸‹çº¿\n\n\nå‡å°‘è¯¯åˆ¤\n\nå“¨å…µé›†ç¾¤ï¼šå“¨å…µæœºåˆ¶é€šå¸¸é‡‡ç”¨å¤šå®ä¾‹ç»„æˆçš„é›†ç¾¤æ¨¡å¼éƒ¨ç½²\n\n\n\n\n\né€‰ä¸»ï¼šé€‰å‡ºæ–°ä¸»åº“ï¼ˆç­›é€‰ + æ‰“åˆ†ï¼‰\n\n\n\n\n\n\næŒ‰ç…§ä¸€å®šçš„ç­›é€‰æ¡ä»¶å»æ‰ä¸ç¬¦åˆæ¡ä»¶çš„ä»åº“\n\n\n\n\nåœ¨çº¿çŠ¶æ€\n\n\nç½‘ç»œçŠ¶æ€\n\né…ç½®é¡¹ï¼ˆmsï¼‰down-after-milliseconds * 10\nå¦‚æœåœ¨ down-after-milliseconds æ¯«ç§’å†…ï¼Œä¸»ä»èŠ‚ç‚¹éƒ½æ²¡æœ‰é€šè¿‡ç½‘ç»œè”ç³»ä¸Šï¼Œæˆ‘ä»¬å°±å¯ä»¥è®¤ä¸ºä¸»ä»èŠ‚ç‚¹æ–­è¿äº†\nå¦‚æœå‘ç”Ÿæ–­è¿çš„æ¬¡æ•°è¶…è¿‡äº† 10 æ¬¡ï¼Œå°±è¯´æ˜è¿™ä¸ªä»åº“çš„ç½‘ç»œçŠ¶å†µä¸å¥½\næ­¤å‚æ•°å¯ä»¥è°ƒèŠ‚å“¨å…µçš„æ•æ„Ÿç¨‹åº¦\n\n\n\n\n\n\n\næŒ‰ç…§ä¸€å®šçš„è§„åˆ™ç»™å‰©ä¸‹çš„ä»åº“é€ä¸ªæ‰“åˆ†\n\n\n\n\nä»åº“ä¼˜å…ˆçº§\n\né€šè¿‡ slave-priority é…ç½®é¡¹è®¾ç½®\n\n\n\nä»åº“å¤åˆ¶è¿›åº¦\n\n\nå’Œæ—§ä¸»åº“åŒæ­¥ç¨‹åº¦æœ€æ¥è¿‘çš„ä»åº“å¾—åˆ†é«˜\n\nsalve_repl_offset æœ€å¤§\n\n\n\n\n\nä»åº“ ID å·\n\nåœ¨ä¼˜å…ˆçº§å’Œå¤åˆ¶è¿›åº¦éƒ½ç›¸åŒçš„æƒ…å†µä¸‹ï¼ŒID å·æœ€å°çš„ä»åº“å¾—åˆ†æœ€é«˜ï¼Œä¼šè¢«é€‰ä¸ºæ–°ä¸»åº“ã€‚\n\n\n\n\n\n\nå¾—åˆ†æœ€é«˜çš„ä½œä¸ºæ–°ä¸»åº“\n\n\n\næ–°ä¸»åº“çš„é€‰æ‹©è¿‡ç¨‹\n\n\n\n\n\n\n\n\n\né€šçŸ¥\n\n\n\n\n\n\nè®©ä»åº“æ‰§è¡Œ replicaof ä¸æ–°ä¸»åº“åŒæ­¥\n\n\n\n4.0 ä¹‹å‰å…¨é‡åŒæ­¥ï¼Œ4.0 ä¹‹åå¢é‡åŒæ­¥ï¼Œäº†è§£ psync2\n\n\n\n\né€šçŸ¥å®¢æˆ·ç«¯ä¸æ–°ä¸»åº“è¿æ¥\n\n\n\n\n\n\n\nåˆ‡æ¢è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯èƒ½å¦æ­£å¸¸è¿›è¡Œè¯·æ±‚æ“ä½œï¼Ÿ\n\n\nå®¢æˆ·ç«¯ä½¿ç”¨äº†è¯»å†™åˆ†ç¦»æ—¶ä¸ä¼šå—åˆ°å½±å“\n\n\nå†™è¯·æ±‚å¤±è´¥æŒç»­çš„æ—¶é—´ = å“¨å…µåˆ‡æ¢ä¸»ä»çš„æ—¶é—´ + å®¢æˆ·ç«¯æ„ŸçŸ¥åˆ°æ–°ä¸»åº“çš„æ—¶é—´\n\n\nå¦‚æœæƒ³è¦åº”ç”¨ç¨‹åºä¸æ„ŸçŸ¥æœåŠ¡çš„ä¸­æ–­ï¼Œè¿˜éœ€è¦å“¨å…µæˆ–å®¢æˆ·ç«¯åšäº›ä»€ä¹ˆï¼Ÿ\n\n\nå®¢æˆ·ç«¯æŠŠå†™å¤±è´¥çš„è¯·æ±‚å…ˆç¼“å­˜èµ·æ¥æˆ–å†™å…¥æ¶ˆæ¯é˜Ÿåˆ—ä¸­é—´ä»¶ä¸­ï¼Œç­‰å“¨å…µåˆ‡æ¢å®Œä¸»ä»åï¼Œå†æŠŠè¿™äº›å†™è¯·æ±‚å‘ç»™æ–°ä¸»åº“ï¼Œåªé€‚åˆå¯¹å†™å…¥è¯·æ±‚è¿”å›å€¼ä¸æ•æ„Ÿçš„ä¸šåŠ¡ï¼Œéœ€è¦ä¸šåŠ¡å±‚åšé€‚é…\n\n\nå“¨å…µä¸»åŠ¨é€šçŸ¥å®¢æˆ·ç«¯\n\n\n\nå“¨å…µå°†æ–°ä¸»åº“åœ°å€å†™å…¥è‡ªå·±å®ä¾‹çš„ pub/subï¼ˆswitch-master äº‹ä»¶ï¼‰ä¸­\n\n\n\n\nå®¢æˆ·ç«¯è®¢é˜… pub/subï¼Œæœ‰æ•°æ®æ—¶ï¼Œå®¢æˆ·ç«¯èƒ½æ„ŸçŸ¥åˆ°ä¸»åº“å˜æ›´ï¼ŒåŒæ—¶å¯ä»¥æ‹¿åˆ°æœ€æ–°çš„ä¸»åº“åœ°å€\n\n\n\n\n\nå®¢æˆ·ç«¯é€šè¿‡ sentinel get-master-addr-by-name å‘½ä»¤ä»å“¨å…µé›†ç¾¤ä¸­è·å–æœ€æ–°çš„åœ°å€\n\n\nä¸€èˆ¬ Redis çš„ SDK éƒ½æä¾›äº†é€šè¿‡å“¨å…µæ‹¿åˆ°å®ä¾‹åœ°å€ï¼Œå†è®¿é—®å®ä¾‹çš„æ–¹å¼ï¼Œç›´æ¥ä½¿ç”¨å³å¯\n\n\n\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/08ï½œå“¨å…µé›†ç¾¤ï¼šå“¨å…µæŒ‚äº†ï¼Œä¸»ä»åº“è¿˜èƒ½åˆ‡æ¢å—ï¼Ÿ":{"title":"08ï½œå“¨å…µé›†ç¾¤ï¼šå“¨å…µæŒ‚äº†ï¼Œä¸»ä»åº“è¿˜èƒ½åˆ‡æ¢å—ï¼Ÿ","links":[],"tags":["redis"],"content":"\n\næœ¬è´¨ä¸Šå“¨å…µå°±æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨ç‰¹å®šæ¨¡å¼ä¸‹çš„ Redis å®ä¾‹ã€‚\n\n\nåŸºäº pub/sub æœºåˆ¶çš„å“¨å…µé›†ç¾¤ç»„æˆè¿‡ç¨‹ï¼ˆå‘å¸ƒ/è®¢é˜…æœºåˆ¶ï¼‰\n\nåªæœ‰è®¢é˜…äº†åŒä¸€ä¸ªé¢‘é“çš„åº”ç”¨æ‰èƒ½é€šè¿‡å‘å¸ƒçš„æ¶ˆæ¯è¿›è¡Œä¿¡æ¯äº¤æ¢\nå“¨å…µé€šè¿‡ sentinel:hello é¢‘é“äº’ç›¸å‘ç°ã€é€šä¿¡\n\n\n\nç»™ä¸»åº“å‘é€ INFO å‘½ä»¤æ‹¿åˆ°ä»åº“åˆ—è¡¨ï¼Œå“¨å…µæ ¹æ®åˆ—è¡¨ä¸Šçš„è¿æ¥ä¿¡æ¯å’Œä»åº“å»ºç«‹è¿æ¥å¹¶ç›‘æ§\n\n\nåŸºäºå“¨å…µè‡ªèº«çš„ pub/sub åŠŸèƒ½ï¼Œå®ç°å®¢æˆ·ç«¯å’Œå“¨å…µä¹‹é—´çš„äº‹ä»¶é€šçŸ¥\n\n\né‡è¦çš„é¢‘é“æ±‡æ€»å›¾\n\n\n\n\n\nå¦‚ï¼šå®¢æˆ·ç«¯æ‰§è¡Œ SUBSCRIBE * è®¢é˜…æ‰€æœ‰äº‹ä»¶\n\n\n\n\nç”±å“ªä¸€ä¸ªå“¨å…µæ‰§è¡Œä¸»ä»åˆ‡æ¢ï¼Ÿ\n\nå’Œä¸»åº“å®¢è§‚ä¸‹çº¿çš„åˆ¤æ–­è¿‡ç¨‹ç±»ä¼¼ï¼ŒæŠ•ç¥¨ä»²è£\n\n\næ ‡è®°ä¸»åº“â€œä¸»è§‚ä¸‹çº¿â€\n\n\n\n\nå‘å…¶ä»–å“¨å…µå®ä¾‹è¦èµæˆç¥¨\n\n\n\n\nè·å¾—ä»²è£æ‰€éœ€çš„èµæˆç¥¨åï¼Œå°±å¯ä»¥æ ‡è®°ä¸»åº“ä¸ºâ€œå®¢è§‚ä¸‹çº¿â€ã€‚\n\n\n\n\næˆåŠŸæ ‡è®°ä¸»åº“ä¸ºå®¢è§‚ä¸‹çº¿çš„å“¨å…µå®ä¾‹å‘å…¶ä»–å“¨å…µå‘é€å‘½ä»¤ï¼Œè¡¨æ˜å¸Œæœ›æ‰§è¡Œä¸»ä»åˆ‡æ¢\n\n\n\n\n\næŠ•ç¥¨ï¼ˆY/Nï¼‰ï¼Œç¡®å®š Leader\n\n\n\n\n\næ‹¿åˆ°åŠæ•°ä»¥ä¸Šèµæˆç¥¨\n\n\n\n\næ‹¿åˆ°çš„ç¥¨æ•°å¤§äºç­‰äºå“¨å…µé…ç½®æ–‡ä»¶ä¸­çš„ quorum å€¼\n\n\næ¯ä¸ªå“¨å…µåªèƒ½æŠ•ä¸€ä¸ªèµæˆç¥¨ï¼Œå¯ä»¥ç»™è‡ªå·±æŠ•ï¼Œç¬¬ä¸€æ¬¡å¿…æŠ• Y\næ‰€æœ‰å“¨å…µåŒæ—¶åˆ¤æ–­ä¸»åº“ä¸»è§‚ä¸‹çº¿ï¼Œç„¶ååŒæ—¶å¾—åˆ°å®¢è§‚ä¸‹çº¿çš„ç»“è®ºæ—¶ï¼Œæ¯ä¸ªå“¨å…µå„è‡ªä¸€ç¥¨ï¼ˆæ¦‚ç‡æä½ï¼‰\n\n\n\n\n\nè¦ä¿è¯æ‰€æœ‰å“¨å…µå®ä¾‹çš„é…ç½®æ˜¯ä¸€è‡´çš„ï¼Œå°¤å…¶æ˜¯ä¸»è§‚ä¸‹çº¿çš„åˆ¤æ–­å€¼ down-after-milliseconds\n\n\næ€è€ƒé¢˜\n\n\né…ç½®äº†åŒ…å« 5 ä¸ªå“¨å…µå®ä¾‹çš„é›†ç¾¤ï¼Œquorum å€¼è®¾ä¸º 2ã€‚åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¦‚æœæœ‰ 3 ä¸ªå“¨å…µå®ä¾‹éƒ½å‘ç”Ÿæ•…éšœäº†ï¼Œæ­¤æ—¶ï¼ŒRedis ä¸»åº“å¦‚æœæœ‰æ•…éšœï¼Œè¿˜èƒ½æ­£ç¡®åœ°åˆ¤æ–­ä¸»åº“â€œå®¢è§‚ä¸‹çº¿â€å—ï¼Ÿ\n\nèƒ½ï¼Œä¸¤ä¸ªå“¨å…µéƒ½ç»™å‡ºä¸»è§‚ä¸‹çº¿çš„ç»“æœï¼Œè¾¾åˆ°äº† quorum çš„å€¼\n\n\n\nå¦‚æœå¯ä»¥çš„è¯ï¼Œè¿˜èƒ½è¿›è¡Œä¸»ä»åº“è‡ªåŠ¨åˆ‡æ¢å—ï¼Ÿ\n\nä¸èƒ½ä¸»ä»åˆ‡æ¢ï¼Œé€‰ä¸¾ Leader æ‹¿ä¸åˆ°è¶…è¿‡åŠæ•°çš„é€‰ç¥¨ï¼ˆ5/2 + 1 = 3ï¼‰\n\n\n\nå“¨å…µå®ä¾‹æ˜¯ä¸æ˜¯è¶Šå¤šè¶Šå¥½å‘¢ï¼Ÿ\n\nä¸æ˜¯ã€‚é€šä¿¡æ¬¡æ•°å¢å¤šï¼Œæ•…éšœé£é™©å˜å¤§ï¼Œé€‰ä¸¾æ—¶é—´å˜é•¿\n\n\n\nè°ƒå¤§ down-after-milliseconds å€¼ï¼Œå¯¹å‡å°‘è¯¯åˆ¤æœ‰æ²¡æœ‰å¥½å¤„ï¼Ÿ\n\næœ‰å¥½å¤„ï¼Œé™ä½è¯¯åˆ¤çš„æ¦‚ç‡ï¼Œä½†ä¸»ä»åˆ‡æ¢æ—¶é—´å˜é•¿ï¼Œå¯¹ä¸šåŠ¡å½±å“æ—¶é—´å˜ä¹…\n\n\n\n\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/09ï½œåˆ‡ç‰‡é›†ç¾¤ï¼šæ•°æ®å¢å¤šäº†ï¼Œæ˜¯è¯¥åŠ å†…å­˜è¿˜æ˜¯åŠ å®ä¾‹ï¼Ÿ":{"title":"09ï½œåˆ‡ç‰‡é›†ç¾¤ï¼šæ•°æ®å¢å¤šäº†ï¼Œæ˜¯è¯¥åŠ å†…å­˜è¿˜æ˜¯åŠ å®ä¾‹ï¼Ÿ","links":[],"tags":["redis"],"content":"\n\nçºµå‘æ‰©å±•ï¼šå‡çº§å•ä¸ª Redis å®ä¾‹çš„èµ„æºé…ç½®ï¼ŒåŒ…æ‹¬å¢åŠ å†…å­˜å®¹é‡ã€å¢åŠ ç£ç›˜å®¹é‡ã€ä½¿ç”¨æ›´é«˜é…ç½®çš„ CPU\n\nå®æ–½èµ·æ¥ç®€å•ã€ç›´æ¥\nå½“ä½¿ç”¨ RDB å¯¹æ•°æ®è¿›è¡ŒæŒä¹…åŒ–æ—¶ï¼Œå¦‚æœæ•°æ®é‡å¢åŠ ï¼Œéœ€è¦çš„å†…å­˜ä¹Ÿä¼šå¢åŠ ï¼Œä¸»çº¿ç¨‹ fork å­è¿›ç¨‹æ—¶å°±å¯èƒ½ä¼šé˜»å¡ï¼ˆè€—æ—¶é•¿ï¼‰\nä¸è¦æ±‚æŒä¹…åŒ–ä¿å­˜ Redis æ•°æ®æ—¶æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©\nå—åˆ°ç¡¬ä»¶å’Œæˆæœ¬çš„é™åˆ¶\n\n\n\næ¨ªå‘æ‰©å±•ï¼šå¢åŠ å½“å‰ Redis å®ä¾‹çš„ä¸ªæ•°\n\næ‰©å±•æ€§æ›´å¥½\næ•°æ®åˆ‡ç‰‡åï¼Œåœ¨å¤šä¸ªå®ä¾‹ä¹‹é—´å¦‚ä½•åˆ†å¸ƒï¼Ÿ\nå®¢æˆ·ç«¯æ€ä¹ˆç¡®å®šæƒ³è¦è®¿é—®çš„æ•°æ®åœ¨å“ªä¸ªå®ä¾‹ä¸Šï¼Ÿ\n\n\n\nåˆ‡ç‰‡é›†ç¾¤æ˜¯ä¸€ç§ä¿å­˜å¤§é‡æ•°æ®çš„é€šç”¨æœºåˆ¶ï¼Œå¯ä»¥æœ‰ä¸åŒçš„å®ç°æ–¹æ¡ˆ\n\n\nRedis Clusterï¼ˆå®˜æ–¹ï¼‰\n\n\né‡‡ç”¨å“ˆå¸Œæ§½ï¼ˆHash Slotï¼‰å¤„ç†æ•°æ®ä¸å®ä¾‹ä¹‹é—´çš„æ˜ å°„å…³ç³»\n\n\nå…±æœ‰ 16384 ä¸ªå“ˆå¸Œæ§½ï¼Œä¸ªæ•°åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å†™æ­»\n\n\n\næ ¹æ®é”®å€¼å¯¹çš„ keyï¼ŒæŒ‰ç…§Â CRC16 ç®—æ³•Â è®¡ç®—ä¸€ä¸ª 16 bit çš„å€¼\n\n\n\n\nç”¨å€¼å¯¹ 16384 å–æ¨¡ï¼Œå¾—åˆ° 0ï½16383 èŒƒå›´å†…çš„æ¨¡æ•°ï¼ˆå“ˆå¸Œæ§½ç¼–å·ï¼‰\n\n\n\næ•°æ®æ˜ å°„å…³ç³»ï¼šé”®çš„å“ˆå¸Œå€¼ =&gt; å“ˆå¸Œæ§½ =&gt; ä¸åŒçš„å®ä¾‹\n\n\n\n\n\néƒ¨ç½²\n\næ‰‹åŠ¨æˆ–è‡ªåŠ¨å°†æ‰€æœ‰æ§½åˆ†é…å®Œåï¼Œé›†ç¾¤æ‰èƒ½æ­£å¸¸å·¥ä½œ\ncluster create å‘½ä»¤åˆ›å»ºé›†ç¾¤ï¼Œè‡ªåŠ¨å°†æ§½å¹³å‡åˆ†å¸ƒåœ¨å®ä¾‹ä¸Š\ncluster meet æ‰‹åŠ¨å»ºç«‹å®ä¾‹é—´çš„è¿æ¥å½¢æˆé›†ç¾¤ï¼Œå†ä½¿ç”¨ cluster addslots åˆ¶å®šæ¯ä¸ªå®ä¾‹ä¸Šçš„å“ˆå¸Œæ§½ä¸ªæ•°\n\n\n\nå®¢æˆ·ç«¯å¦‚ä½•å®šä½æ•°æ®ï¼Ÿ\n\nRedis å®ä¾‹ä¼šæŠŠè‡ªå·±çš„å“ˆå¸Œæ§½ä¿¡æ¯å‘ç»™å’Œå®ƒç›¸è¿æ¥çš„å…¶ä»–å®ä¾‹ï¼Œå®ä¾‹ç›¸äº’è¿æ¥åæ¯ä¸ªå®ä¾‹éƒ½æœ‰æ‰€æœ‰å“ˆå¸Œæ§½çš„æ˜ å°„å…³ç³»\nå®¢æˆ·ç«¯å°†å“ˆå¸Œæ§½ä¿¡æ¯ç¼“å­˜åœ¨æœ¬åœ°\nå…ˆè®¡ç®—é”®å¯¹åº”çš„å“ˆå¸Œæ§½\nç„¶åç»™ç›¸åº”çš„å“ˆå¸Œæ§½å‘é€è¯·æ±‚\n\n\n\nè¿ç»´äººå‘˜æ‰‹åŠ¨è§¦å‘è¿›è¡Œè´Ÿè½½å‡è¡¡å’Œæ•°æ®è¿ç§»\n\n\nå¸¸è§çš„å˜åŒ–\n\nåœ¨é›†ç¾¤ä¸­ï¼Œå®ä¾‹æœ‰æ–°å¢æˆ–åˆ é™¤ï¼ŒRedis éœ€è¦é‡æ–°åˆ†é…å“ˆå¸Œæ§½\nä¸ºäº†è´Ÿè½½å‡è¡¡ï¼ŒRedis éœ€è¦æŠŠå“ˆå¸Œæ§½åœ¨æ‰€æœ‰å®ä¾‹ä¸Šé‡æ–°åˆ†å¸ƒä¸€é\n\n\n\né‡å®šå‘æœºåˆ¶\n\n\nå½“å®¢æˆ·ç«¯æŠŠä¸€ä¸ªé”®å€¼å¯¹çš„æ“ä½œè¯·æ±‚å‘ç»™ä¸€ä¸ªå®ä¾‹æ—¶ï¼Œå¦‚æœè¿™ä¸ªå®ä¾‹ä¸Šå¹¶æ²¡æœ‰è¿™ä¸ªé”®å€¼å¯¹æ˜ å°„çš„å“ˆå¸Œæ§½ï¼Œè¿™ä¸ªå®ä¾‹å°±ä¼šç»™å®¢æˆ·ç«¯è¿”å› MOVED å‘½ä»¤å“åº”ç»“æœï¼Œè¿™ä¸ªç»“æœä¸­å°±åŒ…å«äº†æ–°å®ä¾‹çš„è®¿é—®åœ°å€\n\n\nGET hello:keyï½œ(error) MOVED 13320 172.16.19.5:6379\n\n\nå®ä¾‹ä¸Šçš„æ•°æ®å·²å…¨éƒ¨è¿ç§»å®Œæˆ\n\n\n\n\n\nä¼šæ›´æ–°å®¢æˆ·ç«¯ç¼“å­˜çš„å“ˆå¸Œæ§½åˆ†é…ä¿¡æ¯\n\n\n\n\nå½“è¯·æ±‚çš„å®ä¾‹åªæœ‰ä¸€éƒ¨åˆ†è¿ç§»åˆ°å¦ä¸€ä¸ªå®ä¾‹ï¼Œåˆšå¥½è¯·æ±‚çš„å“ˆå¸Œæ§½å·²è¿ç§»ï¼Œå®¢æˆ·ç«¯ä¼šæ”¶åˆ°ä¸€æ¡ ASK æŠ¥é”™ä¿¡æ¯\n\nGET hello:keyï½œ(error) ASK 13320 172.16.19.5:6379\nå®ä¾‹ä¸Šçš„æ•°æ®åªæœ‰éƒ¨åˆ†è¿ç§»å®Œæˆ\n\n\n\n\nä¸ä¼šæ›´æ–°å®¢æˆ·ç«¯ç¼“å­˜çš„å“ˆå¸Œæ§½åˆ†é…ä¿¡æ¯\n\n\n\n\n\nè¿ç§»æ•°æ®æ˜¯åŒæ­¥çš„ï¼Œå¦‚è¿ç§»ä¸€ä¸ª key æ—¶ï¼Œä¼šé˜»å¡æºèŠ‚ç‚¹å’Œç›®æ ‡èŠ‚ç‚¹\n\n\n\n\nåŸºäºå®¢æˆ·ç«¯åˆ†åŒº\n\nSharededJedis\n\n\n\nåŸºäºä»£ç†ï¼ˆproxyï¼‰\n\n\nCodis\n\n\næ”¯æŒåœ¨çº¿æ‰©å®¹\n\nå®¢æˆ·ç«¯æ— æ„ŸçŸ¥\n\n\n\næ•°æ®è¿ç§»æ˜¯å¼‚æ­¥çš„\n\né€Ÿåº¦æ›´å¿«ï¼Œå¯¹æ€§èƒ½å½±å“å°\n\n\n\n\n\nTwemproxy\n\n\nä¸æ”¯æŒåœ¨çº¿æ‰©å®¹\n\n\n\n\n\n\næ€è€ƒé¢˜\n\n\nRedis Cluster æ–¹æ¡ˆçš„æ˜ å°„æµç¨‹æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ\n\nå“ˆå¸Œæ§½æŠŠæ•°æ®å’ŒèŠ‚ç‚¹è§£è€¦ï¼Œkey é€šè¿‡ Hash è®¡ç®—ï¼Œåªéœ€è¦å…³å¿ƒæ˜ å°„åˆ°å“ªä¸ªå“ˆå¸Œæ§½ï¼Œå†é€šè¿‡å“ˆå¸Œæ§½å’ŒèŠ‚ç‚¹çš„æ˜ å°„è¡¨æ‰¾åˆ°èŠ‚ç‚¹ï¼Œä¸”æ•°æ®åˆ†å¸ƒæ›´å‡åŒ€\næ•°æ®è¿ç§»æ—¶ä»¥å“ˆå¸Œæ§½ä¸ºåŸºæœ¬å•ä½ï¼Œç®€åŒ–äº†èŠ‚ç‚¹æ‰©å®¹ã€ç¼©å®¹çš„éš¾åº¦\n\n\n\nRedis ä¸ºä»€ä¹ˆä¸ç”¨è¡¨ç›´æ¥è®°å½•é”®å€¼å¯¹å’Œå®ä¾‹çš„å¯¹åº”å…³ç³»ï¼Ÿ\n\nkey çš„æ•°é‡æ— æ³•é¢„ä¼°\nRedis Cluster é‡‡ç”¨æ— ä¸­å¿ƒåŒ–æ¨¡å¼ï¼ˆæ—  proxyï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ç›´è¿ï¼‰ï¼Œå®¢æˆ·ç«¯éœ€è¦èƒ½æ­£ç¡®è·¯ç”±åˆ°æ­£ç¡®èŠ‚ç‚¹ï¼Œæ‰€æœ‰èŠ‚ç‚¹éƒ½è¦æœ‰å®Œæ•´çš„è·¯ç”±å…³ç³»ï¼Œå¸®åŠ©çŸ«æ­£å®¢æˆ·ç«¯ä¿å­˜çš„è·¯ç”±å…³ç³»\nå‘ç”Ÿæ•°æ®è¿ç§»æ—¶ï¼Œéœ€è¦ä¿®æ”¹æ¯ä¸ª key çš„å¯¹åº”å…³ç³»ï¼Œç»´æŠ¤æˆæœ¬é«˜\nåŸºäºå•ä¸ªè¡¨çš„å•çº¿ç¨‹æ“ä½œè¡¨éœ€è¦ä¸²è¡Œæ‰§è¡Œï¼Œæ€§èƒ½ä½\nå¤šçº¿ç¨‹æ“ä½œè¡¨ï¼Œæ¶‰åŠåŠ é”å¼€é”€\n\n\n\n\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/11ï½œâ€œä¸‡é‡‘æ²¹â€çš„-Stringï¼Œä¸ºä»€ä¹ˆä¸å¥½ç”¨äº†ï¼Ÿ":{"title":"11ï½œâ€œä¸‡é‡‘æ²¹â€çš„ Stringï¼Œä¸ºä»€ä¹ˆä¸å¥½ç”¨äº†ï¼Ÿ","links":[],"tags":["redis"],"content":"\n\nRedis å®¹é‡é¢„ä¼°å·¥å…·\n\n\nString ç±»å‹\n\n\nå…ƒæ•°æ®ï¼šå†…å­˜ç©ºé—´è®°å½•æ•°æ®é•¿åº¦ã€ç©ºé—´ä½¿ç”¨ç­‰ä¿¡æ¯\n\n\nint ç¼–ç æ–¹å¼ï¼šå½“ä¿å­˜ 64 ä½æœ‰ç¬¦å·æ•´æ•°æ—¶ï¼Œä¼šä¿å­˜ä¸º 8 å­—èŠ‚çš„ Long ç±»å‹æ•´æ•°\n\n\nç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼ˆSimple Dynamic Stringï¼ŒSDSï¼‰ç»“æ„ä½“çš„ç»„æˆ\n\nå›¾ SDS\n\n\n\n\nbufï¼šå­—èŠ‚æ•°ç»„ï¼Œä¿å­˜å®é™…æ•°æ®ã€‚ä¸ºäº†è¡¨ç¤ºå­—èŠ‚æ•°ç»„çš„ç»“æŸï¼ŒRedis ä¼šè‡ªåŠ¨åœ¨æ•°ç»„æœ€ååŠ ä¸€ä¸ªâ€œ\\0â€ï¼Œè¿™å°±ä¼šé¢å¤–å ç”¨ 1 ä¸ªå­—èŠ‚çš„å¼€é”€\nlenï¼šå  4 ä¸ªå­—èŠ‚ï¼Œè¡¨ç¤º buf çš„å·²ç”¨é•¿åº¦\nallocï¼šä¹Ÿå  4 ä¸ªå­—èŠ‚ï¼Œè¡¨ç¤º buf çš„å®é™…åˆ†é…é•¿åº¦ï¼Œä¸€èˆ¬å¤§äº len\n\n\n\nRedisObject ç»“æ„ä½“\n\n\nå›¾\n\n\n\n\n\nåŒ…å«äº† 8 å­—èŠ‚çš„å…ƒæ•°æ®å’Œä¸€ä¸ª 8 å­—èŠ‚æŒ‡é’ˆ\n\n\næŒ‡é’ˆæŒ‡å‘å®é™…æ•°æ®ï¼Œå¦‚ SDS\n\n\nint ç¼–ç ï¼šå½“ä¿å­˜ Long ç±»å‹æ•´æ•°æ—¶ï¼ŒæŒ‡é’ˆç›´æ¥èµ‹å€¼ä¸ºæ•´æ•°æ•°æ®\n\n\nembstr ç¼–ç ï¼šä¿å­˜ &lt;= 44 å­—èŠ‚çš„å­—ç¬¦ä¸²æ•°æ®ï¼Œå…ƒæ•°æ®ã€æŒ‡é’ˆå’Œ SDS æ˜¯ä¸€å—è¿ç»­çš„å†…å­˜åŒºåŸŸ\n\n\nraw ç¼–ç ï¼šä¿å­˜ &gt; 44 å­—èŠ‚çš„å­—ç¬¦ä¸²æ•°æ®ï¼Œç»™ SDS åˆ†é…ç‹¬ç«‹çš„ç©ºé—´\n\n\n\n\n\n\nå“ˆå¸Œè¡¨çš„æ¯ä¸€é¡¹æ˜¯ä¸€ä¸ª dictEntry çš„ç»“æ„ä½“ï¼ŒæŒ‡å‘ä¸€ä¸ªé”®å€¼å¯¹\n\næœ‰ä¸‰ä¸ª 8 å­—èŠ‚çš„æŒ‡é’ˆ\nåˆ†åˆ«æŒ‡å‘ keyã€valueå’Œä¸‹ä¸€ä¸ª dictEntry\n\n\n\nRedis ä½¿ç”¨çš„å†…å­˜åˆ†é…åº“ jemalloc\n\n\næ ¹æ®ç”³è¯·çš„å­—èŠ‚æ•° Nï¼Œæ‰¾ä¸€ä¸ªæ¯” N å¤§çš„æœ€æ¥è¿‘ N çš„ 2 çš„å¹‚æ¬¡æ•°ä½œä¸ºåˆ†é…çš„ç©ºé—´\n\nå‡å°‘é¢‘ç¹åˆ†é…çš„æ¬¡æ•°\n\n\n\n\n\nå‹ç¼©åˆ—è¡¨ ziplist\n\n\nç¤ºä¾‹ï¼šç”¨é›†åˆç±»å‹ä¿å­˜å•å€¼çš„é”®å€¼å¯¹\n\n\nå›¾ç‰‡ ID 1101000060\n\n\nå¯¹è±¡ ID 3302000080\n\n\näºŒçº§ç¼–ç ï¼šhset 1101000 060 3302000080\n\n\næŸ¥æ‰¾æ—¶ä¼šéå†å‹ç¼©åˆ—è¡¨\n\n\nSorted Set ä¹Ÿå¯ä»¥è¾¾åˆ°ç±»ä¼¼çš„æ•ˆæœï¼Œä¸è¿‡æ’å…¥æ—¶æ€§èƒ½æ²¡ Hash é«˜\n\néœ€æ’åºï¼Œè€Œ Hash ç›´æ¥æ’å…¥å°¾éƒ¨\n\n\n\n\n\nHash ç±»å‹è®¾ç½®äº†ç”¨å‹ç¼©åˆ—è¡¨ä¿å­˜æ•°æ®æ—¶çš„ä¸¤ä¸ªé˜ˆå€¼ï¼Œä¸€æ—¦è¶…è¿‡äº†é˜ˆå€¼ï¼ŒHash ç±»å‹å°±ä¼šç”¨å“ˆå¸Œè¡¨æ¥ä¿å­˜æ•°æ®\n\nhash-max-ziplist-entriesï¼šè¡¨ç¤ºç”¨å‹ç¼©åˆ—è¡¨ä¿å­˜æ—¶å“ˆå¸Œé›†åˆä¸­çš„æœ€å¤§å…ƒç´ ä¸ªæ•°\nhash-max-ziplist-valueï¼šè¡¨ç¤ºç”¨å‹ç¼©åˆ—è¡¨ä¿å­˜æ—¶å“ˆå¸Œé›†åˆä¸­å•ä¸ªå…ƒç´ çš„æœ€å¤§é•¿åº¦\næ•°æ®ä¸€æ—¦ç”¨äº†å“ˆå¸Œè¡¨ä¿å­˜å°±ä¸ä¼šè‡ªåŠ¨è½¬å›æˆå‹ç¼©åˆ—è¡¨\n\n\n\né€‰ç”¨ Hash å’Œ Sorted Set å­˜å‚¨æ—¶ï¼ŒèŠ‚çœç©ºé—´ï¼Œä½†è®¾ç½®è¿‡æœŸä¼šå˜å¾—å›°éš¾\n\n\né€‰ç”¨ String å­˜å‚¨æ—¶ï¼Œå¯ä»¥å•ç‹¬è®¾ç½®æ¯ä¸ª key çš„è¿‡æœŸæ—¶é—´ï¼Œè¿˜å¯ä»¥è®¾ç½® maxmemory å’Œæ·˜æ±°ç­–ç•¥ï¼Œä»¥è¿™ç§æ–¹å¼æ§åˆ¶æ•´ä¸ªå®ä¾‹çš„å†…å­˜ä¸Šé™\n\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/12ï½œæœ‰ä¸€äº¿ä¸ª-keys-è¦ç»Ÿè®¡ï¼Œåº”è¯¥ç”¨å“ªç§é›†åˆï¼Ÿ":{"title":"12ï½œæœ‰ä¸€äº¿ä¸ª keys è¦ç»Ÿè®¡ï¼Œåº”è¯¥ç”¨å“ªç§é›†åˆï¼Ÿ","links":[],"tags":["redis"],"content":"\n\nèšåˆç»Ÿè®¡\n\n\nç»Ÿè®¡å¤šä¸ªé›†åˆå…ƒç´ çš„èšåˆç»“æœï¼ŒåŒ…æ‹¬ï¼š\n\nç»Ÿè®¡å¤šä¸ªé›†åˆçš„å…±æœ‰å…ƒç´ ï¼ˆäº¤é›†ç»Ÿè®¡ï¼‰\næŠŠä¸¤ä¸ªé›†åˆç›¸æ¯”ï¼Œç»Ÿè®¡å…¶ä¸­ä¸€ä¸ªé›†åˆç‹¬æœ‰çš„å…ƒç´ ï¼ˆå·®é›†ç»Ÿè®¡ï¼‰\nç»Ÿè®¡å¤šä¸ªé›†åˆçš„æ‰€æœ‰å…ƒç´ ï¼ˆå¹¶é›†ç»Ÿè®¡ï¼‰\n\n\n\nä½¿ç”¨ Set\n\nå¹¶é›†ï¼šSUNIONSTORE user:new user:id user:id:20200803\nå·®é›†ï¼šSDIFFSTORE user:new user:id:20200804 user:id\näº¤é›†ï¼šSINTERSTORE user:id:rem user:id:20200803 user:id:20200804\nè®¡ç®—å¤æ‚åº¦è¾ƒé«˜ï¼Œæ•°æ®é‡è¾ƒå¤§æ—¶ä¼šå¯¼è‡´ Redis å®ä¾‹é˜»å¡\nä¸‰ä¸ªå‘½ä»¤éƒ½ä¼šç”Ÿæˆæ–° keyï¼Œä½†ä»åº“ä¸€èˆ¬æ˜¯ readonlyï¼ˆä¸å»ºè®®å¼€å†™ï¼‰ï¼Œæƒ³åœ¨ä»åº“æ“ä½œéœ€ä½¿ç”¨ SUNIONã€SDIFFã€SINTERï¼Œè¿™äº›å‘½ä»¤å¯ä»¥è®¡ç®—å‡ºç»“æœï¼Œä½†ä¸ä¼šç”Ÿæˆæ–° key\nå¯ä»¥ä»ä¸»ä»é›†ç¾¤ä¸­é€‰æ‹©ä¸€ä¸ªä»åº“ä¸“é—¨è´Ÿè´£èšåˆè®¡ç®—ï¼Œæˆ–è€…æ˜¯æŠŠæ•°æ®è¯»å–åˆ°å®¢æˆ·ç«¯ï¼Œåœ¨å®¢æˆ·ç«¯æ¥å®Œæˆèšåˆç»Ÿè®¡ï¼Œè¿™æ ·å°±å¯ä»¥è§„é¿é˜»å¡ä¸»åº“å®ä¾‹å’Œå…¶ä»–ä»åº“å®ä¾‹çš„é£é™©äº†\n\n\n\n\n\næ’åºç»Ÿè®¡\n\nä½¿ç”¨æœ‰åºé›†åˆï¼šListã€Sorted Set\nList æ˜¯æŒ‰ç…§å…ƒç´ è¿›å…¥ List çš„é¡ºåºè¿›è¡Œæ’åºçš„ï¼Œè€Œ Sorted Set å¯ä»¥æ ¹æ®å…ƒç´ çš„æƒé‡æ¥æ’åº\næ•°æ®æ›´æ–°é¢‘ç¹æˆ–éœ€è¦åˆ†é¡µæ˜¾ç¤ºï¼Œä¼˜å…ˆè€ƒè™‘ä½¿ç”¨ Sorted Set\n\n\n\näºŒå€¼çŠ¶æ€ç»Ÿè®¡\n\n\næŒ‡é›†åˆå…ƒç´ çš„å–å€¼å°±åªæœ‰ 0 å’Œ 1 ä¸¤ç§\n\n\nBitmap\n\n\nå¯¹å¤šä¸ªä»¥æ—¥æœŸä¸º keyï¼Œä½å€¼ä¸ºæ¯ä¸ªå­¦ç”Ÿç­¾åˆ°æƒ…å†µçš„ Bitmapï¼Œæ‰§è¡ŒæŒ‰ä½ä¸æ“ä½œå¯ä»¥ç»Ÿè®¡å‡ºè¿ç»­ç­¾åˆ°çš„å­¦ç”Ÿæ•°é‡\n\n\n\n\n\näº¦æˆ–è€… uid:sign:3000:202008 2 1 å¯ä»¥ç»Ÿè®¡å­¦ç”Ÿåœ¨æŸæ®µæ—¶é—´çš„ç­¾åˆ°æƒ…å†µ\n\n\nä¼˜åŠ¿ï¼šèŠ‚çœå†…å­˜ç©ºé—´\n\n\n\n\n\n\nåŸºæ•°ç»Ÿè®¡\n\n\næŒ‡ç»Ÿè®¡ä¸€ä¸ªé›†åˆä¸­ä¸é‡å¤çš„å…ƒç´ ä¸ªæ•°ï¼Œå¦‚ç»Ÿè®¡ç½‘é¡µçš„ UV\n\n\nSet å’Œ Hash æ¶ˆè€—æ¯”è¾ƒå¤šçš„å†…å­˜ç©ºé—´\n\n\nHyperLogLog\n\nç”¨äºç»Ÿè®¡åŸºæ•°çš„æ•°æ®ç±»å‹\nä¼šç”¨å°±è¡Œ\næ ‡å‡†è¯¯ç®—ç‡ï¼š0.81%\næœ€å¤§ä¼˜åŠ¿ï¼šå³ä½¿é›†åˆå…ƒç´ éå¸¸å¤šï¼Œæ‰€éœ€ç©ºé—´æ€»æ˜¯å›ºå®šï¼Œå¾ˆå°\nPFADD page1:uv user1 user2 user3\nPFCOUNT page1:uv page2:uv = ç»Ÿè®¡ç»“æœæ€»å’Œ\n\n\n\n\n\næ³¨æ„äº‹é¡¹\n\nå¤šä¸ªå®ä¾‹ä¹‹é—´æ— æ³•åšèšåˆè¿ç®—ï¼Œå¯èƒ½ä¼šç›´æ¥æŠ¥é”™æˆ–è€…å¾—åˆ°çš„ç»“æœæ˜¯é”™è¯¯çš„\nç»Ÿè®¡æ•°æ®ä¸åœ¨çº¿ä¸šåŠ¡æ•°æ®æ‹†åˆ†å¼€ï¼Œå®ä¾‹å•ç‹¬éƒ¨ç½²ï¼Œé˜²æ­¢åœ¨åšç»Ÿè®¡æ“ä½œæ—¶å½±å“åˆ°åœ¨çº¿ä¸šåŠ¡\n\n\n\nä»¥ä¸Šæ•°æ®ç±»å‹æ±‡æ€»è¡¨æ ¼\n\n\n\n\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/13ï½œGEO-æ˜¯ä»€ä¹ˆï¼Ÿè¿˜å¯ä»¥å®šä¹‰æ–°çš„æ•°æ®ç±»å‹å—ï¼Ÿ":{"title":"13ï½œGEO æ˜¯ä»€ä¹ˆï¼Ÿè¿˜å¯ä»¥å®šä¹‰æ–°çš„æ•°æ®ç±»å‹å—ï¼Ÿ","links":[],"tags":["redis"],"content":"\n\nLBSï¼šä½ç½®ä¿¡æ¯æœåŠ¡ï¼ˆLocation-Based Serviceï¼‰\n\n\nGEOï¼šæ•°æ®ç±»å‹\n\n\nåº•å±‚æ•°æ®ç»“æ„ç”¨ Sorted Set å®ç°\n\n\nGeoHash ç¼–ç æ–¹æ³•\n\n\nåŸºæœ¬åŸç†ï¼šäºŒåˆ†åŒºé—´ï¼ŒåŒºé—´ç¼–ç \n\n\nå¯¹ç»çº¬åº¦åˆ†åˆ«ç¼–ç ï¼Œå†ç»„åˆ\n\n\nç»åº¦èŒƒå›´ [-180, 180]ï¼Œçº¬åº¦èŒƒå›´ [-90, 90]\n\n\n\nåš N æ¬¡äºŒåˆ†åŒºæ“ä½œï¼ŒN å¯ä»¥è‡ªå®šä¹‰\n\n\n\n\n\n\n\næ ¹æ®ç»çº¬åº¦å€¼è½åœ¨å·¦è¿˜æ˜¯å³åˆ†åŒºå¾—åˆ° 1 ä½ç¼–ç å€¼\n\n\n\n\n\né‡å¤ N æ¬¡ï¼Œå¾—åˆ°ä¸€ä¸ª N bit çš„æ•°\n\n\n\nä¾‹ï¼š116.37 =&gt; 11010\n\n\n\n\nï¼šæœ€ç»ˆç¼–ç å€¼çš„ç»„åˆè§„åˆ™\n\n\n\n\n\n\nå¶æ•°ä½ä¾æ¬¡æ˜¯ç»åº¦çš„ç¼–ç å€¼\n\n\nå¥‡æ•°ä½ä¾æ¬¡æ˜¯çº¬åº¦çš„ç¼–ç å€¼\n\n\n\n\nç»çº¬åº¦ =&gt; Sorted Set å…ƒç´ çš„æƒé‡åˆ†æ•°\n\n\n\n\n\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/14ï½œå¦‚ä½•åœ¨-Redis-ä¸­ä¿å­˜æ—¶é—´åºåˆ—æ•°æ®ï¼Ÿ":{"title":"14ï½œå¦‚ä½•åœ¨ Redis ä¸­ä¿å­˜æ—¶é—´åºåˆ—æ•°æ®ï¼Ÿ","links":[],"tags":["redis"],"content":"\n\nè¦æ±‚\n\nå†™è¦å¿«\næŸ¥è¯¢æ¨¡å¼å¤š\n\n\n\nä¸€ã€åŒæ—¶ä½¿ç”¨ Hash å’Œ Sorted Set\n\n\n{1: a, 2: b, 3: c} + setKey:Â {1: a, 2: b, 3: c}\n\nHash è´Ÿè´£å•é”®æŸ¥è¯¢ï¼ŒSorted Set è´Ÿè´£èŒƒå›´æŸ¥è¯¢\n\n\n\nå¤šä¸ªå†™æ“ä½œçš„åŸå­æ€§\n\n\nMULTI å‘½ä»¤ï¼šè¡¨ç¤ºä¸€ç³»åˆ—åŸå­æ€§æ“ä½œçš„å¼€å§‹\n\n\n\n\n\nEXEC å‘½ä»¤ï¼šè¡¨ç¤ºä¸€ç³»åˆ—åŸå­æ€§æ“ä½œçš„ç»“æŸ\n\n\nå»ºè®®å®¢æˆ·ç«¯ä½¿ç”¨ pipelineï¼Œä¸€æ¬¡æ€§æ‰¹é‡å‘é€å‘½ä»¤ç»™æœåŠ¡ç«¯ï¼Œå‡å°‘ç½‘ç»œ IO æ¬¡æ•°\n\n\n\n\nèšåˆè®¡ç®—éœ€è¦å€ŸåŠ©å®¢æˆ·ç«¯ï¼Œæ•°æ®é‡å¤§æ—¶æ¯”è¾ƒè€—èµ„æº\n\n\n\n\näºŒã€RedisTimeSeries\n\næ˜¯ä¸“é—¨ä¸ºæ—¶é—´åºåˆ—æ•°æ®è®¿é—®è®¾è®¡çš„æ‰©å±•æ¨¡å—\næ”¯æŒèšåˆè®¡ç®—\nå¯ä»¥æŒ‰æ ‡ç­¾å±æ€§è¿‡æ»¤æŸ¥è¯¢æ•°æ®é›†åˆ\nä¸å±äºå†…å»ºåŠŸèƒ½æ¨¡å—ï¼Œéœ€è¦å…ˆæŠŠå®ƒçš„æºç å•ç‹¬ç¼–è¯‘æˆåŠ¨æ€é“¾æ¥åº“ redistimeseries.soï¼Œå†ä½¿ç”¨ loadmodule å‘½ä»¤è¿›è¡ŒåŠ è½½\n\n\n\næ–¹æ¡ˆé€‰æ‹©å»ºè®®\n\néƒ¨ç½²ç¯å¢ƒä¸­ç½‘ç»œå¸¦å®½é«˜ã€Redis å®ä¾‹å†…å­˜å¤§ï¼Œå¯ä»¥ä¼˜å…ˆè€ƒè™‘ç¬¬ä¸€ç§æ–¹æ¡ˆ\néƒ¨ç½²ç¯å¢ƒä¸­ï¼Œç½‘ç»œã€å†…å­˜èµ„æºæœ‰é™ï¼Œè€Œä¸”æ•°æ®é‡å¤§ï¼Œèšåˆè®¡ç®—é¢‘ç¹ï¼Œéœ€è¦æŒ‰æ•°æ®é›†åˆå±æ€§æŸ¥è¯¢ï¼Œå¯ä»¥ä¼˜å…ˆè€ƒè™‘ç¬¬äºŒç§æ–¹æ¡ˆ\næ›´å¥½çš„é€‰æ‹©ï¼šä½¿ç”¨æ—¶åºæ•°æ®åº“\n\n\n\næ€è€ƒé¢˜\n\n\nä½¿ç”¨ Sorted Set ä¿å­˜æ—¶åºæ•°æ®ï¼ŒæŠŠæ—¶é—´æˆ³ä½œä¸º scoreï¼ŒæŠŠå®é™…çš„æ•°æ®ä½œä¸º memberï¼Œæœ‰ä»€ä¹ˆæ½œåœ¨çš„é£é™©ï¼Ÿ\n\nå¦‚æœå¯¹æŸä¸€ä¸ªå¯¹è±¡çš„æ—¶åºæ•°æ®è®°å½•å¾ˆé¢‘ç¹çš„è¯ï¼Œè¿™ä¸ª key å¾ˆå®¹æ˜“å˜æˆä¸€ä¸ª bigkeyï¼Œåœ¨ key è¿‡æœŸé‡Šæ”¾å†…å­˜æ—¶å¯èƒ½å¼•å‘é˜»å¡é£é™©\nå­˜åœ¨ member é‡å¤çš„é—®é¢˜\n\n\n\nå¦‚æœä½ æ˜¯ Redis çš„å¼€å‘ç»´æŠ¤è€…ï¼Œä½ ä¼šæŠŠèšåˆè®¡ç®—ä¹Ÿè®¾è®¡ä¸º Sorted Set çš„å†…åœ¨åŠŸèƒ½å—ï¼Ÿä¸ä¼šã€‚\n\nå› ä¸ºèšåˆè®¡ç®—æ˜¯ CPU å¯†é›†å‹ä»»åŠ¡ï¼ŒRedis åœ¨å¤„ç†è¯·æ±‚æ—¶æ˜¯å•çº¿ç¨‹çš„ï¼Œä¹Ÿå°±æ˜¯å®ƒåœ¨åšèšåˆè®¡ç®—æ—¶æ— æ³•åˆ©ç”¨åˆ°å¤šæ ¸ CPU æ¥æå‡è®¡ç®—é€Ÿåº¦\nå¦‚æœè®¡ç®—é‡å¤ªå¤§ï¼Œä¹Ÿä¼šå¯¼è‡´ Redis çš„å“åº”å»¶è¿Ÿå˜é•¿ï¼Œå½±å“ Redis çš„æ€§èƒ½\n\n\n\n\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/15ï½œæ¶ˆæ¯é˜Ÿåˆ—çš„è€ƒéªŒï¼šRedis-æœ‰å“ªäº›è§£å†³æ–¹æ¡ˆï¼Ÿ":{"title":"15ï½œæ¶ˆæ¯é˜Ÿåˆ—çš„è€ƒéªŒï¼šRedis æœ‰å“ªäº›è§£å†³æ–¹æ¡ˆï¼Ÿ","links":[],"tags":["redis"],"content":"\n\næ¶ˆæ¯é˜Ÿåˆ—çš„ä¸‰å¤§éœ€æ±‚ï¼šæ¶ˆæ¯ä¿åºã€é‡å¤æ¶ˆæ¯å¤„ç†ã€æ¶ˆæ¯å¯é æ€§ä¿è¯\n\n\nList\n\næ”¯æŒé˜»å¡è·å–æ•°æ®\nä¸æ”¯æŒæ¶ˆè´¹ç»„\n\n\n\nStream\n\nRedis 5.0 ä¹‹åä¸“é—¨ä¸ºæ¶ˆæ¯é˜Ÿåˆ—è®¾è®¡çš„æ•°æ®ç±»å‹\nä¸åŒæ¶ˆè´¹ç»„çš„æ¶ˆè´¹è€…å¯ä»¥æ¶ˆè´¹åŒä¸€ä¸ªæ¶ˆæ¯\nåŒä¸€æ¶ˆè´¹ç»„çš„æ¶ˆè´¹è€…ä¸æ¶ˆè´¹åŒä¸€æ¶ˆæ¯\nè‡ªåŠ¨ç”Ÿæˆå…¨å±€å”¯ä¸€ ID\n\n\n\nä¸¤è€…æ¯”è¾ƒ\n\n\n\n\n\nä¸èƒ½ä¸¢æ•°æ®çš„åœºæ™¯åº”è¯¥é‡‡ç”¨ä¸“ä¸šçš„é˜Ÿåˆ—ä¸­é—´ä»¶ï¼šKafka + Zookeeperã€RabbitMQ\n\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/16ï½œå¼‚æ­¥æœºåˆ¶ï¼šå¦‚ä½•é¿å…å•çº¿ç¨‹æ¨¡å‹çš„é˜»å¡ï¼Ÿ":{"title":"16ï½œå¼‚æ­¥æœºåˆ¶ï¼šå¦‚ä½•é¿å…å•çº¿ç¨‹æ¨¡å‹çš„é˜»å¡ï¼Ÿ","links":[],"tags":["redis"],"content":"\n\n4 ç±»äº¤äº’å¯¹è±¡å’Œå…·ä½“çš„æ“ä½œä¹‹é—´çš„å…³ç³»\n\n\n\n\n\nå’Œå®¢æˆ·ç«¯äº¤äº’æ—¶çš„é˜»å¡ç‚¹\n\n\n\né›†åˆçš„å…¨é‡æŸ¥è¯¢å’Œèšåˆæ“ä½œ\n\n\n\n\nåˆ é™¤ bigkey\n\n\n\n\næ¸…ç©ºæ•°æ®åº“\n\n\n\n\n\nå’Œç£ç›˜äº¤äº’æ—¶çš„é˜»å¡ç‚¹\n\n\n\nåŒæ­¥å†™ AOF æ—¥å¿—\n\n\n\n\n\nä¸»ä»èŠ‚ç‚¹äº¤äº’æ—¶çš„é˜»å¡ç‚¹\n\n\n\n\nåŠ è½½ RDB æ–‡ä»¶\n\n\n\nä»åº“æ¥æ”¶ RDB æ–‡ä»¶åä¼šæ¸…ç©ºå½“å‰æ•°æ®åº“\nç„¶ååŠ è½½ RDB åˆ°å†…å­˜ï¼Œæ–‡ä»¶è¶Šå¤§è¶Šæ…¢\n\n\n\n\n\nåˆ‡ç‰‡é›†ç¾¤å®ä¾‹äº¤äº’æ—¶çš„é˜»å¡ç‚¹\n\n\n\n\nä½¿ç”¨ Redis Cluster æ–¹æ¡ˆï¼Œå¹¶è¿ç§» bigkey\n\n\n\nRedis Cluster æ–¹æ¡ˆä½¿ç”¨äº†åŒæ­¥è¿ç§»\nå½“æ²¡æœ‰ bigkey æ—¶ï¼Œåˆ‡ç‰‡é›†ç¾¤çš„å„å®ä¾‹åœ¨è¿›è¡Œäº¤äº’æ—¶ä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹\n\n\n\n\n\nå¯ä»¥å¼‚æ­¥æ“ä½œçš„é˜»å¡ç‚¹ï¼š2ã€3ã€4\n\n\nå¦‚æœä¸€ä¸ªæ“ä½œèƒ½è¢«å¼‚æ­¥æ‰§è¡Œï¼Œå°±æ„å‘³ç€ï¼Œå®ƒå¹¶ä¸æ˜¯ Redis ä¸»çº¿ç¨‹çš„å…³é”®è·¯å¾„ä¸Šçš„æ“ä½œ\n\nå®¢æˆ·ç«¯æŠŠè¯·æ±‚å‘é€ç»™ Redis åï¼Œç­‰ç€ Redis è¿”å›æ•°æ®ç»“æœçš„æ“ä½œ\nè¯»æ“ä½œæ˜¯å…¸å‹çš„å…³é”®è·¯å¾„æ“ä½œ\n\n\n\nå¼‚æ­¥çš„é”®å€¼å¯¹åˆ é™¤å’Œæ•°æ®åº“æ¸…ç©ºæ“ä½œæ˜¯ Redis 4.0 åæä¾›çš„åŠŸèƒ½ï¼ŒRedis ä¹Ÿæä¾›äº†æ–°çš„å‘½ä»¤æ¥æ‰§è¡Œè¿™ä¸¤ä¸ªæ“ä½œ\n\né”®å€¼å¯¹åˆ é™¤ï¼šå½“é›†åˆç±»å‹ä¸­æœ‰å¤§é‡å…ƒç´ ï¼ˆç™¾ä¸‡æˆ–åƒä¸‡çº§åˆ«ï¼‰éœ€è¦åˆ é™¤æ—¶ï¼Œä½¿ç”¨ UNLINK å‘½ä»¤\næ¸…ç©ºæ•°æ®åº“ï¼šåœ¨ FLUSHDB å’Œ FLUSHALL å‘½ä»¤ååŠ ä¸Š ASYNC é€‰é¡¹\n\n\n\nå°å»ºè®®\n\n4.0 ä¹‹å‰åˆ é™¤ bigkeyï¼šå…ˆä½¿ç”¨é›†åˆç±»å‹æä¾›çš„ SCAN å‘½ä»¤è¯»å–æ•°æ®ï¼Œç„¶åå†è¿›è¡Œåˆ é™¤\né›†åˆçš„å…¨é‡æŸ¥è¯¢å’Œèšåˆæ“ä½œï¼šå¯ä»¥ä½¿ç”¨ SCAN å‘½ä»¤ï¼Œåˆ†æ‰¹è¯»å–æ•°æ®ï¼Œå†åœ¨å®¢æˆ·ç«¯è¿›è¡Œèšåˆè®¡ç®—\nä»åº“åŠ è½½ RDB æ–‡ä»¶ï¼šæŠŠä¸»åº“çš„æ•°æ®é‡å¤§å°æ§åˆ¶åœ¨ 2~4GB å·¦å³ï¼Œä»¥ä¿è¯ RDB æ–‡ä»¶èƒ½ä»¥è¾ƒå¿«çš„é€Ÿåº¦åŠ è½½\n\n\n\nlazy-freeï¼ˆæƒ°æ€§åˆ é™¤ï¼‰\n\n\n\n4.0 æ–°å¢åŠŸèƒ½ï¼Œé»˜è®¤å…³é—­\n\n\n\n\n\n4 ä¸ªæ§åˆ¶é€‰é¡¹\n\n\n\na) lazyfree-lazy-expireï¼škey åœ¨è¿‡æœŸåˆ é™¤æ—¶å°è¯•å¼‚æ­¥é‡Šæ”¾å†…å­˜\nb) lazyfree-lazy-evictionï¼šå†…å­˜è¾¾åˆ° maxmemory å¹¶è®¾ç½®äº†æ·˜æ±°ç­–ç•¥æ—¶å°è¯•å¼‚æ­¥é‡Šæ”¾å†…å­˜\nc) lazyfree-lazy-server-delï¼šæ‰§è¡Œ RENAME/MOVE ç­‰å‘½ä»¤æˆ–éœ€è¦è¦†ç›–ä¸€ä¸ª key æ—¶ï¼Œåˆ é™¤æ—§ key å°è¯•å¼‚æ­¥é‡Šæ”¾å†…å­˜\nd) replica-lazy-flushï¼šä¸»ä»å…¨é‡åŒæ­¥ï¼Œä»åº“æ¸…ç©ºæ•°æ®åº“æ—¶å¼‚æ­¥é‡Šæ”¾å†…å­˜\n\n\n\n\nå³ä½¿å¼€å¯äº†lazy-freeï¼Œå¦‚æœç›´æ¥ä½¿ç”¨ DEL å‘½ä»¤è¿˜æ˜¯ä¼šåŒæ­¥åˆ é™¤ keyï¼Œåªæœ‰ä½¿ç”¨ UNLINK å‘½ä»¤æ‰å¯èƒ½ä¼šå¼‚æ­¥åˆ é™¤ key\n\n\n\n\næœ€å…³é”®çš„ä¸€ç‚¹ï¼Œä¸Šé¢æåˆ°å¼€å¯ lazy-free çš„åœºæ™¯ï¼Œé™¤äº† dï¼‰replica-lazy-flushï¼Œå…¶ä»–æƒ…å†µéƒ½åªæ˜¯ å¯èƒ½ å»å¼‚æ­¥é‡Šæ”¾ key çš„å†…å­˜ï¼Œå¹¶ä¸æ˜¯æ¯æ¬¡å¿…å®šå¼‚æ­¥é‡Šæ”¾å†…å­˜çš„\n\n\n\nçœŸæ­£å¼‚æ­¥é‡Šæ”¾å†…å­˜çš„æƒ…å†µï¼šä¸ key çš„ç±»å‹ã€ç¼–ç æ–¹å¼ã€å…ƒç´ æ•°é‡éƒ½æœ‰å…³ç³»\n\na) å½“ Hash/Set åº•å±‚é‡‡ç”¨å“ˆå¸Œè¡¨å­˜å‚¨ï¼ˆé ziplist/int ç¼–ç å­˜å‚¨ï¼‰æ—¶ï¼Œå¹¶ä¸”å…ƒç´ æ•°é‡è¶…è¿‡64ä¸ª\nb) å½“ ZSet åº•å±‚é‡‡ç”¨è·³è¡¨å­˜å‚¨ï¼ˆé ziplist ç¼–ç å­˜å‚¨ï¼‰æ—¶ï¼Œå¹¶ä¸”å…ƒç´ æ•°é‡è¶…è¿‡64ä¸ª\nc) å½“ List é“¾è¡¨èŠ‚ç‚¹æ•°é‡è¶…è¿‡ 64 ä¸ªï¼ˆæ³¨æ„ï¼Œä¸æ˜¯å…ƒç´ æ•°é‡ï¼Œè€Œæ˜¯é“¾è¡¨èŠ‚ç‚¹çš„æ•°é‡ï¼ŒList çš„å®ç°æ˜¯åœ¨æ¯ä¸ªèŠ‚ç‚¹åŒ…å«äº†è‹¥å¹²ä¸ªå…ƒç´ çš„æ•°æ®ï¼Œè¿™äº›å…ƒç´ é‡‡ç”¨ ziplist å­˜å‚¨ï¼‰\nå…¶ä»–æƒ…å†µä¸€å¾‹è¿˜æ˜¯åœ¨ä¸»çº¿ç¨‹æ“ä½œ\n\n\n\n\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/17ï½œä¸ºä»€ä¹ˆ-CPU-ç»“æ„ä¹Ÿä¼šå½±å“-Redis-çš„æ€§èƒ½ï¼Ÿ":{"title":"17ï½œä¸ºä»€ä¹ˆ CPU ç»“æ„ä¹Ÿä¼šå½±å“ Redis çš„æ€§èƒ½ï¼Ÿ","links":[],"tags":["redis"],"content":"\n\nNUMA æ¶æ„ï¼ˆNon-Uniform Memory Access éç»Ÿä¸€å†…å­˜è®¿é—®æ¶æ„ï¼‰\n\n\nå›¾\n\n\nç¬¬ä¸€æ­¥\n\n\n\n\n\nç¬¬äºŒæ­¥\n\n\n\n\n\n\n\næ–‡å­—æè¿°\n\n\nå¤šä¸ª CPU å¤„ç†å™¨ï¼ˆå¤š CPU Socketï¼‰\n\n\næ¯ä¸ªéƒ½æœ‰è‡ªå·±çš„\n\n\nå¤šä¸ªç‰©ç†æ ¸ï¼ˆåŒ…æ‹¬ L1ã€L2 ç¼“å­˜ï¼‰\n\n\næ¯ä¸ªç‰©ç†æ ¸ç§æœ‰çš„ L1ã€L2 å¤§å°å—é™äºå¤„ç†å™¨çš„åˆ¶é€ åŸºæ•°ï¼ŒKB çº§åˆ«å¤§å°\n\nç¼“å­˜åº”ç”¨ç¨‹åºè®¿é—®æœ€é¢‘ç¹çš„æŒ‡ä»¤å’Œæ•°æ®\n\n\n\nç°åœ¨ä¸»æµçš„ CPU å¤„ç†å™¨ä¸­ï¼Œæ¯ä¸ªç‰©ç†æ ¸é€šå¸¸éƒ½ä¼šè¿è¡Œä¸¤ä¸ªè¶…çº¿ç¨‹ï¼Œä¹Ÿå«ä½œé€»è¾‘æ ¸ã€‚åŒä¸€ä¸ªç‰©ç†æ ¸çš„é€»è¾‘æ ¸ä¼šå…±äº«ä½¿ç”¨ L1ã€L2 ç¼“å­˜\n\n\n\n\nL3 ç¼“å­˜\n\nå¤šä¸ªç‰©ç†æ ¸å…±ç”¨\nå‡  MB åˆ°å‡ å MB å¤§å°\nåœ¨ L1ã€L2 ç¼“å­˜ä¸­æ²¡æœ‰æ•°æ®ç¼“å­˜æ—¶è¢«è®¿é—®ï¼Œå°½å¯èƒ½é¿å…è®¿é—®å†…å­˜\n\n\n\nè¿æ¥çš„å†…å­˜\n\n\n\n\nä¸åŒå¤„ç†å™¨é—´é€šè¿‡æ€»çº¿è¿æ¥\n\n\n\n\n\n\n\n\nCPU æ¶æ„å¯¹åº”ç”¨ç¨‹åºè¿è¡Œçš„å½±å“\n\nL1ã€L2 ç¼“å­˜ä¸­çš„æŒ‡ä»¤å’Œæ•°æ®çš„è®¿é—®é€Ÿåº¦å¾ˆå¿«ï¼Œå……åˆ†åˆ©ç”¨ L1ã€L2 ç¼“å­˜ï¼Œå¯ä»¥æœ‰æ•ˆç¼©çŸ­åº”ç”¨ç¨‹åºçš„æ‰§è¡Œæ—¶é—´\nåœ¨ NUMA æ¶æ„ä¸‹ï¼Œå¦‚æœåº”ç”¨ç¨‹åºä»ä¸€ä¸ª Socket ä¸Šè°ƒåº¦åˆ°å¦ä¸€ä¸ª Socket ä¸Šï¼Œå°±å¯èƒ½ä¼šå‡ºç°è¿œç«¯å†…å­˜è®¿é—®çš„æƒ…å†µï¼Œè¿™ä¼šç›´æ¥å¢åŠ åº”ç”¨ç¨‹åºçš„æ‰§è¡Œæ—¶é—´\n\n\n\nECS ä¸»æœºæä¾›çš„ vCPUÂ \n\nè™šæ‹Ÿæ ¸ï¼Œä¸€èˆ¬å¯¹åº”ä¸€ä¸ªç‰©ç†æ ¸å¿ƒä¸Šçš„ä¸€ä¸ªè¶…çº¿ç¨‹ï¼Œè¿™æ˜¯å› ä¸ºåº•å±‚æœåŠ¡å™¨ä¸€èˆ¬ä¼šå¼€å¯è¶…çº¿ç¨‹\né€šå¸¸ï¼Œä¸€ä¸ªç‰©ç†æ ¸å¿ƒä¼šå¯¹åº” 2 ä¸ªè¶…çº¿ç¨‹ï¼Œæ¯ä¸ªè¶…çº¿ç¨‹å¯¹åº”ä¸€ä¸ª vCPU\nå¤šä¸ª vCPU ä¸€èˆ¬åœ¨åŒä¸€ä¸ª NUMA èŠ‚ç‚¹ä¸Š\nå¦‚æœå¸Œæœ›å‡å°‘ CPU è¶…çº¿ç¨‹å¯¹æ€§èƒ½çš„å½±å“ï¼Œå¯ä»¥é€šè¿‡é˜¿é‡Œäº‘ SDK çš„é€‰é¡¹å…³é—­è¶…çº¿ç¨‹\n\n\n\nCPU å¤šæ ¸å¯¹ Redis æ€§èƒ½çš„å½±å“\n\n\n99% å°¾å»¶è¿Ÿï¼š99% çš„è¯·æ±‚å»¶è¿Ÿå°äºçš„å€¼\n\n\ncontext switchï¼šä¸€ä¸ªçº¿ç¨‹å…ˆåœ¨ä¸€ä¸ª CPU æ ¸ä¸Šè¿è¡Œï¼Œä¹‹ååˆåˆ‡æ¢åˆ°å¦ä¸€ä¸ª CPU æ ¸ä¸Šè¿è¡Œï¼Œè¿™æ—¶å°±ä¼šå‘ç”Ÿ context switch\n\næ­¤æ—¶ Redis ä¸»çº¿ç¨‹çš„è¿è¡Œæ—¶ä¿¡æ¯éœ€è¦è¢«åŠ è½½åˆ°å¦ä¸€ä¸ª CPU æ ¸ä¸Š\n\n\n\n\n\nCPU çš„ NUMA æ¶æ„å¯¹ Redis æ€§èƒ½çš„å½±å“\n\n\næŠŠæ“ä½œç³»ç»Ÿçš„ç½‘ç»œä¸­æ–­å¤„ç†ç¨‹åºå’Œ CPU æ ¸ç»‘å®š\n\n\nç½‘ç»œä¸­æ–­å¤„ç†ç¨‹åº\n\næ“ä½œç³»ç»Ÿå†…æ ¸ä¸­ç”¨æ¥å¤„ç†ç½‘å¡ä¸­æ–­äº‹ä»¶ã€æŠŠæ•°æ®ä»å†…æ ¸çš„ç¼“å†²åŒºæ‹·è´åˆ°åº”ç”¨ç¨‹åºç¼“å†²åŒºçš„ç¨‹åºã€‚\nå½“ç½‘å¡æ¥æ”¶åˆ°æ•°æ®åï¼Œä¼šè§¦å‘ç½‘å¡ä¸­æ–­ï¼Œç”¨æ¥é€šçŸ¥æ“ä½œç³»ç»Ÿå†…æ ¸è¿›è¡Œæ•°æ®å¤„ç†ã€‚\n\n\n\né¿å…ç½‘ç»œä¸­æ–­å¤„ç†ç¨‹åºåœ¨ä¸åŒæ ¸ä¸Šæ¥å›è°ƒåº¦æ‰§è¡Œï¼Œèƒ½æœ‰æ•ˆæå‡ Redis çš„ç½‘ç»œå¤„ç†æ€§èƒ½\n\n\n\n\nä¸ºäº†é¿å… Redis è·¨ CPU Socket è®¿é—®ç½‘ç»œæ•°æ®ï¼Œæœ€å¥½æŠŠç½‘ç»œä¸­æ–­ç¨‹åºå’Œ Redis å®ä¾‹ç»‘åœ¨åŒä¸€ä¸ª CPU Socket çš„ä¸åŒæ ¸ä¸Š\n\n\nåœ¨ CPU çš„ NUMA æ¶æ„ä¸‹ï¼Œå¯¹ CPU æ ¸çš„ç¼–å·è§„åˆ™ï¼Œå¹¶ä¸æ˜¯å…ˆæŠŠä¸€ä¸ª CPU Socket ä¸­çš„æ‰€æœ‰é€»è¾‘æ ¸ç¼–å®Œï¼Œå†å¯¹ä¸‹ä¸€ä¸ª CPU Socket ä¸­çš„é€»è¾‘æ ¸ç¼–ç ï¼Œè€Œæ˜¯å…ˆç»™æ¯ä¸ª CPU Socket ä¸­æ¯ä¸ªç‰©ç†æ ¸çš„ç¬¬ä¸€ä¸ªé€»è¾‘æ ¸ä¾æ¬¡ç¼–å·ï¼Œå†ç»™æ¯ä¸ª CPU Socket ä¸­çš„ç‰©ç†æ ¸çš„ç¬¬äºŒä¸ªé€»è¾‘æ ¸ä¾æ¬¡ç¼–å·\n\næ‰§è¡Œ lscpu å‘½ä»¤ æŸ¥çœ‹æ ¸çš„ç¼–å·\n\n\n\n\n\nç»‘æ ¸çš„é£é™©å’Œè§£å†³æ–¹æ¡ˆ\n\n\né£é™©\n\næŠŠ Redis å®ä¾‹ç»‘åˆ°ä¸€ä¸ª CPU é€»è¾‘æ ¸ä¸Šæ—¶ï¼Œä¼šå¯¼è‡´å­è¿›ç¨‹ã€åå°çº¿ç¨‹å’Œ Redis ä¸»çº¿ç¨‹ç«äº‰ CPU èµ„æºï¼Œä¸€æ—¦å­è¿›ç¨‹æˆ–åå°çº¿ç¨‹å ç”¨ CPU æ—¶ï¼Œä¸»çº¿ç¨‹å°±ä¼šè¢«é˜»å¡ï¼Œå¯¼è‡´ Redis è¯·æ±‚å»¶è¿Ÿå¢åŠ \n\n\n\nè§£å†³æ–¹æ¡ˆ\n\n\nä¸€ä¸ª Redis å®ä¾‹å¯¹åº”ç»‘ä¸€ä¸ªç‰©ç†æ ¸\n\nå°†å®ä¾‹ç»‘åˆ°ä¸€ä¸ªç‰©ç†æ ¸ä¸Šçš„æ‰€æœ‰é€»è¾‘æ ¸\nRedis çš„ä¸»çº¿ç¨‹ã€å­è¿›ç¨‹å’Œåå°çº¿ç¨‹å¯ä»¥å…±äº«ä½¿ç”¨ä¸€ä¸ªç‰©ç†æ ¸ä¸Šçš„ä¸¤ä¸ªé€»è¾‘æ ¸ï¼Œç¼“è§£ CPU èµ„æºç«äº‰\n\n\n\nä¼˜åŒ– Redis æºç \n\né¿å…åˆ‡æ¢æ ¸å¸¦æ¥çš„æ€§èƒ½å½±å“\nè®©å­è¿›ç¨‹ã€åå°çº¿ç¨‹æ ¸ä¸»çº¿ç¨‹ä¸åœ¨åŒä¸€ä¸ªæ ¸ä¸Šè¿è¡Œï¼Œé¿å… CPU èµ„æºç«äº‰\n\n\n\nRedis 6.0 ä¹‹åæ”¯æŒ CPU æ ¸ç»‘å®šçš„é…ç½®æ“ä½œ\n\n\n\n\n\n\nåœ¨ä¸€å°æœ‰ 2 ä¸ª CPU Socketï¼ˆæ¯ä¸ª Socket 8 ä¸ªç‰©ç†æ ¸ï¼‰çš„æœåŠ¡å™¨ä¸Šï¼Œæˆ‘ä»¬éƒ¨ç½²äº†æœ‰ 8 ä¸ªå®ä¾‹çš„ Redis åˆ‡ç‰‡é›†ç¾¤ï¼ˆ 8 ä¸ªå®ä¾‹éƒ½ä¸ºä¸»èŠ‚ç‚¹ï¼Œæ²¡æœ‰ä¸»å¤‡å…³ç³»ï¼‰ï¼Œé‡‡ç”¨å“ªç§æ–¹æ¡ˆç»‘æ ¸æœ€ä½³ï¼Ÿ\n\nåè€…\n\n\nå……åˆ†åˆ©ç”¨ 2 ä¸ª L3 ç¼“å­˜\n\n\n\n\nå°±è¿‘è®¿é—®å„è‡ªçš„å†…å­˜\n\n\n\n\n\nå‰è€…ä¼šå¢å¤§ç”¨åˆ° Swap çš„æ¦‚ç‡ï¼ŒCPU Socket çš„å†…å­˜ä¸å¤Ÿæ—¶å¯èƒ½ä¸ä¼šå»å¦ä¸€ä¸ªèŠ‚ç‚¹ç”³è¯·å†…å­˜\n\n\n\næ“ä½œç³»ç»Ÿå¯ä»¥é…ç½®å†…å­˜å›æ”¶ç­–ç•¥å’Œ Swap ä½¿ç”¨å€¾å‘ï¼šæœ¬èŠ‚ç‚¹å›æ”¶å†…å­˜/å…¶ä»–èŠ‚ç‚¹ç”³è¯·å†…å­˜/å†…å­˜æ•°æ®æ¢åˆ° Swap çš„å€¾å‘ç¨‹åº¦\n\n\n\n\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/18ï½œæ³¢åŠ¨çš„å“åº”å»¶è¿Ÿï¼šå¦‚ä½•åº”å¯¹å˜æ…¢çš„-Redisï¼Ÿï¼ˆä¸Šï¼‰":{"title":"18ï½œæ³¢åŠ¨çš„å“åº”å»¶è¿Ÿï¼šå¦‚ä½•åº”å¯¹å˜æ…¢çš„ Redisï¼Ÿï¼ˆä¸Šï¼‰","links":[],"tags":["redis"],"content":"\n\nRedis çœŸçš„å˜æ…¢äº†å—ï¼Ÿ\n\n\n\n\næŸ¥çœ‹ Redis çš„å“åº”å»¶è¿Ÿ\n\n\n\nredis-cli â€”latency -h host -p port\n\n\n\n\n\nåŸºäºå½“å‰ç¯å¢ƒä¸‹çš„ Redis åŸºçº¿æ€§èƒ½åšåˆ¤æ–­\n\n\n\n\nåŸºçº¿æ€§èƒ½ï¼šä¸€ä¸ªç³»ç»Ÿåœ¨ä½å‹åŠ›ã€æ— å¹²æ‰°ä¸‹çš„åŸºæœ¬æ€§èƒ½ï¼Œè¿™ä¸ªæ€§èƒ½åªç”±å½“å‰çš„è½¯ç¡¬ä»¶é…ç½®å†³å®š\n\n\nredis-cli å‘½ä»¤æä¾›çš„ -intrinsic-latency é€‰é¡¹å¯ä»¥ç”¨æ¥æ£€æµ‹å’Œç»Ÿè®¡æµ‹è¯•æœŸé—´çš„æœ€å¤§å»¶è¿Ÿï¼Œè¿™ä¸ªå»¶è¿Ÿå¯ä»¥ä½œä¸ºåŸºçº¿æ€§èƒ½\n\nè¦åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œï¼Œåªè€ƒè™‘æœåŠ¡å™¨ç«¯è½¯ç¡¬ä»¶ç¯å¢ƒçš„å½±å“\n\n\n\nRedis è¿è¡Œæ—¶å»¶è¿Ÿæ˜¯å…¶åŸºçº¿æ€§èƒ½çš„ 2 å€åŠä»¥ä¸Šè¡¨ç¤º Redis å˜æ…¢äº†\n\n\n\n\n\n\nå¦‚ä½•åº”å¯¹ Redis å˜æ…¢ï¼Ÿ\n\nä»æ…¢æŸ¥è¯¢å‘½ä»¤å¼€å§‹æ’æŸ¥ï¼Œå¹¶ä¸”æ ¹æ®ä¸šåŠ¡éœ€æ±‚æ›¿æ¢æ…¢æŸ¥è¯¢å‘½ä»¤\nåœ¨å®¢æˆ·ç«¯è¿›è¡Œæ’åºã€äº¤é›†ã€å¹¶é›†æ“ä½œï¼Œä¸ä½¿ç”¨ SORTã€SUNIONã€SINTER å‘½ä»¤ï¼Œé¿å…æ‹–æ…¢ Redis å®ä¾‹\næ’æŸ¥è¿‡æœŸ key çš„æ—¶é—´è®¾ç½®ï¼Œå¹¶æ ¹æ®å®é™…ä½¿ç”¨éœ€æ±‚ï¼Œè®¾ç½®ä¸åŒçš„è¿‡æœŸæ—¶é—´ï¼Œç»™è¿‡æœŸæ—¶é—´åŠ ä¸Šéšæœºæ•°\n\n\n\nåœ¨ Redis ä¸­ï¼Œè¿˜æœ‰å“ªäº›å…¶ä»–å‘½ä»¤å¯ä»¥ä»£æ›¿ KEYS å‘½ä»¤ï¼Œå®ç°åŒæ ·çš„åŠŸèƒ½å‘¢ï¼Ÿè¿™äº›å‘½ä»¤çš„å¤æ‚åº¦ä¼šå¯¼è‡´ Redis å˜æ…¢å—ï¼Ÿ\n\n\nä½¿ç”¨ SCAN å‘½ä»¤è·å–æ•´ä¸ªå®ä¾‹æ‰€æœ‰ key\n\n\nSCAN cursorCOUNTcount\n\nä¸€æ¬¡æœ€å¤šè¿”å› count ä¸ªæ•°çš„ keyï¼Œæ•°é‡ä¸ä¼šè¶…è¿‡ count\n\n\n\nä¸ä¼šæ¼ key\n\nSCAN é‡‡ç”¨é«˜ä½è¿›ä½æ³•çš„æ–¹å¼éå†å“ˆå¸Œæ¡¶ï¼Œå½“å“ˆå¸Œè¡¨æ‰©å®¹åï¼Œé€šè¿‡æ­¤ç®—æ³•éå†ï¼Œæ—§å“ˆå¸Œè¡¨ä¸­çš„æ•°æ®æ˜ å°„åˆ°æ–°å“ˆå¸Œè¡¨ï¼Œä¾æ—§ä¼šä¿ç•™åŸæ¥çš„å…ˆåé¡ºåºï¼Œæ­¤æ—¶ä¸ä¼šé—æ¼ä¹Ÿä¸ä¼šé‡å¤ key\n\n\n\nå¯èƒ½ä¼šè¿”å›é‡å¤çš„ key\n\nä¸ Redis çš„ Rehash æœºåˆ¶æœ‰å…³ï¼Œå“ˆå¸Œè¡¨ç¼©å®¹æ—¶ï¼Œå·²ç»éå†è¿‡çš„å“ˆå¸Œè¡¨ä¼šæ˜ å°„åˆ°æ–°å“ˆå¸Œè¡¨æ²¡æœ‰éå†åˆ°çš„ä½ç½®\n\n\n\n\n\nRedis é’ˆå¯¹ Hash/Set/Sorted Set æä¾›äº† HSCAN/SSCAN/ZSCAN å‘½ä»¤ï¼Œç”¨äºéå†ä¸€ä¸ª key ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œå»ºè®®åœ¨è·å–ä¸€ä¸ª bigkey çš„æ‰€æœ‰æ•°æ®æ—¶ä½¿ç”¨ï¼Œé¿å…å‘ç”Ÿé˜»å¡é£é™©\n\nkey çš„å…ƒç´ è¾ƒå°‘æ—¶ï¼Œåº•å±‚é‡‡ç”¨ intset/ziplist æ–¹å¼å­˜å‚¨ï¼Œä¼šæ— è§†å‘½ä»¤çš„ count å‚æ•°\n\n\n\nRedis 4.0 ä¹‹åå¯ä»¥ä½¿ç”¨å¼‚æ­¥çº¿ç¨‹æœºåˆ¶å‡å°‘ä¸»çº¿ç¨‹é˜»å¡\n\n\n\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/19ï½œæ³¢åŠ¨çš„å“åº”å»¶è¿Ÿï¼šå¦‚ä½•åº”å¯¹å˜æ…¢çš„-Redisï¼Ÿï¼ˆä¸‹ï¼‰":{"title":"19ï½œæ³¢åŠ¨çš„å“åº”å»¶è¿Ÿï¼šå¦‚ä½•åº”å¯¹å˜æ…¢çš„ Redisï¼Ÿï¼ˆä¸‹ï¼‰","links":[],"tags":["redis"],"content":"\n\næ–‡ä»¶ç³»ç»Ÿï¼šAOF æ¨¡å¼\n\n\n\n\n\nAOF é‡å†™ä¼šå¯¹ç£ç›˜è¿›è¡Œå¤§é‡ IO æ“ä½œï¼Œfsync éœ€è¦ç­‰åˆ°æ•°æ®å†™åˆ°ç£ç›˜åæ‰èƒ½è¿”å›\n\n\n\n\n\neverysec æ—¶ï¼Œä½¿ç”¨åå°å­çº¿ç¨‹è°ƒç”¨ fsync å†™æ—¥å¿—\n\nè™½ç„¶ fsync ç”±åå°å­çº¿ç¨‹è´Ÿè´£æ‰§è¡Œï¼Œä½†ä¸»çº¿ç¨‹ä¼šç›‘æ§ fsync çš„æ‰§è¡Œè¿›åº¦\nä¸Šæ¬¡ fsync æœªæ‰§è¡Œå®Œæ—¶ï¼Œä¸‹æ¬¡ fsync ä¼šè¢«é˜»å¡\n\n\n\nalways æ—¶ï¼Œä¸»çº¿ç¨‹ä¸­è°ƒç”¨ fsync\n\n\n\n\né¿å…ä½¿ç”¨æ“ä½œç³»ç»Ÿçš„ swap\n\n\nå¢åŠ æœºå™¨çš„å†…å­˜\n\n\nä½¿ç”¨ Redis é›†ç¾¤\n\n\næŸ¥çœ‹ Redis è¿›ç¨‹çš„ swap ä½¿ç”¨æƒ…å†µ\n\n\n\nredis-cli info | grep process_id\n\n\n\n\ncd /proc/{process_id}\n\n\n\n\ncat smaps | egrep â€™^(Swap|Size)â€™\n\n\n\n\n\n\n\næ“ä½œç³»ç»Ÿï¼šå†…å­˜å¤§é¡µ\n\n\nå†™æ—¶å¤åˆ¶ï¼šä¸€æ—¦æ•°æ®è¦è¢«ä¿®æ”¹ï¼ŒRedis ä¸ä¼šç›´æ¥ä¿®æ”¹å†…å­˜ä¸­çš„æ•°æ®ï¼Œä¼šå…ˆæ‹·è´ä¸€ä»½å†è¿›è¡Œä¿®æ”¹\n\n\nå¸¸è§„å†…å­˜æœºåˆ¶åªç”¨æ‹·è´ 4KBï¼Œå†…å­˜å¤§é¡µéœ€è¦æ‹·è´ 2MB\n\n\nå…³é—­å³å¯\n\n\n\ncat /sys/kernel/mm/transparent_hugepage/enabled æŸ¥çœ‹æ˜¯å¦ always æ‰“å¼€\n\n\n\n\nå…³é—­ï¼šecho never &gt; /sys/kernel/mm/transparent_hugepage/enabled\n\n\n\n\n\n\n\nChecklist\n\n\n\nè·å– Redis å®ä¾‹åœ¨å½“å‰ç¯å¢ƒä¸‹çš„åŸºçº¿æ€§èƒ½\n\n\n\n\næ˜¯å¦ç”¨äº†æ…¢æŸ¥è¯¢å‘½ä»¤ï¼Ÿä½¿ç”¨å…¶ä»–å‘½ä»¤æ›¿ä»£æ…¢æŸ¥è¯¢å‘½ä»¤ï¼Œæˆ–è€…æŠŠèšåˆè®¡ç®—å‘½ä»¤æ”¾åœ¨å®¢æˆ·ç«¯åš\n\n\n\n\næ˜¯å¦å¯¹è¿‡æœŸ key è®¾ç½®äº†ç›¸åŒçš„è¿‡æœŸæ—¶é—´ï¼Ÿå¯¹äºæ‰¹é‡åˆ é™¤çš„ keyï¼Œå¯ä»¥åœ¨æ¯ä¸ª key çš„è¿‡æœŸæ—¶é—´ä¸ŠåŠ ä¸€ä¸ªéšæœºæ•°ï¼Œé¿å…åŒæ—¶åˆ é™¤\n\n\n\n\næ˜¯å¦å­˜åœ¨ bigkeyï¼Ÿ å¯¹äº bigkey çš„åˆ é™¤æ“ä½œï¼Œå¦‚æœä½ çš„ Redis æ˜¯ 4.0 åŠä»¥ä¸Šçš„ç‰ˆæœ¬ï¼Œå¯ä»¥ç›´æ¥åˆ©ç”¨å¼‚æ­¥çº¿ç¨‹æœºåˆ¶å‡å°‘ä¸»çº¿ç¨‹é˜»å¡ï¼›å¦‚æœæ˜¯ Redis 4.0 ä»¥å‰çš„ç‰ˆæœ¬ï¼Œå¯ä»¥ä½¿ç”¨ SCAN å‘½ä»¤è¿­ä»£åˆ é™¤ï¼›å¯¹äº bigkey çš„é›†åˆæŸ¥è¯¢å’Œèšåˆæ“ä½œï¼Œå¯ä»¥ä½¿ç”¨ SCAN å‘½ä»¤åœ¨å®¢æˆ·ç«¯å®Œæˆ\n\n\n\n\nRedis AOF é…ç½®çº§åˆ«æ˜¯ä»€ä¹ˆï¼Ÿä¸šåŠ¡å±‚é¢æ˜¯å¦çš„ç¡®éœ€è¦è¿™ä¸€å¯é æ€§çº§åˆ«ï¼Ÿå¦‚æœæˆ‘ä»¬éœ€è¦é«˜æ€§èƒ½ï¼ŒåŒæ—¶ä¹Ÿå…è®¸æ•°æ®ä¸¢å¤±ï¼Œå¯ä»¥å°†é…ç½®é¡¹ no-appendfsync-on-rewrite è®¾ç½®ä¸º yesï¼Œé¿å… AOF é‡å†™å’Œ fsync ç«äº‰ç£ç›˜ IO èµ„æºï¼Œå¯¼è‡´ Redis å»¶è¿Ÿå¢åŠ \n\n\n\n\nRedis å®ä¾‹çš„å†…å­˜ä½¿ç”¨æ˜¯å¦è¿‡å¤§ï¼Ÿå‘ç”Ÿ swap äº†å—ï¼Ÿå¢åŠ æœºå™¨å†…å­˜ï¼Œæˆ–è€…æ˜¯ä½¿ç”¨ Redis é›†ç¾¤ï¼Œåˆ†æ‘Šå•æœº Redis çš„é”®å€¼å¯¹æ•°é‡å’Œå†…å­˜å‹åŠ›ã€‚åŒæ—¶ï¼Œè¦é¿å…å‡ºç° Redis å’Œå…¶ä»–å†…å­˜éœ€æ±‚å¤§çš„åº”ç”¨å…±äº«æœºå™¨çš„æƒ…å†µ\n\n\n\n\nåœ¨ Redis å®ä¾‹çš„è¿è¡Œç¯å¢ƒä¸­ï¼Œæ˜¯å¦å¯ç”¨äº†é€æ˜å¤§é¡µæœºåˆ¶ï¼Ÿç›´æ¥å…³é—­å†…å­˜å¤§é¡µæœºåˆ¶å°±è¡Œäº†\n\n\n\n\næ˜¯å¦è¿è¡Œäº† Redis ä¸»ä»é›†ç¾¤ï¼Ÿå¦‚æœæ˜¯çš„è¯ï¼ŒæŠŠä¸»åº“å®ä¾‹çš„æ•°æ®é‡å¤§å°æ§åˆ¶åœ¨ 2~4GBï¼Œä»¥å…ä¸»ä»å¤åˆ¶æ—¶ï¼Œä»åº“å› åŠ è½½å¤§çš„ RDB æ–‡ä»¶è€Œé˜»å¡\n\n\n\n\næ˜¯å¦ä½¿ç”¨äº†å¤šæ ¸ CPU æˆ– NUMA æ¶æ„çš„æœºå™¨è¿è¡Œ Redis å®ä¾‹ï¼Ÿä½¿ç”¨å¤šæ ¸ CPU æ—¶ï¼Œå¯ä»¥ç»™ Redis å®ä¾‹ç»‘å®šç‰©ç†æ ¸ï¼›ä½¿ç”¨ NUMA æ¶æ„æ—¶ï¼Œæ³¨æ„æŠŠ Redis å®ä¾‹å’Œç½‘ç»œä¸­æ–­å¤„ç†ç¨‹åºè¿è¡Œåœ¨åŒä¸€ä¸ª CPU Socket ä¸Š\n\n\n\n\nRedis æ‰€åœ¨çš„æœºå™¨ä¸Šæœ‰æ²¡æœ‰ä¸€äº›å…¶ä»–å å†…å­˜ã€ç£ç›˜ IO å’Œç½‘ç»œ IO çš„ç¨‹åºï¼Œæ¯”å¦‚è¯´æ•°æ®åº“ç¨‹åºæˆ–è€…æ•°æ®é‡‡é›†ç¨‹åºã€‚å¦‚æœæœ‰çš„è¯ï¼Œå»ºè®®å°†è¿™äº›ç¨‹åºè¿ç§»åˆ°å…¶ä»–æœºå™¨ä¸Šè¿è¡Œ\n\n\n\n\né¿å…å­˜å‚¨ bigkeyï¼ŒRedis 4.0+ å¯å¼€å¯ lazy-free æœºåˆ¶\n\n\n\n\nä½¿ç”¨é•¿è¿æ¥\n\n\n\n\n\nç”Ÿæˆ RDB å’Œ AOF é‡å†™ fork è€—æ—¶ä¸¥é‡\n\n\n\na. å®ä¾‹å°½é‡å°\nb. å°½é‡éƒ¨ç½²åœ¨ç‰©ç†æœºä¸Š\nc. ä¼˜åŒ–å¤‡ä»½ç­–ç•¥\nd. åˆç†é…ç½® repl-backlog å’Œ slave-clent-output-buffer-limit é¿å…å…¨é‡åŒæ­¥\ne. è§†æƒ…å†µå…³é—­ AOF\nf. ç›‘æ§ latest_fork_usec è€—æ—¶æ˜¯å¦å˜é•¿\n\n\n\n\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/20ï½œåˆ é™¤æ•°æ®åï¼Œä¸ºä»€ä¹ˆå†…å­˜å ç”¨ç‡è¿˜æ˜¯å¾ˆé«˜ï¼Ÿ":{"title":"20ï½œåˆ é™¤æ•°æ®åï¼Œä¸ºä»€ä¹ˆå†…å­˜å ç”¨ç‡è¿˜æ˜¯å¾ˆé«˜ï¼Ÿ","links":[],"tags":["redis"],"content":"\n\nå†…å­˜ç¢ç‰‡\n\n\nç°è±¡ï¼šå†…å­˜ç©ºé—´é—²ç½®\n\n\nç”ŸæˆåŸå› ï¼šæ“ä½œç³»ç»Ÿçš„å†…å­˜åˆ†é…æœºåˆ¶ + Redis çš„è´Ÿè½½ç‰¹å¾\n\n\næ“ä½œç³»ç»ŸæŒ‰å›ºå®šå¤§å°åˆ†é…å†…å­˜ï¼Œè€Œä¸æ˜¯å®Œå…¨æŒ‰ç…§åº”ç”¨ç¨‹åºç”³è¯·çš„å†…å­˜ç©ºé—´å¤§å°ç»™ç¨‹åºåˆ†é…\n\n\nå½“ç¨‹åºç”³è¯·çš„å†…å­˜æœ€æ¥è¿‘æŸä¸ªå›ºå®šå€¼æ—¶ï¼ŒRedis ä½¿ç”¨çš„ jemalloc ä¼šç»™å®ƒåˆ†é…ç›¸åº”å¤§å°çš„ç©ºé—´\n\nä¸ºäº†å‡å°‘åˆ†é…æ¬¡æ•°\n\n\n\n\n\nåˆ¤æ–­æ˜¯å¦æœ‰å†…å­˜ç¢ç‰‡\n\n\n\n\næ‰§è¡Œ INFO memory\n\n\n\nused_memory_rssï¼šæ“ä½œç³»ç»Ÿå®é™…åˆ†é…çš„ç‰©ç†å†…å­˜ç©ºé—´ï¼ŒåŒ…å«äº†ç¢ç‰‡\nused_memoryï¼šä¿å­˜æ•°æ®å®é™…ç”³è¯·ä½¿ç”¨çš„ç©ºé—´\nmem_fragmentation_ratioï¼šå½“å‰çš„å†…å­˜ç¢ç‰‡ç‡\nmem_fragmentation_ratio = used_memory_rss / used_memory\n\n\n\nç»éªŒé˜ˆå€¼\n\nåˆç†æƒ…å†µï¼šmem_fragmentation_ratio å¤§äº 1 ä½†å°äº 1.5\néœ€è¦é‡‡å–æªæ–½ï¼šmem_fragmentation_ratio å¤§äº 1.5\nå°äº 1 æ—¶åœ¨ä½¿ç”¨ Swapï¼Œåº”è¯¥å‡çº§æœåŠ¡å™¨é…ç½®æˆ–å¢åŠ é›†ç¾¤å®ä¾‹æ•°é‡\n\n\n\n\n\næ¸…ç†\n\n\n\n\n\næš´åŠ›ï¼šé‡å¯ Redis å®ä¾‹\n\n\n4.0-RC3 ä¹‹åæä¾›äº†å†…å­˜ç¢ç‰‡è‡ªåŠ¨æ¸…ç†çš„æ–¹æ³•\n\nâ€œæ¬å®¶è®©ä½ï¼Œåˆå¹¶ç©ºé—´â€\nå¯ç”¨ï¼šconfig set activedefrag yes\nactive-defrag-ignore-bytes 100mbï¼šè¡¨ç¤ºå†…å­˜ç¢ç‰‡çš„å­—èŠ‚æ•°è¾¾åˆ° 100MB æ—¶ï¼Œå¼€å§‹æ¸…ç†\nactive-defrag-threshold-lower 10ï¼šè¡¨ç¤ºå†…å­˜ç¢ç‰‡ç©ºé—´å æ“ä½œç³»ç»Ÿåˆ†é…ç»™ Redis çš„æ€»ç©ºé—´æ¯”ä¾‹è¾¾åˆ° 10% æ—¶ï¼Œå¼€å§‹æ¸…ç†\nactive-defrag-cycle-min 25ï¼š è¡¨ç¤ºè‡ªåŠ¨æ¸…ç†è¿‡ç¨‹æ‰€ç”¨ CPU æ—¶é—´çš„æ¯”ä¾‹ä¸ä½äº 25%ï¼Œä¿è¯æ¸…ç†èƒ½æ­£å¸¸å¼€å±•\nactive-defrag-cycle-max 75ï¼šè¡¨ç¤ºè‡ªåŠ¨æ¸…ç†è¿‡ç¨‹æ‰€ç”¨ CPU æ—¶é—´çš„æ¯”ä¾‹ä¸é«˜äº 75%ï¼Œä¸€æ—¦è¶…è¿‡ï¼Œå°±åœæ­¢æ¸…ç†ï¼Œä»è€Œé¿å…åœ¨æ¸…ç†æ—¶ï¼Œå¤§é‡çš„å†…å­˜æ‹·è´é˜»å¡ Redisï¼Œå¯¼è‡´å“åº”å»¶è¿Ÿå‡é«˜\n\n\n\n\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/21ï½œç¼“å†²åŒºï¼šä¸€ä¸ªå¯èƒ½å¼•å‘â€œæƒ¨æ¡ˆâ€çš„åœ°æ–¹":{"title":"21ï½œç¼“å†²åŒºï¼šä¸€ä¸ªå¯èƒ½å¼•å‘â€œæƒ¨æ¡ˆâ€çš„åœ°æ–¹","links":[],"tags":["redis"],"content":"\n\nå®¢æˆ·ç«¯è¾“å…¥å’Œè¾“å‡ºç¼“å†²åŒº\n\n\né¿å…å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„è¯·æ±‚å‘é€å’Œå¤„ç†é€Ÿåº¦ä¸åŒ¹é…\n\n\nè¾“å…¥ç¼“å†²åŒºä¼šå…ˆæŠŠå®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„å‘½ä»¤æš‚å­˜èµ·æ¥ï¼ŒRedis ä¸»çº¿ç¨‹å†ä»è¾“å…¥ç¼“å†²åŒºä¸­è¯»å–å‘½ä»¤ï¼Œè¿›è¡Œå¤„ç†ã€‚å½“ Redis ä¸»çº¿ç¨‹å¤„ç†å®Œæ•°æ®åï¼Œä¼šæŠŠç»“æœå†™å…¥åˆ°è¾“å‡ºç¼“å†²åŒºï¼Œå†é€šè¿‡è¾“å‡ºç¼“å†²åŒºè¿”å›ç»™å®¢æˆ·ç«¯\n\n\n\n\n\næŸ¥çœ‹è¾“å…¥ç¼“å†²åŒºçš„å†…å­˜ä½¿ç”¨æƒ…å†µï¼šCLIENT LIST å‘½ä»¤\n\ncmdï¼šæœ€æ–°æ‰§è¡Œçš„å‘½ä»¤\nqbufï¼šè¾“å…¥ç¼“å†²åŒºå·²ç»ä½¿ç”¨çš„å¤§å°\nqbuf-freeï¼šå°šæœªä½¿ç”¨çš„å¤§å°\n\n\n\næœåŠ¡ç«¯å…è®¸ä¸ºæ¯ä¸ªå®¢æˆ·ç«¯æœ€å¤šæš‚å­˜ 1GB çš„å‘½ä»¤å’Œæ•°æ®ï¼Œä¸Šé™é˜ˆå€¼åœ¨ä»£ç ä¸­è®¾å®š 1GBï¼Œä¸å¯å˜ï¼ˆè¾“å…¥ç¼“å†²åŒºï¼‰\n\n\nè¾“å‡ºç¼“å†²åŒºä¼šæº¢å‡ºçš„æƒ…å†µ\n\n\nè¿”å› bigkey çš„å¤§é‡ç»“æœ\n\n\næ‰§è¡Œäº† MONITOR å‘½ä»¤ï¼šæ£€æµ‹ Redis æ‰§è¡Œ\n\n\nç¼“å†²åŒºå¤§å°è®¾ç½®ä¸åˆç†\n\nå¤§å°ä¸Šé™é˜ˆå€¼\næŒç»­å†™å…¥æ•°æ®çš„æ•°é‡ä¸Šé™é˜ˆå€¼\n\n\n\n\n\næ™®é€šå®¢æˆ·ç«¯é€šç”¨è®¾ç½® - é…ç½®æ–‡ä»¶ï¼šclient-output-buffer-limit normal 0 0 0\n\n\nè®¢é˜…å®¢æˆ·ç«¯ - é…ç½®æ–‡ä»¶ï¼šclient-output-buffer-limit pubsub 8mb 2mb 60\n\n\n\n\nä¸»ä»é›†ç¾¤ä¸­çš„ç¼“å†²åŒº\n\n\nå¤åˆ¶ç¼“å†²åŒºçš„æº¢å‡ºé—®é¢˜\n\n\n\n\n\nåœ¨ä¸»èŠ‚ç‚¹æ‰§è¡Œï¼šconfig set client-output-buffer-limit slave 512mb 128mb 60 è¿›è¡Œè®¾ç½®\n\n\nslave è¡¨ç¤ºè¯¥é…ç½®é¡¹æ˜¯é’ˆå¯¹å¤åˆ¶ç¼“å†²åŒºçš„\n\n\næ¯ä¸ªä»èŠ‚ç‚¹å„ä¸€ä¸ª\n\n\n\n\nå¤åˆ¶ç§¯å‹ç¼“å†²åŒºï¼ˆrepl_backlog_bufferï¼‰çš„æº¢å‡ºé—®é¢˜\n\n\n\n\n\nå¯¼è‡´æ•°æ®ä¸¢å¤±\n\n\nå…¶ä»–ç¼“å†²åŒºå¯¼è‡´ç½‘ç»œè¿æ¥å…³é—­\n\n\n\n\n\n\nåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨çš„å®¢æˆ·ç«¯éœ€è¦ä½¿ç”¨ç¼“å†²åŒºæ—¶\n\nåœ¨ buffer ä¸­æ‹¼è£…å¥½æ•°æ®ï¼Œä¸€æ¬¡æ€§ç”±æ“ä½œç³»ç»Ÿå‘é€ç»™æœåŠ¡ç«¯\nä½¿ç”¨ Pipeline æ‰¹é‡å‘é€å‘½ä»¤åˆ°æœåŠ¡ç«¯\nä¸»åº“ä¸Šçš„ä»åº“è¾“å‡ºç¼“å†²åŒº slave-client-output-buffer ä¸è®¡ç®—åœ¨ Redis ä½¿ç”¨çš„æ€»å†…å­˜ä¸­ï¼Œä¸ä¼šè¶…è¿‡ maxmemory å¯¼è‡´æ·˜æ±°æ•°æ®ï¼Œåªæœ‰æ™®é€šå’Œè®¢é˜…å®¢æˆ·ç«¯çš„è¾“å‡ºç¼“å†²åŒºå†…å­˜å¢é•¿ï¼Œè¶…è¿‡ maxmemory æ—¶ï¼Œæ‰ä¼šæ·˜æ±°æ•°æ®\n\n\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/22ï½œç¬¬-11ï½21-è®²è¯¾åæ€è€ƒé¢˜ç­”æ¡ˆåŠå¸¸è§é—®é¢˜ç­”ç–‘":{"title":"22ï½œç¬¬ 11ï½21 è®²è¯¾åæ€è€ƒé¢˜ç­”æ¡ˆåŠå¸¸è§é—®é¢˜ç­”ç–‘","links":[],"tags":["redis"],"content":"\n\né—®é¢˜ 1ï¼šå¦‚ä½•ä½¿ç”¨æ…¢æŸ¥è¯¢æ—¥å¿—å’Œ latency monitor æ’æŸ¥æ‰§è¡Œæ…¢çš„æ“ä½œï¼Ÿ\n\n\n\nè®¾ç½® slowlog-log-slower-thanï¼šå¯¹æ‰§è¡Œæ—¶é—´å¤§äºå¤šå°‘å¾®å¦™çš„å‘½ä»¤è¿›è¡Œè®°å½•\n\n\n\n\nè®¾ç½® slowlog-max-lenï¼šæ—¥å¿—æœ€å¤šè®°å½•å¤šå°‘è°ƒå‘½ä»¤\n\n\n\n\nä½¿ç”¨ SLOWLOG GET å‘½ä»¤æŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—\n\n\n\n\n\nä¹Ÿå¯ä»¥ä½¿ç”¨ latency monitor ç›‘æ§å·¥å…·\n\n\n\nç›‘æ§ Redis è¿è¡Œè¿‡ç¨‹ä¸­çš„å³°å€¼å»¶è¿Ÿæƒ…å†µ\nä» 2.8.13 ç‰ˆæœ¬å¼€å§‹æä¾›\nä½¿ç”¨ latency latestæŸ¥çœ‹æœ€æ–°å’Œæœ€å¤§çš„è¶…è¿‡é˜ˆå€¼çš„å»¶è¿Ÿæƒ…å†µ\n\n\n\n\n\né—®é¢˜ 2ï¼šå¦‚ä½•æ’æŸ¥ Redis çš„ bigkeyï¼Ÿ\n\n\næ‰§è¡Œ ./redis-cli â€”bigkeys\n\n\nå¯¹æ•´ä¸ªæ•°æ®åº“ä¸­çš„é”®å€¼å¯¹å¤§å°æƒ…å†µè¿›è¡Œç»Ÿè®¡åˆ†æ\n\n\nè¾“å‡ºæ¯ç§æ•°æ®ç±»å‹ä¸­æœ€å¤§çš„ bigkey çš„ä¿¡æ¯\n\nString ç±»å‹çš„æœ€å¤§ bigkey çš„å­—èŠ‚é•¿åº¦\né›†åˆç±»å‹çš„æœ€å¤§ bigkey çš„å…ƒç´ ä¸ªæ•°\n\n\n\næ‰§è¡Œæ—¶ä¼šæ‰«ææ•°æ®åº“ï¼Œåº”åœ¨ä½å³°æœŸæˆ–è€…ä»èŠ‚ç‚¹ä½¿ç”¨\n\n\nä½¿ç”¨ -i å‚æ•°æ§åˆ¶æ‰«æé—´éš”ï¼Œå•ä½ç§’\n\n\n\n\nå‘½ä»¤æœ‰é™åˆ¶\n\nåªèƒ½è¿”å›æ¯ç§ç±»å‹æœ€å¤§çš„ä¸€ä¸ª\né›†åˆå…ƒç´ å¤šä¸ä¸€å®šå ç”¨å†…å­˜å¤§\n\n\n\nè‡ªå·±å¼€å‘ç»Ÿè®¡å†…å­˜å ç”¨å’Œæ’åœ¨å‰ N ä½çš„ key\n\n\n\nä½¿ç”¨ SCAN å‘½ä»¤æ‰«ææ•°æ®åº“\n\n\n\n\n\nTYPE å‘½ä»¤è·å–è¿”å›çš„ key çš„ç±»å‹\n\n\n\n\nString ç±»å‹ï¼šSTRLEN è·å–é•¿åº¦\n\n\né›†åˆç±»å‹\n\næå‰çŸ¥é“å…ƒç´ å¹³å‡å¤§å° * å…ƒç´ ä¸ªæ•°\nRedis 4.0+ ç‰ˆæœ¬çš„ MEMORY USAGE å‘½ä»¤æŸ¥è¯¢ä¸€ä¸ªé”®å€¼å¯¹å ç”¨çš„å†…å­˜ç©ºé—´\n\n\n\n\n\n\n\n\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/23ï½œæ—è·¯ç¼“å­˜ï¼šRedis-æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ":{"title":"23ï½œæ—è·¯ç¼“å­˜ï¼šRedis æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ","links":[],"tags":["redis"],"content":"\n\næ—è·¯ç¼“å­˜ï¼šè¯»å–ç¼“å­˜ã€è¯»å–æ•°æ®åº“å’Œæ›´æ–°ç¼“å­˜çš„æ“ä½œéƒ½éœ€è¦åœ¨åº”ç”¨ç¨‹åºä¸­å®Œæˆ\n\n\nRedis é€‚åˆåšç¼“å­˜\n\n\n\nåœ¨åˆ†å±‚ç³»ç»Ÿä¸­ï¼Œæ•°æ®æš‚å­˜åœ¨å¿«é€Ÿå­ç³»ç»Ÿä¸­æœ‰åŠ©äºåŠ é€Ÿè®¿é—®\n\n\n\n\nç¼“å­˜å®¹é‡æœ‰é™ï¼Œç¼“å­˜å†™æ»¡æ—¶ï¼Œæ•°æ®éœ€è¦è¢«æ·˜æ±°\n\n\n\n\n\nåªè¯»ç¼“å­˜\n\nå†™æ“ä½œç›´æ¥ä½œç”¨åœ¨æ•°æ®åº“ï¼Œå¹¶åˆ æ‰å·²ç¼“å­˜çš„æ•°æ®\né€‚ç”¨äºå†™è¯·æ±‚è¾ƒå°‘æˆ–è€…åªéœ€è¦æå‡è¯»è¯·æ±‚å“åº”é€Ÿåº¦çš„æƒ…å†µ\næ•°æ®å¯é ï¼Œä¼˜å…ˆä¿è¯æ•°æ®åº“å’Œç¼“å­˜çš„ä¸€è‡´æ€§\n\n\n\nè¯»å†™ç¼“å­˜\n\n\nå¯¹å†™è¯·æ±‚è¿›è¡ŒåŠ é€Ÿ\n\n\nå¯¹æ•°æ®å¯é æ€§è¦æ±‚ä½ï¼Œæˆ–ä¸šåŠ¡ä¸Šä¸ä¼šå¹¶å‘ä¿®æ”¹åŒä¸€ä¸ªå€¼æ—¶\n\n\nåŒæ­¥ç›´å†™\n\n\nå¼‚æ­¥å†™å›\n\néœ€è¦åœ¨è„æ•°æ®è¢«æ·˜æ±°æ—¶ï¼Œè‡ªè¡ŒæŠŠæ•°æ®å†™å›æ•°æ®åº“ï¼ŒRedis æ— æ³•å®ç°è¿™ä¸€ç‚¹\næ‰€ä»¥ï¼Œä½¿ç”¨ Redis ç¼“å­˜æ—¶ï¼Œä¸é‡‡ç”¨è¿™ä¸ªæ¨¡å¼\n\n\n\n\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/24ï½œæ›¿æ¢ç­–ç•¥ï¼šç¼“å­˜æ»¡äº†æ€ä¹ˆåŠï¼Ÿ":{"title":"24ï½œæ›¿æ¢ç­–ç•¥ï¼šç¼“å­˜æ»¡äº†æ€ä¹ˆåŠï¼Ÿ","links":[],"tags":["redis"],"content":"\n\nå»ºè®®æŠŠç¼“å­˜å®¹é‡è®¾ç½®ä¸ºæ€»æ•°æ®é‡çš„ 15% åˆ° 30%ï¼Œå…¼é¡¾è®¿é—®æ€§èƒ½å’Œå†…å­˜ç©ºé—´å¼€é”€\n\nCONFIG SET maxmemory 4gb\n\n\n\næ•°æ®æ·˜æ±°ç­–ç•¥\n\n\nnoevictionï¼ˆä¸è¿›è¡Œæ•°æ®æ·˜æ±°ï¼‰\n\nä¸€æ—¦ç¼“å­˜è¢«å†™æ»¡ï¼Œå†æœ‰å†™è¯·æ±‚æ—¶ï¼ŒRedis ä¸å†æä¾›æœåŠ¡ï¼Œç›´æ¥è¿”å›é”™è¯¯\n\n\n\nè¿›è¡Œæ•°æ®æ·˜æ±°çš„ç­–ç•¥\n\n\nåœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„æ•°æ®ä¸­è¿›è¡Œæ·˜æ±°\n\n\nvolatile-lru\n\n\nvolatile-random\n\n\nvolatile-ttl\n\n\nvolatile-lfu\n\nRedis 4.0 åæ–°å¢\n\n\n\n\n\nåœ¨æ‰€æœ‰æ•°æ®ä¸­è¿›è¡Œæ·˜æ±°\n\n\nallkeys-lru\n\n\nallkeys-random\n\n\nallkeys-lfu\n\nRedis 4.0 åæ–°å¢\n\n\n\n\n\n\n\nRedis 3.0 ä¹‹å‰é»˜è®¤æ˜¯ volatile-lruï¼Œä¹‹åï¼ˆåŒ…æ‹¬ 3.0ï¼‰æ˜¯ noeviction\n\n\n\n\nLRUï¼ˆLeast Recently Usedï¼‰ç®—æ³•\n\n\næœ€è¿‘æœ€å°‘ä½¿ç”¨\n\n\nåŸºäºé“¾è¡¨å®ç°\n\nMRU ç«¯ï¼šé“¾å¤´\nLRU ç«¯ï¼šé“¾å°¾\n\n\n\nåˆšè¢«è®¿é—®çš„å’Œåˆšå†™å…¥çš„æ•°æ®ç§»åˆ°é˜Ÿå¤´ï¼Œå…¶ä»–æ•°æ®å‘åæŒªä¸€ä½\n\n\nRedis ä¸­åšäº†ç®€åŒ–ï¼Œå‡è½»æ•°æ®æ·˜æ±°å¯¹ç¼“å­˜æ€§èƒ½çš„å½±å“\n\n\n\n\nRedis é»˜è®¤ä¼šè®°å½•æ¯ä¸ªæ•°æ®çš„æœ€è¿‘ä¸€æ¬¡è®¿é—®çš„æ—¶é—´æˆ³\n\n\n\nRedisObject.lru\n\n\n\n\n\nå†³å®šæ·˜æ±°çš„æ•°æ®æ—¶ï¼Œç¬¬ä¸€æ¬¡ä¼šéšæœºé€‰å‡º N ä¸ªæ•°æ®ä½œä¸ºå€™é€‰é›†åˆï¼Œæ¯”è¾ƒ lru å­—æ®µï¼Œæ·˜æ±° lru å­—æ®µå€¼æœ€å°çš„æ•°æ®\n\n\n\nè®¾ç½® Nï¼šCONFIG SET maxmemory-samples 100\n\n\n\n\néœ€è¦å†æ¬¡æ·˜æ±°æ•°æ®æ—¶ï¼ŒæŒ‘é€‰æ•°æ®è¿›å…¥ç¬¬ä¸€æ¬¡åˆ›å»ºçš„å€™é€‰é›†åˆï¼Œèƒ½è¿›å…¥çš„æ•°æ®çš„ lru å­—æ®µå€¼å¿…é¡»å°äºå€™é€‰é›†åˆä¸­æœ€å°çš„ lru å€¼ï¼Œæ•°æ®ä¸ªæ•°è¾¾åˆ° maxmemory-samples æ—¶æŠŠæœ€å°çš„æ•°æ®æ·˜æ±°\n\n\n\nç®€åŒ–åï¼ŒRedis ç¼“å­˜ä¸ç”¨ä¸ºæ‰€æœ‰çš„æ•°æ®ç»´æŠ¤ä¸€ä¸ªå¤§é“¾è¡¨ï¼Œä¹Ÿä¸ç”¨åœ¨æ¯æ¬¡æ•°æ®è®¿é—®æ—¶ç§»åŠ¨é“¾è¡¨é¡¹ï¼Œæå‡äº†ç¼“å­˜çš„æ€§èƒ½\n\n\n\n\n\n\næœ‰æ˜æ˜¾çš„æ•°æ®å†·çƒ­åŒºåˆ†æ—¶ï¼Œä¼˜å…ˆä½¿ç”¨ allkeys-lru ç­–ç•¥ï¼Œå¯ä»¥å……åˆ†åˆ©ç”¨ç¼“å­˜ç®—æ³•ä¼˜åŠ¿ï¼ŒæŠŠæœ€è¿‘æœ€å¸¸è®¿é—®çš„æ•°æ®ç•™åœ¨ç¼“å­˜ä¸­ï¼Œæå‡åº”ç”¨çš„è®¿é—®æ€§èƒ½\n\n\næ•°æ®è®¿é—®é¢‘ç‡ç›¸å·®ä¸å¤§ï¼Œæ²¡æœ‰æ˜æ˜¾çš„å†·çƒ­æ•°æ®åŒºåˆ†æ—¶ï¼Œå»ºè®®ä½¿ç”¨ allkeys-random ç­–ç•¥\n\n\nä¸šåŠ¡ä¸­æœ‰ç½®é¡¶çš„éœ€æ±‚ï¼Œå¯ä»¥ä½¿ç”¨ volatile-lruï¼ŒåŒæ—¶ä¸ç»™ç½®é¡¶æ•°æ®è®¾ç½®è¿‡æœŸæ—¶é—´\n\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/25ï½œç¼“å­˜å¼‚å¸¸ï¼ˆä¸Šï¼‰ï¼šå¦‚ä½•è§£å†³ç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜ï¼Ÿ":{"title":"25ï½œç¼“å­˜å¼‚å¸¸ï¼ˆä¸Šï¼‰ï¼šå¦‚ä½•è§£å†³ç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜ï¼Ÿ","links":[],"tags":["redis"],"content":"\n\næ•°æ®çš„ä¸€è‡´æ€§\n\nç¼“å­˜ä¸­æœ‰æ•°æ®ï¼Œç¼“å­˜çš„æ•°æ®å€¼éœ€è¦å’Œæ•°æ®åº“ä¸­çš„å€¼ç›¸åŒ\nç¼“å­˜ä¸­æ²¡æœ‰æ•°æ®ï¼Œæ•°æ®åº“ä¸­çš„å€¼å¿…é¡»æ˜¯æœ€æ–°å€¼\n\n\n\nã€Œè¯»å†™ç¼“å­˜ã€\n\nè¦ä¿è¯ä¸€è‡´æ€§å¯ä»¥é‡‡ç”¨åŒæ­¥ç›´å†™ç­–ç•¥\né€‚ç”¨äºè¯»å†™ç›¸å½“çš„ä¸šåŠ¡åœºæ™¯\n\n\n\nã€Œåªè¯»ç¼“å­˜ã€\n\n\næ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜åŸå› ã€ç°è±¡å’Œåº”å¯¹æ–¹æ¡ˆ\n\n\n\n\n\nåˆ†ä¸º 1. å…ˆåˆ é™¤ç¼“å­˜å†æ›´æ–°æ•°æ®åº“ï¼›2. å…ˆæ›´æ–°æ•°æ®åº“å†åˆ é™¤ç¼“å­˜\n\n\n\n\né€‚ç”¨äºè¯»æ“ä½œæ¯”è¾ƒå¤šçš„ä¸šåŠ¡åœºæ™¯\n\n\n\n\nä¼˜å…ˆä½¿ç”¨å…ˆæ›´æ–°æ•°æ®åº“å†åˆ é™¤ç¼“å­˜çš„æ–¹æ³•\n\n\n\nå…ˆåˆ é™¤ç¼“å­˜å¯èƒ½å¯¼è‡´è¯·æ±‚å› ç¼“å­˜ç¼ºå¤±è€Œè®¿é—®æ•°æ®åº“ï¼Œç»™æ•°æ®åº“å¸¦æ¥å‹åŠ›\n\n\n\n\nä¸šåŠ¡åº”ç”¨ä¸­è¯»å–æ•°æ®åº“å’Œå†™ç¼“å­˜çš„æ—¶é—´ä¸å¥½ä¼°ç®—ï¼Œæ‰€ä»¥å»¶è¿ŸåŒåˆ çš„ç­‰å¾…æ—¶é—´ä¸å¥½è®¾ç½®\n\n\næ³¨æ„ï¼šå¦‚æœè¦ä¿è¯æ•°æ®ä¸€è‡´ï¼Œå¯ä»¥åœ¨æ›´æ–°æ•°æ®åº“çš„æ—¶å€™åœ¨ Redis ç¼“å­˜å®¢æˆ·ç«¯æš‚å­˜å¹¶å‘è¯»è¯·æ±‚ï¼Œç­‰æ•°æ®åº“æ›´æ–°å®Œã€ç¼“å­˜å€¼åˆ é™¤åå†è¯»å–æ•°æ®\n\n\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/26ï½œç¼“å­˜å¼‚å¸¸ï¼ˆä¸‹ï¼‰ï¼šå¦‚ä½•è§£å†³ç¼“å­˜é›ªå´©ã€å‡»ç©¿ã€ç©¿é€éš¾é¢˜ï¼Ÿ":{"title":"26ï½œç¼“å­˜å¼‚å¸¸ï¼ˆä¸‹ï¼‰ï¼šå¦‚ä½•è§£å†³ç¼“å­˜é›ªå´©ã€å‡»ç©¿ã€ç©¿é€éš¾é¢˜ï¼Ÿ","links":[],"tags":["redis"],"content":"\n\nä¸‰å¤§é—®é¢˜çš„åŸå› å’Œåº”å¯¹æ–¹æ¡ˆ\n\n\n\n\n\n\n\nç¼“å­˜é›ªå´©\n\n\n\nå¤§é‡çš„åº”ç”¨è¯·æ±‚æ— æ³•åœ¨ Redis ç¼“å­˜ä¸­è¿›è¡Œå¤„ç†ï¼Œç´§æ¥ç€ï¼Œåº”ç”¨å°†å¤§é‡è¯·æ±‚å‘é€åˆ°æ•°æ®åº“å±‚ï¼Œå¯¼è‡´æ•°æ®åº“å±‚çš„å‹åŠ›æ¿€å¢ã€‚\n\n\n\n\n\nç¼“å­˜å‡»ç©¿\n\n\n\né’ˆå¯¹æŸä¸ªè®¿é—®éå¸¸é¢‘ç¹çš„çƒ­ç‚¹æ•°æ®çš„è¯·æ±‚ï¼Œæ— æ³•åœ¨ç¼“å­˜ä¸­è¿›è¡Œå¤„ç†ï¼Œç´§æ¥ç€ï¼Œè®¿é—®è¯¥æ•°æ®çš„å¤§é‡è¯·æ±‚ï¼Œä¸€ä¸‹å­éƒ½å‘é€åˆ°äº†åç«¯æ•°æ®åº“ï¼Œå¯¼è‡´äº†æ•°æ®åº“å‹åŠ›æ¿€å¢ï¼Œä¼šå½±å“æ•°æ®åº“å¤„ç†å…¶ä»–è¯·æ±‚ã€‚\nç¼“å­˜å‡»ç©¿çš„æƒ…å†µï¼Œç»å¸¸å‘ç”Ÿåœ¨çƒ­ç‚¹æ•°æ®è¿‡æœŸå¤±æ•ˆæ—¶ã€‚\n\n\n\n\n\nç¼“å­˜ç©¿é€\n\n\n\nè¦è®¿é—®çš„æ•°æ®æ—¢ä¸åœ¨ Redis ç¼“å­˜ä¸­ï¼Œä¹Ÿä¸åœ¨æ•°æ®åº“ä¸­ï¼Œå¯¼è‡´è¯·æ±‚åœ¨è®¿é—®ç¼“å­˜æ—¶ï¼Œå‘ç”Ÿç¼“å­˜ç¼ºå¤±ï¼Œå†å»è®¿é—®æ•°æ®åº“æ—¶ï¼Œå‘ç°æ•°æ®åº“ä¸­ä¹Ÿæ²¡æœ‰è¦è®¿é—®çš„æ•°æ®ã€‚\næ­¤æ—¶ç¼“å­˜æˆäº†æ‘†è®¾ã€‚\nåŒæ—¶ç»™ç¼“å­˜å’Œæ•°æ®åº“å·¨å¤§å‹åŠ›ã€‚\n\n\n\n\n\nå°½é‡ä½¿ç”¨é¢„é˜²å¼æ–¹æ¡ˆ\n\n1-1. ç»™ç¼“å­˜æ•°æ®çš„è¿‡æœŸæ—¶é—´åŠ ä¸Šå°çš„éšæœºæ•°\n1-5. Redis ç¼“å­˜ä¸»ä»é›†ç¾¤\n2-1. ä¸ç»™çƒ­ç‚¹æ•°æ®è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œä¸€ç›´ä¿ç•™\n3-3. è¯·æ±‚å…¥å£ç­¾åˆ°å¯¹è¯·æ±‚åˆæ³•æ€§è¿›è¡Œæ£€æŸ¥\n\n\n\n\n\nRedis çš„å¸ƒéš†è¿‡æ»¤å™¨\n\n\n\nä½¿ç”¨ String ç±»å‹å®ç°ï¼Œæ˜¯ä¸€ä¸ª bigkey\nå»ºè®®ä½¿ç”¨æ—¶å•ç‹¬éƒ¨ç½²ä¸€ä¸ªå®ä¾‹\nç›´æ¥é…ç½®å‚æ•°ä½¿ç”¨å³å¯\n4.0 æä¾›äº†å¸ƒéš†è¿‡æ»¤å™¨æ¨¡å—ï¼Œ4.0 ä»¥ä¸‹éœ€è¦å¼•å…¥ç¬¬ä¸‰æ–¹åº“\nåœ¨åˆ¤åˆ«æ•°æ®ä¸å­˜åœ¨æ—¶ï¼Œä¸å­˜åœ¨è¯¯åˆ¤ï¼Œä¸”é€Ÿåº¦éå¸¸å¿«\n\n\n\næ€è€ƒé¢˜ï¼šå¯ä»¥é‡‡ç”¨æœåŠ¡ç†”æ–­ã€æœåŠ¡é™çº§ã€è¯·æ±‚é™æµçš„æ–¹æ³•æ¥åº”å¯¹ç¼“å­˜ç©¿é€é—®é¢˜å—ï¼Ÿ\n\næ²¡å¿…è¦\n\n\nä¸‰ä¸ªæœºåˆ¶æ˜¯ä¸ºäº†è§£å†³ Redis å®ä¾‹æ²¡æœ‰èµ·åˆ°ç¼“å­˜å±‚ä½œç”¨çš„æƒ…å†µï¼Œç©¿é€å®è´¨æ˜¯æŸ¥è¯¢ç¼“å­˜å’Œæ•°æ®åº“ä¸­æ²¡æœ‰çš„æ•°æ®\n\n\n\n\nåœ¨ç©¿é€çš„åœºæ™¯ä¸‹ï¼Œé™¤éäººå·¥ä»‹å…¥ï¼Œå¦åˆ™æ— è®ºè¿‡å»å¤šä¹…éƒ½ä¸å¤ªå¯èƒ½è‡ªç„¶æ¢å¤\n\n\n\n\né—®é¢˜æ²¡æœ‰è§£å†³çš„åŒæ—¶é™ä½äº†ç”¨æˆ·ä½“éªŒ\n\n\n\n\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/27ï½œç¼“å­˜è¢«æ±¡æŸ“äº†ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ":{"title":"27ï½œç¼“å­˜è¢«æ±¡æŸ“äº†ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ","links":[],"tags":["redis"],"content":"\n\nç¼“å­˜æ±¡æŸ“\n\nç•™å­˜åœ¨ç¼“å­˜ä¸­çš„æ•°æ®ï¼Œå®é™…ä¸ä¼šè¢«å†æ¬¡è®¿é—®äº†ï¼Œä½†æ˜¯åˆå æ®äº†ç¼“å­˜ç©ºé—´ã€‚\nå¦‚æœè¿™æ ·çš„æ•°æ®ä½“é‡å¾ˆå¤§ï¼Œç”šè‡³å æ»¡äº†ç¼“å­˜ï¼Œæ¯æ¬¡æœ‰æ–°æ•°æ®å†™å…¥ç¼“å­˜æ—¶ï¼Œè¿˜éœ€è¦æŠŠè¿™äº›æ•°æ®é€æ­¥æ·˜æ±°å‡ºç¼“å­˜ï¼Œå°±ä¼šå¢åŠ ç¼“å­˜æ“ä½œçš„æ—¶é—´å¼€é”€ã€‚\n\n\n\nè§£å†³\n\n\nvolatile-ttl ç­–ç•¥ï¼šè®¾ç½®æ—¶éœ€æ˜ç¡®çŸ¥é“æ•°æ®è¢«å†æ¬¡è®¿é—®çš„æƒ…å†µæ—¶\n\n\nLRU ç¼“å­˜ç­–ç•¥ï¼šåªçœ‹æ•°æ®çš„è®¿é—®æ—¶é—´ï¼Œå¯èƒ½åœ¨å¯¹å¤§é‡æ•°æ®è¿›è¡Œä¸€æ¬¡å…¨ä½“è¯»å–åæ²¡èƒ½åŠæ—¶åˆ é™¤ç¼“å­˜æ•°æ®\n\n\nLFU ç¼“å­˜ç­–ç•¥\n\nåœ¨ LRU ç­–ç•¥åŸºç¡€ä¸Šï¼Œä¸ºæ¯ä¸ªæ•°æ®å¢åŠ ä¸€ä¸ªè®¡æ•°å™¨ï¼Œç”¨äºç»Ÿè®¡æ•°æ®çš„è®¿é—®æ¬¡æ•°\næ·˜æ±°æ•°æ®æ—¶ï¼Œé¦–å…ˆæ ¹æ®æ•°æ®çš„è®¿é—®æ¬¡æ•°è¿›è¡Œç­›é€‰\nå¦‚æœè®¿é—®æ¬¡æ•°ç›¸åŒï¼Œåˆ™æ¯”è¾ƒä¸¤ä¸ªæ•°æ®çš„è®¿é—®æ—¶æ•ˆæ€§\n\n\n\nLFU ä¸ LRU å®ç°çš„å¼‚åŒ\n\nLRU ä½¿ç”¨ 24bit å¤§å°çš„ lru å­—æ®µ\nLFU ä½¿ç”¨å‰ 16bit ä½œä¸º ldt å€¼ï¼Œè¡¨ç¤ºæ•°æ®çš„è®¿é—®æ—¶é—´æˆ³\nå 8bit ä½œä¸º counter å€¼ï¼Œè¡¨ç¤ºæ•°æ®çš„è®¿é—®æ¬¡æ•°ï¼ˆæœ€å¤§å€¼ 255ï¼‰\n\n\n\nLFU çš„è®¡æ•°è§„åˆ™\n\n\nå¢åŠ æœºåˆ¶\n\n\n\næ¯å½“æ•°æ®è¢«è®¿é—®ä¸€æ¬¡\n\n\n\n\nç”¨è®¡æ•°å™¨å½“å‰å€¼ * é…ç½®é¡¹ lfu_log_factorï¼Œå†åŠ  1ï¼Œå†å–å€’æ•°ï¼Œå¾—åˆ°ä¸€ä¸ª p å€¼\n\n\n\n\næŠŠ p å€¼å’Œä¸€ä¸ªå–å€¼èŒƒå›´å†ï¼ˆ0ï¼Œ1ï¼‰é—´çš„éšæœºæ•° r å€¼æ¯”å¤§å°\n\n\n\n\np å€¼å¤§äº r å€¼æ—¶ï¼Œè®¡æ•°å™¨åŠ  1\n\n\nè®¡æ•°å™¨é»˜è®¤å€¼ä¸º 5ï¼ˆç”±ä»£ç ä¸­çš„ LFU_INIT_VAL å¸¸é‡è®¾ç½®ï¼‰ï¼Œé¿å…æ•°æ®åˆšå†™å…¥å°±è¢«æ·˜æ±°\nä¸€èˆ¬å°† lfu_log_factor è®¾ç½®ä¸º 10 å°±å¯ä»¥å¯¹ç™¾ã€åƒã€åä¸‡çº§åˆ«çš„è®¿é—®æ¬¡æ•°åšæ˜æ˜¾åŒºåˆ†\n\n\n\nè¡°å‡æœºåˆ¶\n\n\n\nå‡è®¾è®¾ç½® lfu_decay_time å–å€¼ä¸º 1\n\n\n\n\nå¦‚æœæ•°æ®åœ¨ N åˆ†é’Ÿæ²¡æœ‰è¢«è®¿é—®\n\n\n\n\nè®¿é—®æ¬¡æ•°å‡ N\n\n\nå¦‚æœä¸šåŠ¡åº”ç”¨ä¸­æœ‰çŸ­æ—¶é«˜é¢‘è®¿é—®çš„æ•°æ®ï¼Œå»ºè®®æŠŠ lfu_decay_time è®¾ç½®ä¸º 1\n\n\n\n\n\nä½¿ç”¨ LFU ç­–ç•¥åï¼Œç¼“å­˜è¿˜ä¼šè¢«æ±¡æŸ“ï¼Œå› ä¸ºå­˜åœ¨å‚æ•°è®¾ç½®ä¸åˆç†çš„é—®é¢˜\n\nå¦‚è®¾ç½®å¤ªå¤§å¯¼è‡´è¡°å‡è¿‡æ…¢\næˆ–è€…ä¸€ä¸ªæ•°æ®åªåœ¨çŸ­æ—¶é—´å†…è¢«é«˜é¢‘è®¿é—®ï¼Œä¹Ÿæœ‰å¯èƒ½æ»ç•™åœ¨ç¼“å­˜ä¸­\n\n\n\n\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/28ï½œPikaï¼šå¦‚ä½•åŸºäº-SSD-å®ç°å¤§å®¹é‡-Redisï¼Ÿ":{"title":"28ï½œPikaï¼šå¦‚ä½•åŸºäº SSD å®ç°å¤§å®¹é‡ Redisï¼Ÿ","links":[],"tags":["redis"],"content":"\n\nåŸºäºå¤§å†…å­˜å®ç°å¤§å®¹é‡ Redis å®ä¾‹çš„æ½œåœ¨é—®é¢˜\n\n\n\nå†…å­˜å¿«ç…§ RDB ç”Ÿæˆå’Œæ¢å¤æ•ˆç‡ä½\n\n\n\n\nä¸»ä»èŠ‚ç‚¹å…¨é‡åŒæ­¥æ—¶é•¿å¢åŠ ã€ç¼“å†²åŒºæ˜“æº¢å‡º\n\n\n\n\n\nPika é”®å€¼æ•°æ®åº“\n\n\nPika è®¾è®¡ç›®æ ‡\n\nä¸€ã€å•å®ä¾‹å¯ä»¥ä¿å­˜å¤§å®¹é‡æ•°æ®ï¼ŒåŒæ—¶é¿å…å®ä¾‹æ¢å¤å’Œä¸»ä»åŒæ­¥æ—¶çš„æ½œåœ¨é—®é¢˜\näºŒã€å’Œ Redis æ•°æ®ç±»å‹ä¿æŒå…¼å®¹ï¼Œå¯ä»¥å¹³æ»‘è¿ç§»åˆ° Pika ä¸Š\n\n\n\næ•´ä½“æ¶æ„\n\n\n\n\n\n\nç½‘ç»œæ¡†æ¶\n\n\n\n\n\nPika çº¿ç¨‹æ¨¡å—\n\n\n\n\nå¤šçº¿ç¨‹\n\n\n\n\n\nä¸€ä¸ªè¯·æ±‚åˆ†å‘çº¿ç¨‹ DispatchThread\n\n\nä¸€ç»„å·¥ä½œçº¿ç¨‹ WorkerThread\n\n\nä¸€ä¸ªçº¿ç¨‹æ±  ThreadPool\n\n\n\n\n\n\nNemo å­˜å‚¨æ¨¡å—\n\n\n\n\nå®ç° Pika å’Œ Redis çš„æ•°æ®å…¼å®¹\n\n\nList\n\n\n\n\n\nSet\n\n\n\n\n\nHash\n\n\n\n\n\nSorted Set\n\n\n\n\n\n\n\nä¸ç”¨ä¿®æ”¹ä¸šåŠ¡åº”ç”¨ä¸­æ“ä½œ Redis çš„ä»£ç \n\n\n\n\n\n\nRocksDB\n\n\n\n\nRocksDB å†™å…¥æ•°æ®çš„åŸºæœ¬æµç¨‹\n\n\n\n\n\nåŸºäº SSD ä¿å­˜æ•°æ®\n\n\næ˜¯ä¸€ä¸ªæŒä¹…åŒ–é”®å€¼æ•°æ®åº“\n\n\nä¿å­˜æ•°æ®\n\n\nä½¿ç”¨ä¸¤å°å—å†…å­˜ç©ºé—´ Memtable1 å’Œ Memtable2 äº¤æ›¿ç¼“å­˜å†™å…¥çš„æ•°æ®\n\nå¤§å°å¯è®¾ç½®\nmax_write_buffer_number æ§åˆ¶å†™é™é€Ÿ\n\n\n\nå…¶ä¸­ä¸€å—å†™æ»¡åï¼ŒRocksDB æŠŠæ•°æ®ä»¥æ–‡ä»¶çš„å½¢å¼å¿«é€Ÿå†™å…¥åº•å±‚çš„ SSD\n\n\n\n\nè¯»å–æ•°æ®\n\nå…ˆåœ¨ Member ä¸­æŸ¥è¯¢ï¼ŒæŸ¥è¯¢ä¸åˆ°å†åˆ°æ•°æ®æ–‡ä»¶ä¸­æŸ¥è¯¢\n\n\n\né¿å…äº†å†…å­˜å¿«ç…§çš„ç”Ÿæˆå’Œæ¢å¤é—®é¢˜\n\n\nåœ¨æŠŠæ•°æ®å†™å…¥ Memtable æ—¶ï¼Œä¹Ÿä¼šæŠŠå‘½ä»¤æ“ä½œå†™åˆ° binlog æ–‡ä»¶ä¸­ã€‚\n\n\n\n\n\n\nbinlog æœºåˆ¶\n\n\n\nå®ç°å¢é‡å‘½ä»¤åŒæ­¥\nèŠ‚çœäº†å†…å­˜ï¼Œé¿å…ç¼“å†²åŒºæº¢å‡º\n\n\n\nå…¶ä»–ä¼˜åŠ¿\n\n\n\nå®ä¾‹é‡å¯å¿«\n\n\n\n\nä¸»ä»åº“æ‰§è¡Œå…¨é‡åŒæ­¥é£é™©ä½ï¼Œä¸å—å†…å­˜ç¼“å†²åŒºå¤§å°çš„é™åˆ¶\n\n\n\n\n\nä¸è¶³\n\n\n\n\næ€§èƒ½æ¯”ç”¨å†…å­˜ä½\n\n\n\nå¤šçº¿ç¨‹æ¨¡å‹ä¸€å®šç¨‹åº¦ä¸Šå¼¥è¡¥ä» SSD å­˜å–æ•°æ®é€ æˆçš„æ€§èƒ½æŸå¤±\n\n\n\n\nå†™ binlog æ—¶å½±å“æ€§èƒ½\n\n\n\n\n\né™ä½æ€§èƒ½å½±å“çš„å»ºè®®\n\n\n\nåˆ©ç”¨ Pika çš„å¤šçº¿ç¨‹æ¨¡å‹ï¼Œå¢åŠ çº¿ç¨‹æ•°é‡ï¼Œæå‡ Pika çš„å¹¶å‘è¯·æ±‚å¤„ç†èƒ½åŠ›\n\n\n\n\nä¸º Pika é…ç½®é«˜é…çš„ SSDï¼Œæå‡ SSD è‡ªèº«çš„è®¿é—®æ€§èƒ½\n\n\n\n\n\nå·¥å…·\n\nä½¿ç”¨ aof_to_pika å‘½ä»¤è¿ç§» Redis æ•°æ®åˆ° Pika ä¸­\nGithubï½œPika\n\n\n\n\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/29ï½œæ— é”çš„åŸå­æ“ä½œï¼šRedis-å¦‚ä½•åº”å¯¹å¹¶å‘è®¿é—®ï¼Ÿ":{"title":"29ï½œæ— é”çš„åŸå­æ“ä½œï¼šRedis å¦‚ä½•åº”å¯¹å¹¶å‘è®¿é—®ï¼Ÿ","links":[],"tags":["redis"],"content":"\n\nåŠ é”\n\n\nåŸå­æ“ä½œ\n\n\nå•å‘½ä»¤æ“ä½œ\n\nå¤šä¸ªæ“ä½œåœ¨ Redis ä¸­å®ç°æˆä¸€ä¸ªæ“ä½œï¼ˆå¦‚æ”¹æºç ï¼‰\nINCR/DECR å‘½ä»¤\n\n\n\nä»¥åŸå­æ€§æ–¹å¼æ‰§è¡Œ Lua è„šæœ¬\n\nredis-cli â€”eval {lua.script} {keys}, {args}\né¿å…æŠŠä¸éœ€è¦åšå¹¶å‘æ§åˆ¶çš„æ“ä½œå†™å…¥è„šæœ¬\n\n\n\n\n\nå¹¶å‘è®¿é—®ä¸­éœ€è¦æ§åˆ¶çš„æ“ä½œ\n\nè¯»å– - ä¿®æ”¹ - å†™å›æ“ä½œï¼ˆRMWï¼‰\n\n\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/30ï½œå¦‚ä½•ä½¿ç”¨-Redis-å®ç°åˆ†å¸ƒå¼é”ï¼Ÿ":{"title":"30ï½œå¦‚ä½•ä½¿ç”¨ Redis å®ç°åˆ†å¸ƒå¼é”ï¼Ÿ","links":[],"tags":["redis"],"content":"\n\nå•æœºç‰ˆ\n\nç”¨ä¸€ä¸ªå˜é‡è¡¨ç¤ºï¼š0 æ²¡æœ‰çº¿ç¨‹è·å–åˆ°é”ï¼›1 æœ‰çº¿ç¨‹è·å–åˆ°é”\n\n\n\nåˆ†å¸ƒå¼é”\n\n\né”å˜é‡éœ€è¦æœ‰ä¸€ä¸ªå…±äº«å­˜å‚¨ç³»ç»Ÿæ¥ç»´æŠ¤\n\n\nåŸºäºå•ä¸ªèŠ‚ç‚¹\n\n\nåŠ é”\n\n\n\n\nSET lock_key unique_value NX [EX seconds | PX milliseconds]\n\n\n\nkey ä¸å­˜åœ¨æ—¶ä¼šè¢«åˆ›å»º\nkey å­˜åœ¨ï¼Œä¸åšä»»ä½•èµ‹å€¼æ“ä½œ\nä¾‹ï¼šSET lock_key unique_value NX PX 10000\n\n\n\n\nåŠ é”æˆåŠŸåè®¾ç½®æœ‰æ•ˆæœŸ\n\n\n\n\nå°†ä¸Šè¿°æ“ä½œå†™è¿› Lua è„šæœ¬\n\n\n\n\n\né‡Šæ”¾é”\n\n\n\n\næ¯”è¾ƒé”å˜é‡çš„ unique_value æ˜¯å¦ç›¸ç­‰ï¼Œé¿å…è¯¯é‡Šæ”¾\n\n\n\nunique_valueï¼šéšæœºå€¼ï¼Œå”¯ä¸€ï¼Œå’Œå…¶ä»–å®¢æˆ·ç«¯ä½œåŒºåˆ†\n\n\n\n\n\nä½¿ç”¨ Lua è„šæœ¬ä¿è¯åŸå­æ€§\n\n\n\nä¾‹ï¼šredis-cli â€”eval unlock.script lock_key, unique_value\n\n\n\n\n\n\n\nåŸºäºå¤šä¸ªèŠ‚ç‚¹\n\n\nRedis çš„å¼€å‘è€… Antirez æå‡ºäº†åˆ†å¸ƒå¼é”ç®—æ³• Redlock\n\nåŸºæœ¬æ€è·¯ï¼šè®©å®¢æˆ·ç«¯å’Œå¤šä¸ªç‹¬ç«‹çš„ Redis å®ä¾‹ä¾æ¬¡è¯·æ±‚åŠ é”ï¼Œå¦‚æœå®¢æˆ·ç«¯èƒ½å¤Ÿå’ŒåŠæ•°ä»¥ä¸Šçš„å®ä¾‹æˆåŠŸåœ°å®ŒæˆåŠ é”æ“ä½œï¼Œå°±è®¤ä¸ºåŠ é”æˆåŠŸï¼Œå¦åˆ™åŠ é”å¤±è´¥\néœ€è¦é¿å…æœºå™¨å§‹ç»ˆå‘ç”Ÿè·³è·ƒï¼Œéœ€è¦è¿ç»´æ¥ä¿è¯ï¼Œå¦åˆ™å¯èƒ½ä¼šå¯¼è‡´ Redlock å¤±æ•ˆ\né€šå¸¸æ˜¯ 5 ä¸ª Redisï¼ˆéƒ½æ˜¯ Masterï¼‰ èŠ‚ç‚¹\nèƒ½ä¸ç”¨å°½é‡ä¸ç”¨\n\n\n\n\nå®¢æˆ·ç«¯è·å–å½“å‰æ—¶é—´\n\n\n\n\n\nå®¢æˆ·ç«¯æŒ‰é¡ºåºä¾æ¬¡å‘ N ä¸ª Redis å®ä¾‹æ‰§è¡ŒåŠ é”æ“ä½œ\n\n\n\nå’Œåœ¨å•å®ä¾‹ä¸Šæ‰§è¡Œçš„åŠ é”æ“ä½œä¸€æ ·\nè®¾ç½®è¶…æ—¶æ—¶é—´ï¼šè¿œè¿œå°äºé”çš„æœ‰æ•ˆæ—¶é—´ï¼Œå¦‚å‡ åæ¯«ç§’\n\n\n\n\n\nå®Œæˆå’Œæ‰€æœ‰ Redis å®ä¾‹çš„åŠ é”æ“ä½œåï¼Œå®¢æˆ·ç«¯è®¡ç®—æ•´ä¸ªåŠ é”è¿‡ç¨‹çš„æ€»è€—æ—¶ï¼Œæ»¡è¶³ä¸¤ä¸ªæ¡ä»¶æ‰ç®—æˆåŠŸ\n\n\n\n\na. å®¢æˆ·ç«¯ä»è¶…è¿‡åŠæ•°ï¼ˆå¤§äºç­‰äº N/2+1ï¼‰çš„ Redis å®ä¾‹ä¸ŠæˆåŠŸè·å–åˆ°äº†é”\n\n\nb. å®¢æˆ·ç«¯è·å–é”çš„æ€»è€—æ—¶æ²¡æœ‰è¶…è¿‡é”çš„æœ‰æ•ˆæ—¶é—´\n\n\næœªæ»¡è¶³æ¡ä»¶æ—¶ï¼Œå‘æ‰€æœ‰å®ä¾‹å‘èµ·é‡Šæ”¾é”çš„æ“ä½œ\n\nå³ä½¿æ˜¯åŠ é”å¤±è´¥çš„å®ä¾‹\n\n\n\n\n\n4 é‡æ–°è®¡ç®—è¿™æŠŠé”çš„æœ‰æ•ˆæ—¶é—´ï¼šæœ€åˆæœ‰æ•ˆæ—¶é—´ - å®¢æˆ·ç«¯è·å–é”çš„æ€»è€—æ—¶\n\n\n\nå¦‚æœé”çš„æœ‰æ•ˆæ—¶é—´å·²ç»ä¸å¤Ÿå®Œæˆå…±äº«æ•°æ®çš„æ“ä½œï¼Œå¯ä»¥ä¸»åŠ¨é‡Šæ”¾é”ï¼Œé¿å…æ²¡å®Œæˆæ•°æ®æ“ä½œï¼Œé”å°±è¿‡æœŸçš„æƒ…å†µ\n\n\n\n\n\nå¦‚æœä¸ºäº†æ•ˆç‡ï¼Œå¯ä»¥ä½¿ç”¨å•èŠ‚ç‚¹ï¼Œç¼ºç‚¹æ˜¯å…è®¸é”å¶å°”å¤±æ•ˆï¼Œä¼˜ç‚¹æ˜¯ç®€å•æ•ˆç‡é«˜\n\n\nä¸šåŠ¡å¯¹ç»“æœè¦æ±‚éå¸¸ä¸¥æ ¼ï¼Œä¸ºäº†æ­£ç¡®æ€§ï¼Œä½¿ç”¨ Redlockï¼Œç¼ºç‚¹æ˜¯æ¯”è¾ƒé‡ï¼Œéƒ¨ç½²æˆæœ¬é«˜\n\n\n\n\nè¿™ç¯‡æ–‡ç« è¯¦ç»†ä»‹ç»äº†äº‰è®º Redlock ç®—æ³•æ¶‰åŠçš„å¯é æ€§çš„ç»†èŠ‚ï¼Œä»¥åŠ Redis åˆ†å¸ƒå¼é”åœ¨å„ç§å¼‚å¸¸æƒ…å†µæ˜¯å¦å®‰å…¨çš„åˆ†æï¼Œæ”¶ç›Šä¼šéå¸¸å¤§ï¼šblog-redlock-reasoning.html\n\n\nåŸºäº ZooKeeper çš„åˆ†å¸ƒå¼é”\n\nä¸æ˜¯å”¯ä¸€çš„å®ç°æ–¹å¼\n\n\nå®¢æˆ·ç«¯å°è¯•åˆ›å»ºä¸€ä¸ª znode èŠ‚ç‚¹ï¼Œæ¯”å¦‚ /lockã€‚é‚£ä¹ˆç¬¬ä¸€ä¸ªå®¢æˆ·ç«¯å°±åˆ›å»ºæˆåŠŸäº†ï¼Œç›¸å½“äºæ‹¿åˆ°äº†é”ï¼›è€Œå…¶å®ƒçš„å®¢æˆ·ç«¯ä¼šåˆ›å»ºå¤±è´¥ï¼ˆznode å·²å­˜åœ¨ï¼‰ï¼Œè·å–é”å¤±è´¥\n\n\n\n\næŒæœ‰é”çš„å®¢æˆ·ç«¯è®¿é—®å…±äº«èµ„æºå®Œæˆåï¼Œå°† znode åˆ æ‰ï¼Œè¿™æ ·å…¶å®ƒå®¢æˆ·ç«¯æ¥ä¸‹æ¥å°±èƒ½æ¥è·å–é”äº†\n\n\n\n\nznode åº”è¯¥è¢«åˆ›å»ºæˆ ephemeral çš„ã€‚è¿™æ˜¯ znode çš„ä¸€ä¸ªç‰¹æ€§ï¼Œå®ƒä¿è¯å¦‚æœåˆ›å»º znode çš„é‚£ä¸ªå®¢æˆ·ç«¯å´©æºƒäº†ï¼Œé‚£ä¹ˆç›¸åº”çš„ znode ä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚è¿™ä¿è¯äº†é”ä¸€å®šä¼šè¢«é‡Šæ”¾\n\n\nZooKeeper ä¸€ä¸ªå¾ˆæœ‰ç”¨çš„ç‰¹æ€§æ˜¯ watch æœºåˆ¶ã€‚è¿™ä¸ªæœºåˆ¶å¯ä»¥è¿™æ ·æ¥ä½¿ç”¨ï¼Œæ¯”å¦‚å½“å®¢æˆ·ç«¯è¯•å›¾åˆ›å»º /lock çš„æ—¶å€™ï¼Œå‘ç°å®ƒå·²ç»å­˜åœ¨äº†ï¼Œè¿™æ—¶å€™åˆ›å»ºå¤±è´¥ï¼Œä½†å®¢æˆ·ç«¯ä¸ä¸€å®šå°±æ­¤å¯¹å¤–å®£å‘Šè·å–é”å¤±è´¥ã€‚å®¢æˆ·ç«¯å¯ä»¥è¿›å…¥ä¸€ç§ç­‰å¾…çŠ¶æ€ï¼Œç­‰å¾…å½“ /lock èŠ‚ç‚¹è¢«åˆ é™¤çš„æ—¶å€™ï¼ŒZooKeeper é€šè¿‡ watch æœºåˆ¶é€šçŸ¥å®ƒï¼Œè¿™æ ·å®ƒå°±å¯ä»¥ç»§ç»­å®Œæˆåˆ›å»ºæ“ä½œï¼ˆè·å–é”ï¼‰ã€‚è¿™å¯ä»¥è®©åˆ†å¸ƒå¼é”åœ¨å®¢æˆ·ç«¯ç”¨èµ·æ¥å°±åƒä¸€ä¸ªæœ¬åœ°çš„é”ä¸€æ ·ï¼šåŠ é”å¤±è´¥å°±é˜»å¡ä½ï¼Œç›´åˆ°è·å–åˆ°é”ä¸ºæ­¢ã€‚è¿™æ ·çš„ç‰¹æ€§ Redlock å°±æ— æ³•å®ç°\n\n\n\nå’Œ Redlock çš„ä¸åŒ\n\n\nä¼˜ç‚¹\n\n\n\nåœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯å¯ä»¥æŒæœ‰é”ä»»æ„é•¿çš„æ—¶é—´ï¼Œè¿™å¯ä»¥ç¡®ä¿å®ƒåšå®Œæ‰€æœ‰éœ€è¦çš„èµ„æºè®¿é—®æ“ä½œä¹‹åå†é‡Šæ”¾é”ã€‚è¿™é¿å…äº†åŸºäº Redis çš„é”å¯¹äºæœ‰æ•ˆæ—¶é—´ï¼ˆlock validity timeï¼‰åˆ°åº•è®¾ç½®å¤šé•¿çš„ä¸¤éš¾é—®é¢˜ã€‚å®é™…ä¸Šï¼ŒåŸºäº ZooKeeper çš„é”æ˜¯ä¾é  Sessionï¼ˆå¿ƒè·³ï¼‰æ¥ç»´æŒé”çš„æŒæœ‰çŠ¶æ€çš„ï¼Œè€Œ Redis ä¸æ”¯æŒ Session\n\n\n\n\nåŸºäº ZooKeeper çš„é”æ”¯æŒåœ¨è·å–é”å¤±è´¥ä¹‹åç­‰å¾…é”é‡æ–°é‡Šæ”¾çš„äº‹ä»¶ã€‚è¿™è®©å®¢æˆ·ç«¯å¯¹é”çš„ä½¿ç”¨æ›´åŠ çµæ´»\n\n\n\n\n\nç¼ºç‚¹\n\n\n\næ€§èƒ½ä¸å¦‚ Redis\n\n\n\n\n\n\n\næ­¤å®ç°å¹¶ä¸æ˜¯æœ€ä¼˜çš„ï¼Œä¼šå¼•å‘â€œherd effectâ€ï¼ˆç¾Šç¾¤æ•ˆåº”ï¼‰ï¼Œé™ä½è·å–é”çš„æ€§èƒ½\n\n\nä¸€ä¸ªæ›´å¥½çš„å®ç°\n\nrecipes.html#sc_recipes_Locks\n\n\n\n\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/31ï½œäº‹åŠ¡æœºåˆ¶ï½œRedis-èƒ½å®ç°-ACID-å±æ€§å—ï¼Ÿ":{"title":"31ï½œäº‹åŠ¡æœºåˆ¶ï½œRedis èƒ½å®ç° ACID å±æ€§å—ï¼Ÿ","links":[],"tags":["redis"],"content":"\n\näº‹åŠ¡å‘½ä»¤\n\n\nMULTI\n\nå¼€å¯ä¸€ä¸ªäº‹åŠ¡\n\n\n\nEXEC\n\næäº¤äº‹åŠ¡ï¼Œä»å‘½ä»¤é˜Ÿåˆ—ä¸­å»é™¤æäº¤çš„æ“ä½œå‘½ä»¤ï¼Œè¿›è¡Œå®é™…æ‰§è¡Œ\n\n\n\nDISCARD\n\n\næ”¾å¼ƒä¸€ä¸ªäº‹åŠ¡ï¼Œæ¸…ç©ºå‘½ä»¤é˜Ÿåˆ—\n\nåªæ˜¯æ¸…ç©ºï¼Œèµ·ä¸åˆ°å›æ»šçš„ä½œç”¨\n\n\n\n\n\nWATCH\n\næ£€æµ‹ä¸€ä¸ªæˆ–å¤šä¸ªé”®çš„å€¼åœ¨äº‹åŠ¡æ‰§è¡ŒæœŸé—´æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œå¦‚æœå‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆå½“å‰äº‹åŠ¡æ”¾å¼ƒæ‰§è¡Œ\n\n\n\n\n\n\n\n\n\nRedis çš„äº‹åŠ¡æœºåˆ¶\n\n\nå¯ä»¥ä¿è¯ä¸€è‡´æ€§å’Œéš”ç¦»æ€§ï¼Œæ— æ³•ä¿è¯æŒä¹…æ€§ï¼ˆéå¿…è¦ï¼‰\n\n\nåŸå­æ€§\n\n\nå‘½ä»¤è¯­æ³•æœ‰è¯¯æ—¶ï¼Œå¾—ä¸åˆ°ä¿è¯\n\nä¸å­˜åœ¨çš„å‘½ä»¤ä¸€å¼€å§‹å°±ä¼šè¢«è®°å½•é”™è¯¯\næ— æ³•å¾—åˆ°ä¿è¯çš„åŸå› ï¼šå‘½ä»¤å’Œæ“ä½œçš„æ•°æ®ç±»å‹ä¸åŒ¹é…ï¼Œä½† Redis å®ä¾‹æ²¡æ£€æŸ¥å‡ºé”™è¯¯å¹¶å¼€å§‹æ‰§è¡Œ\né¢„é˜²å»ºè®®ï¼šä¸¥æ ¼æŒ‰ç…§ Redis çš„å‘½ä»¤è§„èŒƒè¿›è¡Œç¨‹åºå¼€å‘ï¼Œå¹¶ä¸”é€šè¿‡ code review ç¡®ä¿å‘½ä»¤çš„æ­£ç¡®æ€§\n\n\n\nå®ä¾‹å‘ç”Ÿæ•…éšœï¼Œä¸” Redis ä½¿ç”¨äº† RDB æœºåˆ¶\n\nRDB ä¸ä¼šåœ¨äº‹åŠ¡æ‰§è¡Œæ—¶æ‰§è¡Œï¼Œä¹Ÿå°±ä¸ä¼šè®°å½•ä¸‹äº‹åŠ¡æ‰§è¡Œäº†ä¸€éƒ¨åˆ†çš„ç»“æœ\nå­˜åœ¨ä¸€ç§æƒ…å†µæ— æ³•ä¿è¯åŸå­æ€§ï¼šå¦‚æœäº‹åŠ¡æ‰§è¡Œå®Œæˆï¼Œè¿˜æ²¡æ‰§è¡Œ RDB å¿«ç…§ï¼Œæ­¤æ—¶å‘ç”Ÿæ•…éšœï¼Œä¼šä¸¢å¤±äº‹åŠ¡ä¿®æ”¹çš„æ•°æ®\n\n\n\nå…¶ä»–æƒ…å†µï¼Œäº‹åŠ¡éƒ½å¯ä»¥åŸå­æ€§æ‰§è¡Œ\n\n\nå‰æï¼šæ‰§è¡Œäº‹åŠ¡çš„ EXEC å‘½ä»¤æ—¶ï¼ŒRedis å®ä¾‹å‘ç”Ÿäº†æ•…éšœï¼Œå¯¼è‡´äº‹åŠ¡æ‰§è¡Œå¤±è´¥\n\n\nå¼€å¯ AOF æ—¥å¿—\n\n\n\nåªä¼šæœ‰éƒ¨åˆ†çš„äº‹åŠ¡æ“ä½œè¢«è®°å½•åˆ° AOF æ—¥å¿—ä¸­\n\n\n\n\nä½¿ç”¨ redis-check-aof å·¥å…·æ£€æŸ¥ AOF æ—¥å¿—æ–‡ä»¶\n\n\n\n\nå·¥å…·ä¼šæŠŠæœªå®Œæˆçš„äº‹åŠ¡æ“ä½œä» AOF æ—¥å¿—ä¸­å»é™¤\n\n\n\n\nè¿™æ—¶å†ä½¿ç”¨ AOF æ¢å¤å®ä¾‹ï¼Œå¤±è´¥çš„äº‹åŠ¡æ“ä½œä¸ä¼šå†è¢«æ‰§è¡Œ\n\n\n\n\n\n\n\n\n\n\n\näº‹åŠ¡ä½¿ç”¨å»ºè®®\n\n\n\n\né…åˆ Pipeline ä½¿ç”¨\n\n\n\néš”ç¦»æ€§ç”±æœåŠ¡ç«¯ä¿è¯ï¼Œæ­¤æ—¶ä¸éœ€è¦ä½¿ç”¨ WATCH\n\n\n\n\n\nWATCH çš„ä½¿ç”¨åœºæ™¯\n\n\n\nWATCH keyï¼Œè¯»å– keyï¼Œä¿®æ”¹ keyï¼Œå†™å›\n\n\n\n\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/32ï½œRedis-ä¸»ä»åŒæ­¥ä¸æ•…éšœåˆ‡æ¢ï¼Œæœ‰å“ªäº›å‘ï¼Ÿ":{"title":"32ï½œRedis ä¸»ä»åŒæ­¥ä¸æ•…éšœåˆ‡æ¢ï¼Œæœ‰å“ªäº›å‘ï¼Ÿ","links":[],"tags":["redis"],"content":"\n\n\n\nä¸»ä»æ•°æ®ä¸ä¸€è‡´\n\n\n\n\nå› ä¸ºä¸»ä»æ•°æ®æ˜¯å¼‚æ­¥å¤åˆ¶\n\n\naï¼‰ä½¿ç”¨å¤–éƒ¨ç›‘æ§ç¨‹åºå¯¹æ¯”ä¸»ä»åº“å¤åˆ¶è¿›åº¦ï¼Œä¸è®©å®¢æˆ·ç«¯ä»è½åçš„ä»åº“ä¸­è¯»å–æ•°æ®\n\n\nå¼€å‘ä¸€ä¸ªå·¥å…·ï¼š\n\n\nåŸºäº INFO replication å‘½ä»¤æŸ¥çœ‹ä¸»åº“æ¥æ”¶å†™å‘½ä»¤çš„è¿›åº¦ä¿¡æ¯ï¼ˆmaster_repl_offsetï¼‰å’Œä»åº“å¤åˆ¶å†™å‘½ä»¤çš„è¿›åº¦ä¿¡æ¯ï¼ˆslave_repl_offsetï¼‰\n\n\næ¯”è¾ƒä¸¤è€…å¤§å°ï¼Œå¤§äºæˆ‘ä»¬é¢„è®¾çš„é˜ˆå€¼åˆ™ä¸è®©å®¢æˆ·ç«¯å’Œæ­¤ä»åº“è¿æ¥\n\n\n\n\nbï¼‰ä¿è¯ä¸»ä»é—´çš„ç½‘ç»œé“¾æ¥çŠ¶å†µè‰¯å¥½\n\n\n\n\n\n\n\n\nè¯»åˆ°è¿‡æœŸæ•°æ®\n\n\n\n\nRedis åŒæ—¶ä½¿ç”¨ä¸¤ç§ç­–ç•¥åˆ é™¤è¿‡æœŸçš„æ•°æ®\n\n\næƒ°æ€§åˆ é™¤\n\n\nå½“ä¸€ä¸ªæ•°æ®è¿‡æœŸæ—¶é—´åˆ°äº†ä¹‹åï¼Œä¸ä¼šç«‹å³åˆ é™¤æ•°æ®ï¼Œç­‰åˆ°å†æœ‰è¯·æ±‚è¯»å†™è¿™ä¸ªæ•°æ®æ—¶ï¼Œæ£€æŸ¥å‘ç°è¿‡æœŸå†åˆ é™¤\n\n\nå¥½å¤„æ˜¯å¯¹äºç”¨ä¸åˆ°çš„æ•°æ®ï¼Œä¸æµªè´¹æ—¶é—´è¿›è¡Œæ£€æŸ¥å’Œåˆ é™¤\n\n\nä¼šå¯¼è‡´å¤§é‡å·²è¿‡æœŸæ•°æ®ç•™å­˜åœ¨å†…å­˜ä¸­\n\nè€Œä¸”ï¼Œä»åº“æœ¬èº«ä¸ä¼šæ‰§è¡Œåˆ é™¤æ“ä½œï¼Œåªèƒ½åŒæ­¥ä¸»åº“çš„åˆ é™¤æ“ä½œï¼Œæ‰€ä»¥ä¸»åº“å¯èƒ½å·²ç»è‡ªåŠ¨åˆ é™¤çš„æ•°æ®ï¼Œåœ¨ä»åº“è¿˜æœ‰ç•™å­˜\n\n\n\n\n\nå®šæœŸåˆ é™¤\n\nRedis æ¯éš”ä¸€æ®µæ—¶é—´ï¼ˆé»˜è®¤ 100msï¼‰éšæœºé€‰å‡ºä¸€å®šæ•°é‡çš„æ•°æ®ï¼Œåˆ é™¤å…¶ä¸­è¿‡æœŸçš„æ•°æ®\n\n\n\n\n\nRedis 3.2 ä¹‹å‰ï¼Œæ•°æ®è¿‡æœŸä½†æœªåˆ é™¤æ—¶ï¼Œä¼šè¢«è¯»å–ï¼Œä¹‹åçš„ç‰ˆæœ¬ä¼šæ£€æŸ¥è¿‡æœŸï¼Œè¿”å›ç©ºå€¼\n\n\nEXPIRE å’Œ PEXPIREï¼šç»™æ•°æ®è®¾ç½®çš„æ˜¯ä»å‘½ä»¤æ‰§è¡Œæ—¶å¼€å§‹è®¡ç®—çš„å­˜æ´»æ—¶é—´\n\nåŠ ä¸Šä¸»ä»èŠ‚ç‚¹æ‰§è¡Œå‘½ä»¤çš„æ—¶é—´ä¸ä¸€è‡´ï¼Œå¯¼è‡´æ•°æ®çš„è¿‡æœŸæ—¶é—´ä¸ä¸€è‡´\n\n\n\nEXPIREAT å’Œ PEXPIREATï¼šç›´æ¥æŠŠæ•°æ®çš„è¿‡æœŸæ—¶é—´è®¾ç½®ä¸ºå…·ä½“çš„ä¸€ä¸ªæ—¶é—´ç‚¹\n\nä¸šåŠ¡ä¸­ä½¿ç”¨è¿™ä¸ª\nä¸€å®šè¦ä¿è¯ä¸»ä»èŠ‚ç‚¹çš„æ—¶é’Ÿä¸€è‡´\n\n\n\n\n\n\n\nä¸åˆç†é…ç½®é¡¹å¯¼è‡´æœåŠ¡æŒ‚æ‰\n\n\n\n\n\n\nprotected-mode\n\n\n\nè®¾ç½®å“¨å…µå®ä¾‹èƒ½å¦è¢«å…¶ä»–æœåŠ¡å™¨è®¿é—®\nå½“è®¾ç½®ä¸º yesï¼Œè€Œå…¶ä½™å“¨å…µå®ä¾‹éƒ¨ç½²åœ¨å…¶å®ƒæœåŠ¡å™¨ï¼Œè¿™äº›å“¨å…µå®ä¾‹é—´å°±æ— æ³•é€šä¿¡ã€‚å½“ä¸»åº“æ•…éšœæ—¶ï¼Œå“¨å…µæ— æ³•åˆ¤æ–­ä¸»åº“ä¸‹çº¿ï¼Œä¹Ÿæ— æ³•è¿›è¡Œä¸»ä»åˆ‡æ¢ï¼Œæœ€ç»ˆ Redis æœåŠ¡ä¸å¯ç”¨\nåº”è¯¥è®¾ç½®ä¸º noï¼Œå¹¶è®¾ç½®ç™½åå•\n\n\n\n\n\ncluster-node-timeout é…ç½®ä¸åˆç†\n\n\n\nè®¾ç½®äº† Redis Cluster ä¸­å®ä¾‹å“åº”å¿ƒè·³æ¶ˆæ¯çš„è¶…æ—¶æ—¶é—´\nè°ƒå¤§äº›ï¼Œä¾‹å¦‚ä¸º 10 åˆ° 20 ç§’\n\n\n\n\n\n\n\nä¸»ä»åº“çš„ mexmemory ä¸åŒ\n\n\n\nä¸€å®šè¦ç›¸åŒ\n\n\n\n\n\nå…¶ä»–å»ºè®®\n\n\n\n\nslave-serve-stale-data é…ç½®é¡¹è®¾ç½®ä»åº“èƒ½å¦å¤„ç†æ•°æ®è¯»å†™å‘½ä»¤ï¼Œno æ—¶ï¼Œä»åº“åªèƒ½æœåŠ¡ INFOã€SLAVEOF å‘½ä»¤ï¼Œå¯ä»¥é¿å…åœ¨ä»åº“ä¸­è¯»åˆ°ä¸ä¸€è‡´çš„æ•°æ®\n\n\nä¸è¦è®©ä»åº“å¯ä»¥å¤„ç†å†™è¯·æ±‚\n\nslave-read-only è®¾ç½®ä¸º yesï¼Œä»åº“ä¸èƒ½å¤„ç†å†™è¯·æ±‚ï¼Œä½†è¿˜èƒ½è¯»\n\n\n\n\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/33ï½œè„‘è£‚ï¼šä¸€æ¬¡å¥‡æ€ªçš„æ•°æ®ä¸¢å¤±":{"title":"33ï½œè„‘è£‚ï¼šä¸€æ¬¡å¥‡æ€ªçš„æ•°æ®ä¸¢å¤±","links":[],"tags":["redis"],"content":"\n\nè„‘è£‚ï¼šæŒ‡åœ¨ä¸»ä»é›†ç¾¤ä¸­ï¼ŒåŒæ—¶æœ‰ä¸¤ä¸ªä¸»èŠ‚ç‚¹ï¼Œéƒ½èƒ½æ¥æ”¶å†™è¯·æ±‚\n\n\nå›¾ 1\n\n\n\n\n\nå›¾ 2\n\n\n\n\n\n\n\nå½±å“ï¼šå®¢æˆ·ç«¯ä¸çŸ¥é“è¯¥å¾€å“ªä¸ªä¸»èŠ‚ç‚¹å†™å…¥æ•°æ®ï¼Œç»“æœä¸åŒå®¢æˆ·ç«¯å¾€ä¸åŒçš„ä¸»èŠ‚ç‚¹å†™æ•°æ®ï¼Œä¸¥é‡çš„ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±\n\n\næ•°æ®ä¸¢å¤±æ’æŸ¥è¿‡ç¨‹\n\n\n\n\nç¡®è®¤æ˜¯ä¸æ˜¯æ•°æ®åŒæ­¥å‡ºç°é—®é¢˜\n\n\n\nä¸»åº“çš„æ•°æ®æœªåŒæ­¥åˆ°ä»åº“ä¸”å‘ç”Ÿäº†æ•…éšœï¼Œä»åº“å‡çº§ä¸ºä¸»åº“ï¼ŒæœªåŒæ­¥çš„æ•°æ®ä¸¢å¤±\nå¯ä»¥é€šè¿‡è®¡ç®— master_repl_offset å’Œ slave_repl_offset çš„å·®å€¼åšåˆ¤æ–­\n\n\n\n\n\næ’æŸ¥å®¢æˆ·ç«¯çš„æ“ä½œæ—¥å¿—ï¼Œå‘ç°è„‘è£‚ç°è±¡\n\n\n\nåœ¨ä¸»ä»åˆ‡æ¢åçš„ä¸€æ®µæ—¶é—´å†…ï¼Œæœ‰å®¢æˆ·ç«¯ä»ç„¶åœ¨å’ŒåŸä¸»åº“é€šä¿¡ï¼Œå¹¶æ²¡æœ‰å’Œå‡çº§çš„æ–°ä¸»åº“è¿›è¡Œäº¤äº’\n\n\n\n\n\nåŸä¸»åº“å‡æ•…éšœå¯¼è‡´çš„è„‘è£‚\n\né‡‡ç”¨å“¨å…µæœºåˆ¶ï¼Œå¦‚æœè¶…è¿‡é¢„è®¾æ•°é‡çš„å“¨å…µå®ä¾‹å’Œä¸»åº“çš„å¿ƒè·³éƒ½è¶…æ—¶ï¼Œæ‰ä¼šæŠŠä¸»åº“åˆ¤æ–­ä¸ºå®¢è§‚ä¸‹é™ï¼Œç„¶åå“¨å…µå¼€å§‹æ‰§è¡Œä¸»ä»åˆ‡æ¢ï¼Œåˆ‡æ¢å®Œæˆåå®¢æˆ·ç«¯ä¼šå’Œæ–°ä¸»åº“é€šä¿¡\nå’Œä¸»åº“éƒ¨ç½²åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šçš„å…¶ä»–ç¨‹åºä¸´æ—¶å ç”¨äº†å¤§é‡èµ„æºï¼ˆä¾‹å¦‚ CPU èµ„æºï¼‰ï¼Œå¯¼è‡´ä¸»åº“èµ„æºä½¿ç”¨å—é™ï¼ŒçŸ­æ—¶é—´å†…æ— æ³•å“åº”å¿ƒè·³ã€‚å…¶å®ƒç¨‹åºä¸å†ä½¿ç”¨èµ„æºæ—¶ï¼Œä¸»åº“åˆæ¢å¤æ­£å¸¸\nä¸»åº“è‡ªèº«é‡åˆ°äº†é˜»å¡çš„æƒ…å†µï¼Œä¾‹å¦‚ï¼Œå¤„ç† bigkey æˆ–æ˜¯å‘ç”Ÿå†…å­˜ swapï¼ˆå¤ä¹ ä¸‹ç¬¬ 19 è®²ä¸­æ€»ç»“çš„å¯¼è‡´å®ä¾‹é˜»å¡çš„åŸå› ï¼‰ï¼ŒçŸ­æ—¶é—´å†…æ— æ³•å“åº”å¿ƒè·³ï¼Œç­‰ä¸»åº“é˜»å¡è§£é™¤åï¼Œåˆæ¢å¤æ­£å¸¸çš„è¯·æ±‚å¤„ç†äº†\n\n\n\nè„‘è£‚åº”å¯¹æ–¹æ¡ˆ\n\n\nmin-slaves-to-writeï¼šè®¾ç½®ä¸»åº“èƒ½è¿›è¡Œæ•°æ®åŒæ­¥çš„æœ€å°‘ä»åº“æ•°é‡\n\n\nmin-slaves-max-lagï¼šè®¾ç½®ä¸»ä»åº“é—´è¿›è¡Œæ•°æ®å¤åˆ¶æ—¶ï¼Œä»åº“ç»™ä¸»åº“å‘é€ ACK æ¶ˆæ¯çš„æœ€å¤§å»¶è¿Ÿï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰\n\n\næ­é…ä¸¤ä¸ªé…ç½®é¡¹ï¼Œå‡è®¾ä¸º N å’Œ Tï¼Œä¸»åº“è¿æ¥çš„ä»åº“ä¸­è‡³å°‘æœ‰ N ä¸ªä»åº“ï¼Œå’Œä¸»åº“è¿›è¡Œæ•°æ®å¤åˆ¶æ—¶çš„ ACK æ¶ˆæ¯å»¶è¿Ÿä¸èƒ½è¶…è¿‡ T ç§’ï¼Œå¦åˆ™ï¼Œä¸»åº“å°±ä¸ä¼šå†æ¥æ”¶å®¢æˆ·ç«¯çš„è¯·æ±‚\n\nåªæ˜¯å‡å°‘æ•°æ®çš„ä¸¢å¤±\n\n\n\nå»ºè®®ï¼šå‡è®¾ä»åº“æœ‰ K ä¸ªï¼Œå°† min-slaves-to-write è®¾ç½®ä¸º K/2+1ï¼ˆå¦‚æœ K = 1ï¼Œå°±è®¾ä¸º 1ï¼‰ï¼Œå°† min-slaves-max-lag è®¾ç½®ä¸ºåå‡ ç§’ï¼ˆå¦‚ 10ï½20sï¼‰ï¼Œåœ¨è¿™ä¸ªé…ç½®ä¸‹ï¼Œå¦‚æœæœ‰ä¸€åŠä»¥ä¸Šçš„ä»åº“å’Œä¸»åº“è¿›è¡Œçš„ ACK æ¶ˆæ¯å»¶è¿Ÿè¶…è¿‡åå‡ ç§’ï¼Œæˆ‘ä»¬å°±ç¦æ­¢ä¸»åº“æ¥æ”¶å®¢æˆ·ç«¯å†™è¯·æ±‚\n\n\n\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/35ï½œCodis-VS-Redis-Clusterï¼šæˆ‘è¯¥é€‰æ‹©å“ªä¸€ä¸ªé›†ç¾¤æ–¹æ¡ˆï¼Ÿ":{"title":"35ï½œCodis VS Redis Clusterï¼šæˆ‘è¯¥é€‰æ‹©å“ªä¸€ä¸ªé›†ç¾¤æ–¹æ¡ˆï¼Ÿ","links":[],"tags":["redis"],"content":"\n\nCodis é›†ç¾¤\n\n\nCodis é›†ç¾¤çš„æ¶æ„å’Œå…³é”®ç»„ä»¶å›¾\n\n\n\n\n\ncodis server\n\nè¿›è¡Œäº†äºŒæ¬¡å¼€å‘çš„ Redis å®ä¾‹ï¼Œå…¶ä¸­å¢åŠ äº†é¢å¤–çš„æ•°æ®ç»“æ„ï¼Œæ”¯æŒæ•°æ®è¿ç§»æ“ä½œï¼Œä¸»è¦è´Ÿè´£å¤„ç†å…·ä½“çš„æ•°æ®è¯»å†™è¯·æ±‚\n\n\n\ncodis proxy\n\næ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚ï¼Œå¹¶æŠŠè¯·æ±‚è½¬å‘ç»™ codis server\n\n\n\nZookeeper é›†ç¾¤\n\n\nä¿å­˜é›†ç¾¤å…ƒæ•°æ®ï¼Œä¾‹å¦‚æ•°æ®ä½ç½®ä¿¡æ¯å’Œ codis proxy ä¿¡æ¯\n\n\nä¹Ÿå¯ä»¥æ¢ç”¨ etcd æˆ–æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¿å­˜å…ƒæ•°æ®ä¿¡æ¯\n\netcd æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼é”®å€¼å¯¹å­˜å‚¨\n\n\n\n\n\ncodis dashboard å’Œ codis fe\n\nå…±åŒç»„æˆé›†ç¾¤ç®¡ç†å·¥å…·\ncodis dashboard è´Ÿè´£æ‰§è¡Œé›†ç¾¤ç®¡ç†å·¥ä½œï¼ŒåŒ…æ‹¬å¢åˆ  codis serverã€codis proxy å’Œè¿›è¡Œæ•°æ®è¿ç§»\ncodis fe è´Ÿè´£æä¾› dashboard çš„ Web æ“ä½œç•Œé¢ï¼Œä¾¿äºè¿›è¡Œé›†ç¾¤ç®¡ç†\n\n\n\n\n\nCodis å¤„ç†è¯·æ±‚\n\n\n\nå…ˆä½¿ç”¨ codis dashboard è®¾ç½® codis server å’Œ codis proxy çš„è®¿é—®åœ°å€\n\n\n\n\nå®¢æˆ·ç«¯ç›´æ¥å’Œ proxy å»ºç«‹è¿æ¥ï¼Œä¸ç”¨ä¿®æ”¹å®¢æˆ·ç«¯ï¼Œå’Œè®¿é—®å•å®ä¾‹ Redis æ²¡åŒºåˆ«\n\n\n\n\nproxy æ¥æ”¶åˆ°è¯·æ±‚ï¼ŒæŸ¥è¯¢è¯·æ±‚æ•°æ®å’Œ codis server çš„æ˜ å°„å…³ç³»ï¼Œè½¬ç»™ç›¸åº”çš„ server å¤„ç†ï¼Œæœ€åé€šè¿‡ proxy æŠŠæ•°æ®è¿”å›ç»™å®¢æˆ·ç«¯\n\n\nå¤„ç†æµç¨‹å›¾\n\n\n\n\n\n\n\nCodis å…³é”®æŠ€æœ¯åŸç†\n\n\né›†ç¾¤é‡Œçš„æ•°æ®åˆ†å¸ƒ\n\n\n\n\né›†ç¾¤ä¸€å…±æœ‰ 1024 ä¸ª Slotï¼Œç¼–å·ä¾æ¬¡æ˜¯ 0 åˆ° 1023\n\n\n\nå¯ä»¥æ‰‹åŠ¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ codis dashboard è¿›è¡Œè‡ªåŠ¨åˆ†é…\n\n\n\n\n\nå®¢æˆ·ç«¯è¦è¯»å†™æ•°æ®æ—¶ï¼Œä½¿ç”¨ CRC32 ç®—æ³•è®¡ç®—æ•°æ® key çš„å“ˆå¸Œå€¼ï¼ŒæŠŠå“ˆå¸Œå€¼å¯¹ 1024 å–æ¨¡å¾—åˆ°å¯¹åº” Slot çš„ç¼–å·\n\n\n\nCRC32(key) % 1024 = n\n\n\n\n\nå³å¯çŸ¥é“æ•°æ®ä¿å­˜åœ¨å“ªä¸ª server ä¸Š\n\n\n\n\n\næ•°æ®è·¯ç”±è¡¨\n\næŒ‡ Slot å’Œ codis server çš„æ˜ å°„å…³ç³»\nåœ¨ codis dashboard åˆ†é…å¥½è·¯ç”±è¡¨åä¼šæŠŠè·¯ç”±è¡¨å‘é€ç»™ codis proxyï¼ŒåŒæ—¶ä¹Ÿä¼šä¿å­˜åœ¨ Zookeeper ä¸­ï¼Œcodis proxy ä¼šæŠŠè·¯ç”±è¡¨ç¼“å­˜åœ¨æœ¬åœ°\nè·¯ç”±è¡¨çš„åˆ†é…å’Œä½¿ç”¨è¿‡ç¨‹\n\n\n\n\n\n\n\né›†ç¾¤æ‰©å®¹å’Œæ•°æ®è¿ç§»\n\n\nå¢åŠ  codis server\n\n\n\nå¯åŠ¨æ–°çš„ codis serverï¼Œå°†å®ƒåŠ å…¥é›†ç¾¤\n\n\n\n\n\næŠŠéƒ¨åˆ†æ•°æ®è¿ç§»åˆ°æ–°çš„ server\n\n\n\n\nCodis é›†ç¾¤æŒ‰ç…§ Slot çš„ç²’åº¦è¿›è¡Œæ•°æ®è¿ç§»\n\n\n\n\n\n\nåœ¨æº server ä¸Šï¼ŒCodis ä»è¦è¿ç§»çš„ Slot ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªæ•°æ®ï¼Œå‘é€ç»™ç›®çš„ server\n\n\n\n\nç›®çš„ server ç¡®è®¤æ”¶åˆ°æ•°æ®åï¼Œä¼šç»™æº server è¿”å›ç¡®è®¤æ¶ˆæ¯ã€‚è¿™æ—¶ï¼Œæº server ä¼šåœ¨æœ¬åœ°å°†åˆšæ‰è¿ç§»çš„æ•°æ®åˆ é™¤\n\n\n\n\nç¬¬ä¸€æ­¥å’Œç¬¬äºŒæ­¥å°±æ˜¯å•ä¸ªæ•°æ®çš„è¿ç§»è¿‡ç¨‹ã€‚Codis ä¼šä¸æ–­é‡å¤è¿™ä¸ªè¿ç§»è¿‡ç¨‹ï¼Œç›´åˆ°è¦è¿ç§»çš„ Slot ä¸­çš„æ•°æ®å…¨éƒ¨è¿ç§»å®Œæˆ\n\n\n\næ”¯æŒä¸¤ç§è¿ç§»æ¨¡å¼\n\n\nåŒæ­¥è¿ç§»\n\né˜»å¡ï¼Œæ­¤æ—¶æº server æ— æ³•å¤„ç†æ–°çš„è¯·æ±‚æ“ä½œ\n\n\n\nå¼‚æ­¥è¿ç§»\n\n\néé˜»å¡ï¼Œè¿ç§»çš„æ•°æ®ä¼šè¢«è®¾ç½®ä¸ºåªè¯»ï¼Œä¸ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜\n\n\nå¯¹äº bigkeyï¼Œé‡‡ç”¨æ‹†åˆ†æŒ‡ä»¤çš„æ–¹å¼è¿›è¡Œè¿ç§»ï¼šå¯¹ bigkey çš„æ¯ä¸ªå…ƒç´ ï¼Œç”¨ä¸€æ¡æŒ‡ä»¤è¿›è¡Œè¿ç§»\n\nä¼šç»™ç›®çš„ server ä¸Šè¢«è¿ç§»ä¸­çš„ bigkey è®¾ç½®ä¸´æ—¶è¿‡æœŸæ—¶é—´ï¼Œå¦‚æœè¿ç§»è¿‡ç¨‹å‘ç”Ÿæ•…éšœï¼Œä¸ä¼šå½±å“è¿ç§»çš„åŸå­æ€§ï¼Œå®Œæˆè¿ç§»ååˆ é™¤è®¾ç½®çš„ä¸´æ—¶è¿‡æœŸæ—¶é—´\n\n\n\nå¯ä»¥é€šè¿‡å¼‚æ­¥è¿ç§»å‘½ä»¤ SLOTSMGRTTAGSLOT-ASYNC çš„å‚æ•° numkeys è®¾ç½®æ¯æ¬¡è¿ç§»çš„ key æ•°é‡\n\n\n\n\n\n\n\n\nå¢åŠ  codis proxy\n\n\n\n\n\n\nå¯åŠ¨æ–°çš„ proxy\n\n\n\n\né€šè¿‡ codis dashboard æŠŠ proxy åŠ å…¥é›†ç¾¤å³å¯\n\n\n\n\n\n\n\n\n\nCodis é›†ç¾¤å¯é æ€§\n\n\ncodis server\n\nç»™æ¯ä¸ª server é…ç½®ä»åº“ï¼Œå¹¶ä½¿ç”¨å“¨å…µæœºåˆ¶è¿›è¡Œç›‘æ§\næ­¤æ—¶æ¯ä¸ª server æˆä¸ºä¸€ä¸ª server groupï¼Œéƒ½æ˜¯ä¸€ä¸»å¤šä»\nserver group çš„ Codis é›†ç¾¤æ¶æ„å›¾\n\n\n\n\n\n\n\ncodis proxy\n\nå’Œ Zookeeper æ­é…ä½¿ç”¨\næœ‰è¶…è¿‡åŠæ•°çš„ Zookeeper å®ä¾‹å¯ä»¥æ­£å¸¸å·¥ä½œï¼ŒZookeeper é›†ç¾¤å°±å¯ä»¥æä¾›æœåŠ¡\nproxy æ•…éšœåªéœ€é‡å¯ï¼Œç„¶åé€šè¿‡ codis dashboard ä» Zookeeper é›†ç¾¤è·å–è·¯ç”±è¡¨å³å¯æ¢å¤æœåŠ¡\n\n\n\n\n\nåˆ‡ç‰‡é›†ç¾¤æ–¹æ¡ˆé€‰æ‹©å»ºè®®\n\n\nCodis å’Œ Redis Cluster çš„åŒºåˆ«\n\n\n\n\n\n\nä»ç¨³å®šæ€§å’Œæˆç†Ÿåº¦ï¼Œé€‰ Codis\n\n\n\n\nä»ä¸šåŠ¡åº”ç”¨å®¢æˆ·ç«¯å…¼å®¹æ€§ï¼Œé€‰ Codis\n\n\n\n\nä»æ•°æ®è¿ç§»æ€§èƒ½çº¬åº¦çœ‹ï¼Œé€‰ Codis\n\n\n\n\n\nä»ä½¿ç”¨ Redis æ–°å‘½ä»¤å’Œæ–°ç‰¹æ€§ï¼Œé€‰ Redis Cluster\n\n\n\nCodis server æ˜¯åŸºäºå¼€æºçš„ Redis 3.2.8 å¼€å‘çš„ï¼Œå·²ç»ä¸å†ç»´æŠ¤\n\n\n\n\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/36ï½œRedis-æ”¯æ’‘ç§’æ€åœºæ™¯çš„å…³é”®æŠ€æœ¯å’Œå®è·µéƒ½æœ‰å“ªäº›ï¼Ÿ":{"title":"36ï½œRedis æ”¯æ’‘ç§’æ€åœºæ™¯çš„å…³é”®æŠ€æœ¯å’Œå®è·µéƒ½æœ‰å“ªäº›ï¼Ÿ","links":[],"tags":["redis"],"content":"\n\nç‰¹å¾\n\n\n\nç¬æ—¶å¹¶å‘è®¿é—®é‡éå¸¸é«˜\n\n\n\n\nè¯»å¤šå†™å°‘\n\n\n\n\n\nç§’æ€åœºæ™¯çš„æ‰€æœ‰ç¯èŠ‚\n\n\næ´»åŠ¨å‰\n\nä¸éœ€è¦ Redis\nå°½é‡æŠŠå•†å“è¯¦æƒ…é¡µé¡µé¢å…ƒç´ é™æ€åŒ–ï¼Œç„¶åä½¿ç”¨å‰ç«¯ CDN æˆ–æµè§ˆå™¨ç¼“å­˜æŠŠå…ƒç´ ç¼“å­˜èµ·æ¥\n\n\n\næ´»åŠ¨å¼€å§‹\n\n\nRedis å‚ä¸çš„ä¸¤ä¸ªç¯èŠ‚\n\n\n\n\n\nä½¿ç”¨ Redis ä¿å­˜åº“å­˜é‡ï¼Œä¸äº¤ç»™æ•°æ®åº“åšåº“å­˜æ‰£å‡\n\nå¦‚æœæŠŠåº“å­˜æ‰£å‡åœ¨æ•°æ®åº“æ‰§è¡Œï¼Œä¼šå¸¦æ¥ä¸¤ä¸ªé—®é¢˜\n\n\né¢å¤–çš„å¼€é”€ã€‚Redis ä¸­ä¿å­˜äº†åº“å­˜é‡ï¼Œè€Œåº“å­˜é‡çš„æœ€æ–°å€¼åˆæ˜¯æ•°æ®åº“åœ¨ç»´æŠ¤ï¼Œæ‰€ä»¥æ•°æ®åº“æ›´æ–°åï¼Œè¿˜éœ€è¦å’Œ Redis è¿›è¡ŒåŒæ­¥ï¼Œè¿™ä¸ªè¿‡ç¨‹å¢åŠ äº†é¢å¤–çš„æ“ä½œé€»è¾‘ï¼Œä¹Ÿå¸¦æ¥äº†é¢å¤–çš„å¼€é”€ã€‚\n\n\n\n\næ•°æ®åº“å¤„ç†è¾ƒæ…¢ï¼Œä¸èƒ½åŠæ—¶æ›´æ–°åº“å­˜ä½™é‡ï¼Œå¯¼è‡´å¤§é‡åº“å­˜æŸ¥éªŒè¯·æ±‚è¯»å–åˆ° Redis ä¸­çš„æ—§åº“å­˜å€¼ï¼Œæ­¤æ—¶ä¼šå‡ºç°ä¸‹å•æ•°é‡å¤§äºå®é™…çš„åº“å­˜é‡ï¼Œå¯¼è‡´è¶…å”®\n\n\n\n\n\næœ€ååœ¨æ•°æ®åº“å¤„ç†è®¢å•\n\nè®¢å•å¤„ç†æ¶‰åŠæ”¯ä»˜ã€å•†å“å‡ºåº“ã€ç‰©æµç­‰å¤šä¸ªå…³è”æ“ä½œï¼Œè¦ä¿è¯å¤„ç†çš„äº‹åŠ¡æ€§ï¼Œéœ€è¦åœ¨æ•°æ®åº“ä¸­å®Œæˆ\nè®¢å•å¤„ç†æ—¶çš„è¯·æ±‚å‹åŠ›å·²ç»ä¸å¤§\n\n\n\n\n\næ´»åŠ¨ç»“æŸå\n\nä¸éœ€è¦ Redis\n\n\n\n\n\nåº“å­˜æ•°æ®ä¿å­˜æ–¹å¼\n\n\nä½¿ç”¨åˆ‡ç‰‡é›†ç¾¤ï¼Œç”¨ä¸åŒå®ä¾‹ä¿å­˜ä¸åŒå•†å“çš„åº“å­˜\n\n\næ¯ä¸ªå•†å“ç”¨ä¸€ä¸ª Hash ç±»å‹çš„é”®å€¼å¯¹ä¿å­˜\n\nkey: itemID\nvalue: {total: N, ordered: M}\n\n\n\nå…ˆç”¨ CRC ç®—æ³•è®¡ç®—ä¸åŒå•†å“ key å¯¹åº”çš„ Slotï¼Œç„¶åï¼Œåœ¨åˆ†é… Slot å’Œå®ä¾‹å¯¹åº”å…³ç³»æ—¶ï¼Œæ‰èƒ½æŠŠä¸åŒç§’æ€å•†å“å¯¹åº”çš„ Slot åˆ†é…åˆ°ä¸åŒå®ä¾‹ä¸Šä¿å­˜\n\n\n\n\nåŸºäºåŸå­æ“ä½œæ”¯æ’‘ç§’æ€åœºæ™¯\n\nä½¿ç”¨ Lua è„šæœ¬æ‰§è¡Œåº“å­˜æŸ¥éªŒå’Œåº“å­˜æ‰£å‡æ“ä½œï¼Œä¿è¯åŸå­æ€§\n\n\n\nåŸºäºåˆ†å¸ƒå¼é”æ¥æ”¯æ’‘ç§’æ€åœºæ™¯\n\nå…ˆè®©å®¢æˆ·ç«¯å‘ Redis ç”³è¯·åˆ†å¸ƒå¼é”ï¼Œåªæœ‰æ‹¿åˆ°é”çš„å®¢æˆ·ç«¯æ‰èƒ½æ‰§è¡Œåº“å­˜æŸ¥éªŒå’Œåº“å­˜æ‰£å‡\nè¿™æ ·å¯ä»¥åœ¨äº‰å¤ºåˆ†å¸ƒå¼é”æ—¶è¿‡æ»¤æ‰å¤§é‡çš„ç§’æ€è¯·æ±‚\nåº“å­˜æŸ¥éªŒå’Œæ‰£å‡ä¹Ÿä¸ç”¨ä½¿ç”¨åŸå­æ“ä½œäº†ï¼Œå› ä¸ºå¤šä¸ªå¹¶å‘å®¢æˆ·ç«¯åªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯èƒ½å¤Ÿæ‹¿åˆ°é”ï¼Œå·²ç»ä¿è¯äº†å®¢æˆ·ç«¯å¹¶å‘è®¿é—®çš„äº’æ–¥æ€§\n\n\n\nå»ºè®®\n\n\nä½¿ç”¨åˆ‡ç‰‡é›†ç¾¤ä¸­çš„ä¸åŒå®ä¾‹ï¼Œåˆ†åˆ«ä¿å­˜åˆ†å¸ƒå¼é”å’Œå•†å“åº“å­˜ä¿¡æ¯\n\nå‡è½»ä¿å­˜åº“å­˜ä¿¡æ¯çš„å®ä¾‹çš„å‹åŠ›\n\n\n\næŠŠç§’æ€å•†å“çš„åº“å­˜ä¿¡æ¯ç”¨å•ç‹¬çš„å®ä¾‹ä¿å­˜ï¼Œä¸è¦å’Œæ—¥å¸¸ä¸šåŠ¡ç³»ç»Ÿçš„æ•°æ®ä¿å­˜åœ¨åŒä¸€ä¸ªå®ä¾‹ä¸Šï¼Œé¿å…å¹²æ‰°ä¸šåŠ¡ç³»ç»Ÿçš„æ­£å¸¸è¿è¡Œ\n\n\n\n\nå…¶ä»–ç¯èŠ‚\n\n\n\nå‰ç«¯é™æ€é¡µé¢çš„è®¾è®¡\n\n\n\n\n\nè¯·æ±‚æ‹¦æˆªå’Œæµæ§\n\n\n\nä½¿ç”¨é»‘åå•ç¦æ­¢æ¶æ„ IP è¿›è¡Œè®¿é—®ï¼›é™æµï¼›ç­‰ç­‰\n\n\n\n\n\nåº“å­˜ä¿¡æ¯è¿‡æœŸæ—¶é—´å¤„ç†\n\n\n\nRedis ä¸­çš„åº“å­˜ä¿¡æ¯ = æ•°æ®åº“çš„ç¼“å­˜ï¼Œä¸ç»™ Reids çš„åº“å­˜ä¿¡æ¯è®¾ç½®è¿‡æœŸæ—¶é—´\n\n\n\n\n\næ•°æ®åº“è®¢å•å¼‚å¸¸å¤„ç†\n\n\n\nå¢åŠ è®¢å•é‡è¯•åŠŸèƒ½\n\n\n\n\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/37ï½œæ•°æ®åˆ†å¸ƒä¼˜åŒ–ï¼šå¦‚ä½•åº”å¯¹æ•°æ®å€¾æ–œï¼Ÿ":{"title":"37ï½œæ•°æ®åˆ†å¸ƒä¼˜åŒ–ï¼šå¦‚ä½•åº”å¯¹æ•°æ®å€¾æ–œï¼Ÿ","links":[],"tags":["redis"],"content":"\n\næ•°æ®é‡å€¾æ–œï¼šåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå®ä¾‹ä¸Šçš„æ•°æ®åˆ†å¸ƒä¸å‡è¡¡ï¼ŒæŸä¸ªå®ä¾‹ä¸Šçš„æ•°æ®ç‰¹åˆ«å¤š\n\n\nbigkey\n\n\né›†åˆç±»å‹çš„ bigkey å¦‚æœæ˜¯é›†åˆç±»å‹ï¼Œå¯ä»¥æ‹†åˆ†æˆå¾ˆå¤šä¸ªå°çš„é›†åˆç±»å‹æ•°æ®ï¼Œåˆ†æ•£ä¿å­˜åœ¨ä¸åŒçš„å®ä¾‹ä¸Š\n\næ¯”å¦‚é€šè¿‡ ID èŒƒå›´æ‹†åˆ†\n\n\n\né¿å… bigkey\n\n\n\n\nSlot åˆ†é…ä¸å‡è¡¡\n\n\næ‰‹åŠ¨è¿ç§» Redis Cluster çš„ Slot\n\n\ncluster slots å‘½ä»¤æŸ¥çœ‹ Slot åˆ†é…æƒ…å†µ\n\n\nå¯ç”¨å‘½ä»¤\n\nCLUSTER SETSLOTï¼šä½¿ç”¨ä¸åŒçš„é€‰é¡¹è¿›è¡Œä¸‰ç§è®¾ç½®ï¼Œåˆ†åˆ«æ˜¯è®¾ç½® Slot è¦è¿å…¥çš„ç›®æ ‡å®ä¾‹ï¼ŒSlot è¦è¿å‡ºçš„æºå®ä¾‹ï¼Œä»¥åŠ Slot æ‰€å±çš„å®ä¾‹\nCLUSTER GETKEYSINSLOTï¼šè·å–æŸä¸ª Slot ä¸­ä¸€å®šæ•°é‡çš„ keyã€‚\nMIGRATEï¼šæŠŠä¸€ä¸ª key ä»æºå®ä¾‹å®é™…è¿ç§»åˆ°ç›®æ ‡å®ä¾‹\n\n\n\n\n\næ‰‹åŠ¨è¿ç§» Codis çš„ Slot\n\ncodis-admin â€”dashboard=ADDR -slot-action â€”create â€”sid=300 â€”gid=6\n\n\n\n\n\nHash Tag\n\n\næŒ‡åŠ åœ¨é”®å€¼å¯¹ key ä¸­çš„ä¸€å¯¹èŠ±æ‹¬å· {}\n\n\nå¦‚æœæœ‰ Hash Tagï¼Œå®¢æˆ·ç«¯åœ¨è®¡ç®— key çš„ CRC16 å€¼æ—¶ï¼Œåªå¯¹ Hash Tag èŠ±æ‹¬å·ä¸­çš„ key å†…å®¹è¿›è¡Œè®¡ç®—\n\n\nç›¸åŒ Hash Tag çš„æ•°æ®ä¼šè¢«æ˜ å°„åˆ°ç›¸åŒçš„ Slot ä¸Š\n\n\nä½¿ç”¨åœºæ™¯ï¼šç”¨åœ¨Â Redis Cluster å’Œ Codis ä¸­ï¼Œæ”¯æŒäº‹åŠ¡æ“ä½œå’ŒèŒƒå›´æŸ¥è¯¢\n\nå› ä¸º Redis Cluster å’Œ Codis æœ¬èº«ä¸æ”¯æŒè·¨å®ä¾‹çš„äº‹åŠ¡æ“ä½œ\n\n\n\nå»ºè®®ï¼šä¸ä½¿ç”¨ Hash Tagï¼Œåœ¨å®¢æˆ·ç«¯æ‰§è¡Œäº‹åŠ¡æ“ä½œå’ŒèŒƒå›´æŸ¥è¯¢\n\n\n\n\n\n\næ•°æ®è®¿é—®å€¾æ–œï¼šè™½ç„¶æ¯ä¸ªé›†ç¾¤å®ä¾‹ä¸Šçš„æ•°æ®é‡ç›¸å·®ä¸å¤§ï¼Œä½†æ˜¯æŸä¸ªå®ä¾‹ä¸Šçš„æ•°æ®æ˜¯çƒ­ç‚¹æ•°æ®ï¼Œè¢«è®¿é—®å¾—éå¸¸é¢‘ç¹\n\n\næ ¹æœ¬åŸå› ï¼šå®ä¾‹å­˜åœ¨çƒ­ç‚¹æ•°æ®\n\n\nåº”å¯¹æ–¹æ³•\n\n\nåªè¯»çš„çƒ­ç‚¹æ•°æ®\n\nå…·ä½“åšæ³•ï¼šå°†çƒ­ç‚¹æ•°æ®å¤åˆ¶å¤šåˆ†ï¼Œæ¯ä¸ªå‰¯æœ¬ key å¢åŠ ä¸€ä¸ªéšæœºå‰ç¼€ï¼Œæ˜ å°„åˆ°ä¸åŒçš„å®ä¾‹çš„ Slot ä¸­\n\n\n\næœ‰è¯»æœ‰å†™çš„çƒ­ç‚¹æ•°æ®\n\n\nç»™å®ä¾‹æœ¬èº«å¢åŠ èµ„æº\n\næ¯”å¦‚é…ç½®æ›´é«˜çš„æœºå™¨\n\n\n\n\n\n\n\n\n\né›†ç¾¤çš„å®ä¾‹èµ„æºé…ç½®å»ºè®®\n\nåœ¨æ„å»ºåˆ‡ç‰‡é›†ç¾¤æ—¶ï¼Œå°½é‡ä½¿ç”¨å¤§å°é…ç½®ç›¸åŒçš„å®ä¾‹ï¼ˆä¾‹å¦‚å®ä¾‹å†…å­˜é…ç½®ä¿æŒç›¸åŒï¼‰ï¼Œå¯ä»¥é¿å…å› å®ä¾‹èµ„æºä¸å‡è¡¡è€Œåœ¨ä¸åŒå®ä¾‹ä¸Šåˆ†é…ä¸åŒæ•°é‡çš„ Slot\n\n\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/38ï½œé€šä¿¡å¼€é”€ï¼šé™åˆ¶-Redis-Cluster-è§„æ¨¡çš„å…³é”®å› ç´ ":{"title":"38ï½œé€šä¿¡å¼€é”€ï¼šé™åˆ¶ Redis Cluster è§„æ¨¡çš„å…³é”®å› ç´ ","links":[],"tags":["redis"],"content":"\n\nRedis Cluster å®ä¾‹é—´ä»¥ Gossip åè®®è¿›è¡Œé€šä¿¡çš„æœºåˆ¶\n\n\nGossip åè®®çš„å·¥ä½œåŸç†\n\nä¸¤ä¸ªå®ä¾‹é—´è¿›è¡Œ PINGã€PONG æ¶ˆæ¯ä¼ é€’çš„æƒ…å†µ\næ¯ä¸ªå®ä¾‹é»˜è®¤æ¯ç§’ä»é›†ç¾¤ä¸­éšæœºæŒ‘é€‰ä¸€äº›å®ä¾‹ï¼ŒæŠŠ PING æ¶ˆæ¯å‘é€ç»™æŒ‘é€‰å‡ºæ¥çš„å®ä¾‹ï¼Œç”¨æ¥æ£€æµ‹è¿™äº›å®ä¾‹æ˜¯å¦åœ¨çº¿ï¼Œå¹¶äº¤æ¢å½¼æ­¤çš„çŠ¶æ€ä¿¡æ¯\nPING æ¶ˆæ¯ä¸­å°è£…äº†å‘é€æ¶ˆæ¯çš„å®ä¾‹è‡ªèº«çš„çŠ¶æ€ä¿¡æ¯ã€éƒ¨åˆ†å…¶å®ƒå®ä¾‹çš„çŠ¶æ€ä¿¡æ¯ï¼Œä»¥åŠ Slot æ˜ å°„è¡¨\nä¸€ä¸ªå®ä¾‹åœ¨æ¥æ”¶åˆ° PING æ¶ˆæ¯åï¼Œä¼šç»™å‘é€ PING æ¶ˆæ¯çš„å®ä¾‹ï¼Œå‘é€ä¸€ä¸ª PONG æ¶ˆæ¯ã€‚PONG æ¶ˆæ¯åŒ…å«çš„å†…å®¹å’Œ PING æ¶ˆæ¯ä¸€æ ·\n\n\n\nGossip æ¶ˆæ¯å¤§å°\n\n\nPING å’Œ PONG æ¶ˆæ¯çš„æ¶ˆæ¯ä½“éƒ½å¤§çº¦ 12KB\n\n\nPING æ¶ˆæ¯ä¸­å¸¦æœ‰ä¸€ä¸ªé•¿åº¦ä¸º 16384 bit çš„ Bitmap\n\næ¯ä¸€ä½å¯¹åº”ä¸€ä¸ª Slotï¼Œå¦‚æœæŸä¸€ä½ä¸º 1ï¼Œè¡¨ç¤ºè¿™ä¸ª Slot å±äºå½“å‰å®ä¾‹\n\n\n\n\n\nå®ä¾‹é—´é€šä¿¡é¢‘ç‡\n\n\n\nGossip åè®®çš„å·¥ä½œåŸç†ç¬¬äºŒç‚¹\n\n\n\n\nå®ä¾‹æ¯ 100ms æ‰«ææœ¬åœ°çš„å®ä¾‹åˆ—è¡¨ï¼Œå¦‚æœå‘ç°æœ‰å®ä¾‹æœ€è¿‘ä¸€æ¬¡æ¥æ”¶ PONG æ¶ˆæ¯çš„æ—¶é—´å·²ç»å¤§äºé…ç½®é¡¹ cluster-node-timeout çš„ä¸€åŠï¼Œå°±ä¼šç«‹åˆ»ç»™è¯¥å®ä¾‹å‘é€ PING æ¶ˆæ¯ï¼Œæ›´æ–°è¿™ä¸ªå®ä¾‹ä¸Šçš„é›†ç¾¤çŠ¶æ€ä¿¡æ¯\n\n\n\næ¯ç§’ä¼šå‘é€çš„ PING æ¶ˆæ¯æ•°é‡ =Â 1 + 10 * å®ä¾‹æ•°\n\nå®ä¾‹æ•° = æœ€è¿‘ä¸€æ¬¡æ¥æ”¶ PONG æ¶ˆæ¯çš„æ—¶é—´è¶…å‡º cluster-node-timeout/2\n\n\n\n\n\né™ä½å®ä¾‹é—´çš„é€šä¿¡å¼€é”€\n\n\nä¸èƒ½å‡å°å®ä¾‹ä¼ è¾“çš„æ¶ˆæ¯å¤§å°\n\n\nåªèƒ½ä¿®æ”¹ cluster-node-timeout é…ç½®é¡¹\n\n\né»˜è®¤ 15 ç§’ï¼Œè°ƒå¤§åˆ° 20 æˆ– 25 ç§’\n\n\néªŒè¯è°ƒæ•´åçš„å€¼æ˜¯å¦èƒ½å‡å°‘å¿ƒè·³æ¶ˆæ¯å ç”¨çš„é›†ç¾¤ç½‘ç»œå¸¦å®½\n\nè°ƒæ•´å‰åä½¿ç”¨ tcpdump å‘½ä»¤æŠ“å–å®ä¾‹å‘é€å¿ƒè·³ä¿¡æ¯ç½‘ç»œåŒ…çš„æƒ…å†µ\nä¾‹å¦‚ï¼Œæ‰§è¡Œï¼štcpdump host 192.168.10.3 port 16379 -i ç½‘å¡å -w /tmp/r1.cap\né€šè¿‡åˆ†æç½‘ç»œåŒ…çš„æ•°é‡å’Œå¤§å°ï¼Œå°±å¯ä»¥åˆ¤æ–­è°ƒæ•´ cluster-node-timeout å€¼å‰åï¼Œå¿ƒè·³æ¶ˆæ¯å ç”¨çš„å¸¦å®½æƒ…å†µ\n\n\n\n\n\n\n\n\n\nå»ºè®®æŠŠ Redis Cluster çš„è§„æ¨¡æ§åˆ¶åœ¨ 400~500 ä¸ªå®ä¾‹\n\nå‡è®¾å•ä¸ªå®ä¾‹æ¯ç§’èƒ½æ”¯æ’‘ 8 ä¸‡è¯·æ±‚æ“ä½œï¼ˆ8 ä¸‡ QPSï¼‰ï¼Œæ¯ä¸ªä¸»å®ä¾‹é…ç½® 1 ä¸ªä»å®ä¾‹ï¼Œ400~ 500 ä¸ªå®ä¾‹å¯æ”¯æŒ 1600 ä¸‡~2000 ä¸‡ QPSï¼ˆ200/250 ä¸ªä¸»å®ä¾‹ *8 ä¸‡ QPS=1600/2000 ä¸‡ QPSï¼‰ï¼Œè¿™ä¸ªååé‡æ€§èƒ½å¯ä»¥æ»¡è¶³ä¸å°‘ä¸šåŠ¡åº”ç”¨çš„éœ€æ±‚\n\n\n\nå»ºè®®é’ˆå¯¹ä¸åŒçš„ä¸šåŠ¡çº¿ã€ä¸šåŠ¡æ¨¡å—ï¼Œå•ç‹¬éƒ¨ç½²ä¸åŒçš„åˆ†ç‰‡é›†ç¾¤ï¼Œæ–¹ä¾¿è¿ç»´å’Œç®¡ç†ï¼Œå‡ºé—®é¢˜ä¹Ÿåªä¼šå½±å“æŸä¸€ä¸ªä¸šåŠ¡æ¨¡å—\n\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/39ï½œRedis-6.0-çš„æ–°ç‰¹æ€§ï¼šå¤šçº¿ç¨‹ã€å®¢æˆ·ç«¯ç¼“å­˜ä¸å®‰å…¨":{"title":"39ï½œRedis 6.0 çš„æ–°ç‰¹æ€§ï¼šå¤šçº¿ç¨‹ã€å®¢æˆ·ç«¯ç¼“å­˜ä¸å®‰å…¨","links":[],"tags":["redis"],"content":"\n\nå¤š IO çº¿ç¨‹\n\n\nä½œç”¨ï¼šä½¿ç”¨å¤šä¸ª IO çº¿ç¨‹å¹¶è¡Œè¯»å–ç½‘ç»œè¯·æ±‚ã€è¿›è¡Œåè®®è§£æã€å›å†™ Socket\n\n\nä¸»çº¿ç¨‹å’Œ IO çº¿ç¨‹åä½œå®Œæˆè¯·æ±‚å¤„ç†\n\n\né˜¶æ®µä¸€ï¼šæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯å»ºç«‹ Socket è¿æ¥ï¼Œå¹¶åˆ†é…å¤„ç†çº¿ç¨‹\n\n\né˜¶æ®µäºŒï¼šIO çº¿ç¨‹è¯»å–å¹¶è§£æè¯·æ±‚\n\n\né˜¶æ®µä¸‰ï¼šä¸»çº¿ç¨‹æ‰§è¡Œè¯·æ±‚æ“ä½œ\n\n\n\n\n\né˜¶æ®µå››ï¼šIO çº¿ç¨‹å›å†™ Socket å’Œä¸»çº¿ç¨‹æ¸…ç©ºå…¨å±€é˜Ÿåˆ—\n\n\n\n\n\n\n\nå¯ç”¨å¤šçº¿ç¨‹å‘½ä»¤ï¼šio-threads-do-reads yes\n\n\nè®¾ç½®çº¿ç¨‹ä¸ªæ•°å‘½ä»¤ï¼šio-threads 6\n\nä¸€èˆ¬è¦å°äºå®ä¾‹æ‰€åœ¨æœºå™¨çš„ CPU æ ¸ä¸ªæ•°\nä¾‹å¦‚ï¼Œå¯¹äºä¸€ä¸ª 8 æ ¸çš„æœºå™¨æ¥è¯´ï¼ŒRedis å®˜æ–¹å»ºè®®é…ç½® 6 ä¸ª IO çº¿ç¨‹\n\n\n\nå¦‚æœåœ¨å®é™…åº”ç”¨ä¸­ï¼Œå‘ç° Redis å®ä¾‹çš„ CPU å¼€é”€ä¸å¤§ï¼Œååé‡å´æ²¡æœ‰æå‡ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ Redis 6.0 çš„å¤šçº¿ç¨‹æœºåˆ¶ï¼ŒåŠ é€Ÿç½‘ç»œå¤„ç†ï¼Œè¿›è€Œæå‡å®ä¾‹çš„ååé‡\n\n\n\n\næ³¨æ„äº‹é¡¹ï¼šå¤š IO çº¿ç¨‹åªè´Ÿè´£å¤„ç†ç½‘ç»œè¯·æ±‚ï¼Œä¸æ‰§è¡Œå‘½ä»¤æ“ä½œ\n\n\né€‚ç”¨åœºæ™¯ï¼šæå‡ Redis ååé‡\n\n\n\n\nå®¢æˆ·ç«¯ç¼“å­˜\n\n\nä½œç”¨\n\n\næ™®é€šæ¨¡å¼ï¼šæ£€æµ‹å®¢æˆ·ç«¯è¯»å–çš„ key çš„ä¿®æ”¹æƒ…å†µ\n\næœåŠ¡ç«¯å¯¹äºè®°å½•çš„ key åªä¼šæŠ¥å‘Šä¸€æ¬¡ invalidate æ¶ˆæ¯ï¼Œå¦‚æœ key å†è¢«ä¿®æ”¹ï¼ŒæœåŠ¡ç«¯å°±ä¸ä¼šå†æ¬¡ç»™å®¢æˆ·ç«¯å‘é€ invalidate æ¶ˆæ¯\n\n\n\nå¹¿æ’­æ¨¡å¼ï¼šå°† key çš„å¤±æ•ˆæ¶ˆæ¯å‘é€ç»™æ‰€æœ‰å®¢æˆ·ç«¯\n\n\nå®¢æˆ·ç«¯éœ€æ‰§è¡Œå‘½ä»¤æ³¨å†Œè¦è·Ÿè¸ªçš„ key\n\nCLIENT TRACKING ON BCAST PREFIX user\n\n\n\n\n\né‡å®šå‘æ¨¡å¼ï¼šæ”¯æŒä½¿ç”¨ RESP 2 åè®®çš„å®¢æˆ·ç«¯\n\n\nRedis 6.0 ä¹‹å‰çš„å®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨æ­¤æ¨¡å¼\n\n\nå®¢æˆ·ç«¯ B åªæ”¯æŒ RESP 2 åè®®\n\nå®¢æˆ·ç«¯ B æ‰§è¡Œï¼Œå®¢æˆ·ç«¯ B çš„ ID å·æ˜¯ 303\nSUBSCRIBE redis:invalidate\n\n\n\nå®¢æˆ·ç«¯ A æ”¯æŒ RESP 3 åè®®ï¼Œå…¼å®¹æ–¹æ¡ˆ\n\næ‰§è¡Œ CLIENT TRACKING ON BCAST REDIRECT 303 å°†è·å–åˆ°çš„å¤±æ•ˆæ¶ˆæ¯è½¬å‘ç»™ B\n\n\n\n\n\n\n\næ³¨æ„äº‹é¡¹ï¼šæ™®é€šæ¨¡å¼å’Œå¹¿æ’­æ¨¡å¼éœ€è¦å¯ç”¨ RESP 3 åè®®æ¥æ”¶å¤±æ•ˆæ¶ˆæ¯\n\n\né€‚ç”¨åœºæ™¯ï¼šåŠ é€Ÿä¸šåŠ¡åº”ç”¨è®¿é—®\n\n\n\n\nè®¿é—®æƒé™æ§åˆ¶\n\n\nä½œç”¨ï¼šåŒºåˆ†ä¸åŒç”¨æˆ·ï¼Œæ”¯æŒä»¥ç”¨æˆ·å’Œ key ä¸ºç²’åº¦è®¾ç½®æŸä¸ªæˆ–æŸç±»å‘½ä»¤çš„è°ƒç”¨æƒé™\n\nä¸€äº›å¯ç”¨çš„æ“ä½œæ±‡æ€»å›¾\n\n\n\n\n\n\n\né€‚ç”¨åœºæ™¯ï¼šæ”¯æŒå¤šç”¨æˆ·ä»¥ä¸åŒæƒé™è®¿é—® Redis\n\n\n\n\nRESP 3 åè®®\n\nä½œç”¨ï¼šä½¿ç”¨ä¸åŒå¼€å¤´å­—ç¬¦è¡¨ç¤ºå¤šç§æ•°æ®ç±»å‹ï¼Œç®€åŒ–å®¢æˆ·ç«¯å¼€å‘å¤æ‚åº¦\né€‚ç”¨åœºæ™¯ï¼šé«˜æ•ˆæ”¯æŒä¸åŒæ•°æ®ç±»å‹ä½¿ç”¨ï¼Œæ”¯æŒå®¢æˆ·ç«¯ç¼“å­˜\n\n\n\næ–°ç‰¹æ€§æ±‡æ€»å›¾\n\n\n\n\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/40ï½œRedis-çš„ä¸‹ä¸€æ­¥ï¼šåŸºäº-NVM-å†…å­˜çš„å®è·µ":{"title":"40ï½œRedis çš„ä¸‹ä¸€æ­¥ï¼šåŸºäº NVM å†…å­˜çš„å®è·µ","links":[],"tags":["redis"],"content":"\n\nç‰¹æ€§\n\n\nèƒ½æŒä¹…åŒ–ä¿å­˜æ•°æ®\n\n\nè¯»å†™é€Ÿåº¦æ¯” DRAM å†…å­˜ç¨æ…¢\n\nDRAMï¼šDynamic random-access memory åŠ¨æ€éšæœºå­˜å–å­˜å‚¨å™¨ï¼ˆåŠå¯¼ä½“è®°å­˜å‚¨å™¨ï¼‰\n\n\n\nå®¹é‡å¤§\n\n\n\n\nOptane AEP å†…å­˜æ¡ï¼ˆç®€ç§° AEP å†…å­˜ï¼ŒIntel 2019 å¹´ 4 æœˆä»½æ¨å‡ºï¼‰\n\n\nMemory æ¨¡å¼\n\nåªç”¨å®¹é‡å¤§å’Œæ€§èƒ½é«˜çš„ç‰¹æ€§ï¼Œæ²¡æœ‰å¯ç”¨æ•°æ®æŒä¹…åŒ–åŠŸèƒ½\nä»éœ€é… DRAM å†…å­˜ï¼Œä½†å®ƒæ˜¯ä½œä¸º AEP å†…å­˜çš„ç¼“å­˜ï¼Œå¯¹åº”ç”¨è½¯ä»¶ä¸å¯è§\nè½¯ä»¶ç³»ç»Ÿèƒ½ä½¿ç”¨åˆ°çš„å†…å­˜ç©ºé—´ï¼Œå°±æ˜¯ AEP å†…å­˜æ¡çš„ç©ºé—´å®¹é‡\n\n\n\nApp Direct æ¨¡å¼\n\n\nå¯ç”¨æŒä¹…åŒ–æ•°æ®çš„åŠŸèƒ½\n\n\næ­¤æ¨¡å¼çš„ AEP å†…å­˜å«åšæŒä¹…åŒ–å†…å­˜ï¼ˆPersistent Memoryï¼ŒPMï¼‰\n\n\nä½¿ç”¨æ–¹æ³•\n\n\n\néƒ¨ç½² PM\n\n\n\n\næ ¼å¼åŒ–\n\n\n\n\næŒ‚è½½åˆ°æœåŠ¡å™¨çš„ä¸€ä¸ªç›®å½•ä¸‹\n\n\n\n\nåœ¨ç›®å½•ä¸‹åˆ›å»ºæ–‡ä»¶ï¼Œé€šè¿‡å†…å­˜æ˜ å°„ï¼ˆmmapï¼‰çš„æ–¹å¼æŠŠæ–‡ä»¶æ˜ å°„åˆ° Redis çš„è¿›ç¨‹ç©ºé—´\n\n\n\n\n\n\n\n\n\nä»éœ€è¦ä¸»ä»é›†ç¾¤\n\nåˆ†æ‹…è¯»å‹åŠ›\n\n\n\næ²¡æœ‰äº† RDBï¼Œä¸»ä»å¤åˆ¶çš„å®ç°ï¼ŒäºŒé€‰ä¸€\n\n\né¦–å…ˆï¼Œå¢åŠ ä»èŠ‚ç‚¹æ—¶ï¼ŒæŠŠå…¨åº“æ•°æ®æ‹·è´åˆ°ä»èŠ‚ç‚¹ä¸Š\n\n\nä¸€ã€ç”¨å†™å‰æ—¥å¿—ï¼Œæ—¥å¿—æ‹·è´åˆ°ä»èŠ‚ç‚¹è¿›è¡Œå›æ”¾\n\nä¼šå¸¦æ¥åŒå†™é—®é¢˜\n\n\n\näºŒã€ä¸»èŠ‚ç‚¹åœ¨ NVM ä¸Šåšå¿«ç…§ï¼Œä½†ä¸å†™æ–‡ä»¶ï¼Œä»èŠ‚ç‚¹ç›´æ¥ä»ä¸»èŠ‚ç‚¹çš„ NVM ä¸Šé€šè¿‡è¿œç¨‹å†…å­˜æ‹·è´æ¥å®ç°å¤åˆ¶ï¼Œéœ€è¦åŸºäº RDMAï¼ˆè¿œç¨‹å†…å­˜è®¿é—®ï¼‰ æ¥åš\n\n\n\n\nåº”ç”¨ç¨‹åºå¦‚ä½•åŸºäºæŒä¹…åŒ–å†…å­˜æ¢å¤è‡ªèº«çš„çŠ¶æ€ï¼Ÿ\n\næŠŠåº”ç”¨ç¨‹åºæœ¬èº«çš„è¿è¡Œæ—¶çŠ¶æ€ï¼Œå¦‚å †æ ˆç­‰ä¹Ÿä¿å­˜åˆ°æŒä¹…åŒ–å†…å­˜ä¸Šï¼Œéœ€è¦å¯¹æ“ä½œç³»ç»Ÿçš„å†…æ ¸åšä¿®æ”¹\nç›®å‰è¿˜æ²¡æœ‰æˆç†Ÿçš„æ–¹æ¡ˆï¼ˆ2021.09.29ï¼‰\n\n\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/41ï½œç¬¬-35ï½40-è®²è¯¾åæ€è€ƒé¢˜ç­”æ¡ˆåŠå¸¸è§é—®é¢˜ç­”ç–‘":{"title":"41ï½œç¬¬ 35ï½40 è®²è¯¾åæ€è€ƒé¢˜ç­”æ¡ˆåŠå¸¸è§é—®é¢˜ç­”ç–‘","links":[],"tags":["redis"],"content":"\n\nMemcached æ˜¯å†…å­˜é”®å€¼æ•°æ®åº“\n\n\nRocksDB æ˜¯ç¡¬ç›˜é”®å€¼æ•°æ®åº“ï¼ˆæŒä¹…åŒ–ï¼‰\n\n\nRedis å’Œ Memcached çš„æ¯”è¾ƒ\n\n\n\n\n\nRedis å’Œ RocksDB çš„æ¯”è¾ƒ\n\n\n\n\n\nå¯æ‰©å±•æ€§\n\nMemcached &gt; Codis &gt; Redis Cluster\n\n\n\nä¸€è‡´æ€§å“ˆå¸Œçš„é›†ç¾¤æ‰©å®¹\n\n\n\nå‡è®¾æ–°åŠ å…¥çš„èŠ‚ç‚¹åœ¨ä¸€è‡´æ€§å“ˆå¸Œåœ†ç¯ä¸Šæ˜¯ A\n\n\n\n\næ²¿é€†æ—¶é’ˆæ–¹å‘çš„å‰ä¸€ä¸ªé›†ç¾¤èŠ‚ç‚¹æ˜¯ B\n\n\n\n\nåªéœ€è¦è¿ç§» B å’Œ A ä¹‹é—´çš„æ•°æ®\n\n\næ•°æ®è¿ç§»é‡æ¯”æ™®é€šå“ˆå¸Œåå–æ¨¡çš„æ–¹æ³•çš„é‡å°‘\n\n\n\n5 åˆ†é’Ÿç†è§£ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ï¼ˆæ˜é‡‘ï¼‰\n\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/Redis-å­¦ä¹ è·¯å¾„":{"title":"Redis å­¦ä¹ è·¯å¾„","links":[],"tags":["redis"],"content":"\n\næŒæ¡æ•°æ®ç»“æ„å’Œç¼“å­˜çš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•\n\n\nå­¦ä¼šåŸºç¡€æ•°æ®ç±»å‹çš„ç”¨æ³•\n\nString\nList\nHash\nSet\nSorted Set\n\n\n\næŒæ¡æ‰©å±•æ•°æ®ç±»å‹çš„ç”¨æ³•\n\nHyperLogLog\nBitmap\nGEO\n\n\n\nç§¯ç´¯ Redis ç”¨ä½œç¼“å­˜çš„æ–¹æ³•ä»¥åŠå…¸å‹é—®é¢˜çš„è§£å†³æ–¹æ¡ˆ\n\næ•°æ®åº“å’Œ Redis ç¼“å­˜çš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜\nç¼“å­˜ç©¿é€é—®é¢˜\nç¼“å­˜é›ªå´©é—®é¢˜\n\n\n\n\n\næŒæ¡æ”¯æ’‘ Redis å®ç°é«˜æ€§èƒ½ã€é«˜å¯é çš„æŠ€æœ¯ç‚¹\n\næŒä¹…åŒ–æœºåˆ¶\nä¸»ä»å¤åˆ¶æœºåˆ¶\nå“¨å…µæœºåˆ¶\næ•…éšœè‡ªåŠ¨æ¢å¤\nåˆ‡ç‰‡é›†ç¾¤\n\n\n\nç²¾é€š Redis åº•å±‚å®ç°åŸç†\n\n\næ•°æ®ç»“æ„çš„å®ç°åŸç†\n\n\né«˜æ€§èƒ½ã€é«˜å¯é ç›¸å…³çš„ä¸€ç³»åˆ—åŸç†\n\næŒä¹…åŒ–\nå“¨å…µé›†ç¾¤ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿçš„é€‰ä¸¾é—®é¢˜å’Œå…±è¯†é—®é¢˜\nåˆ‡ç‰‡é›†ç¾¤ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿçš„å¾ˆå¤šé—®é¢˜ï¼Œä¾‹å¦‚ CAP åŸç†ã€åˆ†å¸ƒå¼äº‹åŠ¡ã€æ¶æ„è®¾è®¡\n\n\n\n\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/Redis-å®¢æˆ·ç«¯å¦‚ä½•ä¸æœåŠ¡ç«¯äº¤æ¢å‘½ä»¤å’Œæ•°æ®ï¼Ÿ":{"title":"Redis å®¢æˆ·ç«¯å¦‚ä½•ä¸æœåŠ¡ç«¯äº¤æ¢å‘½ä»¤å’Œæ•°æ®ï¼Ÿ","links":[],"tags":["redis"],"content":"\n\nå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯äº¤äº’å†…å®¹\n\nå‘½ä»¤\né”®\nå•ä¸ªå€¼\né›†åˆå€¼\nOK å›å¤\næ•´æ•°å›å¤\né”™è¯¯ä¿¡æ¯\n\n\n\nRESP 2 åè®®\n\n\nä¸¤ä¸ªåŸºæœ¬è§„èŒƒ\n\n\n\nå®ç° 5 ç§ç¼–ç æ ¼å¼ç±»å‹ï¼Œåœ¨æ¯ç§ç¼–ç ç±»å‹çš„å¼€å¤´ä½¿ç”¨ä¸€ä¸ªä¸“é—¨çš„å­—ç¬¦åŒºåˆ†\n\n\n\n\næŒ‰ç…§å•ä¸ªå‘½ä»¤æˆ–å•ä¸ªæ•°æ®çš„ç²’åº¦è¿›è¡Œç¼–ç ï¼Œåœ¨æ¯ä¸ªç¼–ç ç»“æœåé¢å¢åŠ ä¸€ä¸ªæ¢è¡Œç¬¦ \\r\\n è¡¨ç¤ºç¼–ç ç»“æŸ\n\n\n\n\n\n\n\nç®€å•å­—ç¬¦ä¸²ç±»å‹ RESP Simple Strings\n\n\n\n+OK\\r\\n\n\n\n\n\n\né•¿å­—ç¬¦ä¸²ç±»å‹ RESP Bulk String\n\n\n\n\nå›¾\n\n\n\n\n\n$9 testvalue\\r\\n\n\n\nRedis SDS ç»“æ„\n\nlen = 14; alloc; buf (â€œRedis\\0Cluster\\0â€)\n\\0 è§£ææˆæ­£å¸¸çš„ 0 å­—ç¬¦\n\n\n\næœ€å¤§ 512MB\n\n\n\n\n\n\næ•´æ•°ç±»å‹ RESP Integer\n\n\n\n:3\\r\\n\n\n\n\n\n\né”™è¯¯ç±»å‹ RESP Errors\n\n\n\n-ERR unknown command PUT, with args beginning with: testkey, testvalue\n\n\n\n\n\næ•°ç»„ç¼–ç ç±»å‹ RESP Arrays\n\n\n\n*2\\r\\n3\\nGETËšâ€‹\\nËšâ€‹7\\r\\ntestkey\\r\\n\n2ï¼šæ•°ç»„å…ƒç´ ä¸ªæ•°ï¼Œå‘½ä»¤ GET å’Œé”® testkey\n\n\n\nä¸è¶³\n\n\n\nåªèƒ½åŒºåˆ†å­—ç¬¦ä¸²å’Œæ•´æ•°ï¼Œå…¶ä»–ç±»å‹éœ€è¦å®¢æˆ·ç«¯è¿›è¡Œé¢å¤–çš„è½¬æ¢æ“ä½œ\n\n\n\n\nä½¿ç”¨æ•°ç»„ç±»åˆ«ç¼–ç è¡¨ç¤ºæ‰€æœ‰çš„é›†åˆç±»å‹ï¼Œå®¢æˆ·ç«¯éœ€è¦æ ¹æ®å‘é€çš„å‘½ä»¤æ“ä½œæŠŠè¿”å›ç»“æœè½¬æ¢æˆç›¸åº”çš„é›†åˆç±»å‹æ•°æ®ç»“æ„\n\n\n\n\n\nRESP 2 åè®®çš„ 5 ç§ç¼–ç ç±»å‹å’Œç›¸åº”çš„å¼€å¤´å­—ç¬¦\n\n\n\n\n\n\n\nRESP 3 åè®®ï¼ˆ6.0ï¼‰\n\n\nå¢åŠ å¯¹å¤šç§æ•°æ®ç±»å‹çš„æ”¯æŒï¼ŒåŒ…æ‹¬ç©ºå€¼ã€æµ®ç‚¹æ•°ã€å¸ƒå°”å€¼ã€æœ‰åºçš„å­—å…¸é›†åˆç­‰\n\nä¹Ÿæ˜¯é€šè¿‡ä¸åŒçš„å¼€å¤´å­—ç¬¦è¿›è¡ŒåŒºåˆ†\nå®¢æˆ·ç«¯ä¸ç”¨å†é€šè¿‡é¢å¤–çš„å­—ç¬¦ä¸²æ¯”å¯¹æ¥å®ç°æ•°æ®è½¬æ¢æ“ä½œ\n\n\n\n\n\nå°å·¥å…·\n\n\ntelnet å®ä¾‹IP å®ä¾‹ç«¯å£\n\nç„¶ååœ¨ telnet ä¸­ç»™å®ä¾‹å‘é€å‘½ä»¤ï¼Œå°±èƒ½çœ‹åˆ° RESP åè®®ç¼–ç åçš„è¿”å›ç»“æœ\nä¹Ÿå¯ä»¥åœ¨ telnet ä¸­å‘ Redis å®ä¾‹å‘é€ç”¨ RESP åè®®ç¼–å†™çš„å‘½ä»¤æ“ä½œ\n\n\n\n\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/Redis-æœ‰å“ªäº›å¥½ç”¨çš„è¿ç»´å·¥å…·ï¼Ÿ":{"title":"Redis æœ‰å“ªäº›å¥½ç”¨çš„è¿ç»´å·¥å…·ï¼Ÿ","links":["%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/11%EF%BD%9C%E2%80%9C%E4%B8%87%E9%87%91%E6%B2%B9%E2%80%9D%E7%9A%84-String%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E5%A5%BD%E7%94%A8%E4%BA%86%EF%BC%9F"],"tags":["redis"],"content":"\n\næœ€åŸºæœ¬çš„ç›‘æ§å‘½ä»¤ï¼šINFO å‘½ä»¤\n\n\nINFO å‘½ä»¤çš„è¿”å›ä¿¡æ¯\n\n\n\n\n\né‡ç‚¹å…³æ³¨ statã€commandstatã€cpuã€memory å‚æ•°çš„è¿”å›ç»“æœ\n\n\né€šè¿‡ persistence å‚æ•°çš„è¿”å›ç»“æœæŸ¥çœ‹ RDB æˆ–è€… AOF çš„æ‰§è¡Œæƒ…å†µ\n\n\né€šè¿‡ replication å‚æ•°çš„è¿”å›ç»“æœæŸ¥çœ‹ä¸»ä»é›†ç¾¤çš„å®æ—¶çŠ¶æ€\n\n\n\n\né¢å‘ Prometheus çš„ Redis-exporter ç›‘æ§\n\nå¼€æºçš„ç³»ç»Ÿç›‘æ§æŠ¥è­¦æ¡†æ¶\nç»“åˆ Grafana è¿›è¡Œå¯è§†åŒ–å±•ç¤º\næ”¯æŒ Redis 2.0 ï½ 6.0\næœ‰æ’ä»¶ï¼Œä¹Ÿå¯ä»¥è¿è¡Œ Lua è„šæœ¬\nä¸»æµå·¥å…·ï¼ˆ2021.10.1ï¼‰\n\n\n\nè½»é‡çº§çš„ç›‘æ§å·¥å…·\n\nRedis-stat\nRedis Live\n\n\n\næ•°æ®è¿ç§»å·¥å…· Redis-shake\n\n\né˜¿é‡Œäº‘ Redis å’Œ MongoDB å›¢é˜Ÿå¼€å‘çš„æ•°æ®åŒæ­¥å·¥å…·\n\n\nè¿›è¡Œæ•°æ®è¿ç§»çš„è¿‡ç¨‹\n\n\n\n\n\nè¿è¡ŒåŸç†\n\n\nå…ˆå¯åŠ¨ Redis-shake è¿›ç¨‹ï¼Œè¿›ç¨‹æ¨¡æ‹Ÿäº†ä¸€ä¸ª Redis å®ä¾‹ï¼Œç„¶åè¿›ç¨‹å’Œæ•°æ®è¿å‡ºçš„æºå®ä¾‹è¿›è¡Œæ•°æ®çš„å…¨é‡åŒæ­¥\n\n\nå’Œ Redis ä¸»ä»å®ä¾‹çš„å…¨é‡åŒæ­¥ç±»ä¼¼\n\n\næºå®ä¾‹ç›¸å½“äºä¸»åº“ï¼ŒRedis-shake ç›¸å½“äºä»åº“\n\n\n\nRDB æ–‡ä»¶ -&gt; Redis-shake -&gt; ç›®çš„å®ä¾‹\n\n\n\n\nå¢é‡å‘½ä»¤ -&gt; Redis-shake -&gt; ç›®çš„å®ä¾‹\n\n\n\n\n\nä¼˜åŠ¿\n\næ”¯æŒå•ä¸ªå®ä¾‹ã€é›†ç¾¤ã€proxyã€äº‘ä¸‹çš„ Redis å®ä¾‹çš„æ•°æ®è¿ç§»\n\n\n\n\n\nè¿ç§»åé€šå¸¸éœ€è¦å¯¹æ¯”æºå®ä¾‹å’Œç›®çš„å®ä¾‹çš„æ•°æ®æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸ä¸€è‡´ï¼Œéœ€è¦æ‰¾å‡ºæ¥ï¼Œä»ç›®çš„å®ä¾‹å‰”é™¤æˆ–å†æ¬¡è¿ç§»ä¸ä¸€è‡´çš„æ•°æ®\n\n\né˜¿é‡Œäº‘å›¢é˜Ÿå¼€å‘çš„ Redis-full-check\n\nå¤šè½®æ¯”å¯¹\nä¸‰ç§å¯¹æ¯”æ¨¡å¼\n\n\n\n\n\n\n\né›†ç¾¤ç®¡ç†å·¥å…· CacheCloud\n\nå®ç°äº†ä¸»ä»é›†ç¾¤ã€å“¨å…µé›†ç¾¤ã€Redis Cluster çš„è‡ªåŠ¨éƒ¨ç½²å’Œç®¡ç†\næä¾› 5 ä¸ªè¿ç»´æ“ä½œå’Œä¸°å¯Œçš„ç›‘æ§ä¿¡æ¯\n\n\n\nè¯„è®ºåŒºï¼šçƒ­ key æŸ¥æ‰¾å·¥å…· redis-faina\n\n\nå…¶ä»–ç« èŠ‚æåˆ°çš„\n\n\nRedis å®¹é‡é¢„ä¼°å·¥å…·\n\n11ï½œâ€œä¸‡é‡‘æ²¹â€çš„ Stringï¼Œä¸ºä»€ä¹ˆä¸å¥½ç”¨äº†ï¼Ÿ\n\n\n\n\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜":{"title":"Redis æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜","links":["%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/00%EF%BD%9C%E5%BC%80%E7%AF%87%E8%AF%8D","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/01%EF%BD%9C%E5%9F%BA%E7%A1%80%E6%9E%B6%E6%9E%84%EF%BC%9A%E4%B8%80%E4%B8%AA%E9%94%AE%E5%80%BC%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8C%85%E5%90%AB%E4%BB%80%E4%B9%88%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/02%EF%BD%9C%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%9A%E5%BF%AB%E9%80%9F%E7%9A%84-Redis-%E6%9C%89%E5%93%AA%E4%BA%9B%E6%85%A2%E6%93%8D%E4%BD%9C%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/03%EF%BD%9C%E9%AB%98%E6%80%A7%E8%83%BD-IO-%E6%A8%A1%E5%9E%8B%EF%BC%9A%E4%B8%BA%E4%BB%80%E4%B9%88%E5%8D%95%E7%BA%BF%E7%A8%8B-Redis-%E9%82%A3%E4%B9%88%E5%BF%AB%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/04%EF%BD%9CAOF-%E6%97%A5%E5%BF%97%EF%BC%9A%E5%AE%95%E6%9C%BA%E4%BA%86%EF%BC%8CRedis-%E5%A6%82%E4%BD%95%E9%81%BF%E5%85%8D%E6%95%B0%E6%8D%AE%E4%B8%A2%E5%A4%B1%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/05%EF%BD%9C%E5%86%85%E5%AD%98%E5%BF%AB%E7%85%A7%EF%BC%9A%E5%AE%95%E6%9C%BA%E5%90%8E%EF%BC%8CRedis-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E5%BF%AB%E9%80%9F%E6%81%A2%E5%A4%8D%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/06%EF%BD%9C%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5%EF%BC%9A%E4%B8%BB%E4%BB%8E%E5%BA%93%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E4%B8%80%E8%87%B4%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/07%EF%BD%9C%E5%93%A8%E5%85%B5%E6%9C%BA%E5%88%B6%EF%BC%9A%E4%B8%BB%E5%BA%93%E6%8C%82%E4%BA%86%EF%BC%8C%E5%A6%82%E4%BD%95%E4%B8%8D%E9%97%B4%E6%96%AD%E6%9C%8D%E5%8A%A1%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/08%EF%BD%9C%E5%93%A8%E5%85%B5%E9%9B%86%E7%BE%A4%EF%BC%9A%E5%93%A8%E5%85%B5%E6%8C%82%E4%BA%86%EF%BC%8C%E4%B8%BB%E4%BB%8E%E5%BA%93%E8%BF%98%E8%83%BD%E5%88%87%E6%8D%A2%E5%90%97%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/09%EF%BD%9C%E5%88%87%E7%89%87%E9%9B%86%E7%BE%A4%EF%BC%9A%E6%95%B0%E6%8D%AE%E5%A2%9E%E5%A4%9A%E4%BA%86%EF%BC%8C%E6%98%AF%E8%AF%A5%E5%8A%A0%E5%86%85%E5%AD%98%E8%BF%98%E6%98%AF%E5%8A%A0%E5%AE%9E%E4%BE%8B%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/11%EF%BD%9C%E2%80%9C%E4%B8%87%E9%87%91%E6%B2%B9%E2%80%9D%E7%9A%84-String%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E5%A5%BD%E7%94%A8%E4%BA%86%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/12%EF%BD%9C%E6%9C%89%E4%B8%80%E4%BA%BF%E4%B8%AA-keys-%E8%A6%81%E7%BB%9F%E8%AE%A1%EF%BC%8C%E5%BA%94%E8%AF%A5%E7%94%A8%E5%93%AA%E7%A7%8D%E9%9B%86%E5%90%88%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/13%EF%BD%9CGEO-%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F%E8%BF%98%E5%8F%AF%E4%BB%A5%E5%AE%9A%E4%B9%89%E6%96%B0%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%90%97%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/14%EF%BD%9C%E5%A6%82%E4%BD%95%E5%9C%A8-Redis-%E4%B8%AD%E4%BF%9D%E5%AD%98%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%95%B0%E6%8D%AE%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/15%EF%BD%9C%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E7%9A%84%E8%80%83%E9%AA%8C%EF%BC%9ARedis-%E6%9C%89%E5%93%AA%E4%BA%9B%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/16%EF%BD%9C%E5%BC%82%E6%AD%A5%E6%9C%BA%E5%88%B6%EF%BC%9A%E5%A6%82%E4%BD%95%E9%81%BF%E5%85%8D%E5%8D%95%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B%E7%9A%84%E9%98%BB%E5%A1%9E%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/17%EF%BD%9C%E4%B8%BA%E4%BB%80%E4%B9%88-CPU-%E7%BB%93%E6%9E%84%E4%B9%9F%E4%BC%9A%E5%BD%B1%E5%93%8D-Redis-%E7%9A%84%E6%80%A7%E8%83%BD%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/18%EF%BD%9C%E6%B3%A2%E5%8A%A8%E7%9A%84%E5%93%8D%E5%BA%94%E5%BB%B6%E8%BF%9F%EF%BC%9A%E5%A6%82%E4%BD%95%E5%BA%94%E5%AF%B9%E5%8F%98%E6%85%A2%E7%9A%84-Redis%EF%BC%9F%EF%BC%88%E4%B8%8A%EF%BC%89","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/19%EF%BD%9C%E6%B3%A2%E5%8A%A8%E7%9A%84%E5%93%8D%E5%BA%94%E5%BB%B6%E8%BF%9F%EF%BC%9A%E5%A6%82%E4%BD%95%E5%BA%94%E5%AF%B9%E5%8F%98%E6%85%A2%E7%9A%84-Redis%EF%BC%9F%EF%BC%88%E4%B8%8B%EF%BC%89","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/20%EF%BD%9C%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E5%90%8E%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E5%86%85%E5%AD%98%E5%8D%A0%E7%94%A8%E7%8E%87%E8%BF%98%E6%98%AF%E5%BE%88%E9%AB%98%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/21%EF%BD%9C%E7%BC%93%E5%86%B2%E5%8C%BA%EF%BC%9A%E4%B8%80%E4%B8%AA%E5%8F%AF%E8%83%BD%E5%BC%95%E5%8F%91%E2%80%9C%E6%83%A8%E6%A1%88%E2%80%9D%E7%9A%84%E5%9C%B0%E6%96%B9","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/22%EF%BD%9C%E7%AC%AC-11%EF%BD%9E21-%E8%AE%B2%E8%AF%BE%E5%90%8E%E6%80%9D%E8%80%83%E9%A2%98%E7%AD%94%E6%A1%88%E5%8F%8A%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E7%AD%94%E7%96%91","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/23%EF%BD%9C%E6%97%81%E8%B7%AF%E7%BC%93%E5%AD%98%EF%BC%9ARedis-%E6%98%AF%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C%E7%9A%84%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/24%EF%BD%9C%E6%9B%BF%E6%8D%A2%E7%AD%96%E7%95%A5%EF%BC%9A%E7%BC%93%E5%AD%98%E6%BB%A1%E4%BA%86%E6%80%8E%E4%B9%88%E5%8A%9E%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/25%EF%BD%9C%E7%BC%93%E5%AD%98%E5%BC%82%E5%B8%B8%EF%BC%88%E4%B8%8A%EF%BC%89%EF%BC%9A%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E7%BC%93%E5%AD%98%E5%92%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%95%B0%E6%8D%AE%E4%B8%8D%E4%B8%80%E8%87%B4%E9%97%AE%E9%A2%98%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/26%EF%BD%9C%E7%BC%93%E5%AD%98%E5%BC%82%E5%B8%B8%EF%BC%88%E4%B8%8B%EF%BC%89%EF%BC%9A%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9%E3%80%81%E5%87%BB%E7%A9%BF%E3%80%81%E7%A9%BF%E9%80%8F%E9%9A%BE%E9%A2%98%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/27%EF%BD%9C%E7%BC%93%E5%AD%98%E8%A2%AB%E6%B1%A1%E6%9F%93%E4%BA%86%EF%BC%8C%E8%AF%A5%E6%80%8E%E4%B9%88%E5%8A%9E%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/28%EF%BD%9CPika%EF%BC%9A%E5%A6%82%E4%BD%95%E5%9F%BA%E4%BA%8E-SSD-%E5%AE%9E%E7%8E%B0%E5%A4%A7%E5%AE%B9%E9%87%8F-Redis%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/29%EF%BD%9C%E6%97%A0%E9%94%81%E7%9A%84%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C%EF%BC%9ARedis-%E5%A6%82%E4%BD%95%E5%BA%94%E5%AF%B9%E5%B9%B6%E5%8F%91%E8%AE%BF%E9%97%AE%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/30%EF%BD%9C%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8-Redis-%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/31%EF%BD%9C%E4%BA%8B%E5%8A%A1%E6%9C%BA%E5%88%B6%EF%BD%9CRedis-%E8%83%BD%E5%AE%9E%E7%8E%B0-ACID-%E5%B1%9E%E6%80%A7%E5%90%97%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/32%EF%BD%9CRedis-%E4%B8%BB%E4%BB%8E%E5%90%8C%E6%AD%A5%E4%B8%8E%E6%95%85%E9%9A%9C%E5%88%87%E6%8D%A2%EF%BC%8C%E6%9C%89%E5%93%AA%E4%BA%9B%E5%9D%91%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/33%EF%BD%9C%E8%84%91%E8%A3%82%EF%BC%9A%E4%B8%80%E6%AC%A1%E5%A5%87%E6%80%AA%E7%9A%84%E6%95%B0%E6%8D%AE%E4%B8%A2%E5%A4%B1","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/35%EF%BD%9CCodis-VS-Redis-Cluster%EF%BC%9A%E6%88%91%E8%AF%A5%E9%80%89%E6%8B%A9%E5%93%AA%E4%B8%80%E4%B8%AA%E9%9B%86%E7%BE%A4%E6%96%B9%E6%A1%88%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/36%EF%BD%9CRedis-%E6%94%AF%E6%92%91%E7%A7%92%E6%9D%80%E5%9C%BA%E6%99%AF%E7%9A%84%E5%85%B3%E9%94%AE%E6%8A%80%E6%9C%AF%E5%92%8C%E5%AE%9E%E8%B7%B5%E9%83%BD%E6%9C%89%E5%93%AA%E4%BA%9B%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/37%EF%BD%9C%E6%95%B0%E6%8D%AE%E5%88%86%E5%B8%83%E4%BC%98%E5%8C%96%EF%BC%9A%E5%A6%82%E4%BD%95%E5%BA%94%E5%AF%B9%E6%95%B0%E6%8D%AE%E5%80%BE%E6%96%9C%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/38%EF%BD%9C%E9%80%9A%E4%BF%A1%E5%BC%80%E9%94%80%EF%BC%9A%E9%99%90%E5%88%B6-Redis-Cluster-%E8%A7%84%E6%A8%A1%E7%9A%84%E5%85%B3%E9%94%AE%E5%9B%A0%E7%B4%A0","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/39%EF%BD%9CRedis-6.0-%E7%9A%84%E6%96%B0%E7%89%B9%E6%80%A7%EF%BC%9A%E5%A4%9A%E7%BA%BF%E7%A8%8B%E3%80%81%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%BC%93%E5%AD%98%E4%B8%8E%E5%AE%89%E5%85%A8","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/40%EF%BD%9CRedis-%E7%9A%84%E4%B8%8B%E4%B8%80%E6%AD%A5%EF%BC%9A%E5%9F%BA%E4%BA%8E-NVM-%E5%86%85%E5%AD%98%E7%9A%84%E5%AE%9E%E8%B7%B5","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/41%EF%BD%9C%E7%AC%AC-35%EF%BD%9E40-%E8%AE%B2%E8%AF%BE%E5%90%8E%E6%80%9D%E8%80%83%E9%A2%98%E7%AD%94%E6%A1%88%E5%8F%8A%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E7%AD%94%E7%96%91","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/%E7%BB%8F%E5%85%B8%E7%9A%84-Redis-%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%96%99","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/Redis-%E5%AD%A6%E4%B9%A0%E8%B7%AF%E5%BE%84","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/Redis-%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%A6%82%E4%BD%95%E4%B8%8E%E6%9C%8D%E5%8A%A1%E7%AB%AF%E4%BA%A4%E6%8D%A2%E5%91%BD%E4%BB%A4%E5%92%8C%E6%95%B0%E6%8D%AE%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/Redis-%E6%9C%89%E5%93%AA%E4%BA%9B%E5%A5%BD%E7%94%A8%E7%9A%84%E8%BF%90%E7%BB%B4%E5%B7%A5%E5%85%B7%EF%BC%9F","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/Redis-%E7%9A%84%E4%BD%BF%E7%94%A8%E8%A7%84%E8%8C%83%E5%B0%8F%E5%BB%BA%E8%AE%AE","%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E6%88%98/%E4%BB%8E%E5%BE%AE%E5%8D%9A%E7%9A%84-Redis-%E5%AE%9E%E8%B7%B5%E4%B8%AD%EF%BC%8C%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E5%AD%A6%E5%88%B0%E5%93%AA%E4%BA%9B%E7%BB%8F%E9%AA%8C%EF%BC%9F"],"tags":["redis","æå®¢æ—¶é—´"],"content":"\nå†…å®¹æ•´ç†è‡ªæå®¢æ—¶é—´ã€ŠRedis æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜ã€‹\n\nåŸºç¡€ç¯‡ Â§\n\n00ï½œå¼€ç¯‡è¯\n01ï½œåŸºç¡€æ¶æ„ï¼šä¸€ä¸ªé”®å€¼æ•°æ®åº“åŒ…å«ä»€ä¹ˆï¼Ÿ\n02ï½œæ•°æ®ç»“æ„ï¼šå¿«é€Ÿçš„ Redis æœ‰å“ªäº›æ…¢æ“ä½œï¼Ÿ\n03ï½œé«˜æ€§èƒ½ IO æ¨¡å‹ï¼šä¸ºä»€ä¹ˆå•çº¿ç¨‹ Redis é‚£ä¹ˆå¿«ï¼Ÿ\n04ï½œAOF æ—¥å¿—ï¼šå®•æœºäº†ï¼ŒRedis å¦‚ä½•é¿å…æ•°æ®ä¸¢å¤±ï¼Ÿ\n05ï½œå†…å­˜å¿«ç…§ï¼šå®•æœºåï¼ŒRedis å¦‚ä½•å®ç°å¿«é€Ÿæ¢å¤ï¼Ÿ\n06ï½œæ•°æ®åŒæ­¥ï¼šä¸»ä»åº“å¦‚ä½•å®ç°æ•°æ®ä¸€è‡´ï¼Ÿ\n07ï½œå“¨å…µæœºåˆ¶ï¼šä¸»åº“æŒ‚äº†ï¼Œå¦‚ä½•ä¸é—´æ–­æœåŠ¡ï¼Ÿ\n08ï½œå“¨å…µé›†ç¾¤ï¼šå“¨å…µæŒ‚äº†ï¼Œä¸»ä»åº“è¿˜èƒ½åˆ‡æ¢å—ï¼Ÿ\n09ï½œåˆ‡ç‰‡é›†ç¾¤ï¼šæ•°æ®å¢å¤šäº†ï¼Œæ˜¯è¯¥åŠ å†…å­˜è¿˜æ˜¯åŠ å®ä¾‹ï¼Ÿ\n\nå®è·µç¯‡ Â§\n\n11ï½œâ€œä¸‡é‡‘æ²¹â€çš„ Stringï¼Œä¸ºä»€ä¹ˆä¸å¥½ç”¨äº†ï¼Ÿ\n12ï½œæœ‰ä¸€äº¿ä¸ª keys è¦ç»Ÿè®¡ï¼Œåº”è¯¥ç”¨å“ªç§é›†åˆï¼Ÿ\n13ï½œGEO æ˜¯ä»€ä¹ˆï¼Ÿè¿˜å¯ä»¥å®šä¹‰æ–°çš„æ•°æ®ç±»å‹å—ï¼Ÿ\n14ï½œå¦‚ä½•åœ¨ Redis ä¸­ä¿å­˜æ—¶é—´åºåˆ—æ•°æ®ï¼Ÿ\n15ï½œæ¶ˆæ¯é˜Ÿåˆ—çš„è€ƒéªŒï¼šRedis æœ‰å“ªäº›è§£å†³æ–¹æ¡ˆï¼Ÿ\n16ï½œå¼‚æ­¥æœºåˆ¶ï¼šå¦‚ä½•é¿å…å•çº¿ç¨‹æ¨¡å‹çš„é˜»å¡ï¼Ÿ\n17ï½œä¸ºä»€ä¹ˆ CPU ç»“æ„ä¹Ÿä¼šå½±å“ Redis çš„æ€§èƒ½ï¼Ÿ\n18ï½œæ³¢åŠ¨çš„å“åº”å»¶è¿Ÿï¼šå¦‚ä½•åº”å¯¹å˜æ…¢çš„ Redisï¼Ÿï¼ˆä¸Šï¼‰\n19ï½œæ³¢åŠ¨çš„å“åº”å»¶è¿Ÿï¼šå¦‚ä½•åº”å¯¹å˜æ…¢çš„ Redisï¼Ÿï¼ˆä¸‹ï¼‰\n20ï½œåˆ é™¤æ•°æ®åï¼Œä¸ºä»€ä¹ˆå†…å­˜å ç”¨ç‡è¿˜æ˜¯å¾ˆé«˜ï¼Ÿ\n21ï½œç¼“å†²åŒºï¼šä¸€ä¸ªå¯èƒ½å¼•å‘â€œæƒ¨æ¡ˆâ€çš„åœ°æ–¹\n22ï½œç¬¬ 11ï½21 è®²è¯¾åæ€è€ƒé¢˜ç­”æ¡ˆåŠå¸¸è§é—®é¢˜ç­”ç–‘\n23ï½œæ—è·¯ç¼“å­˜ï¼šRedis æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ\n24ï½œæ›¿æ¢ç­–ç•¥ï¼šç¼“å­˜æ»¡äº†æ€ä¹ˆåŠï¼Ÿ\n25ï½œç¼“å­˜å¼‚å¸¸ï¼ˆä¸Šï¼‰ï¼šå¦‚ä½•è§£å†³ç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜ï¼Ÿ\n26ï½œç¼“å­˜å¼‚å¸¸ï¼ˆä¸‹ï¼‰ï¼šå¦‚ä½•è§£å†³ç¼“å­˜é›ªå´©ã€å‡»ç©¿ã€ç©¿é€éš¾é¢˜ï¼Ÿ\n27ï½œç¼“å­˜è¢«æ±¡æŸ“äº†ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ\n28ï½œPikaï¼šå¦‚ä½•åŸºäº SSD å®ç°å¤§å®¹é‡ Redisï¼Ÿ\n29ï½œæ— é”çš„åŸå­æ“ä½œï¼šRedis å¦‚ä½•åº”å¯¹å¹¶å‘è®¿é—®ï¼Ÿ\n30ï½œå¦‚ä½•ä½¿ç”¨ Redis å®ç°åˆ†å¸ƒå¼é”ï¼Ÿ\n31ï½œäº‹åŠ¡æœºåˆ¶ï½œRedis èƒ½å®ç° ACID å±æ€§å—ï¼Ÿ\n32ï½œRedis ä¸»ä»åŒæ­¥ä¸æ•…éšœåˆ‡æ¢ï¼Œæœ‰å“ªäº›å‘ï¼Ÿ\n33ï½œè„‘è£‚ï¼šä¸€æ¬¡å¥‡æ€ªçš„æ•°æ®ä¸¢å¤±\n35ï½œCodis VS Redis Clusterï¼šæˆ‘è¯¥é€‰æ‹©å“ªä¸€ä¸ªé›†ç¾¤æ–¹æ¡ˆï¼Ÿ\n36ï½œRedis æ”¯æ’‘ç§’æ€åœºæ™¯çš„å…³é”®æŠ€æœ¯å’Œå®è·µéƒ½æœ‰å“ªäº›ï¼Ÿ\n37ï½œæ•°æ®åˆ†å¸ƒä¼˜åŒ–ï¼šå¦‚ä½•åº”å¯¹æ•°æ®å€¾æ–œï¼Ÿ\n38ï½œé€šä¿¡å¼€é”€ï¼šé™åˆ¶ Redis Cluster è§„æ¨¡çš„å…³é”®å› ç´ \n\næœªæ¥ç¯‡ Â§\n\n39ï½œRedis 6.0 çš„æ–°ç‰¹æ€§ï¼šå¤šçº¿ç¨‹ã€å®¢æˆ·ç«¯ç¼“å­˜ä¸å®‰å…¨\n40ï½œRedis çš„ä¸‹ä¸€æ­¥ï¼šåŸºäº NVM å†…å­˜çš„å®è·µ\n41ï½œç¬¬ 35ï½40 è®²è¯¾åæ€è€ƒé¢˜ç­”æ¡ˆåŠå¸¸è§é—®é¢˜ç­”ç–‘\n\nåŠ é¤ç¯‡ Â§\n\nç»å…¸çš„ Redis å­¦ä¹ èµ„æ–™\nRedis å­¦ä¹ è·¯å¾„\nRedis å®¢æˆ·ç«¯å¦‚ä½•ä¸æœåŠ¡ç«¯äº¤æ¢å‘½ä»¤å’Œæ•°æ®ï¼Ÿ\nRedis æœ‰å“ªäº›å¥½ç”¨çš„è¿ç»´å·¥å…·ï¼Ÿ\nRedis çš„ä½¿ç”¨è§„èŒƒå°å»ºè®®\nä»å¾®åšçš„ Redis å®è·µä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å­¦åˆ°å“ªäº›ç»éªŒï¼Ÿ\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/Redis-çš„ä½¿ç”¨è§„èŒƒå°å»ºè®®":{"title":"Redis çš„ä½¿ç”¨è§„èŒƒå°å»ºè®®","links":[],"tags":["redis"],"content":"\n\né”®å€¼å¯¹ä½¿ç”¨è§„èŒƒ\n\n\n\n\né€šè¿‡å‘½ååŒºåˆ†ä¸åŒä¸šåŠ¡æ•°æ®\n\n\n\n\nSELECT å‘½ä»¤è¿›è¡Œæ•°æ®åº“åˆ‡æ¢ç›¸å½“äºå¢åŠ ä¸€ä¸ªé¢å¤–çš„æ“ä½œ\n\n\nä¸šåŠ¡åç¼©å†™ä½œä¸º key çš„å‰ç¼€\n\nå¯¹äºä¸šåŠ¡åæˆ–ä¸šåŠ¡æ•°æ®åï¼Œå¯ä»¥ä½¿ç”¨ç›¸åº”çš„è‹±æ–‡å•è¯çš„é¦–å­—æ¯è¡¨ç¤ºï¼Œï¼ˆæ¯”å¦‚ user ç”¨ u è¡¨ç¤ºï¼Œmessage ç”¨ mï¼‰ï¼Œæˆ–è€…æ˜¯ç”¨ç¼©å†™è¡¨ç¤ºï¼ˆä¾‹å¦‚ unique visitor ä½¿ç”¨ uvï¼‰ã€‚\n\n\n\n\n\n\n\né¿å…ä½¿ç”¨ bigkey\n\n\n\nå°½é‡æŠŠé›†åˆç±»å‹çš„å…ƒç´ ä¸ªæ•°æ§åˆ¶åœ¨ 1 ä¸‡ä»¥ä¸‹\næ§åˆ¶ String ç±»å‹æ•°æ®çš„å¤§å°ä¸è¶…è¿‡ 10KB\n\n\n\n\nä½¿ç”¨é«˜æ•ˆåºåˆ—åŒ–æ–¹æ³•å’Œå‹ç¼©æ–¹æ³•å‡å° value çš„å¤§å°\n\n\n\n\n\nä½¿ç”¨æ•´æ•°å¯¹è±¡å…±äº«æ± \n\n\n\n\nå¦‚æœä¸€ä¸ªé”®å€¼å¯¹ä¸­æœ‰ 0 åˆ° 9999 èŒƒå›´çš„æ•´æ•°ï¼ŒRedis ä¼šæœç”¨å…±äº«æ± ä¸­çš„æ•´æ•°å¯¹è±¡\n\n\nä¸èƒ½ç”¨çš„æƒ…å†µ\n\n\n\nRedis è®¾ç½®äº† maxmemory å¹¶ä¸”å¯ç”¨ LRU ç­–ç•¥ï¼Œå› ä¸º LRU ç­–ç•¥éœ€è¦ç»Ÿè®¡æ¯ä¸ªé”®å€¼å¯¹çš„ä½¿ç”¨æ—¶é—´\n\n\n\n\né›†åˆç±»å‹æ•°æ®é‡‡ç”¨ ziplist ç¼–ç ï¼Œè€Œé›†åˆå…ƒç´ æ˜¯æ•´æ•°ï¼Œåˆ¤æ–­æ•´æ•°å¯¹è±¡çš„å…±äº«æƒ…å†µæ•ˆç‡ä½\n\n\n\n\n\n\n\n\n\næ•°æ®ä¿å­˜è§„èŒƒ\n\n\n\nä½¿ç”¨ Redis ä¿å­˜çƒ­æ•°æ®\n\n\n\n\nä¸åŒçš„ä¸šåŠ¡æ•°æ®åˆ†å®ä¾‹å­˜å‚¨\n\n\n\n\nåœ¨æ•°æ®ä¿å­˜æ—¶è¦è®¾ç½®è¿‡æœŸæ—¶é—´\n\n\n\n\n\næ§åˆ¶ Redis å®ä¾‹çš„å®¹é‡\n\n\n\n\nå•å®ä¾‹ä¸è¦å¤ªå¤§ï¼Œå»ºè®®è®¾ç½®åœ¨ 2ï½6GB\n\nRDB å¿«ç…§ã€ä¸»ä»é›†ç¾¤æ•°æ®åŒæ­¥éƒ½èƒ½å¾ˆå¿«å®Œæˆ\n\n\n\n\n\n\n\nå‘½ä»¤ä½¿ç”¨è§„èŒƒ\n\n\n\n\nçº¿ä¸Šç¦ç”¨éƒ¨åˆ†å‘½ä»¤\n\n\n\n\nKEYSã€FLUSHALLã€FLUSHDB\n\nä¸¥é‡é˜»å¡ä¸»çº¿ç¨‹\n\n\n\nå…·ä½“çš„åšæ³•ï¼šç®¡ç†å‘˜ç”¨ rename-command å‘½ä»¤åœ¨é…ç½®æ–‡ä»¶ä¸­é‡å‘½åè¿™äº›å‘½ä»¤\n\n\næ›¿ä»£ï¼šSCANã€ASYNC é€‰é¡¹ï¼ˆåˆ†åˆ«å¯¹åº”ä¸Šé¢çš„ KEYSï¼ŒFLUSHALLã€FLUSHDBï¼‰\n\n\n\n\n\n\næ…ç”¨ MONITOR å‘½ä»¤\n\n\n\nä¼šæŠŠç›‘æ§åˆ°çš„å†…å®¹æŒç»­å†™å…¥åˆ°è¾“å‡ºç¼“å†²åŒºï¼Œå¯èƒ½å¾ˆå¿«æº¢å‡ºï¼Œå¯¹æ€§èƒ½é€ æˆå½±å“ç”šè‡³å¼•èµ·æœåŠ¡å´©æºƒ\n\n\n\n\n\næ…ç”¨å…¨é‡æ“ä½œå‘½ä»¤\n\n\n\n\nHGETALLã€SMEMBERS ç­‰\n\nå…¨é‡æ‰«æ\n\n\n\nå»ºè®®\n\n\n\nä½¿ç”¨ SSCANã€HSCAN å‘½ä»¤åˆ†æ‰¹è¿”å›é›†åˆä¸­çš„æ•°æ®\n\n\n\n\nå¤§é›†åˆæ‹†åˆ†æˆå°é›†åˆ\n\n\n\n\nå¦‚æœé›†åˆç±»å‹ä¿å­˜çš„æ˜¯ä¸šåŠ¡æ•°æ®çš„å¤šä¸ªå±æ€§ï¼Œè€Œæ¯æ¬¡æŸ¥è¯¢æ—¶ï¼Œä¹Ÿéœ€è¦è¿”å›è¿™äº›å±æ€§ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ String ç±»å‹ï¼Œå°†è¿™äº›å±æ€§åºåˆ—åŒ–åä¿å­˜ï¼Œæ¯æ¬¡ç›´æ¥è¿”å› String æ•°æ®ï¼Œä¸ç”¨å†å¯¹é›†åˆç±»å‹åšå…¨é‡æ‰«æ\n\n\n\n\n\n\n\n\n\nè§„èŒƒæ±‡æ€»\n\n\n\n\n\nå¼ºåˆ¶ç±»åˆ«çš„è§„èŒƒï¼šå¦‚æœä¸æŒ‰ç…§è§„èŒƒå†…å®¹æ¥æ‰§è¡Œï¼Œå°±ä¼šç»™ Redis çš„åº”ç”¨å¸¦æ¥æå¤§çš„è´Ÿé¢å½±å“ï¼Œä¾‹å¦‚æ€§èƒ½å—æŸã€‚\n\n\næ¨èç±»åˆ«çš„è§„èŒƒï¼šèƒ½æœ‰æ•ˆæå‡æ€§èƒ½ã€èŠ‚çœå†…å­˜ç©ºé—´ï¼Œæˆ–è€…æ˜¯å¢åŠ å¼€å‘å’Œè¿ç»´çš„ä¾¿æ·æ€§ï¼Œå¯ä»¥ç›´æ¥åº”ç”¨åˆ°å®è·µä¸­ã€‚\n\n\nå»ºè®®ç±»åˆ«çš„è§„èŒƒï¼šè¿™ç±»è§„èŒƒå†…å®¹å’Œå®é™…ä¸šåŠ¡åº”ç”¨ç›¸å…³ï¼Œç»“åˆè‡ªå·±çš„ä¸šåŠ¡åœºæ™¯å‚è€ƒä½¿ç”¨ã€‚\n\n\n\n\né¢å‘ä¸šåŠ¡å¼€å‘äººå‘˜\n\n\n\nkey çš„é•¿åº¦å°½é‡çŸ­ï¼ŒèŠ‚çœå†…å­˜ç©ºé—´\n\n\n\n\né¿å… bigkeyï¼Œé˜²æ­¢é˜»å¡ä¸»çº¿ç¨‹\n\n\n\n\n4.0+ ç‰ˆæœ¬å»ºè®®å¼€å¯ lazy-free\n\n\n\n\næŠŠ Redis å½“ä½œç¼“å­˜ä½¿ç”¨ï¼Œè®¾ç½®è¿‡æœŸæ—¶é—´\n\n\n\n\nä¸ä½¿ç”¨å¤æ‚åº¦è¿‡é«˜çš„å‘½ä»¤ï¼Œä¾‹å¦‚SORTã€SINTERã€SINTERSTOREã€ZUNIONSTOREã€ZINTERSTORE\n\n\n\n\næŸ¥è¯¢æ•°æ®å°½é‡ä¸ä¸€æ¬¡æ€§æŸ¥è¯¢å…¨é‡ï¼Œå†™å…¥å¤§é‡æ•°æ®å»ºè®®åˆ†å¤šæ‰¹å†™å…¥\n\n\n\n\næ‰¹é‡æ“ä½œå»ºè®® MGET/MSET æ›¿ä»£ GET/SETï¼ŒHMGET/HMSET æ›¿ä»£ HGET/HSET\n\n\n\n\nç¦æ­¢ä½¿ç”¨ KEYS/FLUSHALL/FLUSHDB å‘½ä»¤\n\n\n\n\né¿å…é›†ä¸­è¿‡æœŸ key\n\n\n\n\næ ¹æ®ä¸šåŠ¡åœºæ™¯é€‰æ‹©åˆé€‚çš„æ·˜æ±°ç­–ç•¥\n\n\n\n\nä½¿ç”¨è¿æ¥æ± æ“ä½œ Redisï¼Œå¹¶è®¾ç½®åˆç†çš„å‚æ•°ï¼Œé¿å…çŸ­è¿æ¥\n\n\n\n\nåªä½¿ç”¨ db0ï¼Œå‡å°‘ SELECT å‘½ä»¤çš„æ¶ˆè€—\n\n\n\n\nè¯»è¯·æ±‚é‡å¾ˆå¤§æ—¶ï¼Œå»ºè®®è¯»å†™åˆ†ç¦»ï¼Œå†™è¯·æ±‚é‡å¾ˆå¤§ï¼Œå»ºè®®ä½¿ç”¨åˆ‡ç‰‡é›†ç¾¤\n\n\n\n\n\né¢å‘ DBA è¿ç»´äººå‘˜\n\n\n\næŒ‰ä¸šåŠ¡çº¿éƒ¨ç½²å®ä¾‹ï¼Œé¿å…å¤šä¸ªä¸šåŠ¡çº¿æ··åˆéƒ¨ç½²ï¼Œå‡ºé—®é¢˜å½±å“å…¶ä»–ä¸šåŠ¡\n\n\n\n\nä¿è¯æœºå™¨æœ‰è¶³å¤Ÿçš„ CPUã€å†…å­˜ã€å¸¦å®½ã€ç£ç›˜èµ„æº\n\n\n\n\nå»ºè®®éƒ¨ç½²ä¸»ä»é›†ç¾¤ï¼Œå¹¶åˆ†å¸ƒåœ¨ä¸åŒæœºå™¨ä¸Šï¼Œslave è®¾ç½®ä¸º readonly\n\n\n\n\nä¸»ä»èŠ‚ç‚¹æ‰€éƒ¨ç½²çš„æœºå™¨å„è‡ªç‹¬ç«‹ï¼Œå°½é‡é¿å…äº¤å‰éƒ¨ç½²ï¼Œå¯¹ä»èŠ‚ç‚¹åšç»´æŠ¤æ—¶ï¼Œä¸ä¼šå½±å“åˆ°ä¸»èŠ‚ç‚¹\n\n\n\n\næ¨èéƒ¨ç½²å“¨å…µé›†ç¾¤å®ç°æ•…éšœè‡ªåŠ¨åˆ‡æ¢ï¼Œå“¨å…µèŠ‚ç‚¹åˆ†å¸ƒåœ¨ä¸åŒæœºå™¨ä¸Š\n\n\n\n\næå‰åšå¥½å®¹é‡è§„åˆ’ï¼Œé˜²æ­¢ä¸»ä»å…¨é‡åŒæ­¥æ—¶ï¼Œå®ä¾‹ä½¿ç”¨å†…å­˜çªå¢å¯¼è‡´å†…å­˜ä¸è¶³\n\n\n\n\nåšå¥½æœºå™¨ CPUã€å†…å­˜ã€å¸¦å®½ã€ç£ç›˜ç›‘æ§ï¼Œèµ„æºä¸è¶³æ—¶åŠæ—¶æŠ¥è­¦ï¼Œä»»æ„èµ„æºä¸è¶³éƒ½ä¼šå½±å“ Redis æ€§èƒ½\n\n\n\n\nå®ä¾‹è®¾ç½®æœ€å¤§è¿æ¥æ•°ï¼Œé˜²æ­¢è¿‡å¤šå®¢æˆ·ç«¯è¿æ¥å¯¼è‡´å®ä¾‹è´Ÿè½½è¿‡é«˜ï¼Œå½±å“æ€§èƒ½\n\n\n\n\nå•ä¸ªå®ä¾‹å†…å­˜å»ºè®®æ§åˆ¶åœ¨ 10G ä»¥ä¸‹ï¼Œå¤§å®ä¾‹åœ¨ä¸»ä»å…¨é‡åŒæ­¥ã€å¤‡ä»½æ—¶æœ‰é˜»å¡é£é™©\n\n\n\n\nè®¾ç½®åˆç†çš„ slowlog é˜ˆå€¼ï¼Œå¹¶å¯¹å…¶è¿›è¡Œç›‘æ§ï¼Œslowlog è¿‡å¤šéœ€åŠæ—¶æŠ¥è­¦\n\n\n\n\nè®¾ç½®åˆç†çš„ repl-backlogï¼Œé™ä½ä¸»ä»å…¨é‡åŒæ­¥çš„æ¦‚ç‡\n\n\n\n\nè®¾ç½®åˆç†çš„ slave client-output-buffer-limitï¼Œé¿å…ä¸»ä»å¤åˆ¶ä¸­æ–­æƒ…å†µå‘ç”Ÿ\n\n\n\n\næ¨èåœ¨ä»èŠ‚ç‚¹ä¸Šå¤‡ä»½ï¼Œä¸å½±å“ä¸»èŠ‚ç‚¹æ€§èƒ½\n\n\n\n\nä¸å¼€å¯ AOF æˆ–å¼€å¯ AOF é…ç½®ä¸ºæ¯ç§’åˆ·ç›˜ï¼Œé¿å…ç£ç›˜ IO æ‹–æ…¢ Redis æ€§èƒ½\n\n\n\n\nè°ƒæ•´ maxmemory æ—¶ï¼Œæ³¨æ„ä¸»ä»èŠ‚ç‚¹çš„è°ƒæ•´é¡ºåºï¼Œé¡ºåºé”™è¯¯ä¼šå¯¼è‡´ä¸»ä»æ•°æ®ä¸ä¸€è‡´\n\n\n\n\nå¯¹å®ä¾‹éƒ¨ç½²ç›‘æ§ï¼Œé‡‡é›† INFO ä¿¡æ¯æ—¶é‡‡ç”¨é•¿è¿æ¥ï¼Œé¿å…é¢‘ç¹çš„çŸ­è¿æ¥\n\n\n\n\nåšå¥½å®ä¾‹è¿è¡Œæ—¶ç›‘æ§ï¼Œé‡ç‚¹å…³æ³¨ expired_keysã€evicted_keysã€latest_fork_usecï¼Œè¿™äº›æŒ‡æ ‡çŸ­æ—¶çªå¢å¯èƒ½ä¼šæœ‰é˜»å¡é£é™©\n\n\n\n\næ‰«æçº¿ä¸Šå®ä¾‹æ—¶ï¼Œè®°å¾—è®¾ç½®ä¼‘çœ æ—¶é—´ï¼Œé¿å…è¿‡é«˜ OPS äº§ç”Ÿæ€§èƒ½æŠ–åŠ¨\n\n\n\n\n\nã€ŠRedisæœ€ä½³å®è·µï¼š7ä¸ªç»´åº¦+43æ¡ä½¿ç”¨è§„èŒƒï¼Œå¸¦ä½ å½»åº•ç©è½¬Redisã€‹\n\n\nã€Šé˜¿é‡Œäº‘ï½œäº‘æ•°æ®åº“ Redis å¼€å‘è¿ç»´è§„èŒƒã€‹\n\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/ä»å¾®åšçš„-Redis-å®è·µä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å­¦åˆ°å“ªäº›ç»éªŒï¼Ÿ":{"title":"ä»å¾®åšçš„ Redis å®è·µä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å­¦åˆ°å“ªäº›ç»éªŒï¼Ÿ","links":[],"tags":["redis"],"content":"\n\nå¾®åšå¯¹ Redis çš„æŠ€æœ¯éœ€æ±‚\n\n\n\nèƒ½å¤Ÿæä¾›é«˜æ€§èƒ½ã€é«˜å¹¶å‘çš„è¯»å†™è®¿é—®ï¼Œä¿è¯è¯»å†™å»¶è¿Ÿä½\n\n\n\n\nèƒ½å¤Ÿæ”¯æŒå¤§å®¹é‡å­˜å‚¨\n\n\n\n\nå¯ä»¥çµæ´»æ‰©å±•ï¼Œå¯¹äºä¸åŒä¸šåŠ¡èƒ½è¿›è¡Œå¿«é€Ÿæ‰©å®¹\n\n\n\n\n\nå¯¹ Redis çš„åŸºæœ¬æ”¹è¿›\n\né¿å…é˜»å¡å’ŒèŠ‚çœå†…å­˜\næŒä¹…åŒ–éœ€æ±‚ï¼šä½¿ç”¨å…¨é‡ RDB + å¢é‡ AOF å¤åˆ¶\nåœ¨ AOF æ—¥å¿—å†™å…¥åˆ·ç›˜æ—¶ï¼Œç”¨é¢å¤–çš„ BIO çº¿ç¨‹è´Ÿè´£å®é™…çš„åˆ·ç›˜å·¥ä½œï¼Œé¿å… AOF æ—¥å¿—æ…¢é€Ÿåˆ·ç›˜é˜»å¡ä¸»çº¿ç¨‹\nå¢åŠ  aofnumber é…ç½®é¡¹è®¾ç½® AOF æ–‡ä»¶çš„æ•°é‡\nä½¿ç”¨ç‹¬ç«‹çš„å¤åˆ¶çº¿ç¨‹è¿›è¡Œä¸»ä»åº“åŒæ­¥ï¼Œé¿å…å¯¹ä¸»çº¿ç¨‹çš„é˜»å¡å½±å“\n\n\n\nå®šåˆ¶åŒ–è®¾è®¡äº† LongSet æ•°æ®ç±»å‹\n\n\næ•°æ®åŒºåˆ†å†·çƒ­åº¦\n\nç”¨å¼‚æ­¥çº¿ç¨‹å°†å†·æ•°æ®ä» Redis è¿ç§»åˆ° RocksDBï¼Œä¿å­˜åˆ°ç¡¬ç›˜ä¸­\n\n\n\n\n\n\n\næœåŠ¡åŒ–æ”¹é€ \n\n\nä½¿ç”¨ Redis é›†ç¾¤æœåŠ¡ä¸åŒçš„ä¸šåŠ¡åœºæ™¯éœ€æ±‚ï¼Œæ¯ä¸€ä¸ªä¸šåŠ¡æ‹¥æœ‰ç‹¬ç«‹çš„èµ„æº\n\n\næ‰€æœ‰çš„ Redis å®ä¾‹å½¢æˆèµ„æºæ± ï¼Œè½»æ¾æ‰©å®¹\n\n\né‡‡ç”¨ç±»ä¼¼ Codis çš„æ–¹æ¡ˆï¼Œé€šè¿‡é›†ç¾¤ä»£ç†å±‚è¿æ¥å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯\n\nå®¢æˆ·ç«¯è¿æ¥ç›‘å¬å’Œç«¯å£è‡ªåŠ¨å¢åˆ \nRedis åè®®è§£æï¼šç¡®å®šéœ€è¦è·¯ç”±çš„è¯·æ±‚ï¼Œå¦‚æœæ˜¯éæ³•å’Œä¸æ”¯æŒçš„è¯·æ±‚ï¼Œç›´æ¥è¿”å›é”™è¯¯\nè¯·æ±‚è·¯ç”±ï¼šæ ¹æ®æ•°æ®å’Œåç«¯å®ä¾‹é—´çš„æ˜ å°„è§„åˆ™ï¼Œå°†è¯·æ±‚è·¯ç”±åˆ°å¯¹åº”çš„åç«¯å®ä¾‹è¿›è¡Œå¤„ç†ï¼Œå¹¶å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯\næŒ‡æ ‡é‡‡é›†ç›‘æ§ï¼šé‡‡é›†é›†ç¾¤è¿è¡Œçš„çŠ¶æ€ï¼Œå¹¶å‘é€åˆ°ä¸“é—¨çš„å¯è§†åŒ–ç»„ä»¶ï¼Œç”±è¿™äº›ç»„ä»¶è¿›è¡Œç›‘æ§å¤„ç†\né…ç½®ä¸­å¿ƒï¼šç®¡ç†æ•´ä¸ªé›†ç¾¤çš„å…ƒæ•°æ®\n\n\n\nå¾®åš Redis æœåŠ¡åŒ–é›†ç¾¤æ¶æ„å›¾\n\n\n\n\n\n\n\nä¸‡äº¿çº§æ—¥è®¿é—®é‡ä¸‹ï¼ŒRedis åœ¨å¾®åšçš„ 9 å¹´ä¼˜åŒ–å†ç¨‹\n\n"},"å­¦ä¹ ç¬”è®°/Redis-æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜/ç»å…¸çš„-Redis-å­¦ä¹ èµ„æ–™":{"title":"ç»å…¸çš„ Redis å­¦ä¹ èµ„æ–™","links":[],"tags":["redis"],"content":"\n\nå·¥å…·ä¹¦ï¼šã€ŠRedis ä½¿ç”¨æ‰‹å†Œã€‹\n\n\næœ€æœ‰ç”¨çš„æ˜¯ã€Œæ•°æ®ç»“æ„ä¸åº”ç”¨ã€çš„å†…å®¹\n\n\nå·¥å…·ç½‘ç«™\n\nRedis å‘½ä»¤å‚è€ƒ\n\n\n\n\n\nåŸç†ä¹¦ï¼šã€ŠRedis è®¾è®¡ä¸å®ç°ã€‹\n\né‡ç‚¹å­¦ä¹  Redis åº•å±‚æ•°æ®ç»“æ„ã€RDB å’Œ AOF æŒä¹…åŒ–æœºåˆ¶ã€å“¨å…µæœºåˆ¶å’Œåˆ‡ç‰‡é›†ç¾¤çš„ä»‹ç»\nå‡ºç‰ˆæ—¥æœŸè¾ƒæ—©ï¼Œé’ˆå¯¹çš„æ˜¯ Redis 3.0\n\n\n\nå®æˆ˜ä¹¦ï¼šã€ŠRedis å¼€å‘ä¸è¿ç»´ã€‹\n\nä»‹ç»äº† Redis çš„ Java å’Œ Python å®¢æˆ·ç«¯ï¼Œä»¥åŠ Redis ç”¨äºç¼“å­˜è®¾è®¡çš„å…³é”®æŠ€æœ¯å’Œæ³¨æ„äº‹é¡¹ï¼Œè¿™äº›å†…å®¹åœ¨å…¶ä»–å‚è€ƒä¹¦ä¸­ä¸å¤ªå¸¸è§ï¼Œé‡ç‚¹å­¦ä¹ \nå›´ç»•å®¢æˆ·ç«¯ã€æŒä¹…åŒ–ã€ä¸»ä»å¤åˆ¶ã€å“¨å…µã€åˆ‡ç‰‡é›†ç¾¤ç­‰å‡ ä¸ªæ–¹é¢ï¼Œç€é‡ä»‹ç»äº†åœ¨æ—¥å¸¸çš„å¼€å‘è¿ç»´è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜å’Œâ€œå‘â€ï¼Œéƒ½æ˜¯ç»éªŒä¹‹è°ˆï¼Œå¯ä»¥å¸®åŠ©æå‰åšè§„é¿\né’ˆå¯¹ Redis é˜»å¡ã€ä¼˜åŒ–å†…å­˜ä½¿ç”¨ã€å¤„ç† bigkey è¿™å‡ ä¸ªç»å…¸é—®é¢˜ï¼Œæä¾›äº†è§£å†³æ–¹æ¡ˆ\n\n\n\næ‰©å±•é˜…è¯»\n\n\nã€Šæ“ä½œç³»ç»Ÿå¯¼è®ºã€‹\n\nå’Œ Redis ç›´æ¥ç›¸å…³çš„éƒ¨åˆ†ï¼šå¯¹è¿›ç¨‹ã€çº¿ç¨‹çš„å®šä¹‰ï¼Œå¯¹è¿›ç¨‹ APIã€çº¿ç¨‹ API ä»¥åŠå¯¹æ–‡ä»¶ç³»ç»Ÿ fsync æ“ä½œã€ç¼“å­˜å’Œç¼“å†²çš„ä»‹ç»\n\n\n\nã€Šå¤§è§„æ¨¡åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿï¼šåŸç†è§£æä¸æ¶æ„å®æˆ˜ã€‹\n\nåˆ†å¸ƒå¼ç³»ç»Ÿç« èŠ‚\n\n\n\nRedis çš„å…³é”®æœºåˆ¶å’Œæ“ä½œç³»ç»Ÿã€åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¯¹åº”çŸ¥è¯†ç‚¹\n\n\n\n\n\n\n\nã€ŠRedis æ·±åº¦å†é™©ï¼šæ ¸å¿ƒåŸç†ä¸åº”ç”¨å®è·µã€‹\n\n"},"å·¥å…·/Mac/Mac-åº”ç”¨å·²æŸå":{"title":"Mac åº”ç”¨å·²æŸå","links":[],"tags":["mac"],"content":"\nå®‰è£…åæ‰“å¼€æç¤ºå·²æŸåæ—¶æ‰§è¡Œå‘½ä»¤ï¼šsudo xattr -d com.apple.quarantine &quot;/Applications/{appName}.app&quot;\n"},"å·¥å…·/Mac/iCloud-ä¸åŒæ­¥æŒ‡å®šæ–‡ä»¶":{"title":"iCloud ä¸åŒæ­¥æŒ‡å®šæ–‡ä»¶","links":[],"tags":["icloud"],"content":"è¯´æ˜ Â§\niCloud ä¸åŒæ­¥å¸¦æœ‰ .nosync åç¼€çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹\nä½¿ç”¨åœºæ™¯ Â§\nåœ¨ iCloud ä¸­å¿½ç•¥ .git ä¸” Git å‘½ä»¤å¯ä»¥æ­£å¸¸ä½¿ç”¨ Â§\ncd repo\nmv .git .git.nosync\nln -s .git.nosync .git"},"å·¥å…·/Mac/iCloud-åŒæ­¥å¡ä½":{"title":"iCloud åŒæ­¥å¡ä½","links":[],"tags":["mac","icloud"],"content":"è§£å†³æ–¹æ¡ˆ Â§\n\n\n~/.zshrc\n# ~/.zshrc\nalias killicloud=&#039;killall bird &amp;&amp; killall cloudd&#039;\n\n\nç»ˆç«¯æ‰§è¡Œå‘½ä»¤ kill iCloud è¿›ç¨‹\nkillicloud\n\n\nç‚¹å‡»è®¿è¾¾ä¾§è¾¹æ çš„ iCloud ï¼Œè§‚å¯ŸåŒæ­¥è¿›åº¦ï¼Œè‹¥è¿˜æ˜¯å¡ä½ï¼Œç»§ç»­ kill iCloud è¿›ç¨‹ç›´åˆ°æ­£å¸¸\n\n\n\n\n\n\næ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡ç¡®ä¿ iCloud åŒæ­¥\n$ crontab -e\n0 * * * * killall bird &amp;&amp; killall cloudd # æ¯å°æ—¶ kill ä¸€æ¬¡ iCloud è¿›ç¨‹\n\n\nå‚è€ƒ Â§\n\nä¸€æ—¥ä¸€æŠ€ | Mac ä¸Š iCloud äº‘ç›˜åŒæ­¥å¡ä½äº†ï¼Ÿå¯ä»¥è¯•è¯•è¿™æ ·åš\n"},"å·¥å…·/Mac/å¼€å‘ç¯å¢ƒ":{"title":"å¼€å‘ç¯å¢ƒ","links":["%E5%B7%A5%E5%85%B7/%E8%BD%AF%E4%BB%B6/Capslock","%E5%B7%A5%E5%85%B7/%E8%BD%AF%E4%BB%B6/Obsidian","%E5%B7%A5%E5%85%B7/%E8%BD%AF%E4%BB%B6/Oh-My-Zsh"],"tags":["å¼€å‘","è®¾ç½®","å·¥å…·","mac"],"content":"è®¾å¤‡ Â§\n\nM1 MacBook Pro 14\nå…ˆæ›´æ–°ç³»ç»Ÿ\n\nHomebrew Â§\n\nå®˜ç½‘\n\nbrew tap homebrew/cask-drivers\nbrew tap homebrew/cask-fonts\nbrew tap homebrew/cask-versions\nbrew tap buo/cask-upgrade\nbrew tap mongodb/brew\n \nbrew install git git-lfs git-flow\ngit config --global core.autocrlf false # ä¸è‡ªåŠ¨è½¬æ¢ CRLF\ngit config --global core.ignorecase false # åŒºåˆ†å¤§å°å†™\ngit config --global init.defaultBranch main\ngit config --global remote.origin.prune true # è‡ªåŠ¨ç§»é™¤å¤šä½™è¿œç«¯åˆ†æ”¯\ngit config --global user.name username # æ³¨æ„ä¸è¦ç…§æŠ„\ngit config --global user.email email # æ³¨æ„ä¸è¦ç…§æŠ„\n \nbrew install font-jetbrains-mono\nbrew install font-lxgw-wenkai\n \n# è®¿è¾¾æ’ä»¶\nbrew install --cask qlmarkdown # Markdown\nbrew install --cask --no-quarantine syntax-highlight # ä»£ç é«˜äº®\nbrew install --cask qlstephen # æŸ¥çœ‹æ²¡æœ‰æ–‡ä»¶æ‰©å±•åçš„çº¯æ–‡æœ¬æ–‡ä»¶\n \n# ä»¥ä¸‹åº”ç”¨ï¼Œå®‰è£…åå…³é—­è‡ªåŠ¨æ£€æŸ¥æ›´æ–°\nbrew install --cask font-hack-nerd-font\nbrew install --cask maczip\nbrew install --cask wechatwebdevtools # å¾®ä¿¡å°ç¨‹åºå¼€å‘è€…å·¥å…·\nbrew install --cask mini-program-studio # æ”¯ä»˜å®å°ç¨‹åºå¼€å‘è€…å·¥å…·\nbrew install --cask macs-fan-control\nbrew install --cask mongodb-compass\nbrew install --cask another-redis-desktop-manager\nbrew install --cask iina # æœ¬åœ°éŸ³è§†é¢‘æ’­æ”¾å™¨\nbrew install --cask cheatsheet # å¿«æ·é”®æç¤º\n \nbrew install battery # https://github.com/actuallymentor/battery\nbrew install percona-toolkit # MySQL è¿ç»´å·¥å…·\n \nbrew install go\n  # æ·»åŠ ä»¥ä¸‹å†…å®¹åˆ° .zshrc æœ«å°¾\n  export PATH=&quot;/Users/wangze/go/bin:$PATH&quot;\n  export GO111MODULE=on\n  export GOPROXY=https://goproxy.cn\n# æ·»åŠ åˆ° ~/.zshrcï¼ˆéœ€è¦å…ˆé…ç½® Zshï¼‰\nalias updatebrew=&#039;brew cleanup --prune=all -q &amp;&amp; brew upgrade &amp;&amp; brew cu -ay &amp;&amp; brew uninstall node@14 node@16 node@18 node@19 --ignore-dependencies -f &amp;&amp; brew cleanup --prune=all -q &amp;&amp; npm update --location=global &amp;&amp; omz update&#039;\nAppStore Â§\n\nBob ç¿»è¯‘å’Œ OCR\niHosts\niShot Pro æˆªå›¾ã€å½•å±\nPasteNow å‰ªåˆ‡æ¿ã€å¤šè®¾å¤‡åŒæ­¥\nWPS Office\næ»´ç­”æ¸…å•\n\nè½¯ä»¶ Â§\n\n\nBartender 4 Take control of your Menu bar\n\n\nCapslock åŠ å¼º Caps é”®åŠŸèƒ½\n\n\nClashX Pro VPN\n\n\nChrome\n\nå®‰è£…åè®¿é—®ä¸€æ¬¡ ncr é¿å… Google é‡å®šå‘\n\n\n\nDocker Desktop\n\n\næ£€æŸ¥ Setting - Resources - Advanced çš„å†…å®¹\n\n\nåœ¨ Preferences - Docker Engine ä¸­å†™å…¥ä»¥ä¸‹å†…å®¹\n{\n    &quot;registry-mirrors&quot;: [\n        &quot;mirrors.ustc.edu.cn&quot;\n    ],\n    &quot;log-driver&quot;: &quot;json-file&quot;,\n    &quot;log-opts&quot;: {\n        &quot;max-size&quot;: &quot;10m&quot;,\n        &quot;max-file&quot;: &quot;1&quot;\n}\n\n\n\n\nGrammarly  å…¨å±€è‹±è¯­è¯­æ³•æ£€æŸ¥\n\n\niTerm2\n\n\nJetBrains Toolbox\n\n\nMac Mouse Fix\n\nMiddle Button\n\nClickï¼šMiddle Click\nClick And Dragï¼šMission Control &amp; Spaces\n\n\nInvert directionï¼šå–æ¶ˆå‹¾é€‰\n\n\n\nNavicat Premium\n\n\nObsidian\n\n\nOh My Zsh\n\n\nOneDrive\n\n\nParallels Desktop è™šæ‹Ÿæœº\n\nmain\n\n\n\nPicGo å›¾åºŠ\n\n\nPostman\n\n\nRaycast\n\n\nRectangle\n\n\nSourcetree Git å›¾å½¢å®¢æˆ·ç«¯\n\n\nTencent Lemon\n\n\nVMware Fusion å…è´¹è™šæ‹Ÿæœº\n\n\nVisual Studio Code\n\n\nWarp ç»ˆç«¯\n\n\nXmind\n\n\nå¾®ä¿¡\n\n\nå¾®ä¿¡é”®ç›˜\n\n\nç½‘æ˜“äº‘éŸ³ä¹\n\n\nç³»ç»Ÿè®¾ç½® Â§\n\n\næ‰“å¼€\n\nã€Œä¸‰æŒ‡æ‹–ç§»ã€\nè§¦æ§æ¿æ‰‹åŠ¿ - æ›´å¤šæ‰‹åŠ¿ -ã€ŒApp ExposÃ©ã€å››æŒ‡å‘ä¸‹æ¸…æ‰«\n\nã€Œä½¿çª—å£æŒ‰åº”ç”¨ç¨‹åºæˆç»„ã€\n\n\nã€Œä½¿ç”¨å¤§å†™é”å®šé”®åˆ‡æ¢â€œABCâ€è¾“å…¥æ³•ã€\nåœ¨æ»šåŠ¨æ¡ä¸­ç‚¹æŒ‰ã€Œè·³åˆ°ç‚¹æŒ‰çš„ä½ç½®ã€\né”®ç›˜å¿«æ·é”®\n\nè°ƒåº¦ä¸­å¿ƒï¼šCtrl + E\nè°ƒåº¦ä¸­å¿ƒ\n\nå‘å·¦ç§»åŠ¨ä¸€ä¸ªç©ºé—´ Ctrl + Q\nå‘å³ç§»åŠ¨ä¸€ä¸ªç©ºé—´ Ctrl + W\n\n\nåº”ç”¨ç¨‹åºçª—å£ï¼šCtrl + D\n\n\n\n\n\nå…³é—­\n\nè°ƒåº¦ä¸­å¿ƒ\n\nã€Œæ ¹æ®æœ€è¿‘çš„ä½¿ç”¨æƒ…å†µè‡ªåŠ¨é‡æ–°æ’åˆ—ç©ºé—´ã€\n\n\niCloud åŒæ­¥ã€Œæ¡Œé¢ä¸æ–‡ç¨¿æ–‡ä»¶å¤¹ã€\nã€Œåœ¨ç¨‹åºåä¸­æ˜¾ç¤ºæœ€è¿‘ä½¿ç”¨çš„åº”ç”¨ç¨‹åºã€\nã€Œè‡ªåŠ¨åˆ‡æ¢åˆ°æ–‡ç¨¿çš„è¾“å…¥æ³•ã€\nã€Œæ˜¾ç¤ºâ€œèšç„¦â€æœç´¢ã€ï¼šæœ‰ Raycast\nã€Œæ˜¾ç¤ºâ€œè®¿è¾¾â€æœç´¢çª—å£ã€ï¼šæœ‰ Raycast\n\n\n\nè®¾ç½® é˜¿é‡Œå…¬å…± DNS\n\nè®¾ç½®ä¼˜å…ˆçº§ï¼šè·¯ç”±å™¨ &gt; æœ¬æœº\n\n\n"},"å·¥å…·/Obsidian/Obsidian-æ’ä»¶":{"title":"Obsidian æ’ä»¶","links":[],"tags":["obsidian"],"content":"æ¨è Â§\n\nEnhancing Mindmap æ€ç»´å¯¼å›¾ï¼Œåªéœ€ä¿®æ”¹æ–‡æ¡£å¤´ï¼Œæ²¡æœ‰é¢å¤–å­¦ä¹ æˆæœ¬\nUpdate time on edit è‡ªåŠ¨æ›´æ–°æ–‡æ¡£çš„åˆ›å»ºã€æ›´æ–°æ—¶é—´\n\nå…¶ä»– Â§\n\n2022å¹´7æœˆï¼Œobsidian ä¾ç„¶å¿…è£…çš„ 10 ä¸ªæ’ä»¶\n\nå¾…æŠ˜è…¾ Â§\n\nç©è½¬ Obsidian 08ï¼šåˆ©ç”¨ Dataview æ‰“é€ è‡ªåŠ¨åŒ– HomePage | by é—²è€…æ—¶é—´ | Medium\n"},"å·¥å…·/Obsidian/Vault":{"title":"Vault","links":[],"tags":["obsidian"],"content":"\nä¿ç®¡åº“æ˜¯æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸Šçš„ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼ŒObsidian å°†æ‚¨çš„ç¬”è®°å­˜å‚¨åœ¨å…¶ä¸­ã€‚æ‚¨å¯ä»¥å°†æ‰€æœ‰ç¬”è®°ä¿å­˜åœ¨ä¸€ä¸ªä¿é™©åº“ä¸­ï¼Œæˆ–ä¸ºæ¯ä¸ªä¸åŒçš„é¡¹ç›®åˆ›å»ºå¤šä¸ªä¿é™©åº“ã€‚\n\nCreate a vault - Obsidian Help"},"å·¥å…·/è½¯ä»¶/Capslock":{"title":"Capslock","links":[],"tags":["è½¯ä»¶","å·¥å…·","mac"],"content":"åŠŸèƒ½ Â§\nåŠ å¼º Caps é”®åŠŸèƒ½\nå®‰è£… Â§\nGithub\nå•å‡» Caps åˆ‡æ¢è¾“å…¥æ³• Â§\n\næ‰“å¼€é…ç½®æ–‡ä»¶ ~/.config/karabiner/karabiner.json\nåšå¦‚ä¸‹ä¿®æ”¹ï¼š\n\næ‰¾åˆ° caps_lock çš„ to_if_alone\nå°† key_code æ”¹æˆ caps_lock\næ‰¾åˆ° spacebar = language switch\nåˆ é™¤æ‰€åœ¨ {} ä»£ç å—\n\n\nç›®çš„ï¼šç»´æŒå•ç‚¹ Caps åˆ‡æ¢è¾“å…¥æ³•\n"},"å·¥å…·/è½¯ä»¶/Crontab-æ‰§è¡Œæç¤ºæ²¡æœ‰æƒé™":{"title":"Crontab æ‰§è¡Œæç¤ºæ²¡æœ‰æƒé™","links":[],"tags":["linux","è‡ªåŠ¨åŒ–"],"content":"\nMac çš„è§£å†³æ–¹æ¡ˆï¼šHow to Fix Cron â€œOperation not permittedâ€ error in macOS - ITPro Helper\n"},"å·¥å…·/è½¯ä»¶/Linux-å®‰è£…-oh-my-zsh":{"title":"Linux å®‰è£… oh-my-zsh","links":[],"tags":["linux","zsh"],"content":"å®‰è£… Zsh Â§\n\n\nInstalling-ZSH\nsudo apt install zsh\n \n# æŸ¥çœ‹æ‰€æœ‰å¯ç”¨ shell\nchsh -l\n \n# å°†ç»ˆç«¯é»˜è®¤ shell åˆ‡æ¢åˆ° zshï¼Œåé¢è¦è¾“å…¥å®é™…çœ‹åˆ°çš„ zsh è·¯å¾„\nchsh -s /bin/zsh\n \n# æ–°å¼€ä¸€ä¸ªç»ˆç«¯ç¡®è®¤æ˜¯å¦åˆ‡æ¢æˆåŠŸ\necho $SHELL\n\n\nå®‰è£… Oh-my-zsh Â§\n\n#install\n\næ’ä»¶ Â§\n\ngit clone åˆ° .oh-my-zsh/custom/plugins\n\nINSTALL.md\nINSTALL.md#oh-my-zsh\n\n\nautojump\n\nUbuntuï¼šsudo apt install autojump\nCentosï¼šyum install aotojump-zsh\n\n\nä¿®æ”¹ ~/.zshrc æ–‡ä»¶çš„å†…å®¹\n\nplugins=(git autojump zsh-autosuggestions zsh-syntax-highlighting)\n\n\n"},"å·¥å…·/è½¯ä»¶/Obsidian":{"title":"Obsidian","links":[],"tags":["è½¯ä»¶"],"content":"\nå®˜ç½‘\nObsidian æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ä¸”å¯æ‰©å±•çš„çŸ¥è¯†åº“ï¼Œå®ƒåœ¨æ‚¨çš„æœ¬åœ°çº¯æ–‡æœ¬æ–‡ä»¶æ–‡ä»¶å¤¹ä¹‹ä¸Šè¿è¡Œã€‚\næ‚¨ç°åœ¨æµè§ˆçš„æ•°å­—èŠ±å›­çš„æ–‡æœ¬ç¼–è¾‘å™¨\n"},"å·¥å…·/è½¯ä»¶/Oh-My-Zsh":{"title":"Oh My Zsh","links":["%E5%B7%A5%E5%85%B7/%E8%BD%AF%E4%BB%B6/Linux-%E5%AE%89%E8%A3%85-oh-my-zsh"],"tags":["å·¥å…·","è½¯ä»¶"],"content":"Linux ç”¨æˆ·è¯·çœ‹ï¼šLinux å®‰è£… oh-my-zsh\nå®‰è£… Â§\n\nåˆ‡æ¢åˆ°ç³»ç»Ÿè‡ªå¸¦çš„ Zshï¼šchsh -s /bin/zsh\nOh My Zsh\n\nç³»ç»Ÿç»ˆç«¯çš„é…è‰²æ–¹æ¡ˆ Â§\n\n\nPowerlevel10k\n\n\nä¸‹è½½\ncd ~/Downloads\ngit clone git://github.com/altercation/solarized.git\n\n\næ‰“å¼€ç»ˆç«¯ï¼ŒæŒ‰ã€ŒâŒ˜ + ,ã€æ‰“å¼€ç»ˆç«¯åå¥½è®¾ç½®ï¼Œç‚¹å‡»ã€Œæè¿°æ–‡ä»¶ &gt; âš™ï¸âŒ„ &gt; å¯¼å…¥ã€ï¼Œé€‰æ‹©ã€Œosx-terminalâ€¦ors-solarized/xterm 256 colorã€\n\n\næ’ä»¶ Â§\nbrew install autojump\nbrew install zsh-syntax-highlighting\nbrew install zsh-autosuggestions\n \n# æ·»åŠ ä»¥ä¸‹å†…å®¹åˆ° .zshrc æ–‡ä»¶æœ«å°¾ï¼ˆä¸Šé¢ä¸‰æ¡å‘½ä»¤è¿è¡Œç»“æŸä¼šæœ‰æç¤ºï¼‰\n \n# zsh plugins\nsource /opt/homebrew/share/zsh-autosuggestions/zsh-autosuggestions.zsh\nsource /opt/homebrew/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh\n[ -f /opt/homebrew/etc/profile.d/autojump.sh ] &amp;&amp; . /opt/homebrew/etc/profile.d/autojump.sh\nHIST_STAMPS=&quot;mm/dd/yyyy&quot;"},"å·¥å…·/è½¯ä»¶/æ²¹çŒ´è„šæœ¬":{"title":"æ²¹çŒ´è„šæœ¬","links":[],"tags":["æ²¹çŒ´","ç¯¡æ”¹çŒ´","tampermonkey","chrome","æ’ä»¶"],"content":"å®‰è£…è¯´æ˜ Â§\n\nGreasy Fork - safe and useful user scripts\n\næˆ‘å‘å¸ƒçš„è„šæœ¬ Â§\n\nuser-scripts\n\næ¨èè„šæœ¬ Â§\n\nEndless Google: Google æœç´¢ç»“æœåˆ—è¡¨å¯ä»¥æ— é™ä¸‹æ‹‰\nredirect å¤–é“¾è·³è½¬: ä» QQ é‚®ç®±ã€çŸ¥ä¹ç­‰ç½‘ç«™ç‚¹å‡»å¤–é“¾æ—¶è‡ªåŠ¨è·³è½¬ï¼Œå…å»ç‚¹å‡»æ­¥éª¤\n"},"ç®¡ç†èŠ±å›­/æ­å»º/å‘å¸ƒæ–¹æ¡ˆ":{"title":"å‘å¸ƒæ–¹æ¡ˆ","links":[],"tags":["æ­å»º","æœªå®Œæˆ"],"content":"é€‰ç”¨æ–¹æ¡ˆ Â§\n\nquartz\n\næ€ä¹ˆåš Â§\næ³¨æ„äº‹é¡¹ Â§\nå‚è€ƒæ–‡ç«  Â§"},"ç®¡ç†èŠ±å›­/æ­å»º/åŒæ­¥æ–¹æ¡ˆ":{"title":"åŒæ­¥æ–¹æ¡ˆ","links":["%E5%B7%A5%E5%85%B7/%E8%BD%AF%E4%BB%B6/Obsidian","%E5%B7%A5%E5%85%B7/Obsidian/Vault","%E5%B7%A5%E5%85%B7/Mac/iCloud-%E5%90%8C%E6%AD%A5%E5%8D%A1%E4%BD%8F"],"tags":["æ­å»º","icloud","åŒæ­¥"],"content":"å¤šç§æ–¹æ¡ˆ Â§\n\nObsidian Syncï¼šå®˜æ–¹ï¼Œè¦é’±\nRemotely Syncï¼šç¬¬ä¸‰æ–¹æ’ä»¶ï¼Œä½†è‡ªåŠ¨åŒæ­¥æœ€çŸ­é—´éš” 1 åˆ†é’Ÿï¼ˆå¯ä»¥æ‰‹åŠ¨åŒæ­¥ï¼‰ï¼Œå…è´¹\niCloudï¼šå®æ—¶åŒæ­¥ï¼Œå…è´¹\n\næˆ‘ä½¿ç”¨çš„åŒæ­¥æ–¹æ¡ˆï¼ˆiCloudï¼‰ Â§\nä¼˜ç‚¹ Â§\nå…è´¹å®æ—¶åŒæ­¥æ–‡æ¡£ã€æ’ä»¶ã€è®¾ç½®\næ€ä¹ˆåš Â§\næˆ‘çš„è®¾å¤‡ï¼šiPhone + MacBook\n\n\niPhone å®‰è£… Obsidian\n\n\nè¿›å…¥ Obsidian åˆ›å»ºä¸€ä¸ªæ‰“å¼€ iCloud åŒæ­¥åŠŸèƒ½çš„ Vault\n\n\n\n\n\næ­¤æ—¶ iCloud ä¸­ä¼šç”Ÿæˆ Vault ç›®å½•\n\n\n\n\n\nMacBook å®‰è£… Obsidian\n\n\nç”¨ Obsidian æ‰“å¼€ 2 åˆ›å»ºçš„ç›®å½•\n\n\né‡åˆ°çš„é—®é¢˜ Â§\n\niCloud åŒæ­¥å¡ä½\n"},"ç®¡ç†èŠ±å›­/æ­å»º/æ¢æ–°è®¾å¤‡":{"title":"æ¢æ–°è®¾å¤‡","links":["%E5%B7%A5%E5%85%B7/Obsidian/Vault","%E7%AE%A1%E7%90%86%E8%8A%B1%E5%9B%AD/%E6%90%AD%E5%BB%BA/%E5%90%8C%E6%AD%A5%E6%96%B9%E6%A1%88"],"tags":["æ­å»º"],"content":"æ¨èåšæ³• Â§\n\nclone æ–‡æ¡£ä»“åº“åˆ°æœ¬åœ°\nå°† .git ç§»åˆ° iCloud çš„ Obsidian ç›®å½•ä¸‹çš„èŠ±å›­ Vault æ ¹ç›®å½•\n\nå¼ºçƒˆä¸æ¨èåšæ³• Â§\n\nåˆ æ‰ iCloud é‡Œçš„ Vault\nå†èµ°ä¸€é åŒæ­¥æ–¹æ¡ˆ\n"},"ç®¡ç†èŠ±å›­/æ­å»º/æ­å»ºæ•°å­—èŠ±å›­":{"title":"æ­å»ºæ•°å­—èŠ±å›­","links":["%E7%AE%A1%E7%90%86%E8%8A%B1%E5%9B%AD/%E6%90%AD%E5%BB%BA/%E5%90%8C%E6%AD%A5%E6%96%B9%E6%A1%88","%E7%AE%A1%E7%90%86%E8%8A%B1%E5%9B%AD/%E6%90%AD%E5%BB%BA/%E5%8F%91%E5%B8%83%E6%96%B9%E6%A1%88","%E7%AE%A1%E7%90%86%E8%8A%B1%E5%9B%AD/%E6%90%AD%E5%BB%BA/%E9%85%8D%E7%BD%AE%E8%87%AA%E5%AE%9A%E4%B9%89%E5%9F%9F%E5%90%8D","%E7%AE%A1%E7%90%86%E8%8A%B1%E5%9B%AD/%E6%90%AD%E5%BB%BA/%E6%B7%BB%E5%8A%A0%E8%AF%84%E8%AE%BA%E5%8C%BA","%E7%AE%A1%E7%90%86%E8%8A%B1%E5%9B%AD/%E6%90%AD%E5%BB%BA/%E9%85%8D%E7%BD%AE%E5%9B%BE%E5%BA%8A","%E7%AE%A1%E7%90%86%E8%8A%B1%E5%9B%AD/%E6%90%AD%E5%BB%BA/%E9%85%8D%E7%BD%AE-Google-Analytics","%E7%AE%A1%E7%90%86%E8%8A%B1%E5%9B%AD/%E6%90%AD%E5%BB%BA/%E6%9C%AC%E5%BA%93%E8%87%AA%E5%8A%A8%E6%8F%90%E4%BA%A4%E5%88%B0-GitHub","%E7%AE%A1%E7%90%86%E8%8A%B1%E5%9B%AD/%E6%90%AD%E5%BB%BA/%E6%9C%AC%E5%9C%B0%E9%A2%84%E8%A7%88","%E5%B7%A5%E5%85%B7/Mac/iCloud-%E4%B8%8D%E5%90%8C%E6%AD%A5%E6%8C%87%E5%AE%9A%E6%96%87%E4%BB%B6","%E7%AE%A1%E7%90%86%E8%8A%B1%E5%9B%AD/%E6%90%AD%E5%BB%BA/%E6%8D%A2%E6%96%B0%E8%AE%BE%E5%A4%87","%E7%AE%A1%E7%90%86%E8%8A%B1%E5%9B%AD/%E9%97%AE%E9%A2%98/%E9%97%AE%E9%A2%98%E5%90%88%E9%9B%86"],"tags":["æ­å»º"],"content":"\nåŒæ­¥æ–¹æ¡ˆ\nå‘å¸ƒæ–¹æ¡ˆ\né…ç½®è‡ªå®šä¹‰åŸŸå\næ·»åŠ è¯„è®ºåŒº\né…ç½®å›¾åºŠ\né…ç½® Google Analytics\næœ¬åº“è‡ªåŠ¨æäº¤åˆ° GitHub\næœ¬åœ°é¢„è§ˆ\nä¸åŒæ­¥ .git æ–‡ä»¶å¤¹\næ¢æ–°è®¾å¤‡\né—®é¢˜åˆé›†\n"},"ç®¡ç†èŠ±å›­/æ­å»º/æœ¬åœ°é¢„è§ˆ":{"title":"æœ¬åœ°é¢„è§ˆ","links":[],"tags":["æ­å»º","hugo"],"content":"å‡†å¤‡ Â§\n\nâš ï¸ ä¸è¦åœ¨ä½ æ­£å¼å†™ç¬”è®°çš„å‘å¸ƒä»“åº“å’Œæ–‡æ¡£ä»“åº“é‡Œæ“ä½œ\nå¤åˆ¶ä½ è¦é¢„è§ˆçš„ä»“åº“åˆ°æ–°æ–‡ä»¶å¤¹\nè¿›å…¥æ–°æ–‡ä»¶å¤¹\n\nå°†ç¬”è®°è½¬æˆå‘å¸ƒä»“åº“æ”¯æŒçš„æ ¼å¼ Â§\nâš ï¸ è¿™ä¸€æ­¥ä¼šä¿®æ”¹ä½ çš„ç¬”è®°æ–‡æ¡£\ngit submodule update --init --recursive\n \nrm -rf content/.obsidian content/cedict_ts.u8 content/Extras/Templates  &amp;&amp; mv content/*.md content/Atlas &amp;&amp; find content/ -name &quot;*.md&quot; | xargs -I file  mv -f file content &amp;&amp;  mv content/AboutTheGarden.md content/_index.md\n \nls content/ &amp;&amp; grep -lr --null &#039;title&#039; content/* | xargs -0 sed -i -E -r &#039;s/title: (.*)/title: &quot;\\1&quot;/g&#039;\n \nrm -rf content/*.md-E\nå¯åŠ¨æœåŠ¡ Â§\nä¸‹é¢çš„å‘½ä»¤éœ€è¦å»é™¤ç‰ˆæœ¬å·å‰çš„ç©ºæ ¼\ngo install github.com/jackyzha0/hugo-obsidian@ latest\nhugo-obsidian -input=content -output=assets/indices -index -root=.\n \ngo install github.com/gohugoio/hugo@ v0.96.0\nhugo server\nå‚è€ƒ Â§\n\nPreview Changes\n"},"ç®¡ç†èŠ±å›­/æ­å»º/æœ¬åº“è‡ªåŠ¨æäº¤åˆ°-GitHub":{"title":"æœ¬åº“è‡ªåŠ¨æäº¤åˆ° GitHub","links":["%E5%B7%A5%E5%85%B7/%E8%BD%AF%E4%BB%B6/Crontab-%E6%89%A7%E8%A1%8C%E6%8F%90%E7%A4%BA%E6%B2%A1%E6%9C%89%E6%9D%83%E9%99%90"],"tags":["æ­å»º"],"content":"\né…ç½® crontab æ¯å¤©è‡ªåŠ¨æ‰§è¡Œ auto_push.sh\n\nå¯èƒ½é‡åˆ°çš„é—®é¢˜ï¼šCrontab æ‰§è¡Œæç¤ºæ²¡æœ‰æƒé™\n\n\nç”±äºå·²é…ç½® GitHub Actionï¼Œè‡ªåŠ¨æäº¤åä¼šè§¦å‘ Action è‡ªåŠ¨éƒ¨ç½²ç½‘ç«™\n"},"ç®¡ç†èŠ±å›­/æ­å»º/æ·»åŠ è¯„è®ºåŒº":{"title":"æ·»åŠ è¯„è®ºåŒº","links":[],"tags":["æ­å»º","è¯„è®ºåŒº","æœªå®Œæˆ"],"content":"Quartz å‘å¸ƒ v4ï¼Œå¾…æ›´æ–°æ­¤æ–‡ç« \n\nåˆ° giscus ç”Ÿæˆè‡ªå·±çš„è¯„è®ºåŒºä»£ç å¹¶å¤åˆ¶\nåˆ°å‘å¸ƒä»“åº“æ‰¾åˆ°ä»¥ä¸‹æ–‡ä»¶ï¼Œå°†ä»£ç ç²˜è´´åˆ°å›¾ä¸­çº¢æ¡†ä½ç½®\n\n\n\n\n"},"ç®¡ç†èŠ±å›­/æ­å»º/é…ç½®-Google-Analytics":{"title":"é…ç½® Google Analytics","links":[],"tags":["æ­å»º","google","æœªå®Œæˆ"],"content":"Quartz å‘å¸ƒ v4ï¼Œå¾…æ›´æ–°æ­¤æ–‡ç« \né…ç½®æ–¹æ³• Â§\n\nåˆ° Google Analyticsï¼ˆåˆ†æï¼‰ åˆ›å»ºä¸€ä¸ªåª’ä½“èµ„æºå¹¶è·å– ID\n\n\n\n\næ‰“å¼€å‘å¸ƒä»“åº“æ ¹ç›®å½•ä¸‹çš„ config.toml æ–‡ä»¶\nå†™å…¥ï¼šgoogleAnalytics = &quot;G-XXX&quot;\næ‰“å¼€å‘å¸ƒä»“åº“çš„ layouts/partials/header.html æ–‡ä»¶\nåœ¨æœ«å°¾å†™å…¥ï¼š{{ template &quot;_internal/google_analytics.html&quot; . }}\n\nå‚è€ƒæ–‡ç«  Â§\n\nGoogle Analytics | Hugo\n"},"ç®¡ç†èŠ±å›­/æ­å»º/é…ç½®å›¾åºŠ":{"title":"é…ç½®å›¾åºŠ","links":[],"tags":["æ­å»º","å›¾åºŠ","picgo","jsdelivr"],"content":"\nä½¿ç”¨ PicGo + Github + JSD æ­å»ºå…è´¹å›¾åºŠ | ZeaLotSean\njsDelivr\n"},"ç®¡ç†èŠ±å›­/æ­å»º/é…ç½®è‡ªå®šä¹‰åŸŸå":{"title":"é…ç½®è‡ªå®šä¹‰åŸŸå","links":[],"tags":["æ­å»º","åŸŸå","vercel","cloudflare"],"content":"Vercel + Cloudflare Â§\n\nHow to Use a Cloudflare Domain with Vercel\n\n\n\n"},"ç®¡ç†èŠ±å›­/é—®é¢˜/å‘å¸ƒç¬”è®°-404":{"title":"ç¬”è®° 404","links":["2023-05-12","%E5%B7%A5%E5%85%B7/%E8%BD%AF%E4%BB%B6/%E6%B2%B9%E7%8C%B4%E8%84%9A%E6%9C%AC","ISO8601"],"tags":["æ­å»º"],"content":"\n\nè®°å½•æ­¤é—®é¢˜çš„æ—¶é—´ï¼š2023-05-12 01:26 ä¸œå…«åŒº\n\n\nç°è±¡ï¼š\n\næ²¹çŒ´è„šæœ¬ åœ¨ 2023-05-12 0 ç‚¹åˆ›å»ºï¼Œå‘å¸ƒå¤±è´¥ï¼Œæ”¹æˆ 2023-05-11ï¼Œå‘å¸ƒæˆåŠŸ\nç¬”è®°å‡ºç°åœ¨æœç´¢ç»“æœï¼Œç‚¹å‡»è‡ªåŠ¨è·³è½¬åˆ° 404 é¡µé¢\n\n\n\nçŒœæµ‹ï¼šæ‰§è¡Œå‘å¸ƒçš„ GitHub Action æœåŠ¡å™¨æ—¶é—´æ¯”æ–‡æ¡£å¤´æ ‡è®°çš„åˆ›å»ºæ—¶é—´æ—©ï¼Œæ–‡æ¡£å±äºæœªæ¥ï¼Œæ‰€ä»¥æœªå‘å¸ƒæˆåŠŸ\n\n\n2023-05-12 08:00 å°è¯•å‘å¸ƒæˆåŠŸ\n\n\nè§£å†³æ–¹æ³•ï¼šä½¿ç”¨ ISO8601 æ ¼å¼çš„æ—¥æœŸ\n\n\nPage Variables | Hugo\n\n"},"ç®¡ç†èŠ±å›­/é—®é¢˜/æ–‡ç« æœ€åæ›´æ–°æ—¶é—´é”™è¯¯":{"title":"æ–‡ç« æœ€åæ›´æ–°æ—¶é—´é”™è¯¯","links":[],"tags":["æ­å»º"],"content":"è§£å†³æ–¹æ³• Â§\n\n\nåœ¨å‘å¸ƒä»“åº“åšå¦‚ä¸‹ä¿®æ”¹ï¼Œè®© Lastmod æ¯” Date ä¼˜å…ˆçº§é«˜\n\n\n\n\n\nä¿®æ”¹å‘å¸ƒä»“åº“çš„ GitHub Actionï¼šHugo å’Œ Github Action æ­£ç¡®ä¿®æ”¹æ–‡ç« çš„æœ€åæ›´æ–°æ—¥æœŸ\n\n\nä¿®æ”¹æ–‡æ¡£ä»“åº“çš„ GitHub Action\n\n\nåœ¨æ‰€æœ‰ md æ–‡ä»¶çš„ç¬¬ 2 è¡Œæ’å…¥ lastmod: æ–‡ä»¶åœ¨ git è®°å½•çš„æœ€åä¿®æ”¹æ—¶é—´\nfind . -name &quot;*.md&quot; -type f -print0 | while read -d $&#039;\\0&#039; file\ndo\n    # get file modification time from git\n    modified=$(git log -1 --pretty=&#039;format:%cd&#039; --date=format:&#039;%Y-%m-%dT%H:%M:%S+0800&#039; $file)\n \n    # replace lastmod value with the file modification time\n    sed -i &#039;&#039; &#039;2i\\\nlastmod: &#039;${modified}&#039;\\\n&#039; &quot;$file&quot;\ndone\n\n\n\n\n\n\n20230515ï¼šæœªè§£å†³ï¼Œå…ˆç”¨ createdAt\n"},"ç®¡ç†èŠ±å›­/é—®é¢˜/ç‰¹æ®Šå­—ç¬¦":{"title":"ç‰¹æ®Šå­—ç¬¦","links":[],"tags":["æ­å»º","hugo","quartz"],"content":"\n&amp;#64 è¡¨ç¤ºé‚®ç®±çš„ at ç¬¦å·ï¼Œå¦åˆ™å‘å¸ƒåæ˜¾ç¤º email protected\n\nä¸Šé¢çš„ç¼–ç åœ¨ä»£ç å—é‡Œæ— æ•ˆï¼Œä½†ç›´æ¥ç”¨ at ç¬¦å·ä¼šè¢«å½“æˆé‚®ç®±\n\n\n"},"ç®¡ç†èŠ±å›­/é—®é¢˜/é—®é¢˜åˆé›†":{"title":"é—®é¢˜åˆé›†","links":["%E7%AE%A1%E7%90%86%E8%8A%B1%E5%9B%AD/%E9%97%AE%E9%A2%98/%E5%8F%91%E5%B8%83%E7%AC%94%E8%AE%B0-404","%E7%AE%A1%E7%90%86%E8%8A%B1%E5%9B%AD/%E9%97%AE%E9%A2%98/%E6%96%87%E7%AB%A0%E6%9C%80%E5%90%8E%E6%9B%B4%E6%96%B0%E6%97%B6%E9%97%B4%E9%94%99%E8%AF%AF"],"tags":["æ­å»º"],"content":"\nå‘å¸ƒç¬”è®° 404\næ–‡ç« æœ€åæ›´æ–°æ—¶é—´é”™è¯¯\n"}}